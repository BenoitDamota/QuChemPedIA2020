<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">n</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="STRN">"function"</span><span class="PUNC">==</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">&&</span><span class="NAME">require</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">f</span><span class="PUNC">&&</span><span class="NAME">c</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">u</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">u</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Cannot find module '"</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">+</span><span class="STRN">"'"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">a.code</span><span class="PUNC">=</span><span class="STRN">"MODULE_NOT_FOUND"</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">=</span><span class="NAME">n</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">exports</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">call</span><span class="PUNC">(</span><span class="NAME">p.exports</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">r</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">||</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">,</span><span class="NAME">p.exports</span><span class="PUNC">,</span><span class="NAME">r</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">exports</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">u</span><span class="PUNC">=</span><span class="STRN">"function"</span><span class="PUNC">==</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">&&</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">t.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">o</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="WHIT">  
<span class='line'>  4</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Drawer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./src/Drawer'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="WHIT">  
<span class='line'>  7</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Parser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./src/Parser'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  8</span> </span><span class="WHIT">  
<span class='line'>  9</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">SvgDrawer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./src/SvgDrawer'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Detect SSR (server side rendering)</span><span class="WHIT">
<span class='line'> 10</span> </span><span class="WHIT">  
<span class='line'> 11</span>   
<span class='line'> 12</span>   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canUseDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">window</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">window.document</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">window.document.createElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 13</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'> 14</span>    * The SmilesDrawer namespace.
<span class='line'> 15</span>    * @typicalname SmilesDrawer
<span class='line'> 16</span>    */</span><span class="WHIT">
<span class='line'> 17</span> </span><span class="WHIT">  
<span class='line'> 18</span>   </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SmilesDrawer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="WHIT">    </span><span class="NAME">Version</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'1.0.0'</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="WHIT">  </span><span class="NAME">SmilesDrawer.Drawer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Drawer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">  </span><span class="NAME">SmilesDrawer.Parser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Parser</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="WHIT">  </span><span class="NAME">SmilesDrawer.SvgDrawer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SvgDrawer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'> 25</span>   * Cleans a SMILES string (removes non-valid characters)
<span class='line'> 26</span>   *
<span class='line'> 27</span>   * @static
<span class='line'> 28</span>   * @param {String} smiles A SMILES string.
<span class='line'> 29</span>   * @returns {String} The clean SMILES string.
<span class='line'> 30</span>   */</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="WHIT">  
<span class='line'> 32</span>   </span><span class="NAME">SmilesDrawer.clean</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">smiles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">smiles.replace</span><span class="PUNC">(</span><span class="REGX">/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}/</span><span class="TOKN">\</span><span class="TOKN">\</span><span class="PUNC">=</span><span class="TOKN">#</span><span class="TOKN">\</span><span class="NAME">$</span><span class="PUNC">:</span><span class="TOKN">\</span><span class="PUNC">*</span><span class="PUNC">]</span><span class="PUNC">/</span><span class="NAME">g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'> 36</span>   * Applies the smiles drawer draw function to each canvas element that has a smiles string in the data-smiles attribute.
<span class='line'> 37</span>   *
<span class='line'> 38</span>   * @static
<span class='line'> 39</span>   * @param {Object} options SmilesDrawer options.
<span class='line'> 40</span>   * @param {String} [selector='canvas[data-smiles]'] Selectors for the draw areas (canvas elements).
<span class='line'> 41</span>   * @param {String} [themeName='light'] The theme to apply.
<span class='line'> 42</span>   * @param {Function} [onError='null'] A callback function providing an error object.
<span class='line'> 43</span>   */</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">  
<span class='line'> 45</span>   
<span class='line'> 46</span>   </span><span class="NAME">SmilesDrawer.apply</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'canvas[data-smiles]'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">themeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'light'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">onError</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="WHIT">    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">smilesDrawer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Drawer</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">    </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.querySelectorAll</span><span class="PUNC">(</span><span class="NAME">selector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="WHIT">  
<span class='line'> 50</span>     </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">elements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="WHIT">      </span><span class="NAME">SmilesDrawer.parse</span><span class="PUNC">(</span><span class="NAME">element.getAttribute</span><span class="PUNC">(</span><span class="STRN">'data-smiles'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tree</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="WHIT">        </span><span class="NAME">smilesDrawer.draw</span><span class="PUNC">(</span><span class="NAME">tree</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">themeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">onError</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="WHIT">          </span><span class="NAME">onError</span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'> 62</span>   * Parses the entered smiles string.
<span class='line'> 63</span>   * 
<span class='line'> 64</span>   * @static
<span class='line'> 65</span>   * @param {String} smiles A SMILES string.
<span class='line'> 66</span>   * @param {Function} successCallback A callback that is called on success with the parse tree.
<span class='line'> 67</span>   * @param {Function} errorCallback A callback that is called with the error object on error.
<span class='line'> 68</span>   */</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">  
<span class='line'> 70</span>   
<span class='line'> 71</span>   </span><span class="NAME">SmilesDrawer.parse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">smiles</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">successCallback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">errorCallback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 73</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">successCallback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">        </span><span class="NAME">successCallback</span><span class="PUNC">(</span><span class="NAME">Parser.parse</span><span class="PUNC">(</span><span class="NAME">smiles</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 75</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 76</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 77</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">errorCallback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 78</span> </span><span class="WHIT">        </span><span class="NAME">errorCallback</span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 82</span> </span><span class="WHIT">  
<span class='line'> 83</span>   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canUseDOM</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 84</span> </span><span class="WHIT">    </span><span class="NAME">window.SmilesDrawer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SmilesDrawer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 85</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// There be dragons (polyfills)</span><span class="WHIT">
<span class='line'> 86</span> </span><span class="WHIT">  
<span class='line'> 87</span>   
<span class='line'> 88</span>   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Array.prototype.fill</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="WHIT">    </span><span class="NAME">Object.defineProperty</span><span class="PUNC">(</span><span class="NAME">Array.prototype</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="WHIT">      </span><span class="NAME">value</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="WHIT">        </span><span class="COMM">// Steps 1-2.</span><span class="WHIT">
<span class='line'> 92</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">this</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 93</span> </span><span class="WHIT">          </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TypeError</span><span class="PUNC">(</span><span class="STRN">'this is null or not defined'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 94</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 95</span> </span><span class="WHIT">  
<span class='line'> 96</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">O</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Steps 3-5.</span><span class="WHIT">
<span class='line'> 97</span> </span><span class="WHIT">  
<span class='line'> 98</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">O.length</span><span class="WHIT"> </span><span class="PUNC">>>></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Steps 6-7.</span><span class="WHIT">
<span class='line'> 99</span> </span><span class="WHIT">  
<span class='line'>100</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">relativeStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">>></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Step 8.</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">  
<span class='line'>103</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">relativeStart</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">relativeStart</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">relativeStart</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Steps 9-10.</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">  
<span class='line'>105</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>106</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">relativeEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">>></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Step 11.</span><span class="WHIT">
<span class='line'>107</span> </span><span class="WHIT">  
<span class='line'>108</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">final</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">relativeEnd</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">relativeEnd</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">relativeEnd</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Step 12.</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">  
<span class='line'>110</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">final</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>111</span> </span><span class="WHIT">          </span><span class="NAME">O</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">          </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Step 13.</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">  
<span class='line'>115</span>   
<span class='line'>116</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">O</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">  
<span class='line'>121</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SmilesDrawer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">  
<span class='line'>123</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./src/Drawer"</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="STRN">"./src/Parser"</span><span class="PUNC">:</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="STRN">"./src/SvgDrawer"</span><span class="PUNC">:</span><span class="NUMB">14</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>124</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>125</span> </span><span class="WHIT">  
<span class='line'>126</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">  
<span class='line'>128</span>   </span><span class="COMM">/** 
<span class='line'>129</span>    * A static class containing helper functions for array-related tasks. 
<span class='line'>130</span>    */</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">  </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">ArrayHelper</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>133</span>      * Clone an array or an object. If an object is passed, a shallow clone will be created.
<span class='line'>134</span>      *
<span class='line'>135</span>      * @static
<span class='line'>136</span>      * @param {*} arr The array or object to be cloned.
<span class='line'>137</span>      * @returns {*} A clone of the array or object.
<span class='line'>138</span>      */</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">    </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">clone</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>140</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array.isArray</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>141</span> </span><span class="WHIT">  
<span class='line'>142</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>143</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>144</span> </span><span class="WHIT">  
<span class='line'>145</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value.clone</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'function'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>146</span> </span><span class="WHIT">          </span><span class="NAME">out</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">          </span><span class="NAME">out</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.clone</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">  
<span class='line'>152</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>153</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>155</span>      * Returns a boolean indicating whether or not the two arrays contain the same elements.
<span class='line'>156</span>      * Only supports 1d, non-nested arrays.
<span class='line'>157</span>      *
<span class='line'>158</span>      * @static
<span class='line'>159</span>      * @param {Array} arrA An array.
<span class='line'>160</span>      * @param {Array} arrB An array.
<span class='line'>161</span>      * @returns {Boolean} A boolean indicating whether or not the two arrays contain the same elements.
<span class='line'>162</span>      */</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">  
<span class='line'>164</span>   
<span class='line'>165</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">equals</span><span class="PUNC">(</span><span class="NAME">arrA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arrA.length</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">arrB.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>168</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>169</span> </span><span class="WHIT">  
<span class='line'>170</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmpA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrA.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>171</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmpB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrB.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>172</span> </span><span class="WHIT">  
<span class='line'>173</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">tmpA.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>174</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tmpA</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">tmpB</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>175</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>176</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>178</span> </span><span class="WHIT">  
<span class='line'>179</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>180</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>182</span>      * Returns a string representation of an array. If the array contains objects with an id property, the id property is printed for each of the elements.
<span class='line'>183</span>      *
<span class='line'>184</span>      * @static
<span class='line'>185</span>      * @param {Object[]} arr An array.
<span class='line'>186</span>      * @param {*} arr[].id If the array contains an object with the property 'id', the properties value is printed. Else, the array elements value is printend.
<span class='line'>187</span>      * @returns {String} A string representation of the array.
<span class='line'>188</span>      */</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">  
<span class='line'>190</span>   
<span class='line'>191</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">print</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>192</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arr.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">  
<span class='line'>196</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'('</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">  
<span class='line'>198</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>199</span> </span><span class="WHIT">        </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">', '</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">', '</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>200</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>201</span> </span><span class="WHIT">  
<span class='line'>202</span>       </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>203</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>204</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>206</span>      * Run a function for each element in the array. The element is supplied as an argument for the callback function
<span class='line'>207</span>      *
<span class='line'>208</span>      * @static
<span class='line'>209</span>      * @param {Array} arr An array.
<span class='line'>210</span>      * @param {Function} callback The callback function that is called for each element.
<span class='line'>211</span>      */</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">  
<span class='line'>213</span>   
<span class='line'>214</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">each</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">        </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>220</span>      * Return the array element from an array containing objects, where a property of the object is set to a given value.
<span class='line'>221</span>      *
<span class='line'>222</span>      * @static
<span class='line'>223</span>      * @param {Array} arr An array.
<span class='line'>224</span>      * @param {(String|Number)} property A property contained within an object in the array.
<span class='line'>225</span>      * @param {(String|Number)} value The value of the property.
<span class='line'>226</span>      * @returns {*} The array element matching the value.
<span class='line'>227</span>      */</span><span class="WHIT">
<span class='line'>228</span> </span><span class="WHIT">  
<span class='line'>229</span>   
<span class='line'>230</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">get</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">property</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>235</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>236</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>237</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>238</span>      * Checks whether or not an array contains a given value. the options object passed as a second argument can contain three properties. value: The value to be searched for. property: The property that is to be searched for a given value. func: A function that is used as a callback to return either true or false in order to do a custom comparison.
<span class='line'>239</span>      *
<span class='line'>240</span>      * @static
<span class='line'>241</span>      * @param {Array} arr An array.
<span class='line'>242</span>      * @param {Object} options See method description.
<span class='line'>243</span>      * @param {*} options.value The value for which to check.
<span class='line'>244</span>      * @param {String} [options.property=undefined] The property on which to check.
<span class='line'>245</span>      * @param {Function} [options.func=undefined] A custom property function.
<span class='line'>246</span>      * @returns {Boolean} A boolean whether or not the array contains a value.
<span class='line'>247</span>      */</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">  
<span class='line'>249</span>   
<span class='line'>250</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">contains</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">options.property</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">options.func</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>253</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">options.value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">options.func</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">options.func</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">options.property</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">options.value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>268</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>269</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">  
<span class='line'>271</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>272</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>273</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>274</span>      * Returns an array containing the intersection between two arrays. That is, values that are common to both arrays.
<span class='line'>275</span>      *
<span class='line'>276</span>      * @static
<span class='line'>277</span>      * @param {Array} arrA An array.
<span class='line'>278</span>      * @param {Array} arrB An array.
<span class='line'>279</span>      * @returns {Array} The intersecting vlaues.
<span class='line'>280</span>      */</span><span class="WHIT">
<span class='line'>281</span> </span><span class="WHIT">  
<span class='line'>282</span>   
<span class='line'>283</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">intersection</span><span class="PUNC">(</span><span class="NAME">arrA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">intersection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">  
<span class='line'>286</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arrA.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arrB.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arrA</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">arrB</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>289</span> </span><span class="WHIT">            </span><span class="NAME">intersection.push</span><span class="PUNC">(</span><span class="NAME">arrA</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>290</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>292</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>293</span> </span><span class="WHIT">  
<span class='line'>294</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">intersection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>295</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>297</span>      * Returns an array of unique elements contained in an array.
<span class='line'>298</span>      *
<span class='line'>299</span>      * @static
<span class='line'>300</span>      * @param {Array} arr An array.
<span class='line'>301</span>      * @returns {Array} An array of unique elements contained within the array supplied as an argument.
<span class='line'>302</span>      */</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">  
<span class='line'>304</span>   
<span class='line'>305</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">unique</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>306</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">contains</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arr.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">        </span><span class="COMM">// using !== instead of hasOwnProperty (http://andrew.hedges.name/experiments/in/)</span><span class="WHIT">
<span class='line'>309</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">contains</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">contains</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>310</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>311</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>313</span>      * Count the number of occurences of a value in an array.
<span class='line'>314</span>      *
<span class='line'>315</span>      * @static
<span class='line'>316</span>      * @param {Array} arr An array.
<span class='line'>317</span>      * @param {*} value A value to be counted.
<span class='line'>318</span>      * @returns {Number} The number of occurences of a value in the array.
<span class='line'>319</span>      */</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">  
<span class='line'>321</span>   
<span class='line'>322</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>323</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span> </span><span class="WHIT">  
<span class='line'>325</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">          </span><span class="NAME">count</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>328</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT">  
<span class='line'>331</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>332</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>334</span>      * Toggles the value of an array. If a value is not contained in an array, the array returned will contain all the values of the original array including the value. If a value is contained in an array, the array returned will contain all the values of the original array excluding the value.
<span class='line'>335</span>      *
<span class='line'>336</span>      * @static
<span class='line'>337</span>      * @param {Array} arr An array.
<span class='line'>338</span>      * @param {*} value A value to be toggled.
<span class='line'>339</span>      * @returns {Array} The toggled array.
<span class='line'>340</span>      */</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">  
<span class='line'>342</span>   
<span class='line'>343</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">toggle</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>344</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">newArr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>345</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">removed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>346</span> </span><span class="WHIT">  
<span class='line'>347</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>348</span> </span><span class="WHIT">        </span><span class="COMM">// Do not copy value if it exists</span><span class="WHIT">
<span class='line'>349</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>350</span> </span><span class="WHIT">          </span><span class="NAME">newArr.push</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>351</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>352</span> </span><span class="WHIT">          </span><span class="COMM">// The element was not copied to the new array, which</span><span class="WHIT">
<span class='line'>353</span> </span><span class="WHIT">          </span><span class="COMM">// means it was removed</span><span class="WHIT">
<span class='line'>354</span> </span><span class="WHIT">          </span><span class="NAME">removed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>355</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>356</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// If the element was not removed, then it was not in the array</span><span class="WHIT">
<span class='line'>357</span> </span><span class="WHIT">      </span><span class="COMM">// so add it</span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">  
<span class='line'>359</span>   
<span class='line'>360</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">removed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">        </span><span class="NAME">newArr.push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>362</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>363</span> </span><span class="WHIT">  
<span class='line'>364</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newArr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>365</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>367</span>      * Remove a value from an array.
<span class='line'>368</span>      *
<span class='line'>369</span>      * @static
<span class='line'>370</span>      * @param {Array} arr An array.
<span class='line'>371</span>      * @param {*} value A value to be removed.
<span class='line'>372</span>      * @returns {Array} A new array with the element with a given value removed.
<span class='line'>373</span>      */</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">  
<span class='line'>375</span>   
<span class='line'>376</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">remove</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>377</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>378</span> </span><span class="WHIT">  
<span class='line'>379</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>380</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>381</span> </span><span class="WHIT">          </span><span class="NAME">tmp.push</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>382</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>383</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>384</span> </span><span class="WHIT">  
<span class='line'>385</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>386</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>388</span>      * Remove a value from an array with unique values.
<span class='line'>389</span>      *
<span class='line'>390</span>      * @static
<span class='line'>391</span>      * @param {Array} arr An array.
<span class='line'>392</span>      * @param {*} value A value to be removed.
<span class='line'>393</span>      * @returns {Array} An array with the element with a given value removed.
<span class='line'>394</span>      */</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">  
<span class='line'>396</span>   
<span class='line'>397</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">removeUnique</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arr.indexOf</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">  
<span class='line'>400</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">        </span><span class="NAME">arr.splice</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">  
<span class='line'>404</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>407</span>      * Remove all elements contained in one array from another array.
<span class='line'>408</span>      *
<span class='line'>409</span>      * @static
<span class='line'>410</span>      * @param {Array} arrA The array to be filtered.
<span class='line'>411</span>      * @param {Array} arrB The array containing elements that will be removed from the other array.
<span class='line'>412</span>      * @returns {Array} The filtered array.
<span class='line'>413</span>      */</span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">  
<span class='line'>415</span>   
<span class='line'>416</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">removeAll</span><span class="PUNC">(</span><span class="NAME">arrA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>417</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arrA.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>418</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arrB.indexOf</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>419</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>420</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>421</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>422</span>      * Merges two arrays and returns the result. The first array will be appended to the second array.
<span class='line'>423</span>      *
<span class='line'>424</span>      * @static
<span class='line'>425</span>      * @param {Array} arrA An array.
<span class='line'>426</span>      * @param {Array} arrB An array.
<span class='line'>427</span>      * @returns {Array} The merged array.
<span class='line'>428</span>      */</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">  
<span class='line'>430</span>   
<span class='line'>431</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">merge</span><span class="PUNC">(</span><span class="NAME">arrA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">arrA.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">arrB.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>433</span> </span><span class="WHIT">  
<span class='line'>434</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arrA.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">        </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrA</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">  
<span class='line'>438</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arrB.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>439</span> </span><span class="WHIT">        </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">arrA.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrB</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>440</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">  
<span class='line'>442</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>445</span>      * Checks whether or not an array contains all the elements of another array, without regard to the order.
<span class='line'>446</span>      *
<span class='line'>447</span>      * @static
<span class='line'>448</span>      * @param {Array} arrA An array.
<span class='line'>449</span>      * @param {Array} arrB An array.
<span class='line'>450</span>      * @returns {Boolean} A boolean indicating whether or not both array contain the same elements.
<span class='line'>451</span>      */</span><span class="WHIT">
<span class='line'>452</span> </span><span class="WHIT">  
<span class='line'>453</span>   
<span class='line'>454</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">containsAll</span><span class="PUNC">(</span><span class="NAME">arrA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">containing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">  
<span class='line'>457</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arrA.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>458</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arrB.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>459</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arrA</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">arrB</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>460</span> </span><span class="WHIT">            </span><span class="NAME">containing</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>461</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>462</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>463</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">  
<span class='line'>465</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">containing</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">arrB.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>466</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>467</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>468</span>      * Sort an array of atomic number information. Where the number is indicated as x, x.y, x.y.z, ...
<span class='line'>469</span>      *
<span class='line'>470</span>      * @param {Object[]} arr An array of vertex ids with their associated atomic numbers.
<span class='line'>471</span>      * @param {Number} arr[].vertexId A vertex id.
<span class='line'>472</span>      * @param {String} arr[].atomicNumber The atomic number associated with the vertex id.
<span class='line'>473</span>      * @returns {Object[]} The array sorted by atomic number. Example of an array entry: { atomicNumber: 2, vertexId: 5 }.
<span class='line'>474</span>      */</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">  
<span class='line'>476</span>   
<span class='line'>477</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">sortByAtomicNumberDesc</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">map</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arr.map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>480</span> </span><span class="WHIT">          </span><span class="NAME">index</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>481</span> </span><span class="WHIT">          </span><span class="NAME">value</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">e.atomicNumber.split</span><span class="PUNC">(</span><span class="STRN">'.'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">map</span><span class="PUNC">(</span><span class="NAME">Number</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>483</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">      </span><span class="NAME">map.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>485</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">b.value.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a.value.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">  
<span class='line'>488</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">b.value</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">a.value</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT">          </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">  
<span class='line'>492</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">min</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">b.value.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a.value.length</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">b.value</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a.value</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">map.map</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>495</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">e.index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>499</span>      * Copies a an n-dimensional array.
<span class='line'>500</span>      * 
<span class='line'>501</span>      * @param {Array} arr The array to be copied.
<span class='line'>502</span>      * @returns {Array} The copy.
<span class='line'>503</span>      */</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">  
<span class='line'>505</span>   
<span class='line'>506</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">deepCopy</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">newArr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">  
<span class='line'>509</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">  
<span class='line'>512</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">          </span><span class="NAME">newArr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.deepCopy</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>515</span> </span><span class="WHIT">          </span><span class="NAME">newArr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>516</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT">  
<span class='line'>519</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newArr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>520</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">  
<span class='line'>522</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">  
<span class='line'>524</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">  
<span class='line'>526</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">  
<span class='line'>529</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>530</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">ArrayHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./ArrayHelper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">  
<span class='line'>532</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vertex'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>533</span> </span><span class="WHIT">  
<span class='line'>534</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Ring'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>535</span> </span><span class="WHIT">  </span><span class="COMM">/** 
<span class='line'>536</span>    * A class representing an atom.
<span class='line'>537</span>    * 
<span class='line'>538</span>    * @property {String} element The element symbol of this atom. Single-letter symbols are always uppercase. Examples: H, C, F, Br, Si, ...
<span class='line'>539</span>    * @property {Boolean} drawExplicit A boolean indicating whether or not this atom is drawn explicitly (for example, a carbon atom). This overrides the default behaviour.
<span class='line'>540</span>    * @property {Object[]} ringbonds An array containing the ringbond ids and bond types as specified in the original SMILE.
<span class='line'>541</span>    * @property {String} branchBond The branch bond as defined in the SMILES.
<span class='line'>542</span>    * @property {Number} ringbonds[].id The ringbond id as defined in the SMILES.
<span class='line'>543</span>    * @property {String} ringbonds[].bondType The bond type of the ringbond as defined in the SMILES.
<span class='line'>544</span>    * @property {Number[]} rings The ids of rings which contain this atom.
<span class='line'>545</span>    * @property {String} bondType The bond type associated with this array. Examples: -, =, #, ...
<span class='line'>546</span>    * @property {Boolean} isBridge A boolean indicating whether or not this atom is part of a bridge in a bridged ring (contained by the largest ring).
<span class='line'>547</span>    * @property {Boolean} isBridgeNode A boolean indicating whether or not this atom is a bridge node (a member of the largest ring in a bridged ring which is connected to a bridge-atom).
<span class='line'>548</span>    * @property {Number[]} originalRings Used to back up rings when they are replaced by a bridged ring.
<span class='line'>549</span>    * @property {Number} bridgedRing The id of the bridged ring if the atom is part of a bridged ring.
<span class='line'>550</span>    * @property {Number[]} anchoredRings The ids of the rings that are anchored to this atom. The centers of anchored rings are translated when this atom is translated.
<span class='line'>551</span>    * @property {Object} bracket If this atom is defined as a bracket atom in the original SMILES, this object contains all the bracket information. Example: { hcount: {Number}, charge: ['--', '-', '+', '++'], isotope: {Number} }.
<span class='line'>552</span>    * @property {Number} plane Specifies on which "plane" the atoms is in stereochemical deptictions (-1 back, 0 middle, 1 front).
<span class='line'>553</span>    * @property {Object[]} attachedPseudoElements A map with containing information for pseudo elements or concatinated elements. The key is comprised of the element symbol and the hydrogen count.
<span class='line'>554</span>    * @property {String} attachedPseudoElement[].element The element symbol.
<span class='line'>555</span>    * @property {Number} attachedPseudoElement[].count The number of occurences that match the key.
<span class='line'>556</span>    * @property {Number} attachedPseudoElement[].hyrogenCount The number of hydrogens attached to each atom matching the key.
<span class='line'>557</span>    * @property {Boolean} hasAttachedPseudoElements A boolean indicating whether or not this attom will be drawn with an attached pseudo element or concatinated elements.
<span class='line'>558</span>    * @property {Boolean} isDrawn A boolean indicating whether or not this atom is drawn. In contrast to drawExplicit, the bond is drawn neither.
<span class='line'>559</span>    * @property {Boolean} isConnectedToRing A boolean indicating whether or not this atom is directly connected (but not a member of) a ring.
<span class='line'>560</span>    * @property {String[]} neighbouringElements An array containing the element symbols of neighbouring atoms.
<span class='line'>561</span>    * @property {Boolean} isPartOfAromaticRing A boolean indicating whether or not this atom is part of an explicitly defined aromatic ring. Example: c1ccccc1.
<span class='line'>562</span>    * @property {Number} bondCount The number of bonds in which this atom is participating.
<span class='line'>563</span>    * @property {String} chirality The chirality of this atom if it is a stereocenter (R or S).
<span class='line'>564</span>    * @property {Number} priority The priority of this atom acording to the CIP rules, where 0 is the highest priority.
<span class='line'>565</span>    * @property {Boolean} mainChain A boolean indicating whether or not this atom is part of the main chain (used for chirality).
<span class='line'>566</span>    * @property {String} hydrogenDirection The direction of the hydrogen, either up or down. Only for stereocenters with and explicit hydrogen.
<span class='line'>567</span>    * @property {Number} subtreeDepth The depth of the subtree coming from a stereocenter.
<span class='line'>568</span>    */</span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">  
<span class='line'>570</span>   
<span class='line'>571</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">Atom</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>572</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>573</span>      * The constructor of the class Atom.
<span class='line'>574</span>      *
<span class='line'>575</span>      * @param {String} element The one-letter code of the element.
<span class='line'>576</span>      * @param {String} [bondType='-'] The type of the bond associated with this atom.
<span class='line'>577</span>      */</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bondType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>579</span> </span><span class="WHIT">      </span><span class="NAME">this.element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">element.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>580</span> </span><span class="WHIT">      </span><span class="NAME">this.drawExplicit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>581</span> </span><span class="WHIT">      </span><span class="NAME">this.ringbonds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>582</span> </span><span class="WHIT">      </span><span class="NAME">this.rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>583</span> </span><span class="WHIT">      </span><span class="NAME">this.bondType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bondType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>584</span> </span><span class="WHIT">      </span><span class="NAME">this.branchBond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>585</span> </span><span class="WHIT">      </span><span class="NAME">this.isBridge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>586</span> </span><span class="WHIT">      </span><span class="NAME">this.isBridgeNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">      </span><span class="NAME">this.originalRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>588</span> </span><span class="WHIT">      </span><span class="NAME">this.bridgedRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>589</span> </span><span class="WHIT">      </span><span class="NAME">this.anchoredRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">      </span><span class="NAME">this.bracket</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">      </span><span class="NAME">this.plane</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>592</span> </span><span class="WHIT">      </span><span class="NAME">this.attachedPseudoElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>593</span> </span><span class="WHIT">      </span><span class="NAME">this.hasAttachedPseudoElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>594</span> </span><span class="WHIT">      </span><span class="NAME">this.isDrawn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>595</span> </span><span class="WHIT">      </span><span class="NAME">this.isConnectedToRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>596</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbouringElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>597</span> </span><span class="WHIT">      </span><span class="NAME">this.isPartOfAromaticRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">this.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>598</span> </span><span class="WHIT">      </span><span class="NAME">this.bondCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">      </span><span class="NAME">this.chirality</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">      </span><span class="NAME">this.isStereoCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">      </span><span class="NAME">this.priority</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>602</span> </span><span class="WHIT">      </span><span class="NAME">this.mainChain</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">      </span><span class="NAME">this.hydrogenDirection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">      </span><span class="NAME">this.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">      </span><span class="NAME">this.hasHydrogen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>608</span>      * Adds a neighbouring element to this atom.
<span class='line'>609</span>      * 
<span class='line'>610</span>      * @param {String} element A string representing an element.
<span class='line'>611</span>      */</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">  
<span class='line'>613</span>   
<span class='line'>614</span>     </span><span class="NAME">addNeighbouringElement</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbouringElements.push</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>618</span>      * Attaches a pseudo element (e.g. Ac) to the atom.
<span class='line'>619</span>      * @param {String} element The element identifier (e.g. Br, C, ...).
<span class='line'>620</span>      * @param {String} previousElement The element that is part of the main chain (not the terminals that are converted to the pseudo element or concatinated).
<span class='line'>621</span>      * @param {Number} [hydrogenCount=0] The number of hydrogens for the element.
<span class='line'>622</span>      * @param {Number} [charge=0] The charge for the element.
<span class='line'>623</span>      */</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">  
<span class='line'>625</span>   
<span class='line'>626</span>     </span><span class="NAME">attachPseudoElement</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>627</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">        </span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">  
<span class='line'>631</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>632</span> </span><span class="WHIT">        </span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>633</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">  
<span class='line'>635</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">  
<span class='line'>637</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.attachedPseudoElements</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">        </span><span class="NAME">this.attachedPseudoElements</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">        </span><span class="NAME">this.attachedPseudoElements</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">          </span><span class="NAME">element</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>642</span> </span><span class="WHIT">          </span><span class="NAME">count</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>643</span> </span><span class="WHIT">          </span><span class="NAME">hydrogenCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">hydrogenCount</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">          </span><span class="NAME">previousElement</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">previousElement</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>645</span> </span><span class="WHIT">          </span><span class="NAME">charge</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="WHIT">
<span class='line'>646</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>647</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>648</span> </span><span class="WHIT">  
<span class='line'>649</span>       </span><span class="NAME">this.hasAttachedPseudoElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>652</span>      * Returns the attached pseudo elements sorted by hydrogen count (ascending).
<span class='line'>653</span>      *
<span class='line'>654</span>      * @returns {Object} The sorted attached pseudo elements.
<span class='line'>655</span>      */</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">  
<span class='line'>657</span>   
<span class='line'>658</span>     </span><span class="NAME">getAttachedPseudoElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>659</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ordered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>660</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>661</span> </span><span class="WHIT">      </span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">this.attachedPseudoElements</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>662</span> </span><span class="WHIT">        </span><span class="NAME">ordered</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">that.attachedPseudoElements</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>663</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ordered</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>667</span>      * Returns the number of attached pseudo elements.
<span class='line'>668</span>      *
<span class='line'>669</span>      * @returns {Number} The number of attached pseudo elements.
<span class='line'>670</span>      */</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">  
<span class='line'>672</span>   
<span class='line'>673</span>     </span><span class="NAME">getAttachedPseudoElementsCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">this.attachedPseudoElements</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>677</span>      * Returns whether this atom is a heteroatom (not C and not H).
<span class='line'>678</span>      *
<span class='line'>679</span>      * @returns {Boolean} A boolean indicating whether this atom is a heteroatom.
<span class='line'>680</span>      */</span><span class="WHIT">
<span class='line'>681</span> </span><span class="WHIT">  
<span class='line'>682</span>   
<span class='line'>683</span>     </span><span class="NAME">isHeteroAtom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>684</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'H'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>687</span>      * Defines this atom as the anchor for a ring. When doing repositionings of the vertices and the vertex associated with this atom is moved, the center of this ring is moved as well.
<span class='line'>688</span>      *
<span class='line'>689</span>      * @param {Number} ringId A ring id.
<span class='line'>690</span>      */</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">  
<span class='line'>692</span>   
<span class='line'>693</span>     </span><span class="NAME">addAnchoredRing</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ArrayHelper.contains</span><span class="PUNC">(</span><span class="NAME">this.anchoredRings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">        </span><span class="NAME">value</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">        </span><span class="NAME">this.anchoredRings.push</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>701</span>      * Returns the number of ringbonds (breaks in rings to generate the MST of the smiles) within this atom is connected to.
<span class='line'>702</span>      *
<span class='line'>703</span>      * @returns {Number} The number of ringbonds this atom is connected to.
<span class='line'>704</span>      */</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">  
<span class='line'>706</span>   
<span class='line'>707</span>     </span><span class="NAME">getRingbondCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>708</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.ringbonds.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>709</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>711</span>      * Backs up the current rings.
<span class='line'>712</span>      */</span><span class="WHIT">
<span class='line'>713</span> </span><span class="WHIT">  
<span class='line'>714</span>   
<span class='line'>715</span>     </span><span class="NAME">backupRings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>716</span> </span><span class="WHIT">      </span><span class="NAME">this.originalRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">this.rings.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>717</span> </span><span class="WHIT">  
<span class='line'>718</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">        </span><span class="NAME">this.originalRings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>723</span>      * Restores the most recent backed up rings.
<span class='line'>724</span>      */</span><span class="WHIT">
<span class='line'>725</span> </span><span class="WHIT">  
<span class='line'>726</span>   
<span class='line'>727</span>     </span><span class="NAME">restoreRings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>728</span> </span><span class="WHIT">      </span><span class="NAME">this.rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">this.originalRings.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>729</span> </span><span class="WHIT">  
<span class='line'>730</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.originalRings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>731</span> </span><span class="WHIT">        </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.originalRings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>732</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>735</span>      * Checks whether or not two atoms share a common ringbond id. A ringbond is a break in a ring created when generating the spanning tree of a structure.
<span class='line'>736</span>      *
<span class='line'>737</span>      * @param {Atom} atomA An atom.
<span class='line'>738</span>      * @param {Atom} atomB An atom.
<span class='line'>739</span>      * @returns {Boolean} A boolean indicating whether or not two atoms share a common ringbond.
<span class='line'>740</span>      */</span><span class="WHIT">
<span class='line'>741</span> </span><span class="WHIT">  
<span class='line'>742</span>   
<span class='line'>743</span>     </span><span class="NAME">haveCommonRingbond</span><span class="PUNC">(</span><span class="NAME">atomA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atomB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">atomA.ringbonds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>745</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">atomB.ringbonds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>746</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atomA.ringbonds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">atomB.ringbonds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>747</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>749</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>750</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>751</span> </span><span class="WHIT">  
<span class='line'>752</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>753</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>754</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>755</span>      * Check whether or not the neighbouring elements of this atom equal the supplied array.
<span class='line'>756</span>      * 
<span class='line'>757</span>      * @param {String[]} arr An array containing all the elements that are neighbouring this atom. E.g. ['C', 'O', 'O', 'N']
<span class='line'>758</span>      * @returns {Boolean} A boolean indicating whether or not the neighbours match the supplied array of elements.
<span class='line'>759</span>      */</span><span class="WHIT">
<span class='line'>760</span> </span><span class="WHIT">  
<span class='line'>761</span>   
<span class='line'>762</span>     </span><span class="NAME">neighbouringElementsEqual</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arr.length</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">this.neighbouringElements.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">  
<span class='line'>767</span>       </span><span class="NAME">arr.sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbouringElements.sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">  
<span class='line'>770</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.neighbouringElements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">this.neighbouringElements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">  
<span class='line'>776</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>779</span>      * Get the atomic number of this atom.
<span class='line'>780</span>      * 
<span class='line'>781</span>      * @returns {Number} The atomic number of this atom.
<span class='line'>782</span>      */</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">  
<span class='line'>784</span>   
<span class='line'>785</span>     </span><span class="NAME">getAtomicNumber</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Atom.atomicNumbers</span><span class="PUNC">[</span><span class="NAME">this.element</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>789</span>      * Get the maximum number of bonds for this atom.
<span class='line'>790</span>      * 
<span class='line'>791</span>      * @returns {Number} The maximum number of bonds of this atom.
<span class='line'>792</span>      */</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">  
<span class='line'>794</span>   
<span class='line'>795</span>     </span><span class="NAME">getMaxBonds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>796</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Atom.maxBonds</span><span class="PUNC">[</span><span class="NAME">this.element</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>799</span>      * A map mapping element symbols to their maximum bonds.
<span class='line'>800</span>      */</span><span class="WHIT">
<span class='line'>801</span> </span><span class="WHIT">  
<span class='line'>802</span>   
<span class='line'>803</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">get</span><span class="WHIT"> </span><span class="NAME">maxBonds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>805</span> </span><span class="WHIT">        </span><span class="STRN">'H'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>806</span> </span><span class="WHIT">        </span><span class="STRN">'C'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>807</span> </span><span class="WHIT">        </span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">        </span><span class="STRN">'O'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">        </span><span class="STRN">'P'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">        </span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">        </span><span class="STRN">'B'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">        </span><span class="STRN">'F'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">        </span><span class="STRN">'I'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">        </span><span class="STRN">'Cl'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">        </span><span class="STRN">'Br'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>817</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>819</span>      * A map mapping element symbols to the atomic number.
<span class='line'>820</span>      */</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">  
<span class='line'>822</span>   
<span class='line'>823</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">get</span><span class="WHIT"> </span><span class="NAME">atomicNumbers</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">        </span><span class="STRN">'H'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">        </span><span class="STRN">'He'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">        </span><span class="STRN">'Li'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">        </span><span class="STRN">'Be'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">        </span><span class="STRN">'B'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>830</span> </span><span class="WHIT">        </span><span class="STRN">'b'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>831</span> </span><span class="WHIT">        </span><span class="STRN">'C'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>832</span> </span><span class="WHIT">        </span><span class="STRN">'c'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>833</span> </span><span class="WHIT">        </span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>834</span> </span><span class="WHIT">        </span><span class="STRN">'n'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>835</span> </span><span class="WHIT">        </span><span class="STRN">'O'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">        </span><span class="STRN">'o'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>837</span> </span><span class="WHIT">        </span><span class="STRN">'F'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>838</span> </span><span class="WHIT">        </span><span class="STRN">'Ne'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">        </span><span class="STRN">'Na'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">11</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">        </span><span class="STRN">'Mg'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">        </span><span class="STRN">'Al'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">13</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">        </span><span class="STRN">'Si'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">14</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">        </span><span class="STRN">'P'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">        </span><span class="STRN">'p'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">        </span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">        </span><span class="STRN">'s'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">        </span><span class="STRN">'Cl'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">17</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">        </span><span class="STRN">'Ar'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>849</span> </span><span class="WHIT">        </span><span class="STRN">'K'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">19</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>850</span> </span><span class="WHIT">        </span><span class="STRN">'Ca'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">20</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>851</span> </span><span class="WHIT">        </span><span class="STRN">'Sc'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">21</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>852</span> </span><span class="WHIT">        </span><span class="STRN">'Ti'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">22</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">        </span><span class="STRN">'V'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">23</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">        </span><span class="STRN">'Cr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">        </span><span class="STRN">'Mn'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">25</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">        </span><span class="STRN">'Fe'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">26</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>857</span> </span><span class="WHIT">        </span><span class="STRN">'Co'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">27</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>858</span> </span><span class="WHIT">        </span><span class="STRN">'Ni'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">28</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>859</span> </span><span class="WHIT">        </span><span class="STRN">'Cu'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">29</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>860</span> </span><span class="WHIT">        </span><span class="STRN">'Zn'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>861</span> </span><span class="WHIT">        </span><span class="STRN">'Ga'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">31</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">        </span><span class="STRN">'Ge'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">        </span><span class="STRN">'As'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">33</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">        </span><span class="STRN">'Se'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">34</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">        </span><span class="STRN">'Br'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">35</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">        </span><span class="STRN">'Kr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">36</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">        </span><span class="STRN">'Rb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">37</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">        </span><span class="STRN">'Sr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">38</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">        </span><span class="STRN">'Y'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">39</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">        </span><span class="STRN">'Zr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">40</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>871</span> </span><span class="WHIT">        </span><span class="STRN">'Nb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">41</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>872</span> </span><span class="WHIT">        </span><span class="STRN">'Mo'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">42</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>873</span> </span><span class="WHIT">        </span><span class="STRN">'Tc'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">43</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>874</span> </span><span class="WHIT">        </span><span class="STRN">'Ru'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">44</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>875</span> </span><span class="WHIT">        </span><span class="STRN">'Rh'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">45</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>876</span> </span><span class="WHIT">        </span><span class="STRN">'Pd'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">46</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>877</span> </span><span class="WHIT">        </span><span class="STRN">'Ag'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">47</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>878</span> </span><span class="WHIT">        </span><span class="STRN">'Cd'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">48</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">        </span><span class="STRN">'In'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">49</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">        </span><span class="STRN">'Sn'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>881</span> </span><span class="WHIT">        </span><span class="STRN">'Sb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">51</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>882</span> </span><span class="WHIT">        </span><span class="STRN">'Te'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">52</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>883</span> </span><span class="WHIT">        </span><span class="STRN">'I'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">53</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>884</span> </span><span class="WHIT">        </span><span class="STRN">'Xe'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">54</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>885</span> </span><span class="WHIT">        </span><span class="STRN">'Cs'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">55</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">        </span><span class="STRN">'Ba'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">56</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">        </span><span class="STRN">'La'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">57</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">        </span><span class="STRN">'Ce'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">58</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>889</span> </span><span class="WHIT">        </span><span class="STRN">'Pr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">59</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>890</span> </span><span class="WHIT">        </span><span class="STRN">'Nd'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">        </span><span class="STRN">'Pm'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">61</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">        </span><span class="STRN">'Sm'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">62</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">        </span><span class="STRN">'Eu'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">63</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">        </span><span class="STRN">'Gd'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">64</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">        </span><span class="STRN">'Tb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">65</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">        </span><span class="STRN">'Dy'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">66</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>897</span> </span><span class="WHIT">        </span><span class="STRN">'Ho'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">67</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>898</span> </span><span class="WHIT">        </span><span class="STRN">'Er'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">68</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">        </span><span class="STRN">'Tm'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">69</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">        </span><span class="STRN">'Yb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">70</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">        </span><span class="STRN">'Lu'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">71</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>902</span> </span><span class="WHIT">        </span><span class="STRN">'Hf'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">72</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>903</span> </span><span class="WHIT">        </span><span class="STRN">'Ta'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">73</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">        </span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">74</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>905</span> </span><span class="WHIT">        </span><span class="STRN">'Re'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">75</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>906</span> </span><span class="WHIT">        </span><span class="STRN">'Os'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">76</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">        </span><span class="STRN">'Ir'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">77</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>908</span> </span><span class="WHIT">        </span><span class="STRN">'Pt'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">78</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>909</span> </span><span class="WHIT">        </span><span class="STRN">'Au'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">79</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>910</span> </span><span class="WHIT">        </span><span class="STRN">'Hg'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">80</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>911</span> </span><span class="WHIT">        </span><span class="STRN">'Tl'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">81</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>912</span> </span><span class="WHIT">        </span><span class="STRN">'Pb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">82</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">        </span><span class="STRN">'Bi'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">83</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">        </span><span class="STRN">'Po'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">84</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">        </span><span class="STRN">'At'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">85</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">        </span><span class="STRN">'Rn'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">86</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">        </span><span class="STRN">'Fr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">87</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">        </span><span class="STRN">'Ra'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">88</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">        </span><span class="STRN">'Ac'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">89</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">        </span><span class="STRN">'Th'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">90</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">        </span><span class="STRN">'Pa'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">91</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">        </span><span class="STRN">'U'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">92</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">        </span><span class="STRN">'Np'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">93</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>924</span> </span><span class="WHIT">        </span><span class="STRN">'Pu'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">94</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">        </span><span class="STRN">'Am'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">95</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>926</span> </span><span class="WHIT">        </span><span class="STRN">'Cm'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">96</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">        </span><span class="STRN">'Bk'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">97</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>928</span> </span><span class="WHIT">        </span><span class="STRN">'Cf'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">98</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>929</span> </span><span class="WHIT">        </span><span class="STRN">'Es'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">99</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>930</span> </span><span class="WHIT">        </span><span class="STRN">'Fm'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>931</span> </span><span class="WHIT">        </span><span class="STRN">'Md'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">101</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">        </span><span class="STRN">'No'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">102</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>933</span> </span><span class="WHIT">        </span><span class="STRN">'Lr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">103</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">        </span><span class="STRN">'Rf'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">104</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">        </span><span class="STRN">'Db'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">105</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">        </span><span class="STRN">'Sg'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">106</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">        </span><span class="STRN">'Bh'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">107</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">        </span><span class="STRN">'Hs'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">108</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">        </span><span class="STRN">'Mt'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">109</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">        </span><span class="STRN">'Ds'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">110</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>941</span> </span><span class="WHIT">        </span><span class="STRN">'Rg'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">111</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>942</span> </span><span class="WHIT">        </span><span class="STRN">'Cn'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">112</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">        </span><span class="STRN">'Uut'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">113</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">        </span><span class="STRN">'Uuq'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">114</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>945</span> </span><span class="WHIT">        </span><span class="STRN">'Uup'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">115</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>946</span> </span><span class="WHIT">        </span><span class="STRN">'Uuh'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">116</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">        </span><span class="STRN">'Uus'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">117</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">        </span><span class="STRN">'Uuo'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">118</span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>950</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>951</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>952</span>      * A map mapping element symbols to the atomic mass.
<span class='line'>953</span>      */</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">  
<span class='line'>955</span>   
<span class='line'>956</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">get</span><span class="WHIT"> </span><span class="NAME">mass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>958</span> </span><span class="WHIT">        </span><span class="STRN">'H'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>959</span> </span><span class="WHIT">        </span><span class="STRN">'He'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>960</span> </span><span class="WHIT">        </span><span class="STRN">'Li'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>961</span> </span><span class="WHIT">        </span><span class="STRN">'Be'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>962</span> </span><span class="WHIT">        </span><span class="STRN">'B'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">        </span><span class="STRN">'b'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>964</span> </span><span class="WHIT">        </span><span class="STRN">'C'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>965</span> </span><span class="WHIT">        </span><span class="STRN">'c'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>966</span> </span><span class="WHIT">        </span><span class="STRN">'N'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>967</span> </span><span class="WHIT">        </span><span class="STRN">'n'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>968</span> </span><span class="WHIT">        </span><span class="STRN">'O'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>969</span> </span><span class="WHIT">        </span><span class="STRN">'o'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>970</span> </span><span class="WHIT">        </span><span class="STRN">'F'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>971</span> </span><span class="WHIT">        </span><span class="STRN">'Ne'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>972</span> </span><span class="WHIT">        </span><span class="STRN">'Na'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">11</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>973</span> </span><span class="WHIT">        </span><span class="STRN">'Mg'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">        </span><span class="STRN">'Al'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">13</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">        </span><span class="STRN">'Si'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">14</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">        </span><span class="STRN">'P'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">        </span><span class="STRN">'p'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">        </span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">        </span><span class="STRN">'s'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>980</span> </span><span class="WHIT">        </span><span class="STRN">'Cl'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">17</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">        </span><span class="STRN">'Ar'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">        </span><span class="STRN">'K'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">19</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">        </span><span class="STRN">'Ca'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">20</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">        </span><span class="STRN">'Sc'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">21</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">        </span><span class="STRN">'Ti'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">22</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">        </span><span class="STRN">'V'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">23</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">        </span><span class="STRN">'Cr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">        </span><span class="STRN">'Mn'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">25</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">        </span><span class="STRN">'Fe'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">26</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>990</span> </span><span class="WHIT">        </span><span class="STRN">'Co'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">27</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">        </span><span class="STRN">'Ni'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">28</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">        </span><span class="STRN">'Cu'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">29</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">        </span><span class="STRN">'Zn'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">        </span><span class="STRN">'Ga'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">31</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">        </span><span class="STRN">'Ge'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">        </span><span class="STRN">'As'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">33</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">        </span><span class="STRN">'Se'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">34</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">        </span><span class="STRN">'Br'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">35</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">        </span><span class="STRN">'Kr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">36</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="WHIT">        </span><span class="STRN">'Rb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">37</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">        </span><span class="STRN">'Sr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">38</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1002</span> </span><span class="WHIT">        </span><span class="STRN">'Y'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">39</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">        </span><span class="STRN">'Zr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">40</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">        </span><span class="STRN">'Nb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">41</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">        </span><span class="STRN">'Mo'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">42</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">        </span><span class="STRN">'Tc'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">43</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">        </span><span class="STRN">'Ru'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">44</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">        </span><span class="STRN">'Rh'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">45</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">        </span><span class="STRN">'Pd'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">46</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1010</span> </span><span class="WHIT">        </span><span class="STRN">'Ag'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">47</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="WHIT">        </span><span class="STRN">'Cd'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">48</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="WHIT">        </span><span class="STRN">'In'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">49</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="WHIT">        </span><span class="STRN">'Sn'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">        </span><span class="STRN">'Sb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">51</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">        </span><span class="STRN">'Te'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">52</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1016</span> </span><span class="WHIT">        </span><span class="STRN">'I'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">53</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1017</span> </span><span class="WHIT">        </span><span class="STRN">'Xe'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">54</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1018</span> </span><span class="WHIT">        </span><span class="STRN">'Cs'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">55</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">        </span><span class="STRN">'Ba'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">56</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">        </span><span class="STRN">'La'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">57</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">        </span><span class="STRN">'Ce'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">58</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">        </span><span class="STRN">'Pr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">59</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="WHIT">        </span><span class="STRN">'Nd'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="WHIT">        </span><span class="STRN">'Pm'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">61</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">        </span><span class="STRN">'Sm'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">62</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">        </span><span class="STRN">'Eu'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">63</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="WHIT">        </span><span class="STRN">'Gd'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">64</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="WHIT">        </span><span class="STRN">'Tb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">65</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">        </span><span class="STRN">'Dy'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">66</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">        </span><span class="STRN">'Ho'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">67</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">        </span><span class="STRN">'Er'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">68</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">        </span><span class="STRN">'Tm'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">69</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">        </span><span class="STRN">'Yb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">70</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">        </span><span class="STRN">'Lu'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">71</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1035</span> </span><span class="WHIT">        </span><span class="STRN">'Hf'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">72</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="WHIT">        </span><span class="STRN">'Ta'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">73</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">        </span><span class="STRN">'W'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">74</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">        </span><span class="STRN">'Re'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">75</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">        </span><span class="STRN">'Os'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">76</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">        </span><span class="STRN">'Ir'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">77</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">        </span><span class="STRN">'Pt'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">78</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">        </span><span class="STRN">'Au'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">79</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">        </span><span class="STRN">'Hg'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">80</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">        </span><span class="STRN">'Tl'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">81</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">        </span><span class="STRN">'Pb'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">82</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">        </span><span class="STRN">'Bi'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">83</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">        </span><span class="STRN">'Po'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">84</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">        </span><span class="STRN">'At'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">85</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">        </span><span class="STRN">'Rn'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">86</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">        </span><span class="STRN">'Fr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">87</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">        </span><span class="STRN">'Ra'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">88</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">        </span><span class="STRN">'Ac'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">89</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">        </span><span class="STRN">'Th'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">90</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">        </span><span class="STRN">'Pa'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">91</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">        </span><span class="STRN">'U'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">92</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">        </span><span class="STRN">'Np'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">93</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">        </span><span class="STRN">'Pu'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">94</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">        </span><span class="STRN">'Am'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">95</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1059</span> </span><span class="WHIT">        </span><span class="STRN">'Cm'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">96</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1060</span> </span><span class="WHIT">        </span><span class="STRN">'Bk'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">97</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1061</span> </span><span class="WHIT">        </span><span class="STRN">'Cf'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">98</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1062</span> </span><span class="WHIT">        </span><span class="STRN">'Es'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">99</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1063</span> </span><span class="WHIT">        </span><span class="STRN">'Fm'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1064</span> </span><span class="WHIT">        </span><span class="STRN">'Md'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">101</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1065</span> </span><span class="WHIT">        </span><span class="STRN">'No'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">102</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1066</span> </span><span class="WHIT">        </span><span class="STRN">'Lr'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">103</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1067</span> </span><span class="WHIT">        </span><span class="STRN">'Rf'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">104</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="WHIT">        </span><span class="STRN">'Db'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">105</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">        </span><span class="STRN">'Sg'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">106</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1070</span> </span><span class="WHIT">        </span><span class="STRN">'Bh'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">107</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">        </span><span class="STRN">'Hs'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">108</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">        </span><span class="STRN">'Mt'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">109</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">        </span><span class="STRN">'Ds'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">110</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">        </span><span class="STRN">'Rg'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">111</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">        </span><span class="STRN">'Cn'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">112</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">        </span><span class="STRN">'Uut'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">113</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="WHIT">        </span><span class="STRN">'Uuq'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">114</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">        </span><span class="STRN">'Uup'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">115</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">        </span><span class="STRN">'Uuh'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">116</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">        </span><span class="STRN">'Uus'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">117</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="WHIT">        </span><span class="STRN">'Uuo'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">118</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1084</span> </span><span class="WHIT">  
<span class='line'>1085</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="WHIT">  
<span class='line'>1087</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Atom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="WHIT">  
<span class='line'>1089</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./ArrayHelper"</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">"./Ring"</span><span class="PUNC">:</span><span class="NUMB">11</span><span class="PUNC">,</span><span class="STRN">"./Vertex"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">  
<span class='line'>1092</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">MathHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./MathHelper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">  
<span class='line'>1095</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vector2'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">  
<span class='line'>1097</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Line'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">  
<span class='line'>1099</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vertex'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="WHIT">  
<span class='line'>1101</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Ring'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">  
<span class='line'>1103</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">    </span><span class="NAME">getChargeText</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./UtilityFunctions'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">  </span><span class="COMM">/** 
<span class='line'>1107</span>    * A class wrapping a canvas element.
<span class='line'>1108</span>    * 
<span class='line'>1109</span>    * @property {HTMLElement} canvas The HTML element for the canvas associated with this CanvasWrapper instance.
<span class='line'>1110</span>    * @property {CanvasRenderingContext2D} ctx The CanvasRenderingContext2D of the canvas associated with this CanvasWrapper instance.
<span class='line'>1111</span>    * @property {Object} colors The colors object as defined in the SmilesDrawer options.
<span class='line'>1112</span>    * @property {Object} opts The SmilesDrawer options.
<span class='line'>1113</span>    * @property {Number} drawingWidth The width of the canvas.
<span class='line'>1114</span>    * @property {Number} drawingHeight The height of the canvas.
<span class='line'>1115</span>    * @property {Number} offsetX The horizontal offset required for centering the drawing.
<span class='line'>1116</span>    * @property {Number} offsetY The vertical offset required for centering the drawing.
<span class='line'>1117</span>    * @property {Number} fontLarge The large font size in pt.
<span class='line'>1118</span>    * @property {Number} fontSmall The small font size in pt.
<span class='line'>1119</span>    */</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">  
<span class='line'>1121</span>   
<span class='line'>1122</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">CanvasWrapper</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1124</span>      * The constructor for the class CanvasWrapper.
<span class='line'>1125</span>      *
<span class='line'>1126</span>      * @param {(String|HTMLElement)} target The canvas id or the canvas HTMLElement.
<span class='line'>1127</span>      * @param {ThemeManager} themeManager Theme manager for setting proper colors.
<span class='line'>1128</span>      * @param {Object} options The smiles drawer options object.
<span class='line'>1129</span>      */</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">themeManager</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="WHIT">        </span><span class="NAME">this.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">        </span><span class="NAME">this.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">  
<span class='line'>1137</span>       </span><span class="NAME">this.ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.canvas.getContext</span><span class="PUNC">(</span><span class="STRN">'2d'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">      </span><span class="NAME">this.themeManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">themeManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">      </span><span class="NAME">this.opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">      </span><span class="NAME">this.drawingWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="WHIT">      </span><span class="NAME">this.drawingHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">      </span><span class="NAME">this.offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">      </span><span class="NAME">this.offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="WHIT">      </span><span class="NAME">this.fontLarge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'pt Helvetica, Arial, sans-serif'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1145</span> </span><span class="WHIT">      </span><span class="NAME">this.fontSmall</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeSmall</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'pt Helvetica, Arial, sans-serif'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1146</span> </span><span class="WHIT">      </span><span class="NAME">this.updateSize</span><span class="PUNC">(</span><span class="NAME">this.opts.width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="WHIT">      </span><span class="NAME">this.ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1148</span> </span><span class="WHIT">      </span><span class="NAME">this.hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx.measureText</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1149</span> </span><span class="WHIT">      </span><span class="NAME">this.halfHydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="WHIT">      </span><span class="NAME">this.halfBondThickness</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondThickness</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// TODO: Find out why clear was here.</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="WHIT">      </span><span class="COMM">// this.clear();</span><span class="WHIT">
<span class='line'>1152</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1153</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1154</span>      * Update the width and height of the canvas
<span class='line'>1155</span>      * 
<span class='line'>1156</span>      * @param {Number} width 
<span class='line'>1157</span>      * @param {Number} height 
<span class='line'>1158</span>      */</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="WHIT">  
<span class='line'>1160</span>   
<span class='line'>1161</span>     </span><span class="NAME">updateSize</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1162</span> </span><span class="WHIT">      </span><span class="NAME">this.devicePixelRatio</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.devicePixelRatio</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1163</span> </span><span class="WHIT">      </span><span class="NAME">this.backingStoreRatio</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx.webkitBackingStorePixelRatio</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.ctx.mozBackingStorePixelRatio</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.ctx.msBackingStorePixelRatio</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.ctx.oBackingStorePixelRatio</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.ctx.backingStorePixelRatio</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="WHIT">      </span><span class="NAME">this.ratio</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.devicePixelRatio</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.backingStoreRatio</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="WHIT">  
<span class='line'>1166</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.ratio</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">        </span><span class="NAME">this.canvas.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.ratio</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">        </span><span class="NAME">this.canvas.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.ratio</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">        </span><span class="NAME">this.canvas.style.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'px'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="WHIT">        </span><span class="NAME">this.canvas.style.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'px'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">        </span><span class="NAME">this.ctx.setTransform</span><span class="PUNC">(</span><span class="NAME">this.ratio</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.ratio</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="WHIT">        </span><span class="NAME">this.canvas.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.ratio</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1174</span> </span><span class="WHIT">        </span><span class="NAME">this.canvas.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.ratio</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1175</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1178</span>      * Sets a provided theme.
<span class='line'>1179</span>      *
<span class='line'>1180</span>      * @param {Object} theme A theme from the smiles drawer options.
<span class='line'>1181</span>      */</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">  
<span class='line'>1183</span>   
<span class='line'>1184</span>     </span><span class="NAME">setTheme</span><span class="PUNC">(</span><span class="NAME">theme</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="WHIT">      </span><span class="NAME">this.colors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">theme</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1188</span>      * Scale the canvas based on vertex positions.
<span class='line'>1189</span>      *
<span class='line'>1190</span>      * @param {Vertex[]} vertices An array of vertices containing the vertices associated with the current molecule.
<span class='line'>1191</span>      */</span><span class="WHIT">
<span class='line'>1192</span> </span><span class="WHIT">  
<span class='line'>1193</span>   
<span class='line'>1194</span>     </span><span class="NAME">scale</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="WHIT">      </span><span class="COMM">// Figure out the final size of the image</span><span class="WHIT">
<span class='line'>1196</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1197</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1198</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1199</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1200</span> </span><span class="WHIT">  
<span class='line'>1201</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1202</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1203</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1204</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="WHIT">  
<span class='line'>1206</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">p.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">p.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1209</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">p.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1210</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">p.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Add padding</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">  
<span class='line'>1213</span>   
<span class='line'>1214</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">padding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.padding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">      </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">padding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1216</span> </span><span class="WHIT">      </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">padding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">      </span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">padding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="WHIT">      </span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">padding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1219</span> </span><span class="WHIT">      </span><span class="NAME">this.drawingWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">minX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="WHIT">      </span><span class="NAME">this.drawingHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">minY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1221</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scaleX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.canvas.offsetWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.drawingWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1222</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scaleY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.canvas.offsetHeight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.drawingHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1223</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scaleX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">scaleY</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">scaleX</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">scaleY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1224</span> </span><span class="WHIT">      </span><span class="NAME">this.ctx.scale</span><span class="PUNC">(</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="WHIT">      </span><span class="NAME">this.offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">minX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="WHIT">      </span><span class="NAME">this.offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">minY</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Center</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="WHIT">  
<span class='line'>1228</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scaleX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">scaleY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="WHIT">        </span><span class="NAME">this.offsetY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.canvas.offsetHeight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.drawingHeight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">        </span><span class="NAME">this.offsetX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.canvas.offsetWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.drawingWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1232</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1234</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1235</span>      * Resets the transform of the canvas.
<span class='line'>1236</span>      */</span><span class="WHIT">
<span class='line'>1237</span> </span><span class="WHIT">  
<span class='line'>1238</span>   
<span class='line'>1239</span>     </span><span class="NAME">reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">      </span><span class="NAME">this.ctx.setTransform</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1243</span>      * Returns the hex code of a color associated with a key from the current theme.
<span class='line'>1244</span>      *
<span class='line'>1245</span>      * @param {String} key The color key in the theme (e.g. C, N, BACKGROUND, ...).
<span class='line'>1246</span>      * @returns {String} A color hex value.
<span class='line'>1247</span>      */</span><span class="WHIT">
<span class='line'>1248</span> </span><span class="WHIT">  
<span class='line'>1249</span>   
<span class='line'>1250</span>     </span><span class="NAME">getColor</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1251</span> </span><span class="WHIT">      </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1252</span> </span><span class="WHIT">  
<span class='line'>1253</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.colors</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1254</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.colors</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1255</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1256</span> </span><span class="WHIT">  
<span class='line'>1257</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.colors</span><span class="PUNC">[</span><span class="STRN">'C'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1258</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1259</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1260</span>      * Draws a circle to a canvas context.
<span class='line'>1261</span>      * @param {Number} x The x coordinate of the circles center.
<span class='line'>1262</span>      * @param {Number} y The y coordinate of the circles center.
<span class='line'>1263</span>      * @param {Number} radius The radius of the circle
<span class='line'>1264</span>      * @param {String} color A hex encoded color.
<span class='line'>1265</span>      * @param {Boolean} [fill=true] Whether to fill or stroke the circle.
<span class='line'>1266</span>      * @param {Boolean} [debug=false] Draw in debug mode.
<span class='line'>1267</span>      * @param {String} [debugText=''] A debug message.
<span class='line'>1268</span>      */</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="WHIT">  
<span class='line'>1270</span>   
<span class='line'>1271</span>     </span><span class="NAME">drawCircle</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">color</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fill</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debug</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debugText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1272</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1273</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1274</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1275</span> </span><span class="WHIT">      </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">      </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">      </span><span class="NAME">ctx.arc</span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">MathHelper.twoPI</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1279</span> </span><span class="WHIT">      </span><span class="NAME">ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1280</span> </span><span class="WHIT">  
<span class='line'>1281</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fill</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">          </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'#f00'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">          </span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1285</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1286</span> </span><span class="WHIT">          </span><span class="NAME">ctx.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'#f00'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="WHIT">          </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1288</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1289</span> </span><span class="WHIT">  
<span class='line'>1290</span>         </span><span class="NAME">this.drawDebugText</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debugText</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1291</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1292</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fill</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">          </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1294</span> </span><span class="WHIT">          </span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1295</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1296</span> </span><span class="WHIT">          </span><span class="NAME">ctx.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1297</span> </span><span class="WHIT">          </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1299</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1300</span> </span><span class="WHIT">  
<span class='line'>1301</span>       </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1303</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1304</span>      * Draw a line to a canvas.
<span class='line'>1305</span>      *
<span class='line'>1306</span>      * @param {Line} line A line.
<span class='line'>1307</span>      * @param {Boolean} [dashed=false] Whether or not the line is dashed.
<span class='line'>1308</span>      * @param {Number} [alpha=1.0] The alpha value of the color.
<span class='line'>1309</span>      */</span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">  
<span class='line'>1311</span>   
<span class='line'>1312</span>     </span><span class="NAME">drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dashed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">alpha</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1313</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1314</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Add a shadow behind the line</span><span class="WHIT">
<span class='line'>1316</span> </span><span class="WHIT">  
<span class='line'>1317</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">shortLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">shorten</span><span class="PUNC">(</span><span class="NUMB">4.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1318</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">shortLine.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1319</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">shortLine.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1320</span> </span><span class="WHIT">      </span><span class="NAME">l.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1321</span> </span><span class="WHIT">      </span><span class="NAME">l.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">      </span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1323</span> </span><span class="WHIT">      </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Draw the "shadow"</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="WHIT">  
<span class='line'>1325</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">dashed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1326</span> </span><span class="WHIT">        </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1327</span> </span><span class="WHIT">        </span><span class="NAME">ctx.globalCompositeOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'destination-out'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1328</span> </span><span class="WHIT">        </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1329</span> </span><span class="WHIT">        </span><span class="NAME">ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">l.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">l.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1330</span> </span><span class="WHIT">        </span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1331</span> </span><span class="WHIT">        </span><span class="NAME">ctx.lineCap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'round'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1332</span> </span><span class="WHIT">        </span><span class="NAME">ctx.lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondThickness</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1.2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="WHIT">        </span><span class="NAME">ctx.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'BACKGROUND'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">        </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">        </span><span class="NAME">ctx.globalCompositeOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'source-over'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">        </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1337</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1338</span> </span><span class="WHIT">  
<span class='line'>1339</span>       </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1340</span> </span><span class="WHIT">      </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">      </span><span class="NAME">l.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">      </span><span class="NAME">l.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">      </span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">      </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">      </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1346</span> </span><span class="WHIT">      </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1347</span> </span><span class="WHIT">      </span><span class="NAME">ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">l.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">l.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineCap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'round'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondThickness</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">gradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx.createLinearGradient</span><span class="PUNC">(</span><span class="NAME">l.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">l.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">      </span><span class="NAME">gradient.addColorStop</span><span class="PUNC">(</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">line.getLeftElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">      </span><span class="NAME">gradient.addColorStop</span><span class="PUNC">(</span><span class="NUMB">0.6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">line.getRightElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="WHIT">  
<span class='line'>1355</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dashed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1356</span> </span><span class="WHIT">        </span><span class="NAME">ctx.setLineDash</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1357</span> </span><span class="WHIT">        </span><span class="NAME">ctx.lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondThickness</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1359</span> </span><span class="WHIT">  
<span class='line'>1360</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">alpha</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1361</span> </span><span class="WHIT">        </span><span class="NAME">ctx.globalAlpha</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">alpha</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1363</span> </span><span class="WHIT">  
<span class='line'>1364</span>       </span><span class="NAME">ctx.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gradient</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">      </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1366</span> </span><span class="WHIT">      </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1367</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1368</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1369</span>      * Draw a wedge on the canvas.
<span class='line'>1370</span>      *
<span class='line'>1371</span>      * @param {Line} line A line.
<span class='line'>1372</span>      * @param {Number} width The wedge width.
<span class='line'>1373</span>      */</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">  
<span class='line'>1375</span>   
<span class='line'>1376</span>     </span><span class="NAME">drawWedge</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.from.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.from.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.to.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">  
<span class='line'>1381</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1382</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1383</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Add a shadow behind the line</span><span class="WHIT">
<span class='line'>1384</span> </span><span class="WHIT">  
<span class='line'>1385</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">shortLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">shorten</span><span class="PUNC">(</span><span class="NUMB">5.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1386</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">shortLine.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">shortLine.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="WHIT">      </span><span class="NAME">l.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">      </span><span class="NAME">l.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">      </span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">      </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">      </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">      </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">      </span><span class="NAME">l.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="WHIT">      </span><span class="NAME">l.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="WHIT">      </span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">      </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">      </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.normals</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1400</span> </span><span class="WHIT">      </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1401</span> </span><span class="WHIT">      </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1402</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isRightChiralCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightChiral</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1403</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">  
<span class='line'>1406</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isRightChiralCenter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">        </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">        </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1409</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1410</span> </span><span class="WHIT">  
<span class='line'>1411</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.halfBondThickness</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">end</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.halfBondThickness</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">end</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.halfBondThickness</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.halfBondThickness</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="WHIT">      </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="WHIT">      </span><span class="NAME">ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">t.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">t.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">u.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">u.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1418</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">v.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1419</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">w.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">w.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">gradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx.createRadialGradient</span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">      </span><span class="NAME">gradient.addColorStop</span><span class="PUNC">(</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">line.getLeftElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">      </span><span class="NAME">gradient.addColorStop</span><span class="PUNC">(</span><span class="NUMB">0.6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">line.getRightElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gradient</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">      </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1427</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1428</span>      * Draw a dashed wedge on the canvas.
<span class='line'>1429</span>      *
<span class='line'>1430</span>      * @param {Line} line A line.
<span class='line'>1431</span>      */</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="WHIT">  
<span class='line'>1433</span>   
<span class='line'>1434</span>     </span><span class="NAME">drawDashedWedge</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1435</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.from.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.from.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.to.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1436</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1437</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="WHIT">  
<span class='line'>1439</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1440</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1441</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1442</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1444</span> </span><span class="WHIT">      </span><span class="NAME">l.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">      </span><span class="NAME">l.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">      </span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">      </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="WHIT">      </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.normals</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">      </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">      </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isRightChiralCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightChiral</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sStart</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sEnd</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">shortLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1458</span> </span><span class="WHIT">  
<span class='line'>1459</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isRightChiralCenter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1460</span> </span><span class="WHIT">        </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1461</span> </span><span class="WHIT">        </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1462</span> </span><span class="WHIT">        </span><span class="NAME">shortLine.shortenRight</span><span class="PUNC">(</span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1463</span> </span><span class="WHIT">        </span><span class="NAME">sStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">shortLine.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1464</span> </span><span class="WHIT">        </span><span class="NAME">sEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">shortLine.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1465</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1466</span> </span><span class="WHIT">        </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1467</span> </span><span class="WHIT">        </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1468</span> </span><span class="WHIT">        </span><span class="NAME">shortLine.shortenLeft</span><span class="PUNC">(</span><span class="NUMB">1.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1469</span> </span><span class="WHIT">        </span><span class="NAME">sStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">shortLine.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="WHIT">        </span><span class="NAME">sEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">shortLine.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1472</span> </span><span class="WHIT">  
<span class='line'>1473</span>       </span><span class="NAME">sStart.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">      </span><span class="NAME">sStart.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">      </span><span class="NAME">sEnd.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">      </span><span class="NAME">sEnd.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">end</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">      </span><span class="NAME">ctx.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineCap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'round'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondThickness</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="WHIT">      </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1483</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.25</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opts.bondThickness</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">3.0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">changed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="WHIT">  
<span class='line'>1486</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">step</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">dir</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">startDash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dashOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1491</span> </span><span class="WHIT">  
<span class='line'>1492</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">changed</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">          </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1494</span> </span><span class="WHIT">          </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1495</span> </span><span class="WHIT">          </span><span class="NAME">ctx.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">line.getRightElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">          </span><span class="NAME">changed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">  
<span class='line'>1499</span>         </span><span class="NAME">startDash.subtract</span><span class="PUNC">(</span><span class="NAME">dashOffset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1500</span> </span><span class="WHIT">        </span><span class="NAME">ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">startDash.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startDash.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1501</span> </span><span class="WHIT">        </span><span class="NAME">startDash.add</span><span class="PUNC">(</span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">dashOffset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1502</span> </span><span class="WHIT">        </span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">startDash.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startDash.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="WHIT">  
<span class='line'>1505</span>       </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">      </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1509</span>      * Draws a debug text message at a given position
<span class='line'>1510</span>      *
<span class='line'>1511</span>      * @param {Number} x The x coordinate.
<span class='line'>1512</span>      * @param {Number} y The y coordinate.
<span class='line'>1513</span>      * @param {String} text The debug text.
<span class='line'>1514</span>      */</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">  
<span class='line'>1516</span>   
<span class='line'>1517</span>     </span><span class="NAME">drawDebugText</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">text</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">      </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1520</span> </span><span class="WHIT">      </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'5px Droid Sans, sans-serif'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">      </span><span class="NAME">ctx.textAlign</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'start'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="WHIT">      </span><span class="NAME">ctx.textBaseline</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'top'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1523</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'#ff0000'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">      </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1528</span>      * Draw a ball to the canvas.
<span class='line'>1529</span>      *
<span class='line'>1530</span>      * @param {Number} x The x position of the text.
<span class='line'>1531</span>      * @param {Number} y The y position of the text.
<span class='line'>1532</span>      * @param {String} elementName The name of the element (single-letter).
<span class='line'>1533</span>      */</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="WHIT">  
<span class='line'>1535</span>   
<span class='line'>1536</span>     </span><span class="NAME">drawBall</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">      </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1539</span> </span><span class="WHIT">      </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">      </span><span class="NAME">ctx.arc</span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">4.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">MathHelper.twoPI</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">      </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1546</span>      * Draw a point to the canvas.
<span class='line'>1547</span>      *
<span class='line'>1548</span>      * @param {Number} x The x position of the point.
<span class='line'>1549</span>      * @param {Number} y The y position of the point.
<span class='line'>1550</span>      * @param {String} elementName The name of the element (single-letter).
<span class='line'>1551</span>      */</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">  
<span class='line'>1553</span>   
<span class='line'>1554</span>     </span><span class="NAME">drawPoint</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1558</span> </span><span class="WHIT">      </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1559</span> </span><span class="WHIT">      </span><span class="NAME">ctx.globalCompositeOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'destination-out'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">      </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">      </span><span class="NAME">ctx.arc</span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">MathHelper.twoPI</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1562</span> </span><span class="WHIT">      </span><span class="NAME">ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1563</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">      </span><span class="NAME">ctx.globalCompositeOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'source-over'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">      </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1566</span> </span><span class="WHIT">      </span><span class="NAME">ctx.arc</span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.75</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">MathHelper.twoPI</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1567</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1568</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">      </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1572</span>      * Draw a text to the canvas.
<span class='line'>1573</span>      *
<span class='line'>1574</span>      * @param {Number} x The x position of the text.
<span class='line'>1575</span>      * @param {Number} y The y position of the text.
<span class='line'>1576</span>      * @param {String} elementName The name of the element (single-letter).
<span class='line'>1577</span>      * @param {Number} hydrogens The number of hydrogen atoms.
<span class='line'>1578</span>      * @param {String} direction The direction of the text in relation to the associated vertex.
<span class='line'>1579</span>      * @param {Boolean} isTerminal A boolean indicating whether or not the vertex is terminal.
<span class='line'>1580</span>      * @param {Number} charge The charge of the atom.
<span class='line'>1581</span>      * @param {Number} isotope The isotope number.
<span class='line'>1582</span>      * @param {Object} attachedPseudoElement A map with containing information for pseudo elements or concatinated elements. The key is comprised of the element symbol and the hydrogen count.
<span class='line'>1583</span>      * @param {String} attachedPseudoElement.element The element symbol.
<span class='line'>1584</span>      * @param {Number} attachedPseudoElement.count The number of occurences that match the key.
<span class='line'>1585</span>      * @param {Number} attachedPseudoElement.hyrogenCount The number of hydrogens attached to each atom matching the key.
<span class='line'>1586</span>      */</span><span class="WHIT">
<span class='line'>1587</span> </span><span class="WHIT">  
<span class='line'>1588</span>   
<span class='line'>1589</span>     </span><span class="NAME">drawText</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hydrogens</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isotope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1593</span> </span><span class="WHIT">      </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1594</span> </span><span class="WHIT">      </span><span class="NAME">ctx.textAlign</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'start'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1595</span> </span><span class="WHIT">      </span><span class="NAME">ctx.textBaseline</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'alphabetic'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1596</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pseudoElementHandled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Charge</span><span class="WHIT">
<span class='line'>1597</span> </span><span class="WHIT">  
<span class='line'>1598</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">chargeText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1599</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">chargeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1600</span> </span><span class="WHIT">  
<span class='line'>1601</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1602</span> </span><span class="WHIT">        </span><span class="NAME">chargeText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getChargeText</span><span class="PUNC">(</span><span class="NAME">charge</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1603</span> </span><span class="WHIT">        </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontSmall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1604</span> </span><span class="WHIT">        </span><span class="NAME">chargeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.measureText</span><span class="PUNC">(</span><span class="NAME">chargeText</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1605</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1606</span> </span><span class="WHIT">  
<span class='line'>1607</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isotopeText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1608</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isotopeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">  
<span class='line'>1610</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isotope</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1611</span> </span><span class="WHIT">        </span><span class="NAME">isotopeText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isotope.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1612</span> </span><span class="WHIT">        </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontSmall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1613</span> </span><span class="WHIT">        </span><span class="NAME">isotopeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.measureText</span><span class="PUNC">(</span><span class="NAME">isotopeText</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1614</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// TODO: Better handle exceptions</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="WHIT">      </span><span class="COMM">// Exception for nitro (draw nitro as NO2 instead of N+O-O)</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="WHIT">  
<span class='line'>1617</span>   
<span class='line'>1618</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">elementName</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'N'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'0O'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'0O-1'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">        </span><span class="NAME">attachedPseudoElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">          </span><span class="STRN">'0O'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">            </span><span class="NAME">element</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'O'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">            </span><span class="NAME">count</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">            </span><span class="NAME">hydrogenCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1624</span> </span><span class="WHIT">            </span><span class="NAME">previousElement</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">            </span><span class="NAME">charge</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">        </span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1629</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1630</span> </span><span class="WHIT">  
<span class='line'>1631</span>       </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'BACKGROUND'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1633</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.measureText</span><span class="PUNC">(</span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="WHIT">      </span><span class="NAME">dim.totalWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dim.width</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">chargeWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1635</span> </span><span class="WHIT">      </span><span class="NAME">dim.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.fontLarge</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1636</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dim.width</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">dim.width</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1637</span> </span><span class="WHIT">      </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1638</span> </span><span class="WHIT">      </span><span class="NAME">ctx.globalCompositeOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'destination-out'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1639</span> </span><span class="WHIT">      </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1640</span> </span><span class="WHIT">      </span><span class="NAME">ctx.arc</span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">MathHelper.twoPI</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1641</span> </span><span class="WHIT">      </span><span class="NAME">ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="WHIT">      </span><span class="NAME">ctx.globalCompositeOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'source-over'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">dim.width</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1645</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">dim.width</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">      </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">elementName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.halfFontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">      </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dim.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1649</span> </span><span class="WHIT">  
<span class='line'>1650</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1651</span> </span><span class="WHIT">        </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontSmall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1652</span> </span><span class="WHIT">        </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">chargeText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.fifthFontSizeSmall</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1653</span> </span><span class="WHIT">        </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">chargeWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1654</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1655</span> </span><span class="WHIT">  
<span class='line'>1656</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isotope</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1657</span> </span><span class="WHIT">        </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontSmall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1658</span> </span><span class="WHIT">        </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">isotopeText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">isotopeWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.fifthFontSizeSmall</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="WHIT">        </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isotopeWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1661</span> </span><span class="WHIT">  
<span class='line'>1662</span>       </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hydrogenCountWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">  
<span class='line'>1666</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.halfFontSizeLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1669</span> </span><span class="WHIT">        </span><span class="NAME">hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.hydrogenWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1670</span> </span><span class="WHIT">        </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hydrogenWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">  
<span class='line'>1672</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'right'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">          </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.quarterFontSizeLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1682</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.halfHydrogenWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">          </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.quarterFontSizeLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.halfHydrogenWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">  
<span class='line'>1688</span>         </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">        </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hydrogenWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1692</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.halfFontSizeLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1693</span> </span><span class="WHIT">        </span><span class="NAME">hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.hydrogenWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1694</span> </span><span class="WHIT">        </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontSmall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1695</span> </span><span class="WHIT">        </span><span class="NAME">hydrogenCountWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.measureText</span><span class="PUNC">(</span><span class="NAME">hydrogens</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1696</span> </span><span class="WHIT">        </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hydrogenCountWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">  
<span class='line'>1698</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'right'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1703</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1704</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1705</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1706</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1707</span> </span><span class="WHIT">          </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.quarterFontSizeLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1708</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.halfHydrogenWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1709</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1710</span> </span><span class="WHIT">          </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.quarterFontSizeLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1711</span> </span><span class="WHIT">          </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.halfHydrogenWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1712</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1713</span> </span><span class="WHIT">  
<span class='line'>1714</span>         </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1715</span> </span><span class="WHIT">        </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1716</span> </span><span class="WHIT">        </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontSmall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1717</span> </span><span class="WHIT">        </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">hydrogens</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.halfHydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hydrogenCountWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.fifthFontSizeSmall</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1718</span> </span><span class="WHIT">        </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.halfHydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hydrogenCountWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1719</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1720</span> </span><span class="WHIT">  
<span class='line'>1721</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pseudoElementHandled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1722</span> </span><span class="WHIT">        </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1723</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1724</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1725</span> </span><span class="WHIT">  
<span class='line'>1726</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1727</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">attachedPseudoElement.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1728</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">  
<span class='line'>1731</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">openParenthesisWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1732</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">closeParenthesisWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1733</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elementCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">count</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1735</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hydrogenCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1736</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elementCharge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">charge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1737</span> </span><span class="WHIT">        </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1738</span> </span><span class="WHIT">  
<span class='line'>1739</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">          </span><span class="NAME">openParenthesisWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.measureText</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1741</span> </span><span class="WHIT">          </span><span class="NAME">closeParenthesisWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.measureText</span><span class="PUNC">(</span><span class="STRN">')'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1742</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1743</span> </span><span class="WHIT">  
<span class='line'>1744</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elementWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.measureText</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elementCountWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elementChargeText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elementChargeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1748</span> </span><span class="WHIT">        </span><span class="NAME">hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1749</span> </span><span class="WHIT">  
<span class='line'>1750</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1751</span> </span><span class="WHIT">          </span><span class="NAME">hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.hydrogenWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1752</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">  
<span class='line'>1754</span>         </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontSmall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="WHIT">  
<span class='line'>1756</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="WHIT">          </span><span class="NAME">elementCountWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.measureText</span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">  
<span class='line'>1760</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementCharge</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1761</span> </span><span class="WHIT">          </span><span class="NAME">elementChargeText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getChargeText</span><span class="PUNC">(</span><span class="NAME">elementCharge</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="WHIT">          </span><span class="NAME">elementChargeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.measureText</span><span class="PUNC">(</span><span class="NAME">elementChargeText</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">  
<span class='line'>1765</span>         </span><span class="NAME">hydrogenCountWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">  
<span class='line'>1767</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="WHIT">          </span><span class="NAME">hydrogenCountWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.measureText</span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">  
<span class='line'>1771</span>         </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1773</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.halfFontSizeLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">        </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="WHIT">  
<span class='line'>1776</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1777</span> </span><span class="WHIT">          </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementCountWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1778</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1779</span> </span><span class="WHIT">  
<span class='line'>1780</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1781</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1782</span> </span><span class="WHIT">            </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">closeParenthesisWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="WHIT">            </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1785</span> </span><span class="WHIT">            </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1786</span> </span><span class="WHIT">            </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">openParenthesisWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1787</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1788</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1789</span> </span><span class="WHIT">  
<span class='line'>1790</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1791</span> </span><span class="WHIT">          </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="WHIT">          </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1794</span> </span><span class="WHIT">          </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1795</span> </span><span class="WHIT">          </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1796</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">  
<span class='line'>1798</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">            </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hydrogenCountWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">            </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1802</span> </span><span class="WHIT">  
<span class='line'>1803</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1804</span> </span><span class="WHIT">              </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontSmall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">              </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hydrogenWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.fifthFontSizeSmall</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="WHIT">            </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1809</span> </span><span class="WHIT">            </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hydrogenWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1810</span> </span><span class="WHIT">  
<span class='line'>1811</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="WHIT">              </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontSmall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1813</span> </span><span class="WHIT">              </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.fifthFontSizeSmall</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1814</span> </span><span class="WHIT">              </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hydrogenCountWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1815</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1816</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1817</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1818</span> </span><span class="WHIT">  
<span class='line'>1819</span>         </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontLarge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1820</span> </span><span class="WHIT">  
<span class='line'>1821</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1822</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1823</span> </span><span class="WHIT">            </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">openParenthesisWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1824</span> </span><span class="WHIT">            </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1825</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1826</span> </span><span class="WHIT">            </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="STRN">')'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="WHIT">            </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">closeParenthesisWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1828</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1830</span> </span><span class="WHIT">  
<span class='line'>1831</span>         </span><span class="NAME">ctx.font</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fontSmall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="WHIT">  
<span class='line'>1833</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1835</span> </span><span class="WHIT">            </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">openParenthesisWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">closeParenthesisWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hydrogenCountWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">elementWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.fifthFontSizeSmall</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">            </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.opts.fifthFontSizeSmall</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">            </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementCountWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">  
<span class='line'>1842</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementCharge</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">            </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">elementChargeText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPosLeft</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">openParenthesisWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">closeParenthesisWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hydrogenWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hydrogenCountWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">elementWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.fifthFontSizeSmall</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1846</span> </span><span class="WHIT">            </span><span class="NAME">ctx.fillText</span><span class="PUNC">(</span><span class="NAME">elementChargeText</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cursorPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.fifthFontSizeSmall</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1847</span> </span><span class="WHIT">            </span><span class="NAME">cursorPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementChargeWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1848</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1850</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">  
<span class='line'>1852</span>       </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1855</span>      * Translate the integer indicating the charge to the appropriate text.
<span class='line'>1856</span>      * @param {Number} charge The integer indicating the charge.
<span class='line'>1857</span>      * @returns {String} A string representing a charge.
<span class='line'>1858</span>      */</span><span class="WHIT">
<span class='line'>1859</span> </span><span class="WHIT">  
<span class='line'>1860</span>   
<span class='line'>1861</span>     </span><span class="NAME">getChargeText</span><span class="PUNC">(</span><span class="NAME">charge</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1862</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1863</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'+'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1864</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1865</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'2+'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1866</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1867</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1868</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1869</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'2-'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1870</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1871</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1872</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1875</span>      * Draws a dubug dot at a given coordinate and adds text.
<span class='line'>1876</span>      *
<span class='line'>1877</span>      * @param {Number} x The x coordinate.
<span class='line'>1878</span>      * @param {Number} y The y coordindate.
<span class='line'>1879</span>      * @param {String} [debugText=''] A string.
<span class='line'>1880</span>      * @param {String} [color='#f00'] A color in hex form.
<span class='line'>1881</span>      */</span><span class="WHIT">
<span class='line'>1882</span> </span><span class="WHIT">  
<span class='line'>1883</span>   
<span class='line'>1884</span>     </span><span class="NAME">drawDebugPoint</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debugText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'#f00'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="WHIT">      </span><span class="NAME">this.drawCircle</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">color</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debugText</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1888</span>      * Draws a ring inside a provided ring, indicating aromaticity.
<span class='line'>1889</span>      *
<span class='line'>1890</span>      * @param {Ring} ring A ring.
<span class='line'>1891</span>      */</span><span class="WHIT">
<span class='line'>1892</span> </span><span class="WHIT">  
<span class='line'>1893</span>   
<span class='line'>1894</span>     </span><span class="NAME">drawAromaticityRing</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1895</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1896</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.apothemFromSideLength</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1897</span> </span><span class="WHIT">      </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1898</span> </span><span class="WHIT">      </span><span class="NAME">ctx.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1899</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondThickness</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1900</span> </span><span class="WHIT">      </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1901</span> </span><span class="WHIT">      </span><span class="NAME">ctx.arc</span><span class="PUNC">(</span><span class="NAME">ring.center.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring.center.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.bondSpacing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1902</span> </span><span class="WHIT">      </span><span class="NAME">ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1903</span> </span><span class="WHIT">      </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1904</span> </span><span class="WHIT">      </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1905</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1906</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1907</span>      * Clear the canvas.
<span class='line'>1908</span>      *
<span class='line'>1909</span>      */</span><span class="WHIT">
<span class='line'>1910</span> </span><span class="WHIT">  
<span class='line'>1911</span>   
<span class='line'>1912</span>     </span><span class="NAME">clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1913</span> </span><span class="WHIT">      </span><span class="NAME">this.ctx.clearRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.canvas.offsetWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.canvas.offsetHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1914</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1915</span> </span><span class="WHIT">  
<span class='line'>1916</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1917</span> </span><span class="WHIT">  
<span class='line'>1918</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CanvasWrapper</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="WHIT">  
<span class='line'>1920</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./Line"</span><span class="PUNC">:</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="STRN">"./MathHelper"</span><span class="PUNC">:</span><span class="NUMB">9</span><span class="PUNC">,</span><span class="STRN">"./Ring"</span><span class="PUNC">:</span><span class="NUMB">11</span><span class="PUNC">,</span><span class="STRN">"./UtilityFunctions"</span><span class="PUNC">:</span><span class="NUMB">17</span><span class="PUNC">,</span><span class="STRN">"./Vector2"</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">,</span><span class="STRN">"./Vertex"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1922</span> </span><span class="WHIT">  
<span class='line'>1923</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>1924</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">MathHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./MathHelper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1925</span> </span><span class="WHIT">  
<span class='line'>1926</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">ArrayHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./ArrayHelper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1927</span> </span><span class="WHIT">  
<span class='line'>1928</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vector2'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="WHIT">  
<span class='line'>1930</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Line'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1931</span> </span><span class="WHIT">  
<span class='line'>1932</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vertex'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1933</span> </span><span class="WHIT">  
<span class='line'>1934</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Edge'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1935</span> </span><span class="WHIT">  
<span class='line'>1936</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Atom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Atom'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1937</span> </span><span class="WHIT">  
<span class='line'>1938</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Ring'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="WHIT">  
<span class='line'>1940</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">RingConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./RingConnection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1941</span> </span><span class="WHIT">  
<span class='line'>1942</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">CanvasWrapper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./CanvasWrapper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1943</span> </span><span class="WHIT">  
<span class='line'>1944</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Graph</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Graph'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1945</span> </span><span class="WHIT">  
<span class='line'>1946</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">SSSR</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./SSSR'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1947</span> </span><span class="WHIT">  
<span class='line'>1948</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">ThemeManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./ThemeManager'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1949</span> </span><span class="WHIT">  </span><span class="COMM">/** 
<span class='line'>1950</span>    * The main class of the application representing the smiles drawer 
<span class='line'>1951</span>    * 
<span class='line'>1952</span>    * @property {Graph} graph The graph associated with this SmilesDrawer.Drawer instance.
<span class='line'>1953</span>    * @property {Number} ringIdCounter An internal counter to keep track of ring ids.
<span class='line'>1954</span>    * @property {Number} ringConnectionIdCounter An internal counter to keep track of ring connection ids.
<span class='line'>1955</span>    * @property {CanvasWrapper} canvasWrapper The CanvasWrapper associated with this SmilesDrawer.Drawer instance.
<span class='line'>1956</span>    * @property {Number} totalOverlapScore The current internal total overlap score.
<span class='line'>1957</span>    * @property {Object} defaultOptions The default options.
<span class='line'>1958</span>    * @property {Object} opts The merged options.
<span class='line'>1959</span>    * @property {Object} theme The current theme.
<span class='line'>1960</span>    */</span><span class="WHIT">
<span class='line'>1961</span> </span><span class="WHIT">  
<span class='line'>1962</span>   
<span class='line'>1963</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">Drawer</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1964</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1965</span>      * The constructor for the class SmilesDrawer.
<span class='line'>1966</span>      *
<span class='line'>1967</span>      * @param {Object} options An object containing custom values for different options. It is merged with the default options.
<span class='line'>1968</span>      */</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1970</span> </span><span class="WHIT">      </span><span class="NAME">this.graph</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1971</span> </span><span class="WHIT">      </span><span class="NAME">this.doubleBondConfigCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1972</span> </span><span class="WHIT">      </span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1973</span> </span><span class="WHIT">      </span><span class="NAME">this.ringIdCounter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1974</span> </span><span class="WHIT">      </span><span class="NAME">this.ringConnectionIdCounter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1975</span> </span><span class="WHIT">      </span><span class="NAME">this.canvasWrapper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1976</span> </span><span class="WHIT">      </span><span class="NAME">this.totalOverlapScore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1977</span> </span><span class="WHIT">      </span><span class="NAME">this.defaultOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1978</span> </span><span class="WHIT">        </span><span class="NAME">width</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">500</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1979</span> </span><span class="WHIT">        </span><span class="NAME">height</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">500</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1980</span> </span><span class="WHIT">        </span><span class="NAME">bondThickness</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1981</span> </span><span class="WHIT">        </span><span class="NAME">bondLength</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1982</span> </span><span class="WHIT">        </span><span class="NAME">shortBondLength</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.85</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1983</span> </span><span class="WHIT">        </span><span class="NAME">bondSpacing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.18</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1984</span> </span><span class="WHIT">        </span><span class="NAME">atomVisualization</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'default'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1985</span> </span><span class="WHIT">        </span><span class="NAME">isomeric</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1986</span> </span><span class="WHIT">        </span><span class="NAME">debug</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1987</span> </span><span class="WHIT">        </span><span class="NAME">terminalCarbons</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1988</span> </span><span class="WHIT">        </span><span class="NAME">explicitHydrogens</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1989</span> </span><span class="WHIT">        </span><span class="NAME">overlapSensitivity</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.42</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1990</span> </span><span class="WHIT">        </span><span class="NAME">overlapResolutionIterations</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1991</span> </span><span class="WHIT">        </span><span class="NAME">compactDrawing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1992</span> </span><span class="WHIT">        </span><span class="NAME">fontSizeLarge</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1993</span> </span><span class="WHIT">        </span><span class="NAME">fontSizeSmall</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="WHIT">        </span><span class="NAME">padding</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">20.0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1995</span> </span><span class="WHIT">        </span><span class="NAME">experimentalSSSR</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1996</span> </span><span class="WHIT">        </span><span class="NAME">kkThreshold</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1997</span> </span><span class="WHIT">        </span><span class="NAME">kkInnerThreshold</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="WHIT">        </span><span class="NAME">kkMaxIteration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">20000</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1999</span> </span><span class="WHIT">        </span><span class="NAME">kkMaxInnerIteration</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2000</span> </span><span class="WHIT">        </span><span class="NAME">kkMaxEnergy</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="NAME">e9</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2001</span> </span><span class="WHIT">        </span><span class="NAME">themes</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2002</span> </span><span class="WHIT">          </span><span class="NAME">dark</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2003</span> </span><span class="WHIT">            </span><span class="NAME">C</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#fff'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2004</span> </span><span class="WHIT">            </span><span class="NAME">O</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#e74c3c'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="WHIT">            </span><span class="NAME">N</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#3498db'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">            </span><span class="NAME">F</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#27ae60'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">            </span><span class="NAME">CL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#16a085'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2008</span> </span><span class="WHIT">            </span><span class="NAME">BR</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#d35400'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="WHIT">            </span><span class="NAME">I</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#8e44ad'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2010</span> </span><span class="WHIT">            </span><span class="NAME">P</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#d35400'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2011</span> </span><span class="WHIT">            </span><span class="NAME">S</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#f1c40f'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2012</span> </span><span class="WHIT">            </span><span class="NAME">B</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#e67e22'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2013</span> </span><span class="WHIT">            </span><span class="NAME">SI</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#e67e22'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="WHIT">            </span><span class="NAME">H</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#fff'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2015</span> </span><span class="WHIT">            </span><span class="NAME">BACKGROUND</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#141414'</span><span class="WHIT">
<span class='line'>2016</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2017</span> </span><span class="WHIT">          </span><span class="NAME">light</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">            </span><span class="NAME">C</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#222'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2019</span> </span><span class="WHIT">            </span><span class="NAME">O</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#e74c3c'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2020</span> </span><span class="WHIT">            </span><span class="NAME">N</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#3498db'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2021</span> </span><span class="WHIT">            </span><span class="NAME">F</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#27ae60'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2022</span> </span><span class="WHIT">            </span><span class="NAME">CL</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#16a085'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2023</span> </span><span class="WHIT">            </span><span class="NAME">BR</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#d35400'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2024</span> </span><span class="WHIT">            </span><span class="NAME">I</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#8e44ad'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2025</span> </span><span class="WHIT">            </span><span class="NAME">P</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#d35400'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="WHIT">            </span><span class="NAME">S</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#f1c40f'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2027</span> </span><span class="WHIT">            </span><span class="NAME">B</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#e67e22'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="WHIT">            </span><span class="NAME">SI</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#e67e22'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2029</span> </span><span class="WHIT">            </span><span class="NAME">H</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#222'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2030</span> </span><span class="WHIT">            </span><span class="NAME">BACKGROUND</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'#fff'</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">      </span><span class="NAME">this.opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.extend</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.defaultOptions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="WHIT">      </span><span class="NAME">this.opts.halfBondSpacing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondSpacing</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">      </span><span class="NAME">this.opts.bondLengthSq</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">      </span><span class="NAME">this.opts.halfFontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">      </span><span class="NAME">this.opts.quarterFontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeLarge</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">4.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">      </span><span class="NAME">this.opts.fifthFontSizeSmall</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.fontSizeSmall</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">5.0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Set the default theme.</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">  
<span class='line'>2041</span>       </span><span class="NAME">this.theme</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.themes.dark</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2044</span>      * A helper method to extend the default options with user supplied ones.
<span class='line'>2045</span>      */</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">  
<span class='line'>2047</span>   
<span class='line'>2048</span>     </span><span class="NAME">extend</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2050</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">extended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">deep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2054</span> </span><span class="WHIT">  
<span class='line'>2055</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Object.prototype.toString.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'[object Boolean]'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2056</span> </span><span class="WHIT">        </span><span class="NAME">deep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2057</span> </span><span class="WHIT">        </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2059</span> </span><span class="WHIT">  
<span class='line'>2060</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">merge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2061</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Object.prototype.hasOwnProperty.call</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2063</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">deep</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">Object.prototype.toString.call</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'[object Object]'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2064</span> </span><span class="WHIT">              </span><span class="NAME">extended</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">that.extend</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">extended</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2065</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2066</span> </span><span class="WHIT">              </span><span class="NAME">extended</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2067</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2068</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2069</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2070</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="WHIT">  
<span class='line'>2072</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2073</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="WHIT">        </span><span class="NAME">merge</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2075</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="WHIT">  
<span class='line'>2077</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">extended</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2078</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2079</span> </span><span class="WHIT">  
<span class='line'>2080</span>     </span><span class="COMM">/**
<span class='line'>2081</span>      * Draws the parsed smiles data to a canvas element.
<span class='line'>2082</span>      *
<span class='line'>2083</span>      * @param {Object} data The tree returned by the smiles parser.
<span class='line'>2084</span>      * @param {(String|HTMLElement)} target The id of the HTML canvas element the structure is drawn to - or the element itself.
<span class='line'>2085</span>      * @param {String} themeName='dark' The name of the theme to use. Built-in themes are 'light' and 'dark'.
<span class='line'>2086</span>      * @param {Boolean} infoOnly=false Only output info on the molecule without drawing anything to the canvas.
<span class='line'>2087</span>      */</span><span class="WHIT">
<span class='line'>2088</span> </span><span class="WHIT">    </span><span class="NAME">draw</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">themeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'light'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">infoOnly</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2089</span> </span><span class="WHIT">      </span><span class="NAME">this.initDraw</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">themeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">infoOnly</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2090</span> </span><span class="WHIT">  
<span class='line'>2091</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.infoOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2092</span> </span><span class="WHIT">        </span><span class="NAME">this.themeManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ThemeManager</span><span class="PUNC">(</span><span class="NAME">this.opts.themes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">themeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2093</span> </span><span class="WHIT">        </span><span class="NAME">this.canvasWrapper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">CanvasWrapper</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2094</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2095</span> </span><span class="WHIT">  
<span class='line'>2096</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">infoOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2097</span> </span><span class="WHIT">        </span><span class="NAME">this.processGraph</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Set the canvas to the appropriate size</span><span class="WHIT">
<span class='line'>2098</span> </span><span class="WHIT">  
<span class='line'>2099</span>         </span><span class="NAME">this.canvasWrapper.scale</span><span class="PUNC">(</span><span class="NAME">this.graph.vertices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Do the actual drawing</span><span class="WHIT">
<span class='line'>2100</span> </span><span class="WHIT">  
<span class='line'>2101</span>         </span><span class="NAME">this.drawEdges</span><span class="PUNC">(</span><span class="NAME">this.opts.debug</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2102</span> </span><span class="WHIT">        </span><span class="NAME">this.drawVertices</span><span class="PUNC">(</span><span class="NAME">this.opts.debug</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2103</span> </span><span class="WHIT">        </span><span class="NAME">this.canvasWrapper.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2104</span> </span><span class="WHIT">  
<span class='line'>2105</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opts.debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2106</span> </span><span class="WHIT">          </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">this.graph</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2107</span> </span><span class="WHIT">          </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2108</span> </span><span class="WHIT">          </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">this.ringConnections</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2109</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2110</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2111</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2112</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2113</span>      * Returns the number of rings this edge is a part of.
<span class='line'>2114</span>      *
<span class='line'>2115</span>      * @param {Number} edgeId The id of an edge.
<span class='line'>2116</span>      * @returns {Number} The number of rings the provided edge is part of.
<span class='line'>2117</span>      */</span><span class="WHIT">
<span class='line'>2118</span> </span><span class="WHIT">  
<span class='line'>2119</span>   
<span class='line'>2120</span>     </span><span class="NAME">edgeRingCount</span><span class="PUNC">(</span><span class="NAME">edgeId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2121</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.edges</span><span class="PUNC">[</span><span class="NAME">edgeId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2122</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2123</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2124</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">a.value.rings.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b.value.rings.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2125</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2126</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2127</span>      * Returns an array containing the bridged rings associated with this  molecule.
<span class='line'>2128</span>      *
<span class='line'>2129</span>      * @returns {Ring[]} An array containing all bridged rings associated with this molecule.
<span class='line'>2130</span>      */</span><span class="WHIT">
<span class='line'>2131</span> </span><span class="WHIT">  
<span class='line'>2132</span>   
<span class='line'>2133</span>     </span><span class="NAME">getBridgedRings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2134</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bridgedRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2135</span> </span><span class="WHIT">  
<span class='line'>2136</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2137</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isBridged</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="WHIT">          </span><span class="NAME">bridgedRings.push</span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2139</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2140</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2141</span> </span><span class="WHIT">  
<span class='line'>2142</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">bridgedRings</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2143</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2144</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2145</span>      * Returns an array containing all fused rings associated with this molecule.
<span class='line'>2146</span>      *
<span class='line'>2147</span>      * @returns {Ring[]} An array containing all fused rings associated with this molecule.
<span class='line'>2148</span>      */</span><span class="WHIT">
<span class='line'>2149</span> </span><span class="WHIT">  
<span class='line'>2150</span>   
<span class='line'>2151</span>     </span><span class="NAME">getFusedRings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2152</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">fusedRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2153</span> </span><span class="WHIT">  
<span class='line'>2154</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2155</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isFused</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2156</span> </span><span class="WHIT">          </span><span class="NAME">fusedRings.push</span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2157</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2158</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2159</span> </span><span class="WHIT">  
<span class='line'>2160</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">fusedRings</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2161</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2163</span>      * Returns an array containing all spiros associated with this molecule.
<span class='line'>2164</span>      *
<span class='line'>2165</span>      * @returns {Ring[]} An array containing all spiros associated with this molecule.
<span class='line'>2166</span>      */</span><span class="WHIT">
<span class='line'>2167</span> </span><span class="WHIT">  
<span class='line'>2168</span>   
<span class='line'>2169</span>     </span><span class="NAME">getSpiros</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2170</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">spiros</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2171</span> </span><span class="WHIT">  
<span class='line'>2172</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2173</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isSpiro</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2174</span> </span><span class="WHIT">          </span><span class="NAME">spiros.push</span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2175</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2176</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2177</span> </span><span class="WHIT">  
<span class='line'>2178</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">spiros</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2179</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2180</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2181</span>      * Returns a string containing a semicolon and new-line separated list of ring properties: Id; Members Count; Neighbours Count; IsSpiro; IsFused; IsBridged; Ring Count (subrings of bridged rings)
<span class='line'>2182</span>      *
<span class='line'>2183</span>      * @returns {String} A string as described in the method description.
<span class='line'>2184</span>      */</span><span class="WHIT">
<span class='line'>2185</span> </span><span class="WHIT">  
<span class='line'>2186</span>   
<span class='line'>2187</span>     </span><span class="NAME">printRingInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2188</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2189</span> </span><span class="WHIT">  
<span class='line'>2190</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2191</span> </span><span class="WHIT">        </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2192</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">';'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2193</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.members.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">';'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2194</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.neighbours.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">';'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2195</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.isSpiro</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'true;'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'false;'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2196</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.isFused</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'true;'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'false;'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2197</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.isBridged</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'true;'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'false;'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2198</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.rings.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">';'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2199</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'\n'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2200</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2201</span> </span><span class="WHIT">  
<span class='line'>2202</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2203</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2204</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2205</span>      * Rotates the drawing to make the widest dimension horizontal.
<span class='line'>2206</span>      */</span><span class="WHIT">
<span class='line'>2207</span> </span><span class="WHIT">  
<span class='line'>2208</span>   
<span class='line'>2209</span>     </span><span class="NAME">rotateDrawing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2210</span> </span><span class="WHIT">      </span><span class="COMM">// Rotate the vertices to make the molecule align horizontally</span><span class="WHIT">
<span class='line'>2211</span> </span><span class="WHIT">      </span><span class="COMM">// Find the longest distance</span><span class="WHIT">
<span class='line'>2212</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2213</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2214</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxDist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2215</span> </span><span class="WHIT">  
<span class='line'>2216</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2217</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2218</span> </span><span class="WHIT">  
<span class='line'>2219</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertexA.value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2220</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2221</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2222</span> </span><span class="WHIT">  
<span class='line'>2223</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2224</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2225</span> </span><span class="WHIT">  
<span class='line'>2226</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertexB.value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2227</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2228</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2229</span> </span><span class="WHIT">  
<span class='line'>2230</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexA.position.distanceSq</span><span class="PUNC">(</span><span class="NAME">vertexB.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2231</span> </span><span class="WHIT">  
<span class='line'>2232</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dist</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">maxDist</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2233</span> </span><span class="WHIT">            </span><span class="NAME">maxDist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="WHIT">            </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2235</span> </span><span class="WHIT">            </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2236</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2237</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2238</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2239</span> </span><span class="WHIT">  
<span class='line'>2240</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">angle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2241</span> </span><span class="WHIT">  
<span class='line'>2242</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2243</span> </span><span class="WHIT">        </span><span class="COMM">// Round to 30 degrees</span><span class="WHIT">
<span class='line'>2244</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">remainder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">0.523599</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Round either up or down in 30 degree steps</span><span class="WHIT">
<span class='line'>2245</span> </span><span class="WHIT">  
<span class='line'>2246</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">remainder</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.2617995</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2247</span> </span><span class="WHIT">          </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">remainder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2248</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2249</span> </span><span class="WHIT">          </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.523599</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">remainder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2250</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Finally, rotate everything</span><span class="WHIT">
<span class='line'>2251</span> </span><span class="WHIT">  
<span class='line'>2252</span>   
<span class='line'>2253</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2254</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2255</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2256</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2257</span> </span><span class="WHIT">  
<span class='line'>2258</span>           </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position.rotateAround</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2259</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2260</span> </span><span class="WHIT">  
<span class='line'>2261</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2262</span> </span><span class="WHIT">          </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">center.rotateAround</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2263</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2264</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2265</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2266</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2267</span>      * Returns the total overlap score of the current molecule.
<span class='line'>2268</span>      *
<span class='line'>2269</span>      * @returns {Number} The overlap score.
<span class='line'>2270</span>      */</span><span class="WHIT">
<span class='line'>2271</span> </span><span class="WHIT">  
<span class='line'>2272</span>   
<span class='line'>2273</span>     </span><span class="NAME">getTotalOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2274</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.totalOverlapScore</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2275</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2276</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2277</span>      * Returns the ring count of the current molecule.
<span class='line'>2278</span>      *
<span class='line'>2279</span>      * @returns {Number} The ring count.
<span class='line'>2280</span>      */</span><span class="WHIT">
<span class='line'>2281</span> </span><span class="WHIT">  
<span class='line'>2282</span>   
<span class='line'>2283</span>     </span><span class="NAME">getRingCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2284</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2285</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2286</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2287</span>      * Checks whether or not the current molecule  a bridged ring.
<span class='line'>2288</span>      *
<span class='line'>2289</span>      * @returns {Boolean} A boolean indicating whether or not the current molecule  a bridged ring.
<span class='line'>2290</span>      */</span><span class="WHIT">
<span class='line'>2291</span> </span><span class="WHIT">  
<span class='line'>2292</span>   
<span class='line'>2293</span>     </span><span class="NAME">hasBridgedRing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2294</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.bridgedRing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2296</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2297</span>      * Returns the number of heavy atoms (non-hydrogen) in the current molecule.
<span class='line'>2298</span>      *
<span class='line'>2299</span>      * @returns {Number} The heavy atom count.
<span class='line'>2300</span>      */</span><span class="WHIT">
<span class='line'>2301</span> </span><span class="WHIT">  
<span class='line'>2302</span>   
<span class='line'>2303</span>     </span><span class="NAME">getHeavyAtomCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2304</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hac</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">  
<span class='line'>2306</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">          </span><span class="NAME">hac</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2311</span> </span><span class="WHIT">  
<span class='line'>2312</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">hac</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2315</span>      * Returns the molecular formula of the loaded molecule as a string.
<span class='line'>2316</span>      * 
<span class='line'>2317</span>      * @returns {String} The molecular formula.
<span class='line'>2318</span>      */</span><span class="WHIT">
<span class='line'>2319</span> </span><span class="WHIT">  
<span class='line'>2320</span>   
<span class='line'>2321</span>     </span><span class="NAME">getMolecularFormula</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2322</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">molecularFormula</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">counts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Map</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Initialize element count</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="WHIT">  
<span class='line'>2325</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">atom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">  
<span class='line'>2328</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">counts.has</span><span class="PUNC">(</span><span class="NAME">atom.element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2329</span> </span><span class="WHIT">          </span><span class="NAME">counts.set</span><span class="PUNC">(</span><span class="NAME">atom.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">counts.get</span><span class="PUNC">(</span><span class="NAME">atom.element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2331</span> </span><span class="WHIT">          </span><span class="NAME">counts.set</span><span class="PUNC">(</span><span class="NAME">atom.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2332</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Hydrogens attached to a chiral center were added as vertices,</span><span class="WHIT">
<span class='line'>2333</span> </span><span class="WHIT">        </span><span class="COMM">// those in non chiral brackets are added here</span><span class="WHIT">
<span class='line'>2334</span> </span><span class="WHIT">  
<span class='line'>2335</span>   
<span class='line'>2336</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.bracket</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">atom.bracket.chirality</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2337</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">counts.has</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2338</span> </span><span class="WHIT">            </span><span class="NAME">counts.set</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">counts.get</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">atom.bracket.hcount</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2339</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2340</span> </span><span class="WHIT">            </span><span class="NAME">counts.set</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atom.bracket.hcount</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2341</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2342</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Add the implicit hydrogens according to valency, exclude</span><span class="WHIT">
<span class='line'>2343</span> </span><span class="WHIT">        </span><span class="COMM">// bracket atoms as they were handled and always have the number</span><span class="WHIT">
<span class='line'>2344</span> </span><span class="WHIT">        </span><span class="COMM">// of hydrogens specified explicitly</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">  
<span class='line'>2346</span>   
<span class='line'>2347</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">atom.bracket</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2348</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nHydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Atom.maxBonds</span><span class="PUNC">[</span><span class="NAME">atom.element</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">atom.bondCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2349</span> </span><span class="WHIT">  
<span class='line'>2350</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.isPartOfAromaticRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2351</span> </span><span class="WHIT">            </span><span class="NAME">nHydrogens</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2352</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2353</span> </span><span class="WHIT">  
<span class='line'>2354</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">counts.has</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2355</span> </span><span class="WHIT">            </span><span class="NAME">counts.set</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">counts.get</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nHydrogens</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2356</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2357</span> </span><span class="WHIT">            </span><span class="NAME">counts.set</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nHydrogens</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2358</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2359</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2361</span> </span><span class="WHIT">  
<span class='line'>2362</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">counts.has</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2363</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">counts.get</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2364</span> </span><span class="WHIT">        </span><span class="NAME">molecularFormula</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2365</span> </span><span class="WHIT">        </span><span class="NAME">counts.delete</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2366</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2367</span> </span><span class="WHIT">  
<span class='line'>2368</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">counts.has</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2369</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">counts.get</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2370</span> </span><span class="WHIT">        </span><span class="NAME">molecularFormula</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'H'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2371</span> </span><span class="WHIT">        </span><span class="NAME">counts.delete</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2372</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2373</span> </span><span class="WHIT">  
<span class='line'>2374</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Object.keys</span><span class="PUNC">(</span><span class="NAME">Atom.atomicNumbers</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2375</span> </span><span class="WHIT">      </span><span class="NAME">elements.map</span><span class="PUNC">(</span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2376</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">counts.has</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2377</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">counts.get</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2378</span> </span><span class="WHIT">          </span><span class="NAME">molecularFormula</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2379</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2380</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2381</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">molecularFormula</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2382</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2383</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2384</span>      * Returns the type of the ringbond (e.g. '=' for a double bond). The ringbond represents the break in a ring introduced when creating the MST. If the two vertices supplied as arguments are not part of a common ringbond, the method returns null.
<span class='line'>2385</span>      *
<span class='line'>2386</span>      * @param {Vertex} vertexA A vertex.
<span class='line'>2387</span>      * @param {Vertex} vertexB A vertex.
<span class='line'>2388</span>      * @returns {(String|null)} Returns the ringbond type or null, if the two supplied vertices are not connected by a ringbond.
<span class='line'>2389</span>      */</span><span class="WHIT">
<span class='line'>2390</span> </span><span class="WHIT">  
<span class='line'>2391</span>   
<span class='line'>2392</span>     </span><span class="NAME">getRingbondType</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2393</span> </span><span class="WHIT">      </span><span class="COMM">// Checks whether the two vertices are the ones connecting the ring</span><span class="WHIT">
<span class='line'>2394</span> </span><span class="WHIT">      </span><span class="COMM">// and what the bond type should be.</span><span class="WHIT">
<span class='line'>2395</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexA.value.getRingbondCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">vertexB.value.getRingbondCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2396</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2397</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2398</span> </span><span class="WHIT">  
<span class='line'>2399</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertexA.value.ringbonds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2400</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertexB.value.ringbonds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2401</span> </span><span class="WHIT">          </span><span class="COMM">// if(i != j) continue;</span><span class="WHIT">
<span class='line'>2402</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexA.value.ringbonds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">vertexB.value.ringbonds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2403</span> </span><span class="WHIT">            </span><span class="COMM">// If the bonds are equal, it doesn't matter which bond is returned.</span><span class="WHIT">
<span class='line'>2404</span> </span><span class="WHIT">            </span><span class="COMM">// if they are not equal, return the one that is not the default ("-")</span><span class="WHIT">
<span class='line'>2405</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexA.value.ringbonds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2406</span> </span><span class="WHIT">              </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vertexB.value.ringbonds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bond</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2407</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2408</span> </span><span class="WHIT">              </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vertexA.value.ringbonds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bond</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2409</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2410</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2411</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2412</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2413</span> </span><span class="WHIT">  
<span class='line'>2414</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2415</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2416</span> </span><span class="WHIT">  
<span class='line'>2417</span>     </span><span class="NAME">initDraw</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">themeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">infoOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2418</span> </span><span class="WHIT">      </span><span class="NAME">this.data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2419</span> </span><span class="WHIT">      </span><span class="NAME">this.infoOnly</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">infoOnly</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2420</span> </span><span class="WHIT">      </span><span class="NAME">this.ringIdCounter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2421</span> </span><span class="WHIT">      </span><span class="NAME">this.ringConnectionIdCounter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2422</span> </span><span class="WHIT">      </span><span class="NAME">this.graph</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Graph</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.isomeric</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2423</span> </span><span class="WHIT">      </span><span class="NAME">this.rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2424</span> </span><span class="WHIT">      </span><span class="NAME">this.ringConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2425</span> </span><span class="WHIT">      </span><span class="NAME">this.originalRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2426</span> </span><span class="WHIT">      </span><span class="NAME">this.originalRingConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2427</span> </span><span class="WHIT">      </span><span class="NAME">this.bridgedRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Reset those, in case the previous drawn SMILES had a dangling \ or /</span><span class="WHIT">
<span class='line'>2428</span> </span><span class="WHIT">  
<span class='line'>2429</span>       </span><span class="NAME">this.doubleBondConfigCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2430</span> </span><span class="WHIT">      </span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2431</span> </span><span class="WHIT">      </span><span class="NAME">this.initRings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2432</span> </span><span class="WHIT">      </span><span class="NAME">this.initHydrogens</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2433</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2434</span> </span><span class="WHIT">  
<span class='line'>2435</span>     </span><span class="NAME">processGraph</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2436</span> </span><span class="WHIT">      </span><span class="NAME">this.position</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Restore the ring information (removes bridged rings and replaces them with the original, multiple, rings)</span><span class="WHIT">
<span class='line'>2437</span> </span><span class="WHIT">  
<span class='line'>2438</span>       </span><span class="NAME">this.restoreRingInformation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Atoms bonded to the same ring atom</span><span class="WHIT">
<span class='line'>2439</span> </span><span class="WHIT">  
<span class='line'>2440</span>       </span><span class="NAME">this.resolvePrimaryOverlaps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2441</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">overlapScore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2442</span> </span><span class="WHIT">      </span><span class="NAME">this.totalOverlapScore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">total</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2443</span> </span><span class="WHIT">  
<span class='line'>2444</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.opts.overlapResolutionIterations</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2445</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.edges.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2446</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.edges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2447</span> </span><span class="WHIT">  
<span class='line'>2448</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isEdgeRotatable</span><span class="PUNC">(</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2449</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">subTreeDepthA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">edge.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">edge.targetId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2450</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">subTreeDepthB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">edge.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">edge.sourceId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Only rotate the shorter subtree</span><span class="WHIT">
<span class='line'>2451</span> </span><span class="WHIT">  
<span class='line'>2452</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edge.targetId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2453</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edge.sourceId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2454</span> </span><span class="WHIT">  
<span class='line'>2455</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">subTreeDepthA</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">subTreeDepthB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2456</span> </span><span class="WHIT">              </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edge.sourceId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2457</span> </span><span class="WHIT">              </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edge.targetId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2458</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2459</span> </span><span class="WHIT">  
<span class='line'>2460</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">subTreeOverlap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSubtreeOverlapScore</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlapScore.vertexScores</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2461</span> </span><span class="WHIT">  
<span class='line'>2462</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">subTreeOverlap.value</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.opts.overlapSensitivity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2463</span> </span><span class="WHIT">              </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2464</span> </span><span class="WHIT">              </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2465</span> </span><span class="WHIT">              </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighboursB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexB.getNeighbours</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2466</span> </span><span class="WHIT">  
<span class='line'>2467</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighboursB.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2468</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighboursB</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2469</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour.position.getRotateAwayFromAngle</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">120</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2470</span> </span><span class="WHIT">                </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">neighbour.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// If the new overlap is bigger, undo change</span><span class="WHIT">
<span class='line'>2471</span> </span><span class="WHIT">  
<span class='line'>2472</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">newTotalOverlapScore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">total</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2473</span> </span><span class="WHIT">  
<span class='line'>2474</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newTotalOverlapScore</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.totalOverlapScore</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2475</span> </span><span class="WHIT">                  </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">neighbour.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2476</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2477</span> </span><span class="WHIT">                  </span><span class="NAME">this.totalOverlapScore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newTotalOverlapScore</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2478</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2479</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighboursB.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2480</span> </span><span class="WHIT">                </span><span class="COMM">// Switch places / sides</span><span class="WHIT">
<span class='line'>2481</span> </span><span class="WHIT">                </span><span class="COMM">// If vertex a is in a ring, do nothing</span><span class="WHIT">
<span class='line'>2482</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexB.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertexA.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2483</span> </span><span class="WHIT">                  </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2484</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2485</span> </span><span class="WHIT">  
<span class='line'>2486</span>                 </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbourA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighboursB</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2487</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbourB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighboursB</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2488</span> </span><span class="WHIT">  
<span class='line'>2489</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbourA.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">neighbourB.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2490</span> </span><span class="WHIT">                  </span><span class="COMM">// Both neighbours in same ring. TODO: does this create problems with wedges? (up = down and vice versa?)</span><span class="WHIT">
<span class='line'>2491</span> </span><span class="WHIT">                  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbourA.value.rings</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">neighbourB.value.rings</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2492</span> </span><span class="WHIT">                    </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2493</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// TODO: Rotate circle</span><span class="WHIT">
<span class='line'>2494</span> </span><span class="WHIT">  
<span class='line'>2495</span>                 </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbourA.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">neighbourB.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2496</span> </span><span class="WHIT">                  </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2497</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2498</span> </span><span class="WHIT">                  </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angleA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbourA.position.getRotateAwayFromAngle</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">120</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2499</span> </span><span class="WHIT">                  </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angleB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbourB.position.getRotateAwayFromAngle</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">120</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2500</span> </span><span class="WHIT">                  </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">neighbourA.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angleA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2501</span> </span><span class="WHIT">                  </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">neighbourB.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angleB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2502</span> </span><span class="WHIT">                  </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">newTotalOverlapScore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">total</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2503</span> </span><span class="WHIT">  
<span class='line'>2504</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newTotalOverlapScore</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.totalOverlapScore</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2505</span> </span><span class="WHIT">                    </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">neighbourA.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">angleA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2506</span> </span><span class="WHIT">                    </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">neighbourB.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">angleB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2507</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2508</span> </span><span class="WHIT">                    </span><span class="NAME">this.totalOverlapScore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newTotalOverlapScore</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2509</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2510</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2511</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2512</span> </span><span class="WHIT">  
<span class='line'>2513</span>               </span><span class="NAME">overlapScore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2514</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2515</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2516</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2517</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2518</span> </span><span class="WHIT">  
<span class='line'>2519</span>       </span><span class="NAME">this.resolveSecondaryOverlaps</span><span class="PUNC">(</span><span class="NAME">overlapScore.scores</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2520</span> </span><span class="WHIT">  
<span class='line'>2521</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opts.isomeric</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2522</span> </span><span class="WHIT">        </span><span class="NAME">this.annotateStereochemistry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2523</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Initialize pseudo elements or shortcuts</span><span class="WHIT">
<span class='line'>2524</span> </span><span class="WHIT">  
<span class='line'>2525</span>   
<span class='line'>2526</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opts.compactDrawing</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.opts.atomVisualization</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'default'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2527</span> </span><span class="WHIT">        </span><span class="NAME">this.initPseudoElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2528</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2529</span> </span><span class="WHIT">  
<span class='line'>2530</span>       </span><span class="NAME">this.rotateDrawing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2531</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2532</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2533</span>      * Initializes rings and ringbonds for the current molecule.
<span class='line'>2534</span>      */</span><span class="WHIT">
<span class='line'>2535</span> </span><span class="WHIT">  
<span class='line'>2536</span>   
<span class='line'>2537</span>     </span><span class="NAME">initRings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2538</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">openBonds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Map</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Close the open ring bonds (spanning tree -> graph)</span><span class="WHIT">
<span class='line'>2539</span> </span><span class="WHIT">  
<span class='line'>2540</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2541</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2542</span> </span><span class="WHIT">  
<span class='line'>2543</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.ringbonds.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2544</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2545</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2546</span> </span><span class="WHIT">  
<span class='line'>2547</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertex.value.ringbonds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2548</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringbondId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value.ringbonds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2549</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringbondBond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value.ringbonds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bond</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// If the other ringbond id has not been discovered,</span><span class="WHIT">
<span class='line'>2550</span> </span><span class="WHIT">          </span><span class="COMM">// add it to the open bonds map and continue.</span><span class="WHIT">
<span class='line'>2551</span> </span><span class="WHIT">          </span><span class="COMM">// if the other ringbond id has already been discovered,</span><span class="WHIT">
<span class='line'>2552</span> </span><span class="WHIT">          </span><span class="COMM">// create a bond between the two atoms.</span><span class="WHIT">
<span class='line'>2553</span> </span><span class="WHIT">  
<span class='line'>2554</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">openBonds.has</span><span class="PUNC">(</span><span class="NAME">ringbondId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2555</span> </span><span class="WHIT">            </span><span class="NAME">openBonds.set</span><span class="PUNC">(</span><span class="NAME">ringbondId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringbondBond</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2556</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2557</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sourceVertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2558</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">targetVertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">openBonds.get</span><span class="PUNC">(</span><span class="NAME">ringbondId</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2559</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">targetRingbondBond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">openBonds.get</span><span class="PUNC">(</span><span class="NAME">ringbondId</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2560</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Edge</span><span class="PUNC">(</span><span class="NAME">sourceVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2561</span> </span><span class="WHIT">            </span><span class="NAME">edge.setBondType</span><span class="PUNC">(</span><span class="NAME">targetRingbondBond</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ringbondBond</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2562</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.addEdge</span><span class="PUNC">(</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2563</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">targetVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">targetVertexId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2564</span> </span><span class="WHIT">            </span><span class="NAME">vertex.addRingbondChild</span><span class="PUNC">(</span><span class="NAME">targetVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2565</span> </span><span class="WHIT">            </span><span class="NAME">vertex.value.addNeighbouringElement</span><span class="PUNC">(</span><span class="NAME">targetVertex.value.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2566</span> </span><span class="WHIT">            </span><span class="NAME">targetVertex.addRingbondChild</span><span class="PUNC">(</span><span class="NAME">sourceVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2567</span> </span><span class="WHIT">            </span><span class="NAME">targetVertex.value.addNeighbouringElement</span><span class="PUNC">(</span><span class="NAME">vertex.value.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2568</span> </span><span class="WHIT">            </span><span class="NAME">vertex.edges.push</span><span class="PUNC">(</span><span class="NAME">edgeId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2569</span> </span><span class="WHIT">            </span><span class="NAME">targetVertex.edges.push</span><span class="PUNC">(</span><span class="NAME">edgeId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2570</span> </span><span class="WHIT">            </span><span class="NAME">openBonds.delete</span><span class="PUNC">(</span><span class="NAME">ringbondId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2571</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2572</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2573</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Get the rings in the graph (the SSSR)</span><span class="WHIT">
<span class='line'>2574</span> </span><span class="WHIT">  
<span class='line'>2575</span>   
<span class='line'>2576</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SSSR.getRings</span><span class="PUNC">(</span><span class="NAME">this.graph</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.experimentalSSSR</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2577</span> </span><span class="WHIT">  
<span class='line'>2578</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rings</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2579</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2580</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2581</span> </span><span class="WHIT">  
<span class='line'>2582</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2583</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringVertices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2584</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addRing</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ring</span><span class="PUNC">(</span><span class="NAME">ringVertices</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Add the ring to the atoms</span><span class="WHIT">
<span class='line'>2585</span> </span><span class="WHIT">  
<span class='line'>2586</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringVertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2587</span> </span><span class="WHIT">          </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">ringVertices</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.rings.push</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2588</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2589</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Find connection between rings</span><span class="WHIT">
<span class='line'>2590</span> </span><span class="WHIT">      </span><span class="COMM">// Check for common vertices and create ring connections. This is a bit</span><span class="WHIT">
<span class='line'>2591</span> </span><span class="WHIT">      </span><span class="COMM">// ugly, but the ringcount is always fairly low (&lt; 100)</span><span class="WHIT">
<span class='line'>2592</span> </span><span class="WHIT">  
<span class='line'>2593</span>   
<span class='line'>2594</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2595</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2596</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2597</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2598</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RingConnection</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// If there are no vertices in the ring connection, then there</span><span class="WHIT">
<span class='line'>2599</span> </span><span class="WHIT">          </span><span class="COMM">// is no ring connection</span><span class="WHIT">
<span class='line'>2600</span> </span><span class="WHIT">  
<span class='line'>2601</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ringConnection.vertices.size</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2602</span> </span><span class="WHIT">            </span><span class="NAME">this.addRingConnection</span><span class="PUNC">(</span><span class="NAME">ringConnection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2603</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2604</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2605</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Add neighbours to the rings</span><span class="WHIT">
<span class='line'>2606</span> </span><span class="WHIT">  
<span class='line'>2607</span>   
<span class='line'>2608</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2609</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2610</span> </span><span class="WHIT">        </span><span class="NAME">ring.neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RingConnection.getNeighbours</span><span class="PUNC">(</span><span class="NAME">this.ringConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2611</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Anchor the ring to one of it's members, so that the ring center will always</span><span class="WHIT">
<span class='line'>2612</span> </span><span class="WHIT">      </span><span class="COMM">// be tied to a single vertex when doing repositionings</span><span class="WHIT">
<span class='line'>2613</span> </span><span class="WHIT">  
<span class='line'>2614</span>   
<span class='line'>2615</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2616</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2617</span> </span><span class="WHIT">        </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">ring.members</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.addAnchoredRing</span><span class="PUNC">(</span><span class="NAME">ring.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2618</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Backup the ring information to restore after placing the bridged ring.</span><span class="WHIT">
<span class='line'>2619</span> </span><span class="WHIT">      </span><span class="COMM">// This is needed in order to identify aromatic rings and stuff like this in</span><span class="WHIT">
<span class='line'>2620</span> </span><span class="WHIT">      </span><span class="COMM">// rings that are member of the superring.</span><span class="WHIT">
<span class='line'>2621</span> </span><span class="WHIT">  
<span class='line'>2622</span>   
<span class='line'>2623</span>       </span><span class="NAME">this.backupRingInformation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Replace rings contained by a larger bridged ring with a bridged ring</span><span class="WHIT">
<span class='line'>2624</span> </span><span class="WHIT">  
<span class='line'>2625</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2626</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2627</span> </span><span class="WHIT">  
<span class='line'>2628</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2629</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2630</span> </span><span class="WHIT">  
<span class='line'>2631</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isPartOfBridgedRing</span><span class="PUNC">(</span><span class="NAME">ring.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">ring.isBridged</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2632</span> </span><span class="WHIT">            </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2633</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2634</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2635</span> </span><span class="WHIT">  
<span class='line'>2636</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2637</span> </span><span class="WHIT">          </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2638</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2639</span> </span><span class="WHIT">  
<span class='line'>2640</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRing</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2641</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">involvedRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getBridgedRingRings</span><span class="PUNC">(</span><span class="NAME">ring.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2642</span> </span><span class="WHIT">        </span><span class="NAME">this.bridgedRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2643</span> </span><span class="WHIT">        </span><span class="NAME">this.createBridgedRing</span><span class="PUNC">(</span><span class="NAME">involvedRings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring.members</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Remove the rings</span><span class="WHIT">
<span class='line'>2644</span> </span><span class="WHIT">  
<span class='line'>2645</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">involvedRings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2646</span> </span><span class="WHIT">          </span><span class="NAME">this.removeRing</span><span class="PUNC">(</span><span class="NAME">involvedRings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2647</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2648</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2649</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2650</span> </span><span class="WHIT">  
<span class='line'>2651</span>     </span><span class="NAME">initHydrogens</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2652</span> </span><span class="WHIT">      </span><span class="COMM">// Do not draw hydrogens except when they are connected to a stereocenter connected to two or more rings.</span><span class="WHIT">
<span class='line'>2653</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.opts.explicitHydrogens</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2654</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2655</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2656</span> </span><span class="WHIT">  
<span class='line'>2657</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2658</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2659</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Hydrogens should have only one neighbour, so just take the first</span><span class="WHIT">
<span class='line'>2660</span> </span><span class="WHIT">          </span><span class="COMM">// Also set hasHydrogen true on connected atom</span><span class="WHIT">
<span class='line'>2661</span> </span><span class="WHIT">  
<span class='line'>2662</span>   
<span class='line'>2663</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertex.neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2664</span> </span><span class="WHIT">          </span><span class="NAME">neighbour.value.hasHydrogen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2665</span> </span><span class="WHIT">  
<span class='line'>2666</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">neighbour.value.isStereoCenter</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">neighbour.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">neighbour.value.bridgedRing</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">neighbour.value.bridgedRing</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">neighbour.value.originalRings.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2667</span> </span><span class="WHIT">            </span><span class="NAME">vertex.value.isDrawn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2668</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2669</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2670</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2671</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2672</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2673</span>      * Returns all rings connected by bridged bonds starting from the ring with the supplied ring id.
<span class='line'>2674</span>      *
<span class='line'>2675</span>      * @param {Number} ringId A ring id.
<span class='line'>2676</span>      * @returns {Number[]} An array containing all ring ids of rings part of a bridged ring system.
<span class='line'>2677</span>      */</span><span class="WHIT">
<span class='line'>2678</span> </span><span class="WHIT">  
<span class='line'>2679</span>   
<span class='line'>2680</span>     </span><span class="NAME">getBridgedRingRings</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2681</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">involvedRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2682</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2683</span> </span><span class="WHIT">  
<span class='line'>2684</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">recurse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2685</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">that.getRing</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2686</span> </span><span class="WHIT">        </span><span class="NAME">involvedRings.push</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2687</span> </span><span class="WHIT">  
<span class='line'>2688</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ring.neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2689</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2690</span> </span><span class="WHIT">  
<span class='line'>2691</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">involvedRings.indexOf</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">RingConnection.isBridge</span><span class="PUNC">(</span><span class="NAME">that.ringConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">that.graph.vertices</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2692</span> </span><span class="WHIT">            </span><span class="NAME">recurse</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2693</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2694</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2695</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2696</span> </span><span class="WHIT">  
<span class='line'>2697</span>       </span><span class="NAME">recurse</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2698</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.unique</span><span class="PUNC">(</span><span class="NAME">involvedRings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2699</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2700</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2701</span>      * Checks whether or not a ring is part of a bridged ring.
<span class='line'>2702</span>      *
<span class='line'>2703</span>      * @param {Number} ringId A ring id.
<span class='line'>2704</span>      * @returns {Boolean} A boolean indicating whether or not the supplied ring (by id) is part of a bridged ring system.
<span class='line'>2705</span>      */</span><span class="WHIT">
<span class='line'>2706</span> </span><span class="WHIT">  
<span class='line'>2707</span>   
<span class='line'>2708</span>     </span><span class="NAME">isPartOfBridgedRing</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2709</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.ringConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2710</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.ringConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">containsRing</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.ringConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isBridge</span><span class="PUNC">(</span><span class="NAME">this.graph.vertices</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2711</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2712</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2713</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2714</span> </span><span class="WHIT">  
<span class='line'>2715</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2716</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2717</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2718</span>      * Creates a bridged ring.
<span class='line'>2719</span>      *
<span class='line'>2720</span>      * @param {Number[]} ringIds An array of ids of rings involved in the bridged ring.
<span class='line'>2721</span>      * @param {Number} sourceVertexId The vertex id to start the bridged ring discovery from.
<span class='line'>2722</span>      * @returns {Ring} The bridged ring.
<span class='line'>2723</span>      */</span><span class="WHIT">
<span class='line'>2724</span> </span><span class="WHIT">  
<span class='line'>2725</span>   
<span class='line'>2726</span>     </span><span class="NAME">createBridgedRing</span><span class="PUNC">(</span><span class="NAME">ringIds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceVertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2727</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringMembers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Set</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2728</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Set</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2729</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Set</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2730</span> </span><span class="WHIT">  
<span class='line'>2731</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringIds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2732</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRing</span><span class="PUNC">(</span><span class="NAME">ringIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2733</span> </span><span class="WHIT">        </span><span class="NAME">ring.isPartOfBridged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2734</span> </span><span class="WHIT">  
<span class='line'>2735</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ring.members.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2736</span> </span><span class="WHIT">          </span><span class="NAME">vertices.add</span><span class="PUNC">(</span><span class="NAME">ring.members</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2737</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2738</span> </span><span class="WHIT">  
<span class='line'>2739</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ring.neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2740</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.neighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2741</span> </span><span class="WHIT">  
<span class='line'>2742</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ringIds.indexOf</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2743</span> </span><span class="WHIT">            </span><span class="NAME">neighbours.add</span><span class="PUNC">(</span><span class="NAME">ring.neighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2744</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2745</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2746</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// A vertex is part of the bridged ring if it only belongs to</span><span class="WHIT">
<span class='line'>2747</span> </span><span class="WHIT">      </span><span class="COMM">// one of the rings (or to another ring</span><span class="WHIT">
<span class='line'>2748</span> </span><span class="WHIT">      </span><span class="COMM">// which is not part of the bridged ring).</span><span class="WHIT">
<span class='line'>2749</span> </span><span class="WHIT">  
<span class='line'>2750</span>   
<span class='line'>2751</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">leftovers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Set</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2752</span> </span><span class="WHIT">  
<span class='line'>2753</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2754</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2755</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">intersection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.intersection</span><span class="PUNC">(</span><span class="NAME">ringIds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.value.rings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2756</span> </span><span class="WHIT">  
<span class='line'>2757</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">intersection.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2758</span> </span><span class="WHIT">          </span><span class="NAME">ringMembers.add</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2759</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2760</span> </span><span class="WHIT">          </span><span class="NAME">leftovers.add</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2761</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2762</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Vertices can also be part of multiple rings and lay on the bridged ring,</span><span class="WHIT">
<span class='line'>2763</span> </span><span class="WHIT">      </span><span class="COMM">// however, they have to have at least two neighbours that are not part of</span><span class="WHIT">
<span class='line'>2764</span> </span><span class="WHIT">      </span><span class="COMM">// two rings</span><span class="WHIT">
<span class='line'>2765</span> </span><span class="WHIT">  
<span class='line'>2766</span>   
<span class='line'>2767</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2768</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">insideRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2769</span> </span><span class="WHIT">  
<span class='line'>2770</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">leftovers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2771</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2772</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">onRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2773</span> </span><span class="WHIT">  
<span class='line'>2774</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertex.edges.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2775</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.edgeRingCount</span><span class="PUNC">(</span><span class="NAME">vertex.edges</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2776</span> </span><span class="WHIT">            </span><span class="NAME">onRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2777</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2778</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2779</span> </span><span class="WHIT">  
<span class='line'>2780</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">onRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2781</span> </span><span class="WHIT">          </span><span class="NAME">vertex.value.isBridgeNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2782</span> </span><span class="WHIT">          </span><span class="NAME">ringMembers.add</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2783</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2784</span> </span><span class="WHIT">          </span><span class="NAME">vertex.value.isBridge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2785</span> </span><span class="WHIT">          </span><span class="NAME">ringMembers.add</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2786</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2787</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Create the ring</span><span class="WHIT">
<span class='line'>2788</span> </span><span class="WHIT">  
<span class='line'>2789</span>   
<span class='line'>2790</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ring</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">ringMembers</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2791</span> </span><span class="WHIT">      </span><span class="NAME">this.addRing</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2792</span> </span><span class="WHIT">      </span><span class="NAME">ring.isBridged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2793</span> </span><span class="WHIT">      </span><span class="NAME">ring.neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">neighbours</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2794</span> </span><span class="WHIT">  
<span class='line'>2795</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringIds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2796</span> </span><span class="WHIT">        </span><span class="NAME">ring.rings.push</span><span class="PUNC">(</span><span class="NAME">this.getRing</span><span class="PUNC">(</span><span class="NAME">ringIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2797</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2798</span> </span><span class="WHIT">  
<span class='line'>2799</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ring.members.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2800</span> </span><span class="WHIT">        </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">ring.members</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.bridgedRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2801</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Atoms inside the ring are no longer part of a ring but are now</span><span class="WHIT">
<span class='line'>2802</span> </span><span class="WHIT">      </span><span class="COMM">// associated with the bridged ring</span><span class="WHIT">
<span class='line'>2803</span> </span><span class="WHIT">  
<span class='line'>2804</span>   
<span class='line'>2805</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">insideRing.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2806</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">insideRing</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2807</span> </span><span class="WHIT">        </span><span class="NAME">vertex.value.rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2808</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Remove former rings from members of the bridged ring and add the bridged ring</span><span class="WHIT">
<span class='line'>2809</span> </span><span class="WHIT">  
<span class='line'>2810</span>   
<span class='line'>2811</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">ringMembers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2812</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2813</span> </span><span class="WHIT">        </span><span class="NAME">vertex.value.rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.removeAll</span><span class="PUNC">(</span><span class="NAME">vertex.value.rings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringIds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2814</span> </span><span class="WHIT">        </span><span class="NAME">vertex.value.rings.push</span><span class="PUNC">(</span><span class="NAME">ring.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2815</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Remove all the ring connections no longer used</span><span class="WHIT">
<span class='line'>2816</span> </span><span class="WHIT">  
<span class='line'>2817</span>   
<span class='line'>2818</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringIds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2819</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringIds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2820</span> </span><span class="WHIT">          </span><span class="NAME">this.removeRingConnectionsBetween</span><span class="PUNC">(</span><span class="NAME">ringIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringIds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2821</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2822</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Update the ring connections and add this ring to the neighbours neighbours</span><span class="WHIT">
<span class='line'>2823</span> </span><span class="WHIT">  
<span class='line'>2824</span>   
<span class='line'>2825</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2826</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">connections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRingConnections</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringIds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2827</span> </span><span class="WHIT">  
<span class='line'>2828</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2829</span> </span><span class="WHIT">          </span><span class="NAME">this.getRingConnection</span><span class="PUNC">(</span><span class="NAME">connections</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">updateOther</span><span class="PUNC">(</span><span class="NAME">ring.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2830</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2831</span> </span><span class="WHIT">  
<span class='line'>2832</span>         </span><span class="NAME">this.getRing</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">neighbours.push</span><span class="PUNC">(</span><span class="NAME">ring.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2833</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2834</span> </span><span class="WHIT">  
<span class='line'>2835</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2836</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2837</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2838</span>      * Checks whether or not two vertices are in the same ring.
<span class='line'>2839</span>      *
<span class='line'>2840</span>      * @param {Vertex} vertexA A vertex.
<span class='line'>2841</span>      * @param {Vertex} vertexB A vertex.
<span class='line'>2842</span>      * @returns {Boolean} A boolean indicating whether or not the two vertices are in the same ring.
<span class='line'>2843</span>      */</span><span class="WHIT">
<span class='line'>2844</span> </span><span class="WHIT">  
<span class='line'>2845</span>   
<span class='line'>2846</span>     </span><span class="NAME">areVerticesInSameRing</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2847</span> </span><span class="WHIT">      </span><span class="COMM">// This is a little bit lighter (without the array and push) than</span><span class="WHIT">
<span class='line'>2848</span> </span><span class="WHIT">      </span><span class="COMM">// getCommonRings().length > 0</span><span class="WHIT">
<span class='line'>2849</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertexA.value.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2850</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertexB.value.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2851</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexA.value.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">vertexB.value.rings</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2852</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2853</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2854</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2855</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2856</span> </span><span class="WHIT">  
<span class='line'>2857</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2858</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2859</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2860</span>      * Returns an array of ring ids shared by both vertices.
<span class='line'>2861</span>      *
<span class='line'>2862</span>      * @param {Vertex} vertexA A vertex.
<span class='line'>2863</span>      * @param {Vertex} vertexB A vertex.
<span class='line'>2864</span>      * @returns {Number[]} An array of ids of rings shared by the two vertices.
<span class='line'>2865</span>      */</span><span class="WHIT">
<span class='line'>2866</span> </span><span class="WHIT">  
<span class='line'>2867</span>   
<span class='line'>2868</span>     </span><span class="NAME">getCommonRings</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2869</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">commonRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2870</span> </span><span class="WHIT">  
<span class='line'>2871</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertexA.value.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2872</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertexB.value.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2873</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexA.value.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">vertexB.value.rings</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2874</span> </span><span class="WHIT">            </span><span class="NAME">commonRings.push</span><span class="PUNC">(</span><span class="NAME">vertexA.value.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2875</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2876</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2877</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2878</span> </span><span class="WHIT">  
<span class='line'>2879</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">commonRings</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2880</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2881</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2882</span>      * Returns the aromatic or largest ring shared by the two vertices.
<span class='line'>2883</span>      *
<span class='line'>2884</span>      * @param {Vertex} vertexA A vertex.
<span class='line'>2885</span>      * @param {Vertex} vertexB A vertex.
<span class='line'>2886</span>      * @returns {(Ring|null)} If an aromatic common ring exists, that ring, else the largest (non-aromatic) ring, else null.
<span class='line'>2887</span>      */</span><span class="WHIT">
<span class='line'>2888</span> </span><span class="WHIT">  
<span class='line'>2889</span>   
<span class='line'>2890</span>     </span><span class="NAME">getLargestOrAromaticCommonRing</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2891</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">commonRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getCommonRings</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2892</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2893</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">largestCommonRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2894</span> </span><span class="WHIT">  
<span class='line'>2895</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">commonRings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2896</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRing</span><span class="PUNC">(</span><span class="NAME">commonRings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2897</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2898</span> </span><span class="WHIT">  
<span class='line'>2899</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ring.isBenzeneLike</span><span class="PUNC">(</span><span class="NAME">this.graph.vertices</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2900</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2901</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">size</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">maxSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2902</span> </span><span class="WHIT">          </span><span class="NAME">maxSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2903</span> </span><span class="WHIT">          </span><span class="NAME">largestCommonRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2904</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2905</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2906</span> </span><span class="WHIT">  
<span class='line'>2907</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">largestCommonRing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2908</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2909</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2910</span>      * Returns an array of vertices positioned at a specified location.
<span class='line'>2911</span>      *
<span class='line'>2912</span>      * @param {Vector2} position The position to search for vertices.
<span class='line'>2913</span>      * @param {Number} radius The radius within to search.
<span class='line'>2914</span>      * @param {Number} excludeVertexId A vertex id to be excluded from the search results.
<span class='line'>2915</span>      * @returns {Number[]} An array containing vertex ids in a given location.
<span class='line'>2916</span>      */</span><span class="WHIT">
<span class='line'>2917</span> </span><span class="WHIT">  
<span class='line'>2918</span>   
<span class='line'>2919</span>     </span><span class="NAME">getVerticesAt</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">excludeVertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2920</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">locals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2921</span> </span><span class="WHIT">  
<span class='line'>2922</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2923</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2924</span> </span><span class="WHIT">  
<span class='line'>2925</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">excludeVertexId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">vertex.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2926</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2927</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2928</span> </span><span class="WHIT">  
<span class='line'>2929</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">position.distanceSq</span><span class="PUNC">(</span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2930</span> </span><span class="WHIT">  
<span class='line'>2931</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2932</span> </span><span class="WHIT">          </span><span class="NAME">locals.push</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2933</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2934</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2935</span> </span><span class="WHIT">  
<span class='line'>2936</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">locals</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2937</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2938</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2939</span>      * Returns the closest vertex (connected as well as unconnected).
<span class='line'>2940</span>      *
<span class='line'>2941</span>      * @param {Vertex} vertex The vertex of which to find the closest other vertex.
<span class='line'>2942</span>      * @returns {Vertex} The closest vertex.
<span class='line'>2943</span>      */</span><span class="WHIT">
<span class='line'>2944</span> </span><span class="WHIT">  
<span class='line'>2945</span>   
<span class='line'>2946</span>     </span><span class="NAME">getClosestVertex</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2947</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">minDist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">99999</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2948</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">minVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2949</span> </span><span class="WHIT">  
<span class='line'>2950</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2951</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2952</span> </span><span class="WHIT">  
<span class='line'>2953</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2954</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2955</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2956</span> </span><span class="WHIT">  
<span class='line'>2957</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">distSq</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.position.distanceSq</span><span class="PUNC">(</span><span class="NAME">v.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2958</span> </span><span class="WHIT">  
<span class='line'>2959</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">distSq</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">minDist</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2960</span> </span><span class="WHIT">          </span><span class="NAME">minDist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">distSq</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2961</span> </span><span class="WHIT">          </span><span class="NAME">minVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2962</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2963</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2964</span> </span><span class="WHIT">  
<span class='line'>2965</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">minVertex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2966</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2967</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2968</span>      * Add a ring to this representation of a molecule.
<span class='line'>2969</span>      *
<span class='line'>2970</span>      * @param {Ring} ring A new ring.
<span class='line'>2971</span>      * @returns {Number} The ring id of the new ring.
<span class='line'>2972</span>      */</span><span class="WHIT">
<span class='line'>2973</span> </span><span class="WHIT">  
<span class='line'>2974</span>   
<span class='line'>2975</span>     </span><span class="NAME">addRing</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2976</span> </span><span class="WHIT">      </span><span class="NAME">ring.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ringIdCounter</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2977</span> </span><span class="WHIT">      </span><span class="NAME">this.rings.push</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2978</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ring.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2979</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2980</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>2981</span>      * Removes a ring from the array of rings associated with the current molecule.
<span class='line'>2982</span>      *
<span class='line'>2983</span>      * @param {Number} ringId A ring id.
<span class='line'>2984</span>      */</span><span class="WHIT">
<span class='line'>2985</span> </span><span class="WHIT">  
<span class='line'>2986</span>   
<span class='line'>2987</span>     </span><span class="NAME">removeRing</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2988</span> </span><span class="WHIT">      </span><span class="NAME">this.rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2989</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">item.id</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2990</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Also remove ring connections involving this ring</span><span class="WHIT">
<span class='line'>2991</span> </span><span class="WHIT">  
<span class='line'>2992</span>       </span><span class="NAME">this.ringConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ringConnections.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2993</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">item.firstRingId</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">item.secondRingId</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2994</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Remove the ring as neighbour of other rings</span><span class="WHIT">
<span class='line'>2995</span> </span><span class="WHIT">  
<span class='line'>2996</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2997</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2998</span> </span><span class="WHIT">        </span><span class="NAME">r.neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.neighbours.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2999</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3000</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3001</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3002</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3003</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3004</span>      * Gets a ring object from the array of rings associated with the current molecule by its id. The ring id is not equal to the index, since rings can be added and removed when processing bridged rings.
<span class='line'>3005</span>      *
<span class='line'>3006</span>      * @param {Number} ringId A ring id.
<span class='line'>3007</span>      * @returns {Ring} A ring associated with the current molecule.
<span class='line'>3008</span>      */</span><span class="WHIT">
<span class='line'>3009</span> </span><span class="WHIT">  
<span class='line'>3010</span>   
<span class='line'>3011</span>     </span><span class="NAME">getRing</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3012</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3013</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3014</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3015</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3016</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3017</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3018</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3019</span>      * Add a ring connection to this representation of a molecule.
<span class='line'>3020</span>      *
<span class='line'>3021</span>      * @param {RingConnection} ringConnection A new ringConnection.
<span class='line'>3022</span>      * @returns {Number} The ring connection id of the new ring connection.
<span class='line'>3023</span>      */</span><span class="WHIT">
<span class='line'>3024</span> </span><span class="WHIT">  
<span class='line'>3025</span>   
<span class='line'>3026</span>     </span><span class="NAME">addRingConnection</span><span class="PUNC">(</span><span class="NAME">ringConnection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3027</span> </span><span class="WHIT">      </span><span class="NAME">ringConnection.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ringConnectionIdCounter</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3028</span> </span><span class="WHIT">      </span><span class="NAME">this.ringConnections.push</span><span class="PUNC">(</span><span class="NAME">ringConnection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3029</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ringConnection.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3030</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3031</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3032</span>      * Removes a ring connection from the array of rings connections associated with the current molecule.
<span class='line'>3033</span>      *
<span class='line'>3034</span>      * @param {Number} ringConnectionId A ring connection id.
<span class='line'>3035</span>      */</span><span class="WHIT">
<span class='line'>3036</span> </span><span class="WHIT">  
<span class='line'>3037</span>   
<span class='line'>3038</span>     </span><span class="NAME">removeRingConnection</span><span class="PUNC">(</span><span class="NAME">ringConnectionId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3039</span> </span><span class="WHIT">      </span><span class="NAME">this.ringConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ringConnections.filter</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3040</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">item.id</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">ringConnectionId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3041</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3042</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3043</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3044</span>      * Removes all ring connections between two vertices.
<span class='line'>3045</span>      *
<span class='line'>3046</span>      * @param {Number} vertexIdA A vertex id.
<span class='line'>3047</span>      * @param {Number} vertexIdB A vertex id.
<span class='line'>3048</span>      */</span><span class="WHIT">
<span class='line'>3049</span> </span><span class="WHIT">  
<span class='line'>3050</span>   
<span class='line'>3051</span>     </span><span class="NAME">removeRingConnectionsBetween</span><span class="PUNC">(</span><span class="NAME">vertexIdA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexIdB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3052</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">toRemove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3053</span> </span><span class="WHIT">  
<span class='line'>3054</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.ringConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3055</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ringConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3056</span> </span><span class="WHIT">  
<span class='line'>3057</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ringConnection.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">vertexIdA</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ringConnection.secondRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">vertexIdB</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ringConnection.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">vertexIdB</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ringConnection.secondRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">vertexIdA</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3058</span> </span><span class="WHIT">          </span><span class="NAME">toRemove.push</span><span class="PUNC">(</span><span class="NAME">ringConnection.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3059</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3060</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3061</span> </span><span class="WHIT">  
<span class='line'>3062</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">toRemove.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3063</span> </span><span class="WHIT">        </span><span class="NAME">this.removeRingConnection</span><span class="PUNC">(</span><span class="NAME">toRemove</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3064</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3065</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3066</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3067</span>      * Get a ring connection with a given id.
<span class='line'>3068</span>      * 
<span class='line'>3069</span>      * @param {Number} id 
<span class='line'>3070</span>      * @returns {RingConnection} The ring connection with the specified id.
<span class='line'>3071</span>      */</span><span class="WHIT">
<span class='line'>3072</span> </span><span class="WHIT">  
<span class='line'>3073</span>   
<span class='line'>3074</span>     </span><span class="NAME">getRingConnection</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3075</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.ringConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3076</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.ringConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3077</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.ringConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3078</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3079</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3080</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3081</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3082</span>      * Get the ring connections between a ring and a set of rings.
<span class='line'>3083</span>      *
<span class='line'>3084</span>      * @param {Number} ringId A ring id.
<span class='line'>3085</span>      * @param {Number[]} ringIds An array of ring ids.
<span class='line'>3086</span>      * @returns {Number[]} An array of ring connection ids.
<span class='line'>3087</span>      */</span><span class="WHIT">
<span class='line'>3088</span> </span><span class="WHIT">  
<span class='line'>3089</span>   
<span class='line'>3090</span>     </span><span class="NAME">getRingConnections</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringIds</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3091</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3092</span> </span><span class="WHIT">  
<span class='line'>3093</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.ringConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3094</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">rc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ringConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3095</span> </span><span class="WHIT">  
<span class='line'>3096</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringIds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3097</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ringIds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3098</span> </span><span class="WHIT">  
<span class='line'>3099</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rc.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rc.secondRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">rc.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rc.secondRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3100</span> </span><span class="WHIT">            </span><span class="NAME">ringConnections.push</span><span class="PUNC">(</span><span class="NAME">rc.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3101</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3102</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3103</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3104</span> </span><span class="WHIT">  
<span class='line'>3105</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ringConnections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3106</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3107</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3108</span>      * Returns the overlap score of the current molecule based on its positioned vertices. The higher the score, the more overlaps occur in the structure drawing.
<span class='line'>3109</span>      *
<span class='line'>3110</span>      * @returns {Object} Returns the total overlap score and the overlap score of each vertex sorted by score (higher to lower). Example: { total: 99, scores: [ { id: 0, score: 22 }, ... ]  }
<span class='line'>3111</span>      */</span><span class="WHIT">
<span class='line'>3112</span> </span><span class="WHIT">  
<span class='line'>3113</span>   
<span class='line'>3114</span>     </span><span class="NAME">getOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3115</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">total</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3116</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">overlapScores</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3117</span> </span><span class="WHIT">  
<span class='line'>3118</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3119</span> </span><span class="WHIT">        </span><span class="NAME">overlapScores</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3120</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3121</span> </span><span class="WHIT">  
<span class='line'>3122</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3123</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3124</span> </span><span class="WHIT">  
<span class='line'>3125</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">--</span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3126</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3127</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3128</span> </span><span class="WHIT">  
<span class='line'>3129</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">a.value.isDrawn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">b.value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3130</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3131</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3132</span> </span><span class="WHIT">  
<span class='line'>3133</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">a.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b.position</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">lengthSq</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3134</span> </span><span class="WHIT">  
<span class='line'>3135</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dist</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLengthSq</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3136</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">weighted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">dist</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3137</span> </span><span class="WHIT">            </span><span class="NAME">total</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">weighted</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3138</span> </span><span class="WHIT">            </span><span class="NAME">overlapScores</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">weighted</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3139</span> </span><span class="WHIT">            </span><span class="NAME">overlapScores</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">weighted</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3140</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3141</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3142</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3143</span> </span><span class="WHIT">  
<span class='line'>3144</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sortable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3145</span> </span><span class="WHIT">  
<span class='line'>3146</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3147</span> </span><span class="WHIT">        </span><span class="NAME">sortable.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3148</span> </span><span class="WHIT">          </span><span class="NAME">id</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3149</span> </span><span class="WHIT">          </span><span class="NAME">score</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">overlapScores</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3150</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3151</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3152</span> </span><span class="WHIT">  
<span class='line'>3153</span>       </span><span class="NAME">sortable.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3154</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b.score</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a.score</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3155</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3156</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3157</span> </span><span class="WHIT">        </span><span class="NAME">total</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">total</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3158</span> </span><span class="WHIT">        </span><span class="NAME">scores</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sortable</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3159</span> </span><span class="WHIT">        </span><span class="NAME">vertexScores</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">overlapScores</span><span class="WHIT">
<span class='line'>3160</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3161</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3162</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3163</span>      * When drawing a double bond, choose the side to place the double bond. E.g. a double bond should always been drawn inside a ring.
<span class='line'>3164</span>      *
<span class='line'>3165</span>      * @param {Vertex} vertexA A vertex.
<span class='line'>3166</span>      * @param {Vertex} vertexB A vertex.
<span class='line'>3167</span>      * @param {Vector2[]} sides An array containing the two normals of the line spanned by the two provided vertices.
<span class='line'>3168</span>      * @returns {Object} Returns an object containing the following information: {
<span class='line'>3169</span>             totalSideCount: Counts the sides of each vertex in the molecule, is an array [ a, b ],
<span class='line'>3170</span>             totalPosition: Same as position, but based on entire molecule,
<span class='line'>3171</span>             sideCount: Counts the sides of each neighbour, is an array [ a, b ],
<span class='line'>3172</span>             position: which side to position the second bond, is 0 or 1, represents the index in the normal array. This is based on only the neighbours
<span class='line'>3173</span>             anCount: the number of neighbours of vertexA,
<span class='line'>3174</span>             bnCount: the number of neighbours of vertexB
<span class='line'>3175</span>         }
<span class='line'>3176</span>      */</span><span class="WHIT">
<span class='line'>3177</span> </span><span class="WHIT">  
<span class='line'>3178</span>   
<span class='line'>3179</span>     </span><span class="NAME">chooseSide</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sides</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3180</span> </span><span class="WHIT">      </span><span class="COMM">// Check which side has more vertices</span><span class="WHIT">
<span class='line'>3181</span> </span><span class="WHIT">      </span><span class="COMM">// Get all the vertices connected to the both ends</span><span class="WHIT">
<span class='line'>3182</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">an</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexA.getNeighbours</span><span class="PUNC">(</span><span class="NAME">vertexB.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3183</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexB.getNeighbours</span><span class="PUNC">(</span><span class="NAME">vertexA.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3184</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">anCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">an.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3185</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bnCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bn.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// All vertices connected to the edge vertexA to vertexB</span><span class="WHIT">
<span class='line'>3186</span> </span><span class="WHIT">  
<span class='line'>3187</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.merge</span><span class="PUNC">(</span><span class="NAME">an</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Only considering the connected vertices</span><span class="WHIT">
<span class='line'>3188</span> </span><span class="WHIT">  
<span class='line'>3189</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sideCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3190</span> </span><span class="WHIT">  
<span class='line'>3191</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">tn.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3192</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">tn</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3193</span> </span><span class="WHIT">  
<span class='line'>3194</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v.sameSideAs</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sides</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3195</span> </span><span class="WHIT">          </span><span class="NAME">sideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3196</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3197</span> </span><span class="WHIT">          </span><span class="NAME">sideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3198</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3199</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Considering all vertices in the graph, this is to resolve ties</span><span class="WHIT">
<span class='line'>3200</span> </span><span class="WHIT">      </span><span class="COMM">// from the above side counts</span><span class="WHIT">
<span class='line'>3201</span> </span><span class="WHIT">  
<span class='line'>3202</span>   
<span class='line'>3203</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">totalSideCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3204</span> </span><span class="WHIT">  
<span class='line'>3205</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3206</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3207</span> </span><span class="WHIT">  
<span class='line'>3208</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v.sameSideAs</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sides</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3209</span> </span><span class="WHIT">          </span><span class="NAME">totalSideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3210</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3211</span> </span><span class="WHIT">          </span><span class="NAME">totalSideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3212</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3213</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3214</span> </span><span class="WHIT">  
<span class='line'>3215</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3216</span> </span><span class="WHIT">        </span><span class="NAME">totalSideCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">totalSideCount</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3217</span> </span><span class="WHIT">        </span><span class="NAME">totalPosition</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">totalSideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">totalSideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3218</span> </span><span class="WHIT">        </span><span class="NAME">sideCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sideCount</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3219</span> </span><span class="WHIT">        </span><span class="NAME">position</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">sideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3220</span> </span><span class="WHIT">        </span><span class="NAME">anCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">anCount</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3221</span> </span><span class="WHIT">        </span><span class="NAME">bnCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">bnCount</span><span class="WHIT">
<span class='line'>3222</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3223</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3224</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3225</span>      * Sets the center for a ring.
<span class='line'>3226</span>      *
<span class='line'>3227</span>      * @param {Ring} ring A ring.
<span class='line'>3228</span>      */</span><span class="WHIT">
<span class='line'>3229</span> </span><span class="WHIT">  
<span class='line'>3230</span>   
<span class='line'>3231</span>     </span><span class="NAME">setRingCenter</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3232</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3233</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">total</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3234</span> </span><span class="WHIT">  
<span class='line'>3235</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringSize</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3236</span> </span><span class="WHIT">        </span><span class="NAME">total.add</span><span class="PUNC">(</span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">ring.members</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3237</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3238</span> </span><span class="WHIT">  
<span class='line'>3239</span>       </span><span class="NAME">ring.center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">total.divide</span><span class="PUNC">(</span><span class="NAME">ringSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3240</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3241</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3242</span>      * Gets the center of a ring contained within a bridged ring and containing a given vertex.
<span class='line'>3243</span>      *
<span class='line'>3244</span>      * @param {Ring} ring A bridged ring.
<span class='line'>3245</span>      * @param {Vertex} vertex A vertex.
<span class='line'>3246</span>      * @returns {Vector2} The center of the subring that containing the vertex.
<span class='line'>3247</span>      */</span><span class="WHIT">
<span class='line'>3248</span> </span><span class="WHIT">  
<span class='line'>3249</span>   
<span class='line'>3250</span>     </span><span class="NAME">getSubringCenter</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3251</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value.originalRings</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3252</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.center</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3253</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">smallest</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Always get the smallest ring.</span><span class="WHIT">
<span class='line'>3254</span> </span><span class="WHIT">  
<span class='line'>3255</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3256</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ring.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3257</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ring.rings</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3258</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ring.rings</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">smallest</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3259</span> </span><span class="WHIT">              </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.rings</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">center</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3260</span> </span><span class="WHIT">              </span><span class="NAME">smallest</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.rings</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3261</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3262</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3263</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3264</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3265</span> </span><span class="WHIT">  
<span class='line'>3266</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3267</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3268</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3269</span>      * Draw the actual edges as bonds to the canvas.
<span class='line'>3270</span>      *
<span class='line'>3271</span>      * @param {Boolean} debug A boolean indicating whether or not to draw debug helpers.
<span class='line'>3272</span>      */</span><span class="WHIT">
<span class='line'>3273</span> </span><span class="WHIT">  
<span class='line'>3274</span>   
<span class='line'>3275</span>     </span><span class="NAME">drawEdges</span><span class="PUNC">(</span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3276</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3277</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">drawn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">this.graph.edges.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3278</span> </span><span class="WHIT">      </span><span class="NAME">drawn.fill</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3279</span> </span><span class="WHIT">      </span><span class="NAME">this.graph.traverseBF</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3280</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edges</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">that.graph.getEdges</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3281</span> </span><span class="WHIT">  
<span class='line'>3282</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">edges.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3283</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3284</span> </span><span class="WHIT">  
<span class='line'>3285</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">drawn</span><span class="PUNC">[</span><span class="NAME">edgeId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3286</span> </span><span class="WHIT">            </span><span class="NAME">drawn</span><span class="PUNC">[</span><span class="NAME">edgeId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3287</span> </span><span class="WHIT">            </span><span class="NAME">that.drawEdge</span><span class="PUNC">(</span><span class="NAME">edgeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debug</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3288</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3289</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3290</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Draw ring for implicitly defined aromatic rings</span><span class="WHIT">
<span class='line'>3291</span> </span><span class="WHIT">  
<span class='line'>3292</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.bridgedRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3293</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3294</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3295</span> </span><span class="WHIT">  
<span class='line'>3296</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isRingAromatic</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3297</span> </span><span class="WHIT">            </span><span class="NAME">this.canvasWrapper.drawAromaticityRing</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3298</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3299</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3300</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3301</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3302</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3303</span>      * Draw the an edge as a bonds to the canvas.
<span class='line'>3304</span>      *
<span class='line'>3305</span>      * @param {Number} edgeId An edge id.
<span class='line'>3306</span>      * @param {Boolean} debug A boolean indicating whether or not to draw debug helpers.
<span class='line'>3307</span>      */</span><span class="WHIT">
<span class='line'>3308</span> </span><span class="WHIT">  
<span class='line'>3309</span>   
<span class='line'>3310</span>     </span><span class="NAME">drawEdge</span><span class="PUNC">(</span><span class="NAME">edgeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3311</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3312</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.edges</span><span class="PUNC">[</span><span class="NAME">edgeId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3313</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3314</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3315</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexA.value.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3316</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexB.value.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3317</span> </span><span class="WHIT">  
<span class='line'>3318</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertexA.value.isDrawn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">vertexB.value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.opts.atomVisualization</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'default'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3319</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3320</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3321</span> </span><span class="WHIT">  
<span class='line'>3322</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexA.position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3323</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3324</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getEdgeNormals</span><span class="PUNC">(</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Create a point on each side of the line</span><span class="WHIT">
<span class='line'>3325</span> </span><span class="WHIT">  
<span class='line'>3326</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sides</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.clone</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3327</span> </span><span class="WHIT">      </span><span class="NAME">sides</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3328</span> </span><span class="WHIT">      </span><span class="NAME">sides</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3329</span> </span><span class="WHIT">  
<span class='line'>3330</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'='</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.getRingbondType</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'='</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">edge.isPartOfAromaticRing</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.bridgedRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3331</span> </span><span class="WHIT">        </span><span class="COMM">// Always draw double bonds inside the ring</span><span class="WHIT">
<span class='line'>3332</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">inRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.areVerticesInSameRing</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3333</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.chooseSide</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sides</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3334</span> </span><span class="WHIT">  
<span class='line'>3335</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">inRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3336</span> </span><span class="WHIT">          </span><span class="COMM">// Always draw double bonds inside a ring</span><span class="WHIT">
<span class='line'>3337</span> </span><span class="WHIT">          </span><span class="COMM">// if the bond is shared by two rings, it is drawn in the larger</span><span class="WHIT">
<span class='line'>3338</span> </span><span class="WHIT">          </span><span class="COMM">// problem: smaller ring is aromatic, bond is still drawn in larger -> fix this</span><span class="WHIT">
<span class='line'>3339</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lcr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getLargestOrAromaticCommonRing</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3340</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lcr.center</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3341</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3342</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Choose the normal that is on the same side as the center</span><span class="WHIT">
<span class='line'>3343</span> </span><span class="WHIT">  
<span class='line'>3344</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3345</span> </span><span class="WHIT">  
<span class='line'>3346</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">center.sameSideAs</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3347</span> </span><span class="WHIT">            </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3348</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3349</span> </span><span class="WHIT">            </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3350</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3351</span> </span><span class="WHIT">  
<span class='line'>3352</span>           </span><span class="NAME">line.shorten</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.shortBondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// The shortened edge</span><span class="WHIT">
<span class='line'>3353</span> </span><span class="WHIT">  
<span class='line'>3354</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.isPartOfAromaticRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3355</span> </span><span class="WHIT">            </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3356</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3357</span> </span><span class="WHIT">            </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3358</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// The normal edge</span><span class="WHIT">
<span class='line'>3359</span> </span><span class="WHIT">  
<span class='line'>3360</span>   
<span class='line'>3361</span>           </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3362</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.center</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">vertexA.isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertexB.isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3363</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.halfBondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3364</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.halfBondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3365</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lineA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3366</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lineB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3367</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">lineA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3368</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">lineB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3369</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s.anCount</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">s.bnCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">s.bnCount</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">s.anCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3370</span> </span><span class="WHIT">          </span><span class="COMM">// Both lines are the same length here</span><span class="WHIT">
<span class='line'>3371</span> </span><span class="WHIT">          </span><span class="COMM">// Add the spacing to the edges (which are of unit length)</span><span class="WHIT">
<span class='line'>3372</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.halfBondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3373</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.halfBondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3374</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lineA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3375</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lineB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3376</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">lineA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3377</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">lineB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3378</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s.sideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">s.sideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3379</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3380</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3381</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3382</span> </span><span class="WHIT">          </span><span class="NAME">line.shorten</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.shortBondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3383</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3384</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3385</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s.sideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">s.sideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3386</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3387</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3388</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3389</span> </span><span class="WHIT">          </span><span class="NAME">line.shorten</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.shortBondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3390</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3391</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3392</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s.totalSideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">s.totalSideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3393</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3394</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3395</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3396</span> </span><span class="WHIT">          </span><span class="NAME">line.shorten</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.shortBondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3397</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3398</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3399</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s.totalSideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">s.totalSideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3400</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3401</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3402</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3403</span> </span><span class="WHIT">          </span><span class="NAME">line.shorten</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.shortBondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3404</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3405</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3406</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3407</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'#'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3408</span> </span><span class="WHIT">        </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3409</span> </span><span class="WHIT">        </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">that.opts.bondSpacing</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3410</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lineA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3411</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lineB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3412</span> </span><span class="WHIT">        </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">lineA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3413</span> </span><span class="WHIT">        </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">lineB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3414</span> </span><span class="WHIT">        </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3415</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'.'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="COMM">// TODO: Something... maybe... version 2?</span><span class="WHIT">
<span class='line'>3416</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3417</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isChiralCenterA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexA.value.isStereoCenter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3418</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isChiralCenterB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexB.value.isStereoCenter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3419</span> </span><span class="WHIT">  
<span class='line'>3420</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.wedge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3421</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawWedge</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3422</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.wedge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3423</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawDashedWedge</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3424</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3425</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3426</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3427</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3428</span> </span><span class="WHIT">  
<span class='line'>3429</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3430</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">midpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.midpoint</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3431</span> </span><span class="WHIT">        </span><span class="NAME">this.canvasWrapper.drawDebugText</span><span class="PUNC">(</span><span class="NAME">midpoint.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midpoint.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'e: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3432</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3433</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3434</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3435</span>      * Draws the vertices representing atoms to the canvas.
<span class='line'>3436</span>      *
<span class='line'>3437</span>      * @param {Boolean} debug A boolean indicating whether or not to draw debug messages to the canvas.
<span class='line'>3438</span>      */</span><span class="WHIT">
<span class='line'>3439</span> </span><span class="WHIT">  
<span class='line'>3440</span>   
<span class='line'>3441</span>     </span><span class="NAME">drawVertices</span><span class="PUNC">(</span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3442</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3443</span> </span><span class="WHIT">  
<span class='line'>3444</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3445</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3446</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">atom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3447</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3448</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isotope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3449</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bondCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value.bondCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3450</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3451</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Atom.maxBonds</span><span class="PUNC">[</span><span class="NAME">element</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">bondCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3452</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.getTextDirection</span><span class="PUNC">(</span><span class="NAME">this.graph.vertices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3453</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.terminalCarbons</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">atom.hasAttachedPseudoElements</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">vertex.isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3454</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isCarbon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// This is a HACK to remove all hydrogens from nitrogens in aromatic rings, as this</span><span class="WHIT">
<span class='line'>3455</span> </span><span class="WHIT">        </span><span class="COMM">// should be the most common state. This has to be fixed by kekulization</span><span class="WHIT">
<span class='line'>3456</span> </span><span class="WHIT">  
<span class='line'>3457</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'N'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">atom.isPartOfAromaticRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3458</span> </span><span class="WHIT">          </span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3459</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3460</span> </span><span class="WHIT">  
<span class='line'>3461</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.bracket</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3462</span> </span><span class="WHIT">          </span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.bracket.hcount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3463</span> </span><span class="WHIT">          </span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.bracket.charge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3464</span> </span><span class="WHIT">          </span><span class="NAME">isotope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.bracket.isotope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3465</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3466</span> </span><span class="WHIT">  
<span class='line'>3467</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opts.atomVisualization</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'allballs'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3468</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawBall</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3469</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.isDrawn</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isCarbon</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">atom.drawExplicit</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">atom.hasAttachedPseudoElements</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3470</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opts.atomVisualization</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'default'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3471</span> </span><span class="WHIT">            </span><span class="NAME">this.canvasWrapper.drawText</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hydrogens</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isotope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atom.getAttachedPseudoElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3472</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opts.atomVisualization</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'balls'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3473</span> </span><span class="WHIT">            </span><span class="NAME">this.canvasWrapper.drawBall</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3474</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3475</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.getNeighbourCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertex.forcePositioned</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3476</span> </span><span class="WHIT">          </span><span class="COMM">// If there is a carbon which bonds are in a straight line, draw a dot</span><span class="WHIT">
<span class='line'>3477</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertex.neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3478</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertex.neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3479</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.threePointangle</span><span class="PUNC">(</span><span class="NAME">vertex.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3480</span> </span><span class="WHIT">  
<span class='line'>3481</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3482</span> </span><span class="WHIT">            </span><span class="NAME">this.canvasWrapper.drawPoint</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3483</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3484</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3485</span> </span><span class="WHIT">  
<span class='line'>3486</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3487</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'v: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.print</span><span class="PUNC">(</span><span class="NAME">atom.ringbonds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3488</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawDebugText</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3489</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="COMM">// this.canvasWrapper.drawDebugText(vertex.position.x, vertex.position.y, vertex.value.chirality);</span><span class="WHIT">
<span class='line'>3490</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3491</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Draw the ring centers for debug purposes</span><span class="WHIT">
<span class='line'>3492</span> </span><span class="WHIT">  
<span class='line'>3493</span>   
<span class='line'>3494</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opts.debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3495</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3496</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">center</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3497</span> </span><span class="WHIT">          </span><span class="NAME">this.canvasWrapper.drawDebugPoint</span><span class="PUNC">(</span><span class="NAME">center.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'r: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3498</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3499</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3500</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3501</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3502</span>      * Position the vertices according to their bonds and properties.
<span class='line'>3503</span>      */</span><span class="WHIT">
<span class='line'>3504</span> </span><span class="WHIT">  
<span class='line'>3505</span>   
<span class='line'>3506</span>     </span><span class="NAME">position</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3507</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">startVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Always start drawing at a bridged ring if there is one</span><span class="WHIT">
<span class='line'>3508</span> </span><span class="WHIT">      </span><span class="COMM">// If not, start with a ring</span><span class="WHIT">
<span class='line'>3509</span> </span><span class="WHIT">      </span><span class="COMM">// else, start with 0</span><span class="WHIT">
<span class='line'>3510</span> </span><span class="WHIT">  
<span class='line'>3511</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3512</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.bridgedRing</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3513</span> </span><span class="WHIT">          </span><span class="NAME">startVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3514</span> </span><span class="WHIT">          </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3515</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3516</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3517</span> </span><span class="WHIT">  
<span class='line'>3518</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3519</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isBridged</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3520</span> </span><span class="WHIT">          </span><span class="NAME">startVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">members</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3521</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3522</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3523</span> </span><span class="WHIT">  
<span class='line'>3524</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">startVertex</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3525</span> </span><span class="WHIT">        </span><span class="NAME">startVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">members</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3526</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3527</span> </span><span class="WHIT">  
<span class='line'>3528</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">startVertex</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3529</span> </span><span class="WHIT">        </span><span class="NAME">startVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3530</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3531</span> </span><span class="WHIT">  
<span class='line'>3532</span>       </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">startVertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3533</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3534</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3535</span>      * Stores the current information associated with rings.
<span class='line'>3536</span>      */</span><span class="WHIT">
<span class='line'>3537</span> </span><span class="WHIT">  
<span class='line'>3538</span>   
<span class='line'>3539</span>     </span><span class="NAME">backupRingInformation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3540</span> </span><span class="WHIT">      </span><span class="NAME">this.originalRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3541</span> </span><span class="WHIT">      </span><span class="NAME">this.originalRingConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3542</span> </span><span class="WHIT">  
<span class='line'>3543</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3544</span> </span><span class="WHIT">        </span><span class="NAME">this.originalRings.push</span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3545</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3546</span> </span><span class="WHIT">  
<span class='line'>3547</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.ringConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3548</span> </span><span class="WHIT">        </span><span class="NAME">this.originalRingConnections.push</span><span class="PUNC">(</span><span class="NAME">this.ringConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3549</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3550</span> </span><span class="WHIT">  
<span class='line'>3551</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3552</span> </span><span class="WHIT">        </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.backupRings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3553</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3554</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3555</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3556</span>      * Restores the most recently backed up information associated with rings.
<span class='line'>3557</span>      */</span><span class="WHIT">
<span class='line'>3558</span> </span><span class="WHIT">  
<span class='line'>3559</span>   
<span class='line'>3560</span>     </span><span class="NAME">restoreRingInformation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3561</span> </span><span class="WHIT">      </span><span class="COMM">// Get the subring centers from the bridged rings</span><span class="WHIT">
<span class='line'>3562</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bridgedRings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getBridgedRings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3563</span> </span><span class="WHIT">      </span><span class="NAME">this.rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3564</span> </span><span class="WHIT">      </span><span class="NAME">this.ringConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3565</span> </span><span class="WHIT">  
<span class='line'>3566</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">bridgedRings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3567</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bridgedRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bridgedRings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3568</span> </span><span class="WHIT">  
<span class='line'>3569</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">bridgedRing.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3570</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bridgedRing.rings</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3571</span> </span><span class="WHIT">          </span><span class="NAME">this.originalRings</span><span class="PUNC">[</span><span class="NAME">ring.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.center</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3572</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3573</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3574</span> </span><span class="WHIT">  
<span class='line'>3575</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.originalRings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3576</span> </span><span class="WHIT">        </span><span class="NAME">this.rings.push</span><span class="PUNC">(</span><span class="NAME">this.originalRings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3577</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3578</span> </span><span class="WHIT">  
<span class='line'>3579</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.originalRingConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3580</span> </span><span class="WHIT">        </span><span class="NAME">this.ringConnections.push</span><span class="PUNC">(</span><span class="NAME">this.originalRingConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3581</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3582</span> </span><span class="WHIT">  
<span class='line'>3583</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3584</span> </span><span class="WHIT">        </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.restoreRings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3585</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3586</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// TODO: This needs some cleaning up</span><span class="WHIT">
<span class='line'>3587</span> </span><span class="WHIT">  
<span class='line'>3588</span>     </span><span class="COMM">/**
<span class='line'>3589</span>      * Creates a new ring, that is, positiones all the vertices inside a ring.
<span class='line'>3590</span>      *
<span class='line'>3591</span>      * @param {Ring} ring The ring to position.
<span class='line'>3592</span>      * @param {(Vector2|null)} [center=null] The center of the ring to be created.
<span class='line'>3593</span>      * @param {(Vertex|null)} [startVertex=null] The first vertex to be positioned inside the ring.
<span class='line'>3594</span>      * @param {(Vertex|null)} [previousVertex=null] The last vertex that was positioned.
<span class='line'>3595</span>      * @param {Boolean} [previousVertex=false] A boolean indicating whether or not this ring was force positioned already - this is needed after force layouting a ring, in order to draw rings connected to it.
<span class='line'>3596</span>      */</span><span class="WHIT">
<span class='line'>3597</span> </span><span class="WHIT">  
<span class='line'>3598</span>   
<span class='line'>3599</span>     </span><span class="NAME">createRing</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3600</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ring.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3601</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3602</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3603</span> </span><span class="WHIT">  
<span class='line'>3604</span>       </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3605</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">orderedNeighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.getOrderedNeighbours</span><span class="PUNC">(</span><span class="NAME">this.ringConnections</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3606</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">startingAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startVertex</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">startVertex.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">angle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3607</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.polyCircumradius</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3608</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.centralAngle</span><span class="PUNC">(</span><span class="NAME">ring.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3609</span> </span><span class="WHIT">      </span><span class="NAME">ring.centralAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3610</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startingAngle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3611</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3612</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">startVertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startVertex</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">startVertex.id</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3613</span> </span><span class="WHIT">  
<span class='line'>3614</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ring.members.indexOf</span><span class="PUNC">(</span><span class="NAME">startVertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3615</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">startVertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3616</span> </span><span class="WHIT">          </span><span class="NAME">startVertex.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3617</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3618</span> </span><span class="WHIT">  
<span class='line'>3619</span>         </span><span class="NAME">startVertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.members</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3620</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// If the ring is bridged, then draw the vertices inside the ring</span><span class="WHIT">
<span class='line'>3621</span> </span><span class="WHIT">      </span><span class="COMM">// using a force based approach</span><span class="WHIT">
<span class='line'>3622</span> </span><span class="WHIT">  
<span class='line'>3623</span>   
<span class='line'>3624</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ring.isBridged</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3625</span> </span><span class="WHIT">        </span><span class="NAME">this.graph.kkLayout</span><span class="PUNC">(</span><span class="NAME">ring.members.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startVertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.kkThreshold</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.kkInnerThreshold</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.kkMaxIteration</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.kkMaxInnerIteration</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.kkMaxEnergy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3626</span> </span><span class="WHIT">        </span><span class="NAME">ring.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Update the center of the bridged ring</span><span class="WHIT">
<span class='line'>3627</span> </span><span class="WHIT">  
<span class='line'>3628</span>         </span><span class="NAME">this.setRingCenter</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3629</span> </span><span class="WHIT">        </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ring.center</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Setting the centers for the subrings</span><span class="WHIT">
<span class='line'>3630</span> </span><span class="WHIT">  
<span class='line'>3631</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ring.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3632</span> </span><span class="WHIT">          </span><span class="NAME">this.setRingCenter</span><span class="PUNC">(</span><span class="NAME">ring.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3633</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3634</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3635</span> </span><span class="WHIT">        </span><span class="NAME">ring.eachMember</span><span class="PUNC">(</span><span class="NAME">this.graph.vertices</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3636</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">that.graph.vertices</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3637</span> </span><span class="WHIT">  
<span class='line'>3638</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertex.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3639</span> </span><span class="WHIT">            </span><span class="NAME">vertex.setPosition</span><span class="PUNC">(</span><span class="NAME">center.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3640</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3641</span> </span><span class="WHIT">  
<span class='line'>3642</span>           </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3643</span> </span><span class="WHIT">  
<span class='line'>3644</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ring.isBridged</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ring.rings.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3645</span> </span><span class="WHIT">            </span><span class="NAME">vertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3646</span> </span><span class="WHIT">            </span><span class="NAME">vertex.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3647</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3648</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">previousVertex.id</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3649</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3650</span> </span><span class="WHIT">  
<span class='line'>3651</span>       </span><span class="NAME">ring.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3652</span> </span><span class="WHIT">      </span><span class="NAME">ring.center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Draw neighbours in decreasing order of connectivity</span><span class="WHIT">
<span class='line'>3653</span> </span><span class="WHIT">  
<span class='line'>3654</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">orderedNeighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3655</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRing</span><span class="PUNC">(</span><span class="NAME">orderedNeighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">neighbour</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3656</span> </span><span class="WHIT">  
<span class='line'>3657</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbour.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3658</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3659</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3660</span> </span><span class="WHIT">  
<span class='line'>3661</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RingConnection.getVertices</span><span class="PUNC">(</span><span class="NAME">this.ringConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neighbour.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3662</span> </span><span class="WHIT">  
<span class='line'>3663</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertices.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3664</span> </span><span class="WHIT">          </span><span class="COMM">// This ring is a fused ring</span><span class="WHIT">
<span class='line'>3665</span> </span><span class="WHIT">          </span><span class="NAME">ring.isFused</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3666</span> </span><span class="WHIT">          </span><span class="NAME">neighbour.isFused</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3667</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3668</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Get middle between vertex A and B</span><span class="WHIT">
<span class='line'>3669</span> </span><span class="WHIT">  
<span class='line'>3670</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">midpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.midpoint</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Get the normals to the line between A and B</span><span class="WHIT">
<span class='line'>3671</span> </span><span class="WHIT">  
<span class='line'>3672</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.normals</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Normalize the normals</span><span class="WHIT">
<span class='line'>3673</span> </span><span class="WHIT">  
<span class='line'>3674</span>           </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3675</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Set length from middle of side to center (the apothem)</span><span class="WHIT">
<span class='line'>3676</span> </span><span class="WHIT">  
<span class='line'>3677</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.polyCircumradius</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neighbour.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3678</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">apothem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.apothem</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neighbour.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3679</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">apothem</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">midpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3680</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">apothem</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">midpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Pick the normal which results in a larger distance to the previous center</span><span class="WHIT">
<span class='line'>3681</span> </span><span class="WHIT">          </span><span class="COMM">// Also check whether it's inside another ring</span><span class="WHIT">
<span class='line'>3682</span> </span><span class="WHIT">  
<span class='line'>3683</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3684</span> </span><span class="WHIT">  
<span class='line'>3685</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">lengthSq</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">lengthSq</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3686</span> </span><span class="WHIT">            </span><span class="NAME">nextCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3687</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Get the vertex (A or B) which is in clock-wise direction of the other</span><span class="WHIT">
<span class='line'>3688</span> </span><span class="WHIT">  
<span class='line'>3689</span>   
<span class='line'>3690</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">posA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3691</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">posB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">vertexB.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3692</span> </span><span class="WHIT">  
<span class='line'>3693</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">posA.clockwise</span><span class="PUNC">(</span><span class="NAME">posB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3694</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">neighbour.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3695</span> </span><span class="WHIT">              </span><span class="NAME">this.createRing</span><span class="PUNC">(</span><span class="NAME">neighbour</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3696</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3697</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3698</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">neighbour.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3699</span> </span><span class="WHIT">              </span><span class="NAME">this.createRing</span><span class="PUNC">(</span><span class="NAME">neighbour</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3700</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3701</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3702</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertices.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3703</span> </span><span class="WHIT">          </span><span class="COMM">// This ring is a spiro</span><span class="WHIT">
<span class='line'>3704</span> </span><span class="WHIT">          </span><span class="NAME">ring.isSpiro</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3705</span> </span><span class="WHIT">          </span><span class="NAME">neighbour.isSpiro</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3706</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Get the vector pointing from the shared vertex to the new centpositioner</span><span class="WHIT">
<span class='line'>3707</span> </span><span class="WHIT">  
<span class='line'>3708</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexA.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3709</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.invert</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3710</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Get the distance from the vertex to the center</span><span class="WHIT">
<span class='line'>3711</span> </span><span class="WHIT">  
<span class='line'>3712</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.polyCircumradius</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neighbour.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3713</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3714</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.add</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3715</span> </span><span class="WHIT">  
<span class='line'>3716</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">neighbour.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3717</span> </span><span class="WHIT">            </span><span class="NAME">this.createRing</span><span class="PUNC">(</span><span class="NAME">neighbour</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3718</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3719</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3720</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Next, draw atoms that are not part of a ring that are directly attached to this ring</span><span class="WHIT">
<span class='line'>3721</span> </span><span class="WHIT">  
<span class='line'>3722</span>   
<span class='line'>3723</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ring.members.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3724</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringMember</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">ring.members</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3725</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringMemberNeighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ringMember.neighbours</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// If there are multiple, the ovlerap will be resolved in the appropriate step</span><span class="WHIT">
<span class='line'>3726</span> </span><span class="WHIT">  
<span class='line'>3727</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringMemberNeighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3728</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">ringMemberNeighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3729</span> </span><span class="WHIT">  
<span class='line'>3730</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3731</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3732</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3733</span> </span><span class="WHIT">  
<span class='line'>3734</span>           </span><span class="NAME">v.value.isConnectedToRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3735</span> </span><span class="WHIT">          </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringMember</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3736</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3737</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3738</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3739</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3740</span>      * Rotate an entire subtree by an angle around a center.
<span class='line'>3741</span>      *
<span class='line'>3742</span>      * @param {Number} vertexId A vertex id (the root of the sub-tree).
<span class='line'>3743</span>      * @param {Number} parentVertexId A vertex id in the previous direction of the subtree that is to rotate.
<span class='line'>3744</span>      * @param {Number} angle An angle in randians.
<span class='line'>3745</span>      * @param {Vector2} center The rotational center.
<span class='line'>3746</span>      */</span><span class="WHIT">
<span class='line'>3747</span> </span><span class="WHIT">  
<span class='line'>3748</span>   
<span class='line'>3749</span>     </span><span class="NAME">rotateSubtree</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3750</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3751</span> </span><span class="WHIT">      </span><span class="NAME">this.graph.traverseTree</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3752</span> </span><span class="WHIT">        </span><span class="NAME">vertex.position.rotateAround</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3753</span> </span><span class="WHIT">  
<span class='line'>3754</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertex.value.anchoredRings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3755</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">that.rings</span><span class="PUNC">[</span><span class="NAME">vertex.value.anchoredRings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3756</span> </span><span class="WHIT">  
<span class='line'>3757</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3758</span> </span><span class="WHIT">            </span><span class="NAME">ring.center.rotateAround</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3759</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3760</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3761</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3762</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3763</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3764</span>      * Gets the overlap score of a subtree.
<span class='line'>3765</span>      *
<span class='line'>3766</span>      * @param {Number} vertexId A vertex id (the root of the sub-tree).
<span class='line'>3767</span>      * @param {Number} parentVertexId A vertex id in the previous direction of the subtree.
<span class='line'>3768</span>      * @param {Number[]} vertexOverlapScores An array containing the vertex overlap scores indexed by vertex id.
<span class='line'>3769</span>      * @returns {Object} An object containing the total overlap score and the center of mass of the subtree weighted by overlap score { value: 0.2, center: new Vector2() }.
<span class='line'>3770</span>      */</span><span class="WHIT">
<span class='line'>3771</span> </span><span class="WHIT">  
<span class='line'>3772</span>   
<span class='line'>3773</span>     </span><span class="NAME">getSubtreeOverlapScore</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexOverlapScores</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3774</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">that</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3775</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">score</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3776</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3777</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3778</span> </span><span class="WHIT">      </span><span class="NAME">this.graph.traverseTree</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3779</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertex.value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3780</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3781</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3782</span> </span><span class="WHIT">  
<span class='line'>3783</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexOverlapScores</span><span class="PUNC">[</span><span class="NAME">vertex.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3784</span> </span><span class="WHIT">  
<span class='line'>3785</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">that.opts.overlapSensitivity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3786</span> </span><span class="WHIT">          </span><span class="NAME">score</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3787</span> </span><span class="WHIT">          </span><span class="NAME">count</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3788</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3789</span> </span><span class="WHIT">  
<span class='line'>3790</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">that.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertex.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3791</span> </span><span class="WHIT">        </span><span class="NAME">position.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3792</span> </span><span class="WHIT">        </span><span class="NAME">center.add</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3793</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3794</span> </span><span class="WHIT">      </span><span class="NAME">center.divide</span><span class="PUNC">(</span><span class="NAME">score</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3795</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3796</span> </span><span class="WHIT">        </span><span class="NAME">value</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">score</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3797</span> </span><span class="WHIT">        </span><span class="NAME">center</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">center</span><span class="WHIT">
<span class='line'>3798</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3799</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3800</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3801</span>      * Returns the current (positioned vertices so far) center of mass.
<span class='line'>3802</span>      * 
<span class='line'>3803</span>      * @returns {Vector2} The current center of mass.
<span class='line'>3804</span>      */</span><span class="WHIT">
<span class='line'>3805</span> </span><span class="WHIT">  
<span class='line'>3806</span>   
<span class='line'>3807</span>     </span><span class="NAME">getCurrentCenterOfMass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3808</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">total</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3809</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3810</span> </span><span class="WHIT">  
<span class='line'>3811</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3812</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3813</span> </span><span class="WHIT">  
<span class='line'>3814</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3815</span> </span><span class="WHIT">          </span><span class="NAME">total.add</span><span class="PUNC">(</span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3816</span> </span><span class="WHIT">          </span><span class="NAME">count</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3817</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3818</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3819</span> </span><span class="WHIT">  
<span class='line'>3820</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">total.divide</span><span class="PUNC">(</span><span class="NAME">count</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3821</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3822</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3823</span>      * Returns the current (positioned vertices so far) center of mass in the neighbourhood of a given position.
<span class='line'>3824</span>      *
<span class='line'>3825</span>      * @param {Vector2} vec The point at which to look for neighbours.
<span class='line'>3826</span>      * @param {Number} [r=currentBondLength*2.0] The radius of vertices to include.
<span class='line'>3827</span>      * @returns {Vector2} The current center of mass.
<span class='line'>3828</span>      */</span><span class="WHIT">
<span class='line'>3829</span> </span><span class="WHIT">  
<span class='line'>3830</span>   
<span class='line'>3831</span>     </span><span class="NAME">getCurrentCenterOfMassInNeigbourhood</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3832</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">total</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3833</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3834</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">rSq</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3835</span> </span><span class="WHIT">  
<span class='line'>3836</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3837</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3838</span> </span><span class="WHIT">  
<span class='line'>3839</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.positioned</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vec.distanceSq</span><span class="PUNC">(</span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">rSq</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3840</span> </span><span class="WHIT">          </span><span class="NAME">total.add</span><span class="PUNC">(</span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3841</span> </span><span class="WHIT">          </span><span class="NAME">count</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3842</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3843</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3844</span> </span><span class="WHIT">  
<span class='line'>3845</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">total.divide</span><span class="PUNC">(</span><span class="NAME">count</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3846</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3847</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3848</span>      * Resolve primary (exact) overlaps, such as two vertices that are connected to the same ring vertex.
<span class='line'>3849</span>      */</span><span class="WHIT">
<span class='line'>3850</span> </span><span class="WHIT">  
<span class='line'>3851</span>   
<span class='line'>3852</span>     </span><span class="NAME">resolvePrimaryOverlaps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3853</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">overlaps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3854</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">done</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Looking for overlaps created by two bonds coming out of a ring atom, which both point straight</span><span class="WHIT">
<span class='line'>3855</span> </span><span class="WHIT">      </span><span class="COMM">// away from the ring and are thus perfectly overlapping.</span><span class="WHIT">
<span class='line'>3856</span> </span><span class="WHIT">  
<span class='line'>3857</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3858</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3859</span> </span><span class="WHIT">  
<span class='line'>3860</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ring.members.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3861</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">ring.members</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3862</span> </span><span class="WHIT">  
<span class='line'>3863</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">done</span><span class="PUNC">[</span><span class="NAME">vertex.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3864</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3865</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3866</span> </span><span class="WHIT">  
<span class='line'>3867</span>           </span><span class="NAME">done</span><span class="PUNC">[</span><span class="NAME">vertex.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3868</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nonRingNeighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getNonRingNeighbours</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3869</span> </span><span class="WHIT">  
<span class='line'>3870</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nonRingNeighbours.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3871</span> </span><span class="WHIT">            </span><span class="COMM">// Look for rings where there are atoms with two bonds outside the ring (overlaps)</span><span class="WHIT">
<span class='line'>3872</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3873</span> </span><span class="WHIT">  
<span class='line'>3874</span>             </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertex.value.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3875</span> </span><span class="WHIT">              </span><span class="NAME">rings.push</span><span class="PUNC">(</span><span class="NAME">vertex.value.rings</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3876</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3877</span> </span><span class="WHIT">  
<span class='line'>3878</span>             </span><span class="NAME">overlaps.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3879</span> </span><span class="WHIT">              </span><span class="NAME">common</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3880</span> </span><span class="WHIT">              </span><span class="NAME">rings</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3881</span> </span><span class="WHIT">              </span><span class="NAME">vertices</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">nonRingNeighbours</span><span class="WHIT">
<span class='line'>3882</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3883</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nonRingNeighbours.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertex.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3884</span> </span><span class="WHIT">            </span><span class="COMM">// Look for bonds coming out of joined rings to adjust the angle, an example is: C1=CC(=CC=C1)[C@]12SCCN1CC1=CC=CC=C21</span><span class="WHIT">
<span class='line'>3885</span> </span><span class="WHIT">            </span><span class="COMM">// where the angle has to be adjusted to account for fused ring</span><span class="WHIT">
<span class='line'>3886</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3887</span> </span><span class="WHIT">  
<span class='line'>3888</span>             </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertex.value.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3889</span> </span><span class="WHIT">              </span><span class="NAME">rings.push</span><span class="PUNC">(</span><span class="NAME">vertex.value.rings</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3890</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3891</span> </span><span class="WHIT">  
<span class='line'>3892</span>             </span><span class="NAME">overlaps.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3893</span> </span><span class="WHIT">              </span><span class="NAME">common</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3894</span> </span><span class="WHIT">              </span><span class="NAME">rings</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3895</span> </span><span class="WHIT">              </span><span class="NAME">vertices</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">nonRingNeighbours</span><span class="WHIT">
<span class='line'>3896</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3897</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3898</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3899</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3900</span> </span><span class="WHIT">  
<span class='line'>3901</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">overlaps.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3902</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">overlap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">overlaps</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3903</span> </span><span class="WHIT">  
<span class='line'>3904</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">overlap.vertices.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3905</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">overlap.vertices</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3906</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">overlap.vertices</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3907</span> </span><span class="WHIT">  
<span class='line'>3908</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">a.value.isDrawn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">b.value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3909</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3910</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3911</span> </span><span class="WHIT">  
<span class='line'>3912</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.getRing</span><span class="PUNC">(</span><span class="NAME">overlap.rings</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getAngle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">6.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3913</span> </span><span class="WHIT">          </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">a.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3914</span> </span><span class="WHIT">          </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">b.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Decide which way to rotate the vertices depending on the effect it has on the overlap score</span><span class="WHIT">
<span class='line'>3915</span> </span><span class="WHIT">  
<span class='line'>3916</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">overlapScore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3917</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">subTreeOverlapA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSubtreeOverlapScore</span><span class="PUNC">(</span><span class="NAME">a.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlapScore.vertexScores</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3918</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">subTreeOverlapB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSubtreeOverlapScore</span><span class="PUNC">(</span><span class="NAME">b.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlapScore.vertexScores</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3919</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">total</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">subTreeOverlapA.value</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">subTreeOverlapB.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3920</span> </span><span class="WHIT">          </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">a.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3921</span> </span><span class="WHIT">          </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">b.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3922</span> </span><span class="WHIT">          </span><span class="NAME">overlapScore</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3923</span> </span><span class="WHIT">          </span><span class="NAME">subTreeOverlapA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSubtreeOverlapScore</span><span class="PUNC">(</span><span class="NAME">a.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlapScore.vertexScores</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3924</span> </span><span class="WHIT">          </span><span class="NAME">subTreeOverlapB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSubtreeOverlapScore</span><span class="PUNC">(</span><span class="NAME">b.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlapScore.vertexScores</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3925</span> </span><span class="WHIT">  
<span class='line'>3926</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">subTreeOverlapA.value</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">subTreeOverlapB.value</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">total</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3927</span> </span><span class="WHIT">            </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">a.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3928</span> </span><span class="WHIT">            </span><span class="NAME">this.rotateSubtree</span><span class="PUNC">(</span><span class="NAME">b.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">overlap.common.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3929</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3930</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">overlap.vertices.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3931</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">overlap.rings.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="COMM">// TODO: Implement for more overlap resolution</span><span class="WHIT">
<span class='line'>3932</span> </span><span class="WHIT">            </span><span class="COMM">// console.log(overlap);</span><span class="WHIT">
<span class='line'>3933</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3934</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3935</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3936</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3937</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3938</span>      * Resolve secondary overlaps. Those overlaps are due to the structure turning back on itself.
<span class='line'>3939</span>      *
<span class='line'>3940</span>      * @param {Object[]} scores An array of objects sorted descending by score.
<span class='line'>3941</span>      * @param {Number} scores[].id A vertex id.
<span class='line'>3942</span>      * @param {Number} scores[].score The overlap score associated with the vertex id.
<span class='line'>3943</span>      */</span><span class="WHIT">
<span class='line'>3944</span> </span><span class="WHIT">  
<span class='line'>3945</span>   
<span class='line'>3946</span>     </span><span class="NAME">resolveSecondaryOverlaps</span><span class="PUNC">(</span><span class="NAME">scores</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3947</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">scores.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3948</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scores</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">score</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.opts.overlapSensitivity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3949</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">scores</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3950</span> </span><span class="WHIT">  
<span class='line'>3951</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3952</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">closest</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getClosestVertex</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3953</span> </span><span class="WHIT">  
<span class='line'>3954</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">closest</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3955</span> </span><span class="WHIT">              </span><span class="COMM">// If one of the vertices is the first one, the previous vertex is not the central vertex but the dummy</span><span class="WHIT">
<span class='line'>3956</span> </span><span class="WHIT">              </span><span class="COMM">// so take the next rather than the previous, which is vertex 1</span><span class="WHIT">
<span class='line'>3957</span> </span><span class="WHIT">              </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">closestPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3958</span> </span><span class="WHIT">  
<span class='line'>3959</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">closest.isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3960</span> </span><span class="WHIT">                </span><span class="NAME">closestPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">closest.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">closest.previousPosition</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3961</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3962</span> </span><span class="WHIT">                </span><span class="NAME">closestPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">closest.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">closest.position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3963</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3964</span> </span><span class="WHIT">  
<span class='line'>3965</span>               </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexPreviousPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">vertex.previousPosition</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3966</span> </span><span class="WHIT">              </span><span class="NAME">vertex.position.rotateAwayFrom</span><span class="PUNC">(</span><span class="NAME">closestPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexPreviousPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">20</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3967</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3968</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3969</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3970</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3971</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3972</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3973</span>      * Get the last non-null or 0 angle vertex.
<span class='line'>3974</span>      * @param {Number} vertexId A vertex id.
<span class='line'>3975</span>      * @returns {Vertex} The last vertex with an angle that was not 0 or null.
<span class='line'>3976</span>      */</span><span class="WHIT">
<span class='line'>3977</span> </span><span class="WHIT">  
<span class='line'>3978</span>   
<span class='line'>3979</span>     </span><span class="NAME">getLastVertexWithAngle</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3980</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3981</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3982</span> </span><span class="WHIT">  
<span class='line'>3983</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3984</span> </span><span class="WHIT">        </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3985</span> </span><span class="WHIT">        </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3986</span> </span><span class="WHIT">        </span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.parentVertexId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3987</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3988</span> </span><span class="WHIT">  
<span class='line'>3989</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3990</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3991</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>3992</span>      * Positiones the next vertex thus creating a bond.
<span class='line'>3993</span>      *
<span class='line'>3994</span>      * @param {Vertex} vertex A vertex.
<span class='line'>3995</span>      * @param {Vertex} [previousVertex=null] The previous vertex which has been positioned.
<span class='line'>3996</span>      * @param {Number} [angle=0.0] The (global) angle of the vertex.
<span class='line'>3997</span>      * @param {Boolean} [originShortest=false] Whether the origin is the shortest subtree in the branch.
<span class='line'>3998</span>      * @param {Boolean} [skipPositioning=false] Whether or not to skip positioning and just check the neighbours.
<span class='line'>3999</span>      */</span><span class="WHIT">
<span class='line'>4000</span> </span><span class="WHIT">  
<span class='line'>4001</span>   
<span class='line'>4002</span>     </span><span class="NAME">createNextBond</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originShortest</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">skipPositioning</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4003</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.positioned</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">skipPositioning</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4004</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4005</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// If the double bond config was set on this vertex, do not check later</span><span class="WHIT">
<span class='line'>4006</span> </span><span class="WHIT">  
<span class='line'>4007</span>   
<span class='line'>4008</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">doubleBondConfigSet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Keeping track of configurations around double bonds</span><span class="WHIT">
<span class='line'>4009</span> </span><span class="WHIT">  
<span class='line'>4010</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4011</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4012</span> </span><span class="WHIT">  
<span class='line'>4013</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">edge.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">edge.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">this.doubleBondConfigCount</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4014</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4015</span> </span><span class="WHIT">            </span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edge.bondType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4016</span> </span><span class="WHIT">            </span><span class="NAME">doubleBondConfigSet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Switch if the bond is a branch bond and previous vertex is the first</span><span class="WHIT">
<span class='line'>4017</span> </span><span class="WHIT">            </span><span class="COMM">// TODO: Why is it different with the first vertex?</span><span class="WHIT">
<span class='line'>4018</span> </span><span class="WHIT">  
<span class='line'>4019</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex.parentVertexId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertex.value.branchBond</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4020</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4021</span> </span><span class="WHIT">                </span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4022</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4023</span> </span><span class="WHIT">                </span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4024</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4025</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4026</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4027</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4028</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// If the current node is the member of one ring, then point straight away</span><span class="WHIT">
<span class='line'>4029</span> </span><span class="WHIT">      </span><span class="COMM">// from the center of the ring. However, if the current node is a member of</span><span class="WHIT">
<span class='line'>4030</span> </span><span class="WHIT">      </span><span class="COMM">// two rings, point away from the middle of the centers of the two rings</span><span class="WHIT">
<span class='line'>4031</span> </span><span class="WHIT">  
<span class='line'>4032</span>   
<span class='line'>4033</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">skipPositioning</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4034</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">previousVertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4035</span> </span><span class="WHIT">          </span><span class="COMM">// Add a (dummy) previous position if there is no previous vertex defined</span><span class="WHIT">
<span class='line'>4036</span> </span><span class="WHIT">          </span><span class="COMM">// Since the first vertex is at (0, 0), create a vector at (bondLength, 0)</span><span class="WHIT">
<span class='line'>4037</span> </span><span class="WHIT">          </span><span class="COMM">// and rotate it by 90Â°</span><span class="WHIT">
<span class='line'>4038</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dummy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4039</span> </span><span class="WHIT">          </span><span class="NAME">dummy.rotate</span><span class="PUNC">(</span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4040</span> </span><span class="WHIT">          </span><span class="NAME">vertex.previousPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dummy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4041</span> </span><span class="WHIT">          </span><span class="NAME">vertex.setPosition</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4042</span> </span><span class="WHIT">          </span><span class="NAME">vertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Do not position the vertex if it belongs to a bridged ring that is positioned using a layout algorithm.</span><span class="WHIT">
<span class='line'>4043</span> </span><span class="WHIT">  
<span class='line'>4044</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.bridgedRing</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4045</span> </span><span class="WHIT">            </span><span class="NAME">vertex.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4046</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4047</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4048</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">previousVertex.neighbours</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4049</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">joinedVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4050</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0.0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4051</span> </span><span class="WHIT">  
<span class='line'>4052</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex.value.bridgedRing</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">previousVertex.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4053</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4054</span> </span><span class="WHIT">              </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4055</span> </span><span class="WHIT">  
<span class='line'>4056</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ArrayHelper.containsAll</span><span class="PUNC">(</span><span class="NAME">neighbour.value.rings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertex.value.rings</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4057</span> </span><span class="WHIT">                </span><span class="NAME">joinedVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4058</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4059</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4060</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4061</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4062</span> </span><span class="WHIT">  
<span class='line'>4063</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">joinedVertex</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4064</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4065</span> </span><span class="WHIT">              </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4066</span> </span><span class="WHIT">  
<span class='line'>4067</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v.positioned</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.areVerticesInSameRing</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4068</span> </span><span class="WHIT">                </span><span class="NAME">pos.add</span><span class="PUNC">(</span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">v.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertex.position</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4069</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4070</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4071</span> </span><span class="WHIT">  
<span class='line'>4072</span>             </span><span class="NAME">pos.invert</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">previousVertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4073</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4074</span> </span><span class="WHIT">            </span><span class="NAME">pos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">joinedVertex.position.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">rotateAround</span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4075</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4076</span> </span><span class="WHIT">  
<span class='line'>4077</span>           </span><span class="NAME">vertex.previousPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">previousVertex.position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4078</span> </span><span class="WHIT">          </span><span class="NAME">vertex.setPositionFromVector</span><span class="PUNC">(</span><span class="NAME">pos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4079</span> </span><span class="WHIT">          </span><span class="NAME">vertex.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4080</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4081</span> </span><span class="WHIT">          </span><span class="COMM">// If the previous vertex was not part of a ring, draw a bond based</span><span class="WHIT">
<span class='line'>4082</span> </span><span class="WHIT">          </span><span class="COMM">// on the global angle of the previous bond</span><span class="WHIT">
<span class='line'>4083</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4084</span> </span><span class="WHIT">          </span><span class="NAME">v.rotate</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4085</span> </span><span class="WHIT">          </span><span class="NAME">v.add</span><span class="PUNC">(</span><span class="NAME">previousVertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4086</span> </span><span class="WHIT">          </span><span class="NAME">vertex.setPositionFromVector</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4087</span> </span><span class="WHIT">          </span><span class="NAME">vertex.previousPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">previousVertex.position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4088</span> </span><span class="WHIT">          </span><span class="NAME">vertex.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4089</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4090</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Go to next vertex</span><span class="WHIT">
<span class='line'>4091</span> </span><span class="WHIT">      </span><span class="COMM">// If two rings are connected by a bond ...</span><span class="WHIT">
<span class='line'>4092</span> </span><span class="WHIT">  
<span class='line'>4093</span>   
<span class='line'>4094</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.bridgedRing</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4095</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nextRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRing</span><span class="PUNC">(</span><span class="NAME">vertex.value.bridgedRing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4096</span> </span><span class="WHIT">  
<span class='line'>4097</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nextRing.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4098</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">vertex.previousPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4099</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.invert</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4100</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4101</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.polyCircumradius</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextRing.members.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4102</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4103</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.add</span><span class="PUNC">(</span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4104</span> </span><span class="WHIT">          </span><span class="NAME">this.createRing</span><span class="PUNC">(</span><span class="NAME">nextRing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4105</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4106</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4107</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nextRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRing</span><span class="PUNC">(</span><span class="NAME">vertex.value.rings</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4108</span> </span><span class="WHIT">  
<span class='line'>4109</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nextRing.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4110</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">vertex.previousPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4111</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.invert</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4112</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4113</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.polyCircumradius</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextRing.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4114</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4115</span> </span><span class="WHIT">          </span><span class="NAME">nextCenter.add</span><span class="PUNC">(</span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4116</span> </span><span class="WHIT">          </span><span class="NAME">this.createRing</span><span class="PUNC">(</span><span class="NAME">nextRing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextCenter</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4117</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4118</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4119</span> </span><span class="WHIT">        </span><span class="COMM">// Draw the non-ring vertices connected to this one  </span><span class="WHIT">
<span class='line'>4120</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isStereoCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value.isStereoCenter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4121</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmpNeighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.getNeighbours</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4122</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Remove neighbours that are not drawn</span><span class="WHIT">
<span class='line'>4123</span> </span><span class="WHIT">  
<span class='line'>4124</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">tmpNeighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4125</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">tmpNeighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4126</span> </span><span class="WHIT">            </span><span class="NAME">neighbours.push</span><span class="PUNC">(</span><span class="NAME">tmpNeighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4127</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4128</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Remove the previous vertex (which has already been drawn)</span><span class="WHIT">
<span class='line'>4129</span> </span><span class="WHIT">  
<span class='line'>4130</span>   
<span class='line'>4131</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4132</span> </span><span class="WHIT">          </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.remove</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4133</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4134</span> </span><span class="WHIT">  
<span class='line'>4135</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.getAngle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4136</span> </span><span class="WHIT">  
<span class='line'>4137</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbours.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4138</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nextVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Make a single chain always cis except when there's a tribble (yes, this is a Star Trek reference) bond</span><span class="WHIT">
<span class='line'>4139</span> </span><span class="WHIT">          </span><span class="COMM">// or if there are successive double bonds. Added a ring check because if there is an aromatic ring the ring bond inside the ring counts as a double bond and leads to =-= being straight.</span><span class="WHIT">
<span class='line'>4140</span> </span><span class="WHIT">  
<span class='line'>4141</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'#'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">previousVertex.value.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'#'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">vertex.value.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'='</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">previousVertex.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">previousVertex.value.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'='</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertex.value.branchBond</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4142</span> </span><span class="WHIT">            </span><span class="NAME">vertex.value.drawExplicit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4143</span> </span><span class="WHIT">  
<span class='line'>4144</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4145</span> </span><span class="WHIT">              </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">straightEdge1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4146</span> </span><span class="WHIT">              </span><span class="NAME">straightEdge1.center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4147</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4148</span> </span><span class="WHIT">  
<span class='line'>4149</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">straightEdge2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextVertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4150</span> </span><span class="WHIT">            </span><span class="NAME">straightEdge2.center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4151</span> </span><span class="WHIT">  
<span class='line'>4152</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'#'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">previousVertex.value.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'#'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4153</span> </span><span class="WHIT">              </span><span class="NAME">nextVertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4154</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4155</span> </span><span class="WHIT">  
<span class='line'>4156</span>             </span><span class="NAME">nextVertex.drawExplicit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4157</span> </span><span class="WHIT">            </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">nextVertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nextVertex.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4158</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">previousVertex.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4159</span> </span><span class="WHIT">            </span><span class="COMM">// If coming out of a ring, always draw away from the center of mass</span><span class="WHIT">
<span class='line'>4160</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">proposedAngleA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4161</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">proposedAngleB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">proposedAngleA</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4162</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">proposedVectorA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4163</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">proposedVectorB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4164</span> </span><span class="WHIT">            </span><span class="NAME">proposedVectorA.rotate</span><span class="PUNC">(</span><span class="NAME">proposedAngleA</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4165</span> </span><span class="WHIT">            </span><span class="NAME">proposedVectorB.rotate</span><span class="PUNC">(</span><span class="NAME">proposedAngleB</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// let centerOfMass = this.getCurrentCenterOfMassInNeigbourhood(vertex.position, 100);</span><span class="WHIT">
<span class='line'>4166</span> </span><span class="WHIT">  
<span class='line'>4167</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">centerOfMass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getCurrentCenterOfMass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4168</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">distanceA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">proposedVectorA.distanceSq</span><span class="PUNC">(</span><span class="NAME">centerOfMass</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4169</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">distanceB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">proposedVectorB.distanceSq</span><span class="PUNC">(</span><span class="NAME">centerOfMass</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4170</span> </span><span class="WHIT">            </span><span class="NAME">nextVertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">distanceA</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">distanceB</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">proposedAngleB</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">proposedAngleA</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4171</span> </span><span class="WHIT">            </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">nextVertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nextVertex.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4172</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4173</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.angle</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Take the min and max if the previous angle was in a 4-neighbourhood (90Â° angles)</span><span class="WHIT">
<span class='line'>4174</span> </span><span class="WHIT">            </span><span class="COMM">// TODO: If a is null or zero, it should be checked whether or not this one should go cis or trans, that is,</span><span class="WHIT">
<span class='line'>4175</span> </span><span class="WHIT">            </span><span class="COMM">//       it should go into the oposite direction of the last non-null or 0 previous vertex / angle.</span><span class="WHIT">
<span class='line'>4176</span> </span><span class="WHIT">  
<span class='line'>4177</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">previousVertex.neighbours.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4178</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4179</span> </span><span class="WHIT">                </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NUMB">1.0472</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4180</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4181</span> </span><span class="WHIT">                </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1.0472</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4182</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4183</span> </span><span class="WHIT">                </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0472</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4184</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4185</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4186</span> </span><span class="WHIT">              </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getLastVertexWithAngle</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4187</span> </span><span class="WHIT">              </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v.angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4188</span> </span><span class="WHIT">  
<span class='line'>4189</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4190</span> </span><span class="WHIT">                </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0472</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4191</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4192</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Handle configuration around double bonds</span><span class="WHIT">
<span class='line'>4193</span> </span><span class="WHIT">  
<span class='line'>4194</span>   
<span class='line'>4195</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">doubleBondConfigSet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4196</span> </span><span class="WHIT">              </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bondType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextVertex.id</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">bondType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4197</span> </span><span class="WHIT">  
<span class='line'>4198</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4199</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="COMM">// Nothing to do since it will be trans per default</span><span class="WHIT">
<span class='line'>4200</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4201</span> </span><span class="WHIT">                  </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4202</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4203</span> </span><span class="WHIT">  
<span class='line'>4204</span>                 </span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4205</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4206</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4207</span> </span><span class="WHIT">                  </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4208</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="COMM">// Nothing to do since it will be trans per default</span><span class="WHIT">
<span class='line'>4209</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4210</span> </span><span class="WHIT">  
<span class='line'>4211</span>                 </span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4212</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4213</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4214</span> </span><span class="WHIT">  
<span class='line'>4215</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">originShortest</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4216</span> </span><span class="WHIT">              </span><span class="NAME">nextVertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4217</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4218</span> </span><span class="WHIT">              </span><span class="NAME">nextVertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4219</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4220</span> </span><span class="WHIT">  
<span class='line'>4221</span>             </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">nextVertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nextVertex.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4222</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4223</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbours.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4224</span> </span><span class="WHIT">          </span><span class="COMM">// If the previous vertex comes out of a ring, it doesn't have an angle set</span><span class="WHIT">
<span class='line'>4225</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4226</span> </span><span class="WHIT">  
<span class='line'>4227</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4228</span> </span><span class="WHIT">            </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0472</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4229</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Check for the longer subtree - always go with cis for the longer subtree</span><span class="WHIT">
<span class='line'>4230</span> </span><span class="WHIT">  
<span class='line'>4231</span>   
<span class='line'>4232</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">subTreeDepthA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4233</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">subTreeDepthB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4234</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4235</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4236</span> </span><span class="WHIT">          </span><span class="NAME">l.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">subTreeDepthA</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4237</span> </span><span class="WHIT">          </span><span class="NAME">r.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">subTreeDepthB</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Also get the subtree for the previous direction (this is important when</span><span class="WHIT">
<span class='line'>4238</span> </span><span class="WHIT">          </span><span class="COMM">// the previous vertex is the shortest path)</span><span class="WHIT">
<span class='line'>4239</span> </span><span class="WHIT">  
<span class='line'>4240</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">subTreeDepthC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">previousVertex.id</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4241</span> </span><span class="WHIT">  
<span class='line'>4242</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4243</span> </span><span class="WHIT">            </span><span class="NAME">previousVertex.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">subTreeDepthC</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4244</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4245</span> </span><span class="WHIT">  
<span class='line'>4246</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4247</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">trans</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Carbons go always cis</span><span class="WHIT">
<span class='line'>4248</span> </span><span class="WHIT">  
<span class='line'>4249</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r.value.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">l.value.element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">subTreeDepthB</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">subTreeDepthA</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4250</span> </span><span class="WHIT">            </span><span class="NAME">cis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4251</span> </span><span class="WHIT">            </span><span class="NAME">trans</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4252</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r.value.element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">l.value.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">subTreeDepthA</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">subTreeDepthB</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4253</span> </span><span class="WHIT">            </span><span class="NAME">cis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4254</span> </span><span class="WHIT">            </span><span class="NAME">trans</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4255</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">subTreeDepthB</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">subTreeDepthA</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4256</span> </span><span class="WHIT">            </span><span class="NAME">cis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4257</span> </span><span class="WHIT">            </span><span class="NAME">trans</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4258</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4259</span> </span><span class="WHIT">  
<span class='line'>4260</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cisVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">cis</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4261</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">transVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">trans</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4262</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeCis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cisVertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4263</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeTrans</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">transVertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// If the origin tree is the shortest, make them the main chain</span><span class="WHIT">
<span class='line'>4264</span> </span><span class="WHIT">  
<span class='line'>4265</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">originShortest</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4266</span> </span><span class="WHIT">  
<span class='line'>4267</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">subTreeDepthC</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">subTreeDepthA</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">subTreeDepthC</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">subTreeDepthB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4268</span> </span><span class="WHIT">            </span><span class="NAME">originShortest</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4269</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4270</span> </span><span class="WHIT">  
<span class='line'>4271</span>           </span><span class="NAME">transVertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4272</span> </span><span class="WHIT">          </span><span class="NAME">cisVertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4273</span> </span><span class="WHIT">  
<span class='line'>4274</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4275</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">transVertex.value.branchBond</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'\\'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4276</span> </span><span class="WHIT">              </span><span class="NAME">transVertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4277</span> </span><span class="WHIT">              </span><span class="NAME">cisVertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4278</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4279</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.doubleBondConfig</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4280</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">transVertex.value.branchBond</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4281</span> </span><span class="WHIT">              </span><span class="NAME">transVertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4282</span> </span><span class="WHIT">              </span><span class="NAME">cisVertex.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4283</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4284</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4285</span> </span><span class="WHIT">  
<span class='line'>4286</span>           </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">transVertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">transVertex.angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originShortest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4287</span> </span><span class="WHIT">          </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">cisVertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">cisVertex.angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originShortest</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4288</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbours.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4289</span> </span><span class="WHIT">          </span><span class="COMM">// The vertex with the longest sub-tree should always go straight</span><span class="WHIT">
<span class='line'>4290</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4291</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4292</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4293</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4294</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4295</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4296</span> </span><span class="WHIT">          </span><span class="NAME">s.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4297</span> </span><span class="WHIT">          </span><span class="NAME">l.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4298</span> </span><span class="WHIT">          </span><span class="NAME">r.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4299</span> </span><span class="WHIT">  
<span class='line'>4300</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d2</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">d2</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4301</span> </span><span class="WHIT">            </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4302</span> </span><span class="WHIT">            </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4303</span> </span><span class="WHIT">            </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4304</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d3</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">d3</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4305</span> </span><span class="WHIT">            </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4306</span> </span><span class="WHIT">            </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4307</span> </span><span class="WHIT">            </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4308</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Create a cross if more than one subtree is of length > 1</span><span class="WHIT">
<span class='line'>4309</span> </span><span class="WHIT">          </span><span class="COMM">// or the vertex is connected to a ring</span><span class="WHIT">
<span class='line'>4310</span> </span><span class="WHIT">  
<span class='line'>4311</span>   
<span class='line'>4312</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousVertex</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">previousVertex.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">s.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">l.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">r.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">l.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">r.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">s.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4313</span> </span><span class="WHIT">            </span><span class="NAME">s.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">vertex.angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4314</span> </span><span class="WHIT">  
<span class='line'>4315</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.angle</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4316</span> </span><span class="WHIT">              </span><span class="NAME">l.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">30</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4317</span> </span><span class="WHIT">              </span><span class="NAME">r.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">90</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4318</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4319</span> </span><span class="WHIT">              </span><span class="NAME">l.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">30</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4320</span> </span><span class="WHIT">              </span><span class="NAME">r.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">90</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4321</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4322</span> </span><span class="WHIT">  
<span class='line'>4323</span>             </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">s.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4324</span> </span><span class="WHIT">            </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">l.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4325</span> </span><span class="WHIT">            </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4326</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4327</span> </span><span class="WHIT">            </span><span class="NAME">s.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4328</span> </span><span class="WHIT">            </span><span class="NAME">l.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">90</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4329</span> </span><span class="WHIT">            </span><span class="NAME">r.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">90</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4330</span> </span><span class="WHIT">            </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">s.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4331</span> </span><span class="WHIT">            </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">l.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4332</span> </span><span class="WHIT">            </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4333</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4334</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbours.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4335</span> </span><span class="WHIT">          </span><span class="COMM">// The vertex with the longest sub-tree should always go to the reflected opposide direction</span><span class="WHIT">
<span class='line'>4336</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4337</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4338</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4339</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4340</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4341</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4342</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4343</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4344</span> </span><span class="WHIT">          </span><span class="NAME">w.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4345</span> </span><span class="WHIT">          </span><span class="NAME">x.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4346</span> </span><span class="WHIT">          </span><span class="NAME">y.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4347</span> </span><span class="WHIT">          </span><span class="NAME">z.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4348</span> </span><span class="WHIT">  
<span class='line'>4349</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d2</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">d2</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">d2</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4350</span> </span><span class="WHIT">            </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4351</span> </span><span class="WHIT">            </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4352</span> </span><span class="WHIT">            </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4353</span> </span><span class="WHIT">            </span><span class="NAME">z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4354</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d3</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">d3</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">d3</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4355</span> </span><span class="WHIT">            </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4356</span> </span><span class="WHIT">            </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4357</span> </span><span class="WHIT">            </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4358</span> </span><span class="WHIT">            </span><span class="NAME">z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4359</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d4</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">d4</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">d4</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">d3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4360</span> </span><span class="WHIT">            </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4361</span> </span><span class="WHIT">            </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4362</span> </span><span class="WHIT">            </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4363</span> </span><span class="WHIT">            </span><span class="NAME">z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4364</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4365</span> </span><span class="WHIT">  
<span class='line'>4366</span>           </span><span class="NAME">w.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">36</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4367</span> </span><span class="WHIT">          </span><span class="NAME">x.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">36</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4368</span> </span><span class="WHIT">          </span><span class="NAME">y.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">108</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4369</span> </span><span class="WHIT">          </span><span class="NAME">z.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">108</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4370</span> </span><span class="WHIT">          </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">w.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4371</span> </span><span class="WHIT">          </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">x.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4372</span> </span><span class="WHIT">          </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">y.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4373</span> </span><span class="WHIT">          </span><span class="NAME">this.createNextBond</span><span class="PUNC">(</span><span class="NAME">z</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">z.angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4374</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4375</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4376</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4377</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4378</span>      * Gets the vetex sharing the edge that is the common bond of two rings.
<span class='line'>4379</span>      *
<span class='line'>4380</span>      * @param {Vertex} vertex A vertex.
<span class='line'>4381</span>      * @returns {(Number|null)} The id of a vertex sharing the edge that is the common bond of two rings with the vertex provided or null, if none.
<span class='line'>4382</span>      */</span><span class="WHIT">
<span class='line'>4383</span> </span><span class="WHIT">  
<span class='line'>4384</span>   
<span class='line'>4385</span>     </span><span class="NAME">getCommonRingbondNeighbour</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4386</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.neighbours</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4387</span> </span><span class="WHIT">  
<span class='line'>4388</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4389</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4390</span> </span><span class="WHIT">  
<span class='line'>4391</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ArrayHelper.containsAll</span><span class="PUNC">(</span><span class="NAME">neighbour.value.rings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.value.rings</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4392</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4393</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4394</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4395</span> </span><span class="WHIT">  
<span class='line'>4396</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4397</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4398</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4399</span>      * Check if a vector is inside any ring.
<span class='line'>4400</span>      *
<span class='line'>4401</span>      * @param {Vector2} vec A vector.
<span class='line'>4402</span>      * @returns {Boolean} A boolean indicating whether or not the point (vector) is inside any of the rings associated with the current molecule.
<span class='line'>4403</span>      */</span><span class="WHIT">
<span class='line'>4404</span> </span><span class="WHIT">  
<span class='line'>4405</span>   
<span class='line'>4406</span>     </span><span class="NAME">isPointInRing</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4407</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4408</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4409</span> </span><span class="WHIT">  
<span class='line'>4410</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ring.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4411</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4412</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4413</span> </span><span class="WHIT">  
<span class='line'>4414</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.polyCircumradius</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4415</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">radiusSq</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4416</span> </span><span class="WHIT">  
<span class='line'>4417</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.distanceSq</span><span class="PUNC">(</span><span class="NAME">ring.center</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">radiusSq</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4418</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4419</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4420</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4421</span> </span><span class="WHIT">  
<span class='line'>4422</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4423</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4424</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4425</span>      * Check whether or not an edge is part of a ring.
<span class='line'>4426</span>      *
<span class='line'>4427</span>      * @param {Edge} edge An edge.
<span class='line'>4428</span>      * @returns {Boolean} A boolean indicating whether or not the edge is part of a ring.
<span class='line'>4429</span>      */</span><span class="WHIT">
<span class='line'>4430</span> </span><span class="WHIT">  
<span class='line'>4431</span>   
<span class='line'>4432</span>     </span><span class="NAME">isEdgeInRing</span><span class="PUNC">(</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4433</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4434</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4435</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.areVerticesInSameRing</span><span class="PUNC">(</span><span class="NAME">source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4436</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4437</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4438</span>      * Check whether or not an edge is rotatable.
<span class='line'>4439</span>      *
<span class='line'>4440</span>      * @param {Edge} edge An edge.
<span class='line'>4441</span>      * @returns {Boolean} A boolean indicating whether or not the edge is rotatable.
<span class='line'>4442</span>      */</span><span class="WHIT">
<span class='line'>4443</span> </span><span class="WHIT">  
<span class='line'>4444</span>   
<span class='line'>4445</span>     </span><span class="NAME">isEdgeRotatable</span><span class="PUNC">(</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4446</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4447</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Only single bonds are rotatable</span><span class="WHIT">
<span class='line'>4448</span> </span><span class="WHIT">  
<span class='line'>4449</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.bondType</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4450</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4451</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Do not rotate edges that have a further single bond to each side - do that!</span><span class="WHIT">
<span class='line'>4452</span> </span><span class="WHIT">      </span><span class="COMM">// If the bond is terminal, it doesn't make sense to rotate it</span><span class="WHIT">
<span class='line'>4453</span> </span><span class="WHIT">      </span><span class="COMM">// if (vertexA.getNeighbourCount() + vertexB.getNeighbourCount() &lt; 5) {</span><span class="WHIT">
<span class='line'>4454</span> </span><span class="WHIT">      </span><span class="COMM">//   return false;</span><span class="WHIT">
<span class='line'>4455</span> </span><span class="WHIT">      </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>4456</span> </span><span class="WHIT">  
<span class='line'>4457</span>   
<span class='line'>4458</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexA.isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">vertexB.isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4459</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4460</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Ringbonds are not rotatable</span><span class="WHIT">
<span class='line'>4461</span> </span><span class="WHIT">  
<span class='line'>4462</span>   
<span class='line'>4463</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexA.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertexB.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.areVerticesInSameRing</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4464</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4465</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4466</span> </span><span class="WHIT">  
<span class='line'>4467</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4468</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4469</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4470</span>      * Check whether or not a ring is an implicitly defined aromatic ring (lower case smiles).
<span class='line'>4471</span>      *
<span class='line'>4472</span>      * @param {Ring} ring A ring.
<span class='line'>4473</span>      * @returns {Boolean} A boolean indicating whether or not a ring is implicitly defined as aromatic.
<span class='line'>4474</span>      */</span><span class="WHIT">
<span class='line'>4475</span> </span><span class="WHIT">  
<span class='line'>4476</span>   
<span class='line'>4477</span>     </span><span class="NAME">isRingAromatic</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4478</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ring.members.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4479</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">ring.members</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4480</span> </span><span class="WHIT">  
<span class='line'>4481</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertex.value.isPartOfAromaticRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4482</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4483</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4484</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4485</span> </span><span class="WHIT">  
<span class='line'>4486</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4487</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4488</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4489</span>      * Get the normals of an edge.
<span class='line'>4490</span>      *
<span class='line'>4491</span>      * @param {Edge} edge An edge.
<span class='line'>4492</span>      * @returns {Vector2[]} An array containing two vectors, representing the normals.
<span class='line'>4493</span>      */</span><span class="WHIT">
<span class='line'>4494</span> </span><span class="WHIT">  
<span class='line'>4495</span>   
<span class='line'>4496</span>     </span><span class="NAME">getEdgeNormals</span><span class="PUNC">(</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4497</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4498</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Get the normalized normals for the edge</span><span class="WHIT">
<span class='line'>4499</span> </span><span class="WHIT">  
<span class='line'>4500</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.units</span><span class="PUNC">(</span><span class="NAME">v1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4501</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4502</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4503</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4504</span>      * Returns an array of vertices that are neighbouring a vertix but are not members of a ring (including bridges).
<span class='line'>4505</span>      *
<span class='line'>4506</span>      * @param {Number} vertexId A vertex id.
<span class='line'>4507</span>      * @returns {Vertex[]} An array of vertices.
<span class='line'>4508</span>      */</span><span class="WHIT">
<span class='line'>4509</span> </span><span class="WHIT">  
<span class='line'>4510</span>   
<span class='line'>4511</span>     </span><span class="NAME">getNonRingNeighbours</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4512</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nrneighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4513</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4514</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.neighbours</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4515</span> </span><span class="WHIT">  
<span class='line'>4516</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4517</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4518</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nIntersections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.intersection</span><span class="PUNC">(</span><span class="NAME">vertex.value.rings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neighbour.value.rings</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4519</span> </span><span class="WHIT">  
<span class='line'>4520</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nIntersections</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">neighbour.value.isBridge</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4521</span> </span><span class="WHIT">          </span><span class="NAME">nrneighbours.push</span><span class="PUNC">(</span><span class="NAME">neighbour</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4522</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4523</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4524</span> </span><span class="WHIT">  
<span class='line'>4525</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nrneighbours</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4526</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4527</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4528</span>      * Annotaed stereochemistry information for visualization.
<span class='line'>4529</span>      */</span><span class="WHIT">
<span class='line'>4530</span> </span><span class="WHIT">  
<span class='line'>4531</span>   
<span class='line'>4532</span>     </span><span class="NAME">annotateStereochemistry</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4533</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// For each stereo-center</span><span class="WHIT">
<span class='line'>4534</span> </span><span class="WHIT">  
<span class='line'>4535</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4536</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4537</span> </span><span class="WHIT">  
<span class='line'>4538</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertex.value.isStereoCenter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4539</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4540</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4541</span> </span><span class="WHIT">  
<span class='line'>4542</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.getNeighbours</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4543</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nNeighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4544</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">priorities</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">nNeighbours</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4545</span> </span><span class="WHIT">  
<span class='line'>4546</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nNeighbours</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4547</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Uint8Array</span><span class="PUNC">(</span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4548</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">priority</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4549</span> </span><span class="WHIT">          </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">vertex.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4550</span> </span><span class="WHIT">          </span><span class="NAME">this.visitStereochemistry</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">priority</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxDepth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Sort each level according to atomic number</span><span class="WHIT">
<span class='line'>4551</span> </span><span class="WHIT">  
<span class='line'>4552</span>           </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">priority.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4553</span> </span><span class="WHIT">            </span><span class="NAME">priority</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4554</span> </span><span class="WHIT">              </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4555</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4556</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4557</span> </span><span class="WHIT">  
<span class='line'>4558</span>           </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">priority</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4559</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4560</span> </span><span class="WHIT">  
<span class='line'>4561</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxLevels</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4562</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxEntries</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4563</span> </span><span class="WHIT">  
<span class='line'>4564</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">priorities.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4565</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">maxLevels</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4566</span> </span><span class="WHIT">            </span><span class="NAME">maxLevels</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4567</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4568</span> </span><span class="WHIT">  
<span class='line'>4569</span>           </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4570</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">maxEntries</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4571</span> </span><span class="WHIT">              </span><span class="NAME">maxEntries</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4572</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4573</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4574</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4575</span> </span><span class="WHIT">  
<span class='line'>4576</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">priorities.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4577</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">diff</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxLevels</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4578</span> </span><span class="WHIT">  
<span class='line'>4579</span>           </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">diff</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4580</span> </span><span class="WHIT">            </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4581</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Break ties by the position in the SMILES string as per specification</span><span class="WHIT">
<span class='line'>4582</span> </span><span class="WHIT">  
<span class='line'>4583</span>   
<span class='line'>4584</span>           </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Make all same length. Fill with zeroes.</span><span class="WHIT">
<span class='line'>4585</span> </span><span class="WHIT">  
<span class='line'>4586</span>           </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4587</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">diff</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxEntries</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4588</span> </span><span class="WHIT">  
<span class='line'>4589</span>             </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">diff</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4590</span> </span><span class="WHIT">              </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4591</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4592</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4593</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4594</span> </span><span class="WHIT">  
<span class='line'>4595</span>         </span><span class="NAME">priorities.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4596</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4597</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4598</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4599</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4600</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4601</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4602</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4603</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4604</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4605</span> </span><span class="WHIT">  
<span class='line'>4606</span>           </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4607</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4608</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">order</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Uint8Array</span><span class="PUNC">(</span><span class="NAME">nNeighbours</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4609</span> </span><span class="WHIT">  
<span class='line'>4610</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nNeighbours</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4611</span> </span><span class="WHIT">          </span><span class="NAME">order</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">priorities</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4612</span> </span><span class="WHIT">          </span><span class="NAME">vertex.value.priority</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4613</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Check the angles between elements 0 and 1, and 0 and 2 to determine whether they are</span><span class="WHIT">
<span class='line'>4614</span> </span><span class="WHIT">        </span><span class="COMM">// drawn cw or ccw</span><span class="WHIT">
<span class='line'>4615</span> </span><span class="WHIT">        </span><span class="COMM">// TODO: OC(Cl)=[C@]=C(C)F currently fails here, however this is, IMHO, not a valid SMILES.</span><span class="WHIT">
<span class='line'>4616</span> </span><span class="WHIT">  
<span class='line'>4617</span>   
<span class='line'>4618</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">posA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">order</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4619</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">posB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">order</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4620</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">posC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">order</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4621</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cwA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">posA.relativeClockwise</span><span class="PUNC">(</span><span class="NAME">posB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4622</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cwB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">posA.relativeClockwise</span><span class="PUNC">(</span><span class="NAME">posC</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// If the second priority is clockwise from the first, the ligands are drawn clockwise, since</span><span class="WHIT">
<span class='line'>4623</span> </span><span class="WHIT">        </span><span class="COMM">// The hydrogen can be drawn on either side</span><span class="WHIT">
<span class='line'>4624</span> </span><span class="WHIT">  
<span class='line'>4625</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isCw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cwA</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4626</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">rotation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value.bracket.chirality</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'@'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4627</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">rs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.parityOfPermutation</span><span class="PUNC">(</span><span class="NAME">order</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">rotation</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'R'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'S'</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Flip the hydrogen direction when the drawing doesn't match the chirality.</span><span class="WHIT">
<span class='line'>4628</span> </span><span class="WHIT">  
<span class='line'>4629</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">wedgeA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4630</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">wedgeB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4631</span> </span><span class="WHIT">  
<span class='line'>4632</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isCw</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rs</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'R'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isCw</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rs</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'S'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4633</span> </span><span class="WHIT">          </span><span class="NAME">vertex.value.hydrogenDirection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4634</span> </span><span class="WHIT">          </span><span class="NAME">wedgeA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4635</span> </span><span class="WHIT">          </span><span class="NAME">wedgeB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4636</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4637</span> </span><span class="WHIT">  
<span class='line'>4638</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.hasHydrogen</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4639</span> </span><span class="WHIT">          </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">order</span><span class="PUNC">[</span><span class="NAME">order.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">wedge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wedgeA</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4640</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Get the shortest subtree to flip up / down. Ignore lowest priority</span><span class="WHIT">
<span class='line'>4641</span> </span><span class="WHIT">        </span><span class="COMM">// The rules are following:</span><span class="WHIT">
<span class='line'>4642</span> </span><span class="WHIT">        </span><span class="COMM">// 1. Do not draw wedge between two stereocenters</span><span class="WHIT">
<span class='line'>4643</span> </span><span class="WHIT">        </span><span class="COMM">// 2. Heteroatoms</span><span class="WHIT">
<span class='line'>4644</span> </span><span class="WHIT">        </span><span class="COMM">// 3. Draw outside ring</span><span class="WHIT">
<span class='line'>4645</span> </span><span class="WHIT">        </span><span class="COMM">// 4. Shortest subtree</span><span class="WHIT">
<span class='line'>4646</span> </span><span class="WHIT">  
<span class='line'>4647</span>   
<span class='line'>4648</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">wedgeOrder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">neighbours.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4649</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">showHydrogen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertex.value.hasHydrogen</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4650</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value.hasHydrogen</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4651</span> </span><span class="WHIT">  
<span class='line'>4652</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">order.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4653</span> </span><span class="WHIT">          </span><span class="NAME">wedgeOrder</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Uint32Array</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4654</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">order</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4655</span> </span><span class="WHIT">          </span><span class="NAME">wedgeOrder</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour.value.isStereoCenter</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">100000</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// wedgeOrder[j][0] += neighbour.value.rings.length > 0 ? 0 : 10000;</span><span class="WHIT">
<span class='line'>4656</span> </span><span class="WHIT">          </span><span class="COMM">// Only add if in same ring, unlike above</span><span class="WHIT">
<span class='line'>4657</span> </span><span class="WHIT">  
<span class='line'>4658</span>           </span><span class="NAME">wedgeOrder</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.areVerticesInSameRing</span><span class="PUNC">(</span><span class="NAME">neighbour</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4659</span> </span><span class="WHIT">          </span><span class="NAME">wedgeOrder</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour.value.isHeteroAtom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4660</span> </span><span class="WHIT">          </span><span class="NAME">wedgeOrder</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour.value.subtreeDepth</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4661</span> </span><span class="WHIT">          </span><span class="NAME">wedgeOrder</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">neighbour.value.subtreeDepth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4662</span> </span><span class="WHIT">          </span><span class="NAME">wedgeOrder</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">order</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4663</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4664</span> </span><span class="WHIT">  
<span class='line'>4665</span>         </span><span class="NAME">wedgeOrder.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4666</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4667</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4668</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4669</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4670</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4671</span> </span><span class="WHIT">  
<span class='line'>4672</span>           </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4673</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// If all neighbours are in a ring, do not draw wedge, the hydrogen will be drawn.</span><span class="WHIT">
<span class='line'>4674</span> </span><span class="WHIT">  
<span class='line'>4675</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">showHydrogen</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4676</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">wedgeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wedgeOrder</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4677</span> </span><span class="WHIT">  
<span class='line'>4678</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.hasHydrogen</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4679</span> </span><span class="WHIT">            </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wedgeId</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">wedge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wedgeB</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4680</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4681</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">wedge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wedgeB</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4682</span> </span><span class="WHIT">  
<span class='line'>4683</span>             </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">order.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4684</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">wedge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">wedgeA</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4685</span> </span><span class="WHIT">                </span><span class="NAME">wedge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wedgeB</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4686</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4687</span> </span><span class="WHIT">                </span><span class="NAME">wedge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wedgeA</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4688</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4689</span> </span><span class="WHIT">  
<span class='line'>4690</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">order</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">wedgeId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4691</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4692</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4693</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4694</span> </span><span class="WHIT">  
<span class='line'>4695</span>             </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wedgeId</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">wedge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wedge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4696</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4697</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4698</span> </span><span class="WHIT">  
<span class='line'>4699</span>         </span><span class="NAME">vertex.value.chirality</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4700</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4701</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4702</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4703</span>      * 
<span class='line'>4704</span>      * 
<span class='line'>4705</span>      * @param {Number} vertexId The id of a vertex.
<span class='line'>4706</span>      * @param {(Number|null)} previousVertexId The id of the parent vertex of the vertex.
<span class='line'>4707</span>      * @param {Uint8Array} visited An array containing the visited flag for all vertices in the graph.
<span class='line'>4708</span>      * @param {Array} priority An array of arrays storing the atomic numbers for each level.
<span class='line'>4709</span>      * @param {Number} maxDepth The maximum depth.
<span class='line'>4710</span>      * @param {Number} depth The current depth.
<span class='line'>4711</span>      */</span><span class="WHIT">
<span class='line'>4712</span> </span><span class="WHIT">  
<span class='line'>4713</span>   
<span class='line'>4714</span>     </span><span class="NAME">visitStereochemistry</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">priority</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxDepth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">depth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentAtomicNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4715</span> </span><span class="WHIT">      </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4716</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4717</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">atomicNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value.getAtomicNumber</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4718</span> </span><span class="WHIT">  
<span class='line'>4719</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">priority.length</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">depth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4720</span> </span><span class="WHIT">        </span><span class="NAME">priority.push</span><span class="PUNC">(</span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4721</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4722</span> </span><span class="WHIT">  
<span class='line'>4723</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertexId</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">weight</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4724</span> </span><span class="WHIT">        </span><span class="NAME">priority</span><span class="PUNC">[</span><span class="NAME">depth</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">parentAtomicNumber</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">atomicNumber</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4725</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4726</span> </span><span class="WHIT">  
<span class='line'>4727</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">neighbours</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4728</span> </span><span class="WHIT">  
<span class='line'>4729</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4730</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">depth</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">maxDepth</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4731</span> </span><span class="WHIT">          </span><span class="NAME">this.visitStereochemistry</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">priority</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxDepth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">depth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atomicNumber</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4732</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4733</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Valences are filled with hydrogens and passed to the next level.</span><span class="WHIT">
<span class='line'>4734</span> </span><span class="WHIT">  
<span class='line'>4735</span>   
<span class='line'>4736</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">depth</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">maxDepth</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4737</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4738</span> </span><span class="WHIT">  
<span class='line'>4739</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4740</span> </span><span class="WHIT">          </span><span class="NAME">bonds</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.getEdge</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">weight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4741</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4742</span> </span><span class="WHIT">  
<span class='line'>4743</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertex.value.getMaxBonds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4744</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">priority.length</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">depth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4745</span> </span><span class="WHIT">            </span><span class="NAME">priority.push</span><span class="PUNC">(</span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4746</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4747</span> </span><span class="WHIT">  
<span class='line'>4748</span>           </span><span class="NAME">priority</span><span class="PUNC">[</span><span class="NAME">depth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">atomicNumber</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4749</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4750</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4751</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4752</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4753</span>      * Creates pseudo-elements (such as Et, Me, Ac, Bz, ...) at the position of the carbon sets
<span class='line'>4754</span>      * the involved atoms not to be displayed.
<span class='line'>4755</span>      */</span><span class="WHIT">
<span class='line'>4756</span> </span><span class="WHIT">  
<span class='line'>4757</span>   
<span class='line'>4758</span>     </span><span class="NAME">initPseudoElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4759</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4760</span> </span><span class="WHIT">        </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4761</span> </span><span class="WHIT">        </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">neighbourIds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.neighbours</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4762</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">neighbourIds.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4763</span> </span><span class="WHIT">  
<span class='line'>4764</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbourIds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4765</span> </span><span class="WHIT">          </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbourIds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4766</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Ignore atoms that have less than 3 neighbours, except if</span><span class="WHIT">
<span class='line'>4767</span> </span><span class="WHIT">        </span><span class="COMM">// the vertex is connected to a ring and has two neighbours</span><span class="WHIT">
<span class='line'>4768</span> </span><span class="WHIT">  
<span class='line'>4769</span>   
<span class='line'>4770</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.getNeighbourCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">vertex.value.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4771</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4772</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// TODO: This exceptions should be handled more elegantly (via config file?)</span><span class="WHIT">
<span class='line'>4773</span> </span><span class="WHIT">        </span><span class="COMM">// Ignore phosphates (especially for triphosphates)</span><span class="WHIT">
<span class='line'>4774</span> </span><span class="WHIT">  
<span class='line'>4775</span>   
<span class='line'>4776</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'P'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4777</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4778</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Ignore also guanidine</span><span class="WHIT">
<span class='line'>4779</span> </span><span class="WHIT">  
<span class='line'>4780</span>   
<span class='line'>4781</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.value.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'N'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'N'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'N'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4782</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4783</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Continue if there are less than two heteroatoms</span><span class="WHIT">
<span class='line'>4784</span> </span><span class="WHIT">        </span><span class="COMM">// or if a neighbour has more than 1 neighbour</span><span class="WHIT">
<span class='line'>4785</span> </span><span class="WHIT">  
<span class='line'>4786</span>   
<span class='line'>4787</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">heteroAtomCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4788</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4789</span> </span><span class="WHIT">  
<span class='line'>4790</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4791</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4792</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbouringElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour.value.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4793</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbourCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour.getNeighbourCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4794</span> </span><span class="WHIT">  
<span class='line'>4795</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbouringElement</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">neighbouringElement</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'H'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">neighbourCount</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4796</span> </span><span class="WHIT">            </span><span class="NAME">heteroAtomCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4797</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4798</span> </span><span class="WHIT">  
<span class='line'>4799</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbourCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4800</span> </span><span class="WHIT">            </span><span class="NAME">ctn</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4801</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4802</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4803</span> </span><span class="WHIT">  
<span class='line'>4804</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ctn</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">heteroAtomCount</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4805</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4806</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Get the previous atom (the one which is not terminal)</span><span class="WHIT">
<span class='line'>4807</span> </span><span class="WHIT">  
<span class='line'>4808</span>   
<span class='line'>4809</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">previous</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4810</span> </span><span class="WHIT">  
<span class='line'>4811</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4812</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4813</span> </span><span class="WHIT">  
<span class='line'>4814</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbour.getNeighbourCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4815</span> </span><span class="WHIT">            </span><span class="NAME">previous</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4816</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4817</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4818</span> </span><span class="WHIT">  
<span class='line'>4819</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4820</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4821</span> </span><span class="WHIT">  
<span class='line'>4822</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbour.getNeighbourCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4823</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4824</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4825</span> </span><span class="WHIT">  
<span class='line'>4826</span>           </span><span class="NAME">neighbour.value.isDrawn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4827</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Atom.maxBonds</span><span class="PUNC">[</span><span class="NAME">neighbour.value.element</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">neighbour.value.bondCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4828</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4829</span> </span><span class="WHIT">  
<span class='line'>4830</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">neighbour.value.bracket</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4831</span> </span><span class="WHIT">            </span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour.value.bracket.hcount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4832</span> </span><span class="WHIT">            </span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour.value.bracket.charge</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4833</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4834</span> </span><span class="WHIT">  
<span class='line'>4835</span>           </span><span class="NAME">vertex.value.attachPseudoElement</span><span class="PUNC">(</span><span class="NAME">neighbour.value.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previous</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">previous.value.element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hydrogens</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4836</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4837</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// The second pass</span><span class="WHIT">
<span class='line'>4838</span> </span><span class="WHIT">  
<span class='line'>4839</span>   
<span class='line'>4840</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4841</span> </span><span class="WHIT">        </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4842</span> </span><span class="WHIT">        </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">atom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4843</span> </span><span class="WHIT">        </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4844</span> </span><span class="WHIT">  
<span class='line'>4845</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'H'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">atom.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4846</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4847</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4848</span> </span><span class="WHIT">  
<span class='line'>4849</span>         </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">neighbourIds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.neighbours</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4850</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">neighbourIds.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4851</span> </span><span class="WHIT">  
<span class='line'>4852</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbourIds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4853</span> </span><span class="WHIT">          </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.graph.vertices</span><span class="PUNC">[</span><span class="NAME">neighbourIds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4854</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4855</span> </span><span class="WHIT">  
<span class='line'>4856</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4857</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbour</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4858</span> </span><span class="WHIT">  
<span class='line'>4859</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">neighbour.hasAttachedPseudoElements</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">neighbour.getAttachedPseudoElementsCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4860</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4861</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4862</span> </span><span class="WHIT">  
<span class='line'>4863</span>           </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">pseudoElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbour.getAttachedPseudoElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4864</span> </span><span class="WHIT">  
<span class='line'>4865</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pseudoElements.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'0O'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">pseudoElements.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'3C'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4866</span> </span><span class="WHIT">            </span><span class="NAME">neighbour.isDrawn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4867</span> </span><span class="WHIT">            </span><span class="NAME">vertex.value.attachPseudoElement</span><span class="PUNC">(</span><span class="STRN">'Ac'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4868</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4869</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4870</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4871</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4872</span> </span><span class="WHIT">  
<span class='line'>4873</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4874</span> </span><span class="WHIT">  
<span class='line'>4875</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Drawer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4876</span> </span><span class="WHIT">  
<span class='line'>4877</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./ArrayHelper"</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">"./Atom"</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="STRN">"./CanvasWrapper"</span><span class="PUNC">:</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="STRN">"./Edge"</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="STRN">"./Graph"</span><span class="PUNC">:</span><span class="NUMB">7</span><span class="PUNC">,</span><span class="STRN">"./Line"</span><span class="PUNC">:</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="STRN">"./MathHelper"</span><span class="PUNC">:</span><span class="NUMB">9</span><span class="PUNC">,</span><span class="STRN">"./Ring"</span><span class="PUNC">:</span><span class="NUMB">11</span><span class="PUNC">,</span><span class="STRN">"./RingConnection"</span><span class="PUNC">:</span><span class="NUMB">12</span><span class="PUNC">,</span><span class="STRN">"./SSSR"</span><span class="PUNC">:</span><span class="NUMB">13</span><span class="PUNC">,</span><span class="STRN">"./ThemeManager"</span><span class="PUNC">:</span><span class="NUMB">16</span><span class="PUNC">,</span><span class="STRN">"./Vector2"</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">,</span><span class="STRN">"./Vertex"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4878</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4879</span> </span><span class="WHIT">  
<span class='line'>4880</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>4881</span> </span><span class="WHIT">  
<span class='line'>4882</span>   </span><span class="COMM">/** 
<span class='line'>4883</span>    * A class representing an edge. 
<span class='line'>4884</span>    * 
<span class='line'>4885</span>    * @property {Number} id The id of this edge.
<span class='line'>4886</span>    * @property {Number} sourceId The id of the source vertex.
<span class='line'>4887</span>    * @property {Number} targetId The id of the target vertex.
<span class='line'>4888</span>    * @property {Number} weight The weight of this edge. That is, the degree of the bond (single bond = 1, double bond = 2, etc).
<span class='line'>4889</span>    * @property {String} [bondType='-'] The bond type of this edge.
<span class='line'>4890</span>    * @property {Boolean} [isPartOfAromaticRing=false] Whether or not this edge is part of an aromatic ring.
<span class='line'>4891</span>    * @property {Boolean} [center=false] Wheter or not the bond is centered. For example, this affects straight double bonds.
<span class='line'>4892</span>    * @property {String} [wedge=''] Wedge direction. Either '', 'up' or 'down'
<span class='line'>4893</span>    */</span><span class="WHIT">
<span class='line'>4894</span> </span><span class="WHIT">  </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">Edge</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4895</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4896</span>      * The constructor for the class Edge.
<span class='line'>4897</span>      *
<span class='line'>4898</span>      * @param {Number} sourceId A vertex id.
<span class='line'>4899</span>      * @param {Number} targetId A vertex id.
<span class='line'>4900</span>      * @param {Number} [weight=1] The weight of the edge.
<span class='line'>4901</span>      */</span><span class="WHIT">
<span class='line'>4902</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">weight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4903</span> </span><span class="WHIT">      </span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4904</span> </span><span class="WHIT">      </span><span class="NAME">this.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4905</span> </span><span class="WHIT">      </span><span class="NAME">this.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4906</span> </span><span class="WHIT">      </span><span class="NAME">this.weight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">weight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4907</span> </span><span class="WHIT">      </span><span class="NAME">this.bondType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4908</span> </span><span class="WHIT">      </span><span class="NAME">this.isPartOfAromaticRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4909</span> </span><span class="WHIT">      </span><span class="NAME">this.center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4910</span> </span><span class="WHIT">      </span><span class="NAME">this.wedge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4911</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4912</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4913</span>      * Set the bond type of this edge. This also sets the edge weight.
<span class='line'>4914</span>      * @param {String} bondType 
<span class='line'>4915</span>      */</span><span class="WHIT">
<span class='line'>4916</span> </span><span class="WHIT">  
<span class='line'>4917</span>   
<span class='line'>4918</span>     </span><span class="NAME">setBondType</span><span class="PUNC">(</span><span class="NAME">bondType</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4919</span> </span><span class="WHIT">      </span><span class="NAME">this.bondType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bondType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4920</span> </span><span class="WHIT">      </span><span class="NAME">this.weight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Edge.bonds</span><span class="PUNC">[</span><span class="NAME">bondType</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4921</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4922</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4923</span>      * An object mapping the bond type to the number of bonds.
<span class='line'>4924</span>      *
<span class='line'>4925</span>      * @returns {Object} The object containing the map.
<span class='line'>4926</span>      */</span><span class="WHIT">
<span class='line'>4927</span> </span><span class="WHIT">  
<span class='line'>4928</span>   
<span class='line'>4929</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">get</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4930</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4931</span> </span><span class="WHIT">        </span><span class="STRN">'-'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4932</span> </span><span class="WHIT">        </span><span class="STRN">'/'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4933</span> </span><span class="WHIT">        </span><span class="STRN">'\\'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4934</span> </span><span class="WHIT">        </span><span class="STRN">'='</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4935</span> </span><span class="WHIT">        </span><span class="STRN">'#'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4936</span> </span><span class="WHIT">        </span><span class="STRN">'$'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT">
<span class='line'>4937</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4938</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4939</span> </span><span class="WHIT">  
<span class='line'>4940</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4941</span> </span><span class="WHIT">  
<span class='line'>4942</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Edge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4943</span> </span><span class="WHIT">  
<span class='line'>4944</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">7</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4945</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4946</span> </span><span class="WHIT">  
<span class='line'>4947</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>4948</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">MathHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./MathHelper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4949</span> </span><span class="WHIT">  
<span class='line'>4950</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vector2'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4951</span> </span><span class="WHIT">  
<span class='line'>4952</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vertex'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4953</span> </span><span class="WHIT">  
<span class='line'>4954</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Edge'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4955</span> </span><span class="WHIT">  
<span class='line'>4956</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Ring'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4957</span> </span><span class="WHIT">  
<span class='line'>4958</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Atom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Atom'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4959</span> </span><span class="WHIT">  </span><span class="COMM">/** 
<span class='line'>4960</span>    * A class representing the molecular graph. 
<span class='line'>4961</span>    * 
<span class='line'>4962</span>    * @property {Vertex[]} vertices The vertices of the graph.
<span class='line'>4963</span>    * @property {Edge[]} edges The edges of this graph.
<span class='line'>4964</span>    * @property {Object} vertexIdsToEdgeId A map mapping vertex ids to the edge between the two vertices. The key is defined as vertexAId + '_' + vertexBId.
<span class='line'>4965</span>    * @property {Boolean} isometric A boolean indicating whether or not the SMILES associated with this graph is isometric.
<span class='line'>4966</span>    */</span><span class="WHIT">
<span class='line'>4967</span> </span><span class="WHIT">  
<span class='line'>4968</span>   
<span class='line'>4969</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">Graph</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4970</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4971</span>      * The constructor of the class Graph.
<span class='line'>4972</span>      * 
<span class='line'>4973</span>      * @param {Object} parseTree A SMILES parse tree.
<span class='line'>4974</span>      * @param {Boolean} [isomeric=false] A boolean specifying whether or not the SMILES is isomeric.
<span class='line'>4975</span>      */</span><span class="WHIT">
<span class='line'>4976</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">parseTree</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isomeric</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4977</span> </span><span class="WHIT">      </span><span class="NAME">this.vertices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4978</span> </span><span class="WHIT">      </span><span class="NAME">this.edges</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4979</span> </span><span class="WHIT">      </span><span class="NAME">this.vertexIdsToEdgeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4980</span> </span><span class="WHIT">      </span><span class="NAME">this.isomeric</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isomeric</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Used for the bridge detection algorithm</span><span class="WHIT">
<span class='line'>4981</span> </span><span class="WHIT">  
<span class='line'>4982</span>       </span><span class="NAME">this._time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4983</span> </span><span class="WHIT">  
<span class='line'>4984</span>       </span><span class="NAME">this._init</span><span class="PUNC">(</span><span class="NAME">parseTree</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4985</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4986</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>4987</span>      * PRIVATE FUNCTION. Initializing the graph from the parse tree.
<span class='line'>4988</span>      *
<span class='line'>4989</span>      * @param {Object} node The current node in the parse tree.
<span class='line'>4990</span>      * @param {Number} parentVertexId=null The id of the previous vertex.
<span class='line'>4991</span>      * @param {Boolean} isBranch=false Whether or not the bond leading to this vertex is a branch bond. Branches are represented by parentheses in smiles (e.g. CC(O)C).
<span class='line'>4992</span>      */</span><span class="WHIT">
<span class='line'>4993</span> </span><span class="WHIT">  
<span class='line'>4994</span>   
<span class='line'>4995</span>     </span><span class="NAME">_init</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">order</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentVertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isBranch</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4996</span> </span><span class="WHIT">      </span><span class="COMM">// Create a new vertex object</span><span class="WHIT">
<span class='line'>4997</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">atom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Atom</span><span class="PUNC">(</span><span class="NAME">node.atom.element</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">node.atom.element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">node.atom</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">node.bond</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4998</span> </span><span class="WHIT">      </span><span class="NAME">atom.branchBond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">node.branchBond</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4999</span> </span><span class="WHIT">      </span><span class="NAME">atom.ringbonds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">node.ringbonds</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5000</span> </span><span class="WHIT">      </span><span class="NAME">atom.bracket</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">node.atom.element</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">node.atom</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5001</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vertex</span><span class="PUNC">(</span><span class="NAME">atom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5002</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">parentVertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">parentVertexId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5003</span> </span><span class="WHIT">      </span><span class="NAME">this.addVertex</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Add the id of this node to the parent as child</span><span class="WHIT">
<span class='line'>5004</span> </span><span class="WHIT">  
<span class='line'>5005</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parentVertexId</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5006</span> </span><span class="WHIT">        </span><span class="NAME">vertex.setParentVertexId</span><span class="PUNC">(</span><span class="NAME">parentVertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5007</span> </span><span class="WHIT">        </span><span class="NAME">vertex.value.addNeighbouringElement</span><span class="PUNC">(</span><span class="NAME">parentVertex.value.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5008</span> </span><span class="WHIT">        </span><span class="NAME">parentVertex.addChild</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5009</span> </span><span class="WHIT">        </span><span class="NAME">parentVertex.value.addNeighbouringElement</span><span class="PUNC">(</span><span class="NAME">atom.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// In addition create a spanningTreeChildren property, which later will</span><span class="WHIT">
<span class='line'>5010</span> </span><span class="WHIT">        </span><span class="COMM">// not contain the children added through ringbonds</span><span class="WHIT">
<span class='line'>5011</span> </span><span class="WHIT">  
<span class='line'>5012</span>         </span><span class="NAME">parentVertex.spanningTreeChildren.push</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Add edge between this node and its parent</span><span class="WHIT">
<span class='line'>5013</span> </span><span class="WHIT">  
<span class='line'>5014</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Edge</span><span class="PUNC">(</span><span class="NAME">parentVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5015</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5016</span> </span><span class="WHIT">  
<span class='line'>5017</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isBranch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5018</span> </span><span class="WHIT">          </span><span class="NAME">edge.setBondType</span><span class="PUNC">(</span><span class="NAME">vertex.value.branchBond</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5019</span> </span><span class="WHIT">          </span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5020</span> </span><span class="WHIT">          </span><span class="NAME">edge.setBondType</span><span class="PUNC">(</span><span class="NAME">vertex.value.branchBond</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5021</span> </span><span class="WHIT">          </span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5022</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5023</span> </span><span class="WHIT">          </span><span class="NAME">edge.setBondType</span><span class="PUNC">(</span><span class="NAME">parentVertex.value.bondType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5024</span> </span><span class="WHIT">          </span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parentVertex.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5025</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5026</span> </span><span class="WHIT">  
<span class='line'>5027</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.addEdge</span><span class="PUNC">(</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5028</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5029</span> </span><span class="WHIT">  
<span class='line'>5030</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">node.ringbondCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5031</span> </span><span class="WHIT">  
<span class='line'>5032</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.bracket</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5033</span> </span><span class="WHIT">        </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.bracket.hcount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5034</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5035</span> </span><span class="WHIT">  
<span class='line'>5036</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">stereoHydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5037</span> </span><span class="WHIT">  
<span class='line'>5038</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.bracket</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">atom.bracket.chirality</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5039</span> </span><span class="WHIT">        </span><span class="NAME">atom.isStereoCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5040</span> </span><span class="WHIT">        </span><span class="NAME">stereoHydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.bracket.hcount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5041</span> </span><span class="WHIT">  
<span class='line'>5042</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">stereoHydrogens</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5043</span> </span><span class="WHIT">          </span><span class="NAME">this._init</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5044</span> </span><span class="WHIT">            </span><span class="NAME">atom</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'H'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5045</span> </span><span class="WHIT">            </span><span class="NAME">isBracket</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'false'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5046</span> </span><span class="WHIT">            </span><span class="NAME">branches</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5047</span> </span><span class="WHIT">            </span><span class="NAME">branchCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5048</span> </span><span class="WHIT">            </span><span class="NAME">ringbonds</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5049</span> </span><span class="WHIT">            </span><span class="NAME">ringbondCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5050</span> </span><span class="WHIT">            </span><span class="NAME">next</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5051</span> </span><span class="WHIT">            </span><span class="NAME">hasNext</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5052</span> </span><span class="WHIT">            </span><span class="NAME">bond</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="WHIT">
<span class='line'>5053</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5054</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5055</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5056</span> </span><span class="WHIT">  
<span class='line'>5057</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">node.branchCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5058</span> </span><span class="WHIT">        </span><span class="NAME">this._init</span><span class="PUNC">(</span><span class="NAME">node.branches</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5059</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5060</span> </span><span class="WHIT">  
<span class='line'>5061</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">node.hasNext</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5062</span> </span><span class="WHIT">        </span><span class="NAME">this._init</span><span class="PUNC">(</span><span class="NAME">node.next</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">node.branchCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5063</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5064</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5065</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5066</span>      * Clears all the elements in this graph (edges and vertices).
<span class='line'>5067</span>      */</span><span class="WHIT">
<span class='line'>5068</span> </span><span class="WHIT">  
<span class='line'>5069</span>   
<span class='line'>5070</span>     </span><span class="NAME">clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5071</span> </span><span class="WHIT">      </span><span class="NAME">this.vertices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5072</span> </span><span class="WHIT">      </span><span class="NAME">this.edges</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5073</span> </span><span class="WHIT">      </span><span class="NAME">this.vertexIdsToEdgeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5074</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5075</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5076</span>      * Add a vertex to the graph.
<span class='line'>5077</span>      *
<span class='line'>5078</span>      * @param {Vertex} vertex A new vertex.
<span class='line'>5079</span>      * @returns {Number} The vertex id of the new vertex.
<span class='line'>5080</span>      */</span><span class="WHIT">
<span class='line'>5081</span> </span><span class="WHIT">  
<span class='line'>5082</span>   
<span class='line'>5083</span>     </span><span class="NAME">addVertex</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5084</span> </span><span class="WHIT">      </span><span class="NAME">vertex.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5085</span> </span><span class="WHIT">      </span><span class="NAME">this.vertices.push</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5086</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5087</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5088</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5089</span>      * Add an edge to the graph.
<span class='line'>5090</span>      *
<span class='line'>5091</span>      * @param {Edge} edge A new edge.
<span class='line'>5092</span>      * @returns {Number} The edge id of the new edge.
<span class='line'>5093</span>      */</span><span class="WHIT">
<span class='line'>5094</span> </span><span class="WHIT">  
<span class='line'>5095</span>   
<span class='line'>5096</span>     </span><span class="NAME">addEdge</span><span class="PUNC">(</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5097</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5098</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5099</span> </span><span class="WHIT">      </span><span class="NAME">edge.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.edges.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5100</span> </span><span class="WHIT">      </span><span class="NAME">this.edges.push</span><span class="PUNC">(</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5101</span> </span><span class="WHIT">      </span><span class="NAME">this.vertexIdsToEdgeId</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'_'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edge.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5102</span> </span><span class="WHIT">      </span><span class="NAME">this.vertexIdsToEdgeId</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'_'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edge.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5103</span> </span><span class="WHIT">      </span><span class="NAME">edge.isPartOfAromaticRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">source.value.isPartOfAromaticRing</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">target.value.isPartOfAromaticRing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5104</span> </span><span class="WHIT">      </span><span class="NAME">source.value.bondCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edge.weight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5105</span> </span><span class="WHIT">      </span><span class="NAME">target.value.bondCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edge.weight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5106</span> </span><span class="WHIT">      </span><span class="NAME">source.edges.push</span><span class="PUNC">(</span><span class="NAME">edge.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5107</span> </span><span class="WHIT">      </span><span class="NAME">target.edges.push</span><span class="PUNC">(</span><span class="NAME">edge.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5108</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">edge.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5109</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5110</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5111</span>      * Returns the edge between two given vertices.
<span class='line'>5112</span>      *
<span class='line'>5113</span>      * @param {Number} vertexIdA A vertex id.
<span class='line'>5114</span>      * @param {Number} vertexIdB A vertex id.
<span class='line'>5115</span>      * @returns {(Edge|null)} The edge or, if no edge can be found, null.
<span class='line'>5116</span>      */</span><span class="WHIT">
<span class='line'>5117</span> </span><span class="WHIT">  
<span class='line'>5118</span>   
<span class='line'>5119</span>     </span><span class="NAME">getEdge</span><span class="PUNC">(</span><span class="NAME">vertexIdA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexIdB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5120</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertexIdsToEdgeId</span><span class="PUNC">[</span><span class="NAME">vertexIdA</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'_'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vertexIdB</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5121</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.edges</span><span class="PUNC">[</span><span class="NAME">edgeId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5122</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5123</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5124</span>      * Returns the ids of edges connected to a vertex.
<span class='line'>5125</span>      *
<span class='line'>5126</span>      * @param {Number} vertexId A vertex id.
<span class='line'>5127</span>      * @returns {Number[]} An array containing the ids of edges connected to the vertex.
<span class='line'>5128</span>      */</span><span class="WHIT">
<span class='line'>5129</span> </span><span class="WHIT">  
<span class='line'>5130</span>   
<span class='line'>5131</span>     </span><span class="NAME">getEdges</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5132</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeIds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5133</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5134</span> </span><span class="WHIT">  
<span class='line'>5135</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertex.neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5136</span> </span><span class="WHIT">        </span><span class="NAME">edgeIds.push</span><span class="PUNC">(</span><span class="NAME">this.vertexIdsToEdgeId</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'_'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vertex.neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5137</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5138</span> </span><span class="WHIT">  
<span class='line'>5139</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">edgeIds</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5140</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5141</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5142</span>      * Check whether or not two vertices are connected by an edge.
<span class='line'>5143</span>      *
<span class='line'>5144</span>      * @param {Number} vertexIdA A vertex id.
<span class='line'>5145</span>      * @param {Number} vertexIdB A vertex id.
<span class='line'>5146</span>      * @returns {Boolean} A boolean indicating whether or not two vertices are connected by an edge.
<span class='line'>5147</span>      */</span><span class="WHIT">
<span class='line'>5148</span> </span><span class="WHIT">  
<span class='line'>5149</span>   
<span class='line'>5150</span>     </span><span class="NAME">hasEdge</span><span class="PUNC">(</span><span class="NAME">vertexIdA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexIdB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5151</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.vertexIdsToEdgeId</span><span class="PUNC">[</span><span class="NAME">vertexIdA</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'_'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vertexIdB</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5152</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5153</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5154</span>      * Returns an array containing the vertex ids of this graph.
<span class='line'>5155</span>      * 
<span class='line'>5156</span>      * @returns {Number[]} An array containing all vertex ids of this graph.
<span class='line'>5157</span>      */</span><span class="WHIT">
<span class='line'>5158</span> </span><span class="WHIT">  
<span class='line'>5159</span>   
<span class='line'>5160</span>     </span><span class="NAME">getVertexList</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5161</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this.vertices.length</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5162</span> </span><span class="WHIT">  
<span class='line'>5163</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5164</span> </span><span class="WHIT">        </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5165</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5166</span> </span><span class="WHIT">  
<span class='line'>5167</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5168</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5169</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5170</span>      * Returns an array containing source, target arrays of this graphs edges.
<span class='line'>5171</span>      * 
<span class='line'>5172</span>      * @returns {Array[]} An array containing source, target arrays of this graphs edges. Example: [ [ 2, 5 ], [ 6, 9 ] ].
<span class='line'>5173</span>      */</span><span class="WHIT">
<span class='line'>5174</span> </span><span class="WHIT">  
<span class='line'>5175</span>   
<span class='line'>5176</span>     </span><span class="NAME">getEdgeList</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5177</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">this.edges.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5178</span> </span><span class="WHIT">  
<span class='line'>5179</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.edges.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5180</span> </span><span class="WHIT">        </span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">this.edges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.edges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">targetId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5181</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5182</span> </span><span class="WHIT">  
<span class='line'>5183</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5184</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5185</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5186</span>      * Get the adjacency matrix of the graph.
<span class='line'>5187</span>      * 
<span class='line'>5188</span>      * @returns {Array[]} The adjancency matrix of the molecular graph.
<span class='line'>5189</span>      */</span><span class="WHIT">
<span class='line'>5190</span> </span><span class="WHIT">  
<span class='line'>5191</span>   
<span class='line'>5192</span>     </span><span class="NAME">getAdjacencyMatrix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5193</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5194</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5195</span> </span><span class="WHIT">  
<span class='line'>5196</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5197</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5198</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fill</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5199</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5200</span> </span><span class="WHIT">  
<span class='line'>5201</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.edges.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5202</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.edges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5203</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5204</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5205</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5206</span> </span><span class="WHIT">  
<span class='line'>5207</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5208</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5209</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5210</span>      * Get the adjacency matrix of the graph with all bridges removed (thus the components). Thus the remaining vertices are all part of ring systems.
<span class='line'>5211</span>      * 
<span class='line'>5212</span>      * @returns {Array[]} The adjancency matrix of the molecular graph with all bridges removed.
<span class='line'>5213</span>      */</span><span class="WHIT">
<span class='line'>5214</span> </span><span class="WHIT">  
<span class='line'>5215</span>   
<span class='line'>5216</span>     </span><span class="NAME">getComponentsAdjacencyMatrix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5217</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5218</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5219</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bridges</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getBridges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5220</span> </span><span class="WHIT">  
<span class='line'>5221</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5222</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5223</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fill</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5224</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5225</span> </span><span class="WHIT">  
<span class='line'>5226</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.edges.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5227</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.edges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5228</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5229</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5230</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5231</span> </span><span class="WHIT">  
<span class='line'>5232</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">bridges.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5233</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">bridges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">bridges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5234</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">bridges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">bridges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5235</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5236</span> </span><span class="WHIT">  
<span class='line'>5237</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5238</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5239</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5240</span>      * Get the adjacency matrix of a subgraph.
<span class='line'>5241</span>      * 
<span class='line'>5242</span>      * @param {Number[]} vertexIds An array containing the vertex ids contained within the subgraph.
<span class='line'>5243</span>      * @returns {Array[]} The adjancency matrix of the subgraph.
<span class='line'>5244</span>      */</span><span class="WHIT">
<span class='line'>5245</span> </span><span class="WHIT">  
<span class='line'>5246</span>   
<span class='line'>5247</span>     </span><span class="NAME">getSubgraphAdjacencyMatrix</span><span class="PUNC">(</span><span class="NAME">vertexIds</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5248</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexIds.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5249</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5250</span> </span><span class="WHIT">  
<span class='line'>5251</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5252</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5253</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fill</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5254</span> </span><span class="WHIT">  
<span class='line'>5255</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5256</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5257</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5258</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5259</span> </span><span class="WHIT">  
<span class='line'>5260</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.hasEdge</span><span class="PUNC">(</span><span class="NAME">vertexIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexIds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5261</span> </span><span class="WHIT">            </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5262</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5263</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5264</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5265</span> </span><span class="WHIT">  
<span class='line'>5266</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5267</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5268</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5269</span>      * Get the distance matrix of the graph.
<span class='line'>5270</span>      * 
<span class='line'>5271</span>      * @returns {Array[]} The distance matrix of the graph.
<span class='line'>5272</span>      */</span><span class="WHIT">
<span class='line'>5273</span> </span><span class="WHIT">  
<span class='line'>5274</span>   
<span class='line'>5275</span>     </span><span class="NAME">getDistanceMatrix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5276</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5277</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">adja</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getAdjacencyMatrix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5278</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5279</span> </span><span class="WHIT">  
<span class='line'>5280</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5281</span> </span><span class="WHIT">        </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5282</span> </span><span class="WHIT">        </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fill</span><span class="PUNC">(</span><span class="NAME">Infinity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5283</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5284</span> </span><span class="WHIT">  
<span class='line'>5285</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5286</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5287</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">adja</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5288</span> </span><span class="WHIT">            </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5289</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5290</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5291</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5292</span> </span><span class="WHIT">  
<span class='line'>5293</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5294</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5295</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5296</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5297</span> </span><span class="WHIT">              </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5298</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5299</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5300</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5301</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5302</span> </span><span class="WHIT">  
<span class='line'>5303</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5304</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5305</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5306</span>      * Get the distance matrix of a subgraph.
<span class='line'>5307</span>      * 
<span class='line'>5308</span>      * @param {Number[]} vertexIds An array containing the vertex ids contained within the subgraph.
<span class='line'>5309</span>      * @returns {Array[]} The distance matrix of the subgraph.
<span class='line'>5310</span>      */</span><span class="WHIT">
<span class='line'>5311</span> </span><span class="WHIT">  
<span class='line'>5312</span>   
<span class='line'>5313</span>     </span><span class="NAME">getSubgraphDistanceMatrix</span><span class="PUNC">(</span><span class="NAME">vertexIds</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5314</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexIds.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5315</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">adja</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSubgraphAdjacencyMatrix</span><span class="PUNC">(</span><span class="NAME">vertexIds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5316</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5317</span> </span><span class="WHIT">  
<span class='line'>5318</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5319</span> </span><span class="WHIT">        </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5320</span> </span><span class="WHIT">        </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fill</span><span class="PUNC">(</span><span class="NAME">Infinity</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5321</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5322</span> </span><span class="WHIT">  
<span class='line'>5323</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5324</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5325</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">adja</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5326</span> </span><span class="WHIT">            </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5327</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5328</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5329</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5330</span> </span><span class="WHIT">  
<span class='line'>5331</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5332</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5333</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5334</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5335</span> </span><span class="WHIT">              </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5336</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5337</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5338</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5339</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5340</span> </span><span class="WHIT">  
<span class='line'>5341</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dist</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5342</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5343</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5344</span>      * Get the adjacency list of the graph.
<span class='line'>5345</span>      * 
<span class='line'>5346</span>      * @returns {Array[]} The adjancency list of the graph.
<span class='line'>5347</span>      */</span><span class="WHIT">
<span class='line'>5348</span> </span><span class="WHIT">  
<span class='line'>5349</span>   
<span class='line'>5350</span>     </span><span class="NAME">getAdjacencyList</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5351</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5352</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">adjacencyList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5353</span> </span><span class="WHIT">  
<span class='line'>5354</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5355</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5356</span> </span><span class="WHIT">  
<span class='line'>5357</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5358</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5359</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5360</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5361</span> </span><span class="WHIT">  
<span class='line'>5362</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.hasEdge</span><span class="PUNC">(</span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5363</span> </span><span class="WHIT">            </span><span class="NAME">adjacencyList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5364</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5365</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5366</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5367</span> </span><span class="WHIT">  
<span class='line'>5368</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">adjacencyList</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5369</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5370</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5371</span>      * Get the adjacency list of a subgraph.
<span class='line'>5372</span>      * 
<span class='line'>5373</span>      * @param {Number[]} vertexIds An array containing the vertex ids contained within the subgraph.
<span class='line'>5374</span>      * @returns {Array[]} The adjancency list of the subgraph.
<span class='line'>5375</span>      */</span><span class="WHIT">
<span class='line'>5376</span> </span><span class="WHIT">  
<span class='line'>5377</span>   
<span class='line'>5378</span>     </span><span class="NAME">getSubgraphAdjacencyList</span><span class="PUNC">(</span><span class="NAME">vertexIds</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5379</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexIds.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5380</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">adjacencyList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5381</span> </span><span class="WHIT">  
<span class='line'>5382</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5383</span> </span><span class="WHIT">        </span><span class="NAME">adjacencyList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5384</span> </span><span class="WHIT">  
<span class='line'>5385</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5386</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5387</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5388</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5389</span> </span><span class="WHIT">  
<span class='line'>5390</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.hasEdge</span><span class="PUNC">(</span><span class="NAME">vertexIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexIds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5391</span> </span><span class="WHIT">            </span><span class="NAME">adjacencyList</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5392</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5393</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5394</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5395</span> </span><span class="WHIT">  
<span class='line'>5396</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">adjacencyList</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5397</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5398</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5399</span>      * Returns an array containing the edge ids of bridges. A bridge splits the graph into multiple components when removed.
<span class='line'>5400</span>      * 
<span class='line'>5401</span>      * @returns {Number[]} An array containing the edge ids of the bridges.
<span class='line'>5402</span>      */</span><span class="WHIT">
<span class='line'>5403</span> </span><span class="WHIT">  
<span class='line'>5404</span>   
<span class='line'>5405</span>     </span><span class="NAME">getBridges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5406</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5407</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5408</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">disc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5409</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">low</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5410</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5411</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">adj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getAdjacencyList</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5412</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">outBridges</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5413</span> </span><span class="WHIT">      </span><span class="NAME">visited.fill</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5414</span> </span><span class="WHIT">      </span><span class="NAME">parent.fill</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5415</span> </span><span class="WHIT">      </span><span class="NAME">this._time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5416</span> </span><span class="WHIT">  
<span class='line'>5417</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5418</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5419</span> </span><span class="WHIT">          </span><span class="NAME">this._bridgeDfs</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">disc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">low</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">outBridges</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5420</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5421</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5422</span> </span><span class="WHIT">  
<span class='line'>5423</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">outBridges</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5424</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5425</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5426</span>      * Traverses the graph in breadth-first order.
<span class='line'>5427</span>      * 
<span class='line'>5428</span>      * @param {Number} startVertexId The id of the starting vertex.
<span class='line'>5429</span>      * @param {Function} callback The callback function to be called on every vertex.
<span class='line'>5430</span>      */</span><span class="WHIT">
<span class='line'>5431</span> </span><span class="WHIT">  
<span class='line'>5432</span>   
<span class='line'>5433</span>     </span><span class="NAME">traverseBF</span><span class="PUNC">(</span><span class="NAME">startVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5434</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5435</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5436</span> </span><span class="WHIT">      </span><span class="NAME">visited.fill</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5437</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">queue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">startVertexId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5438</span> </span><span class="WHIT">  
<span class='line'>5439</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">queue.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5440</span> </span><span class="WHIT">        </span><span class="COMM">// JavaScripts shift() is O(n) ... bad JavaScript, bad!</span><span class="WHIT">
<span class='line'>5441</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">queue.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5442</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5443</span> </span><span class="WHIT">        </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5444</span> </span><span class="WHIT">  
<span class='line'>5445</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertex.neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5446</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5447</span> </span><span class="WHIT">  
<span class='line'>5448</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5449</span> </span><span class="WHIT">            </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5450</span> </span><span class="WHIT">            </span><span class="NAME">queue.push</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5451</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5452</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5453</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5454</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5455</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5456</span>      * Get the depth of a subtree in the direction opposite to the vertex specified as the parent vertex.
<span class='line'>5457</span>      *
<span class='line'>5458</span>      * @param {Number} vertexId A vertex id.
<span class='line'>5459</span>      * @param {Number} parentVertexId The id of a neighbouring vertex.
<span class='line'>5460</span>      * @returns {Number} The depth of the sub-tree.
<span class='line'>5461</span>      */</span><span class="WHIT">
<span class='line'>5462</span> </span><span class="WHIT">  
<span class='line'>5463</span>   
<span class='line'>5464</span>     </span><span class="NAME">getTreeDepth</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentVertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5465</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">parentVertexId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5466</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5467</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5468</span> </span><span class="WHIT">  
<span class='line'>5469</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getSpanningTreeNeighbours</span><span class="PUNC">(</span><span class="NAME">parentVertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5470</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5471</span> </span><span class="WHIT">  
<span class='line'>5472</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5473</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">childId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5474</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getTreeDepth</span><span class="PUNC">(</span><span class="NAME">childId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5475</span> </span><span class="WHIT">  
<span class='line'>5476</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">max</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5477</span> </span><span class="WHIT">          </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5478</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5479</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5480</span> </span><span class="WHIT">  
<span class='line'>5481</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5482</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5483</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5484</span>      * Traverse a sub-tree in the graph.
<span class='line'>5485</span>      *
<span class='line'>5486</span>      * @param {Number} vertexId A vertex id.
<span class='line'>5487</span>      * @param {Number} parentVertexId A neighbouring vertex.
<span class='line'>5488</span>      * @param {Function} callback The callback function that is called with each visited as an argument.
<span class='line'>5489</span>      * @param {Number} [maxDepth=999999] The maximum depth of the recursion.
<span class='line'>5490</span>      * @param {Boolean} [ignoreFirst=false] Whether or not to ignore the starting vertex supplied as vertexId in the callback.
<span class='line'>5491</span>      * @param {Number} [depth=1] The current depth in the tree.
<span class='line'>5492</span>      * @param {Uint8Array} [visited=null] An array holding a flag on whether or not a node has been visited.
<span class='line'>5493</span>      */</span><span class="WHIT">
<span class='line'>5494</span> </span><span class="WHIT">  
<span class='line'>5495</span>   
<span class='line'>5496</span>     </span><span class="NAME">traverseTree</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxDepth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">999999</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ignoreFirst</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">depth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5497</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">visited</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5498</span> </span><span class="WHIT">        </span><span class="NAME">visited</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Uint8Array</span><span class="PUNC">(</span><span class="NAME">this.vertices.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5499</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5500</span> </span><span class="WHIT">  
<span class='line'>5501</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">depth</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">maxDepth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5502</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5503</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5504</span> </span><span class="WHIT">  
<span class='line'>5505</span>       </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5506</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5507</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.getNeighbours</span><span class="PUNC">(</span><span class="NAME">parentVertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5508</span> </span><span class="WHIT">  
<span class='line'>5509</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ignoreFirst</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">depth</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5510</span> </span><span class="WHIT">        </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5511</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5512</span> </span><span class="WHIT">  
<span class='line'>5513</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5514</span> </span><span class="WHIT">        </span><span class="NAME">this.traverseTree</span><span class="PUNC">(</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxDepth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ignoreFirst</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">depth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5515</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5516</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5517</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5518</span>      * Positiones the (sub)graph using Kamada and Kawais algorithm for drawing general undirected graphs. https://pdfs.semanticscholar.org/b8d3/bca50ccc573c5cb99f7d201e8acce6618f04.pdf
<span class='line'>5519</span>      * There are undocumented layout parameters. They are undocumented for a reason, so be very careful.
<span class='line'>5520</span>      * 
<span class='line'>5521</span>      * @param {Number[]} vertexIds An array containing vertexIds to be placed using the force based layout.
<span class='line'>5522</span>      * @param {Vector2} center The center of the layout.
<span class='line'>5523</span>      * @param {Number} startVertexId A vertex id. Should be the starting vertex - e.g. the first to be positioned and connected to a previously place vertex.
<span class='line'>5524</span>      * @param {Ring} ring The bridged ring associated with this force-based layout.
<span class='line'>5525</span>      */</span><span class="WHIT">
<span class='line'>5526</span> </span><span class="WHIT">  
<span class='line'>5527</span>   
<span class='line'>5528</span>     </span><span class="NAME">kkLayout</span><span class="PUNC">(</span><span class="NAME">vertexIds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">threshold</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">innerThreshold</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxIteration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2000</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxInnerIteration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">50</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxEnergy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="NAME">e9</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5529</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeStrength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bondLength</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Add vertices that are directly connected to the ring</span><span class="WHIT">
<span class='line'>5530</span> </span><span class="WHIT">  
<span class='line'>5531</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexIds.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5532</span> </span><span class="WHIT">  
<span class='line'>5533</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5534</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">vertexIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5535</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.neighbours.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5536</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5537</span> </span><span class="WHIT">  
<span class='line'>5538</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">matDist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSubgraphDistanceMatrix</span><span class="PUNC">(</span><span class="NAME">vertexIds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5539</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexIds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Initialize the positions. Place all vertices on a ring around the center</span><span class="WHIT">
<span class='line'>5540</span> </span><span class="WHIT">  
<span class='line'>5541</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.polyCircumradius</span><span class="PUNC">(</span><span class="NUMB">500</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5542</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.centralAngle</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5543</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5544</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrPositionX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5545</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrPositionY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5546</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrPositioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5547</span> </span><span class="WHIT">      </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5548</span> </span><span class="WHIT">  
<span class='line'>5549</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5550</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">vertexIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5551</span> </span><span class="WHIT">  
<span class='line'>5552</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertex.positioned</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5553</span> </span><span class="WHIT">          </span><span class="NAME">arrPositionX</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">center.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5554</span> </span><span class="WHIT">          </span><span class="NAME">arrPositionY</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">center.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5555</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5556</span> </span><span class="WHIT">          </span><span class="NAME">arrPositionX</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.position.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5557</span> </span><span class="WHIT">          </span><span class="NAME">arrPositionY</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5558</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5559</span> </span><span class="WHIT">  
<span class='line'>5560</span>         </span><span class="NAME">arrPositioned</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.positioned</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5561</span> </span><span class="WHIT">        </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5562</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Create the matrix containing the lengths</span><span class="WHIT">
<span class='line'>5563</span> </span><span class="WHIT">  
<span class='line'>5564</span>   
<span class='line'>5565</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">matLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5566</span> </span><span class="WHIT">      </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5567</span> </span><span class="WHIT">  
<span class='line'>5568</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5569</span> </span><span class="WHIT">        </span><span class="NAME">matLength</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5570</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5571</span> </span><span class="WHIT">  
<span class='line'>5572</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5573</span> </span><span class="WHIT">          </span><span class="NAME">matLength</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">matDist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5574</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5575</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Create the matrix containing the spring strenghts</span><span class="WHIT">
<span class='line'>5576</span> </span><span class="WHIT">  
<span class='line'>5577</span>   
<span class='line'>5578</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">matStrength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5579</span> </span><span class="WHIT">      </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5580</span> </span><span class="WHIT">  
<span class='line'>5581</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5582</span> </span><span class="WHIT">        </span><span class="NAME">matStrength</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5583</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5584</span> </span><span class="WHIT">  
<span class='line'>5585</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5586</span> </span><span class="WHIT">          </span><span class="NAME">matStrength</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edgeStrength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">matDist</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">2.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5587</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5588</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Create the matrix containing the energies</span><span class="WHIT">
<span class='line'>5589</span> </span><span class="WHIT">  
<span class='line'>5590</span>   
<span class='line'>5591</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">matEnergy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5592</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrEnergySumX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5593</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrEnergySumY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5594</span> </span><span class="WHIT">      </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5595</span> </span><span class="WHIT">  
<span class='line'>5596</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5597</span> </span><span class="WHIT">        </span><span class="NAME">matEnergy</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5598</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5599</span> </span><span class="WHIT">  
<span class='line'>5600</span>       </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5601</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ux</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">denom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5602</span> </span><span class="WHIT">  
<span class='line'>5603</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5604</span> </span><span class="WHIT">        </span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionX</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5605</span> </span><span class="WHIT">        </span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionY</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5606</span> </span><span class="WHIT">        </span><span class="NAME">dEx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5607</span> </span><span class="WHIT">        </span><span class="NAME">dEy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5608</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5609</span> </span><span class="WHIT">  
<span class='line'>5610</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5611</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5612</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5613</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5614</span> </span><span class="WHIT">  
<span class='line'>5615</span>           </span><span class="NAME">vx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionX</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5616</span> </span><span class="WHIT">          </span><span class="NAME">vy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionY</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5617</span> </span><span class="WHIT">          </span><span class="NAME">denom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5618</span> </span><span class="WHIT">          </span><span class="NAME">matEnergy</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">matStrength</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">matLength</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">denom</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">matStrength</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">matLength</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">denom</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5619</span> </span><span class="WHIT">          </span><span class="NAME">matEnergy</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">matEnergy</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5620</span> </span><span class="WHIT">          </span><span class="NAME">dEx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">matEnergy</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5621</span> </span><span class="WHIT">          </span><span class="NAME">dEy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">matEnergy</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5622</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5623</span> </span><span class="WHIT">  
<span class='line'>5624</span>         </span><span class="NAME">arrEnergySumX</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dEx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5625</span> </span><span class="WHIT">        </span><span class="NAME">arrEnergySumY</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dEy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5626</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Utility functions, maybe inline them later</span><span class="WHIT">
<span class='line'>5627</span> </span><span class="WHIT">  
<span class='line'>5628</span>   
<span class='line'>5629</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">energy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5630</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">arrEnergySumX</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">arrEnergySumX</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">arrEnergySumY</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">arrEnergySumY</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrEnergySumX</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrEnergySumY</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5631</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5632</span> </span><span class="WHIT">  
<span class='line'>5633</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">highestEnergy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5634</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxEnergy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5635</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxEnergyId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5636</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxDEX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5637</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxDEY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5638</span> </span><span class="WHIT">        </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5639</span> </span><span class="WHIT">  
<span class='line'>5640</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5641</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">delta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEY</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">energy</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5642</span> </span><span class="WHIT">  
<span class='line'>5643</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">delta</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">maxEnergy</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">arrPositioned</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5644</span> </span><span class="WHIT">            </span><span class="NAME">maxEnergy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">delta</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5645</span> </span><span class="WHIT">            </span><span class="NAME">maxEnergyId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5646</span> </span><span class="WHIT">            </span><span class="NAME">maxDEX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dEX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5647</span> </span><span class="WHIT">            </span><span class="NAME">maxDEY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dEY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5648</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5649</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5650</span> </span><span class="WHIT">  
<span class='line'>5651</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">maxEnergyId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxEnergy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxDEX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxDEY</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5652</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5653</span> </span><span class="WHIT">  
<span class='line'>5654</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">update</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5655</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dxx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5656</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dyy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5657</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5658</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionX</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5659</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionY</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5660</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">matLength</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5661</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrK</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">matStrength</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5662</span> </span><span class="WHIT">        </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5663</span> </span><span class="WHIT">  
<span class='line'>5664</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5665</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5666</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5667</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5668</span> </span><span class="WHIT">  
<span class='line'>5669</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionX</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5670</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionY</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5671</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrL</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5672</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrK</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5673</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5674</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">denom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5675</span> </span><span class="WHIT">          </span><span class="NAME">dxx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">denom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5676</span> </span><span class="WHIT">          </span><span class="NAME">dyy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">denom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5677</span> </span><span class="WHIT">          </span><span class="NAME">dxy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">denom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5678</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Prevent division by zero</span><span class="WHIT">
<span class='line'>5679</span> </span><span class="WHIT">  
<span class='line'>5680</span>   
<span class='line'>5681</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dxx</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5682</span> </span><span class="WHIT">          </span><span class="NAME">dxx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5683</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5684</span> </span><span class="WHIT">  
<span class='line'>5685</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dyy</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5686</span> </span><span class="WHIT">          </span><span class="NAME">dyy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5687</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5688</span> </span><span class="WHIT">  
<span class='line'>5689</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dxy</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5690</span> </span><span class="WHIT">          </span><span class="NAME">dxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5691</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5692</span> </span><span class="WHIT">  
<span class='line'>5693</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dEX</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">dxx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dEY</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">dxy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5694</span> </span><span class="WHIT">        </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dxy</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">dxx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">dyy</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">dxy</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// had to split this onto two lines because the syntax highlighter went crazy.</span><span class="WHIT">
<span class='line'>5695</span> </span><span class="WHIT">  
<span class='line'>5696</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">dxy</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dEX</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">dxx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5697</span> </span><span class="WHIT">        </span><span class="NAME">arrPositionX</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5698</span> </span><span class="WHIT">        </span><span class="NAME">arrPositionY</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Update the energies</span><span class="WHIT">
<span class='line'>5699</span> </span><span class="WHIT">  
<span class='line'>5700</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">matEnergy</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5701</span> </span><span class="WHIT">        </span><span class="NAME">dEX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5702</span> </span><span class="WHIT">        </span><span class="NAME">dEY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5703</span> </span><span class="WHIT">        </span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionX</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5704</span> </span><span class="WHIT">        </span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionY</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5705</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prevEx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prevEy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">denom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5706</span> </span><span class="WHIT">        </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5707</span> </span><span class="WHIT">  
<span class='line'>5708</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5709</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5710</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5711</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5712</span> </span><span class="WHIT">  
<span class='line'>5713</span>           </span><span class="NAME">vx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionX</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5714</span> </span><span class="WHIT">          </span><span class="NAME">vy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionY</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Store old energies</span><span class="WHIT">
<span class='line'>5715</span> </span><span class="WHIT">  
<span class='line'>5716</span>           </span><span class="NAME">prevEx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrE</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5717</span> </span><span class="WHIT">          </span><span class="NAME">prevEy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrE</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5718</span> </span><span class="WHIT">          </span><span class="NAME">denom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5719</span> </span><span class="WHIT">          </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrK</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">arrL</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ux</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">denom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5720</span> </span><span class="WHIT">          </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrK</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">arrL</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">denom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5721</span> </span><span class="WHIT">          </span><span class="NAME">arrE</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5722</span> </span><span class="WHIT">          </span><span class="NAME">dEX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5723</span> </span><span class="WHIT">          </span><span class="NAME">dEY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5724</span> </span><span class="WHIT">          </span><span class="NAME">arrEnergySumX</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">prevEx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5725</span> </span><span class="WHIT">          </span><span class="NAME">arrEnergySumY</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">prevEy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5726</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5727</span> </span><span class="WHIT">  
<span class='line'>5728</span>         </span><span class="NAME">arrEnergySumX</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dEX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5729</span> </span><span class="WHIT">        </span><span class="NAME">arrEnergySumY</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dEY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5730</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Setting up variables for the while loops</span><span class="WHIT">
<span class='line'>5731</span> </span><span class="WHIT">  
<span class='line'>5732</span>   
<span class='line'>5733</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxEnergyId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5734</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dEX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5735</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dEY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5736</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">delta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5737</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">iteration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5738</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">innerIteration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5739</span> </span><span class="WHIT">  
<span class='line'>5740</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maxEnergy</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">threshold</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">maxIteration</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">iteration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5741</span> </span><span class="WHIT">        </span><span class="NAME">iteration</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5742</span> </span><span class="WHIT">        </span><span class="PUNC">[</span><span class="NAME">maxEnergyId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxEnergy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEY</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">highestEnergy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5743</span> </span><span class="WHIT">        </span><span class="NAME">delta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxEnergy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5744</span> </span><span class="WHIT">        </span><span class="NAME">innerIteration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5745</span> </span><span class="WHIT">  
<span class='line'>5746</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">delta</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">innerThreshold</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">maxInnerIteration</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">innerIteration</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5747</span> </span><span class="WHIT">          </span><span class="NAME">innerIteration</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5748</span> </span><span class="WHIT">          </span><span class="NAME">update</span><span class="PUNC">(</span><span class="NAME">maxEnergyId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5749</span> </span><span class="WHIT">          </span><span class="PUNC">[</span><span class="NAME">delta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dEY</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">energy</span><span class="PUNC">(</span><span class="NAME">maxEnergyId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5750</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5751</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5752</span> </span><span class="WHIT">  
<span class='line'>5753</span>       </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5754</span> </span><span class="WHIT">  
<span class='line'>5755</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5756</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexIds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5757</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5758</span> </span><span class="WHIT">        </span><span class="NAME">vertex.position.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionX</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5759</span> </span><span class="WHIT">        </span><span class="NAME">vertex.position.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arrPositionY</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5760</span> </span><span class="WHIT">        </span><span class="NAME">vertex.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5761</span> </span><span class="WHIT">        </span><span class="NAME">vertex.forcePositioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5762</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5763</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5764</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5765</span>      * PRIVATE FUNCTION used by getBridges().
<span class='line'>5766</span>      */</span><span class="WHIT">
<span class='line'>5767</span> </span><span class="WHIT">  
<span class='line'>5768</span>   
<span class='line'>5769</span>     </span><span class="NAME">_bridgeDfs</span><span class="PUNC">(</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">disc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">low</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">outBridges</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5770</span> </span><span class="WHIT">      </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5771</span> </span><span class="WHIT">      </span><span class="NAME">disc</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">low</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">this._time</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5772</span> </span><span class="WHIT">  
<span class='line'>5773</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">adj</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5774</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adj</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5775</span> </span><span class="WHIT">  
<span class='line'>5776</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5777</span> </span><span class="WHIT">          </span><span class="NAME">parent</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">u</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5778</span> </span><span class="WHIT">  
<span class='line'>5779</span>           </span><span class="NAME">this._bridgeDfs</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">disc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">low</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">outBridges</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5780</span> </span><span class="WHIT">  
<span class='line'>5781</span>           </span><span class="NAME">low</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">low</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">low</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// If low > disc, we have a bridge</span><span class="WHIT">
<span class='line'>5782</span> </span><span class="WHIT">  
<span class='line'>5783</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">low</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">disc</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5784</span> </span><span class="WHIT">            </span><span class="NAME">outBridges.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5785</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5786</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5787</span> </span><span class="WHIT">          </span><span class="NAME">low</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">low</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">disc</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5788</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5789</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5790</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5791</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5792</span>      * Returns the connected components of the graph.
<span class='line'>5793</span>      * 
<span class='line'>5794</span>      * @param {Array[]} adjacencyMatrix An adjacency matrix.
<span class='line'>5795</span>      * @returns {Set[]} Connected components as sets.
<span class='line'>5796</span>      */</span><span class="WHIT">
<span class='line'>5797</span> </span><span class="WHIT">  
<span class='line'>5798</span>   
<span class='line'>5799</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getConnectedComponents</span><span class="PUNC">(</span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5800</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5801</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5802</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">components</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5803</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5804</span> </span><span class="WHIT">      </span><span class="NAME">visited.fill</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5805</span> </span><span class="WHIT">  
<span class='line'>5806</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">u</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5807</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5808</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">component</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5809</span> </span><span class="WHIT">          </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5810</span> </span><span class="WHIT">          </span><span class="NAME">component.push</span><span class="PUNC">(</span><span class="NAME">u</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5811</span> </span><span class="WHIT">          </span><span class="NAME">count</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5812</span> </span><span class="WHIT">  
<span class='line'>5813</span>           </span><span class="NAME">Graph._ccGetDfs</span><span class="PUNC">(</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5814</span> </span><span class="WHIT">  
<span class='line'>5815</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">component.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5816</span> </span><span class="WHIT">            </span><span class="NAME">components.push</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5817</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5818</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5819</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5820</span> </span><span class="WHIT">  
<span class='line'>5821</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5822</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5823</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5824</span>      * Returns the number of connected components for the graph. 
<span class='line'>5825</span>      * 
<span class='line'>5826</span>      * @param {Array[]} adjacencyMatrix An adjacency matrix.
<span class='line'>5827</span>      * @returns {Number} The number of connected components of the supplied graph.
<span class='line'>5828</span>      */</span><span class="WHIT">
<span class='line'>5829</span> </span><span class="WHIT">  
<span class='line'>5830</span>   
<span class='line'>5831</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getConnectedComponentCount</span><span class="PUNC">(</span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5832</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5833</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5834</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5835</span> </span><span class="WHIT">      </span><span class="NAME">visited.fill</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5836</span> </span><span class="WHIT">  
<span class='line'>5837</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">u</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5838</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5839</span> </span><span class="WHIT">          </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5840</span> </span><span class="WHIT">          </span><span class="NAME">count</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5841</span> </span><span class="WHIT">  
<span class='line'>5842</span>           </span><span class="NAME">Graph._ccCountDfs</span><span class="PUNC">(</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5843</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5844</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5845</span> </span><span class="WHIT">  
<span class='line'>5846</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5847</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5848</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5849</span>      * PRIVATE FUNCTION used by getConnectedComponentCount().
<span class='line'>5850</span>      */</span><span class="WHIT">
<span class='line'>5851</span> </span><span class="WHIT">  
<span class='line'>5852</span>   
<span class='line'>5853</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">_ccCountDfs</span><span class="PUNC">(</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5854</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5855</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5856</span> </span><span class="WHIT">  
<span class='line'>5857</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5858</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5859</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5860</span> </span><span class="WHIT">  
<span class='line'>5861</span>         </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5862</span> </span><span class="WHIT">  
<span class='line'>5863</span>         </span><span class="NAME">Graph._ccCountDfs</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5864</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5865</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5866</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5867</span>      * PRIVATE FUNCTION used by getConnectedComponents().
<span class='line'>5868</span>      */</span><span class="WHIT">
<span class='line'>5869</span> </span><span class="WHIT">  
<span class='line'>5870</span>   
<span class='line'>5871</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">_ccGetDfs</span><span class="PUNC">(</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5872</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5873</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5874</span> </span><span class="WHIT">  
<span class='line'>5875</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5876</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5877</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5878</span> </span><span class="WHIT">  
<span class='line'>5879</span>         </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5880</span> </span><span class="WHIT">        </span><span class="NAME">component.push</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5881</span> </span><span class="WHIT">  
<span class='line'>5882</span>         </span><span class="NAME">Graph._ccGetDfs</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5883</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5884</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5885</span> </span><span class="WHIT">  
<span class='line'>5886</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5887</span> </span><span class="WHIT">  
<span class='line'>5888</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Graph</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5889</span> </span><span class="WHIT">  
<span class='line'>5890</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./Atom"</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="STRN">"./Edge"</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="STRN">"./MathHelper"</span><span class="PUNC">:</span><span class="NUMB">9</span><span class="PUNC">,</span><span class="STRN">"./Ring"</span><span class="PUNC">:</span><span class="NUMB">11</span><span class="PUNC">,</span><span class="STRN">"./Vector2"</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">,</span><span class="STRN">"./Vertex"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">8</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5891</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5892</span> </span><span class="WHIT">  
<span class='line'>5893</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>5894</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vector2'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5895</span> </span><span class="WHIT">  </span><span class="COMM">/** 
<span class='line'>5896</span>    * A class representing a line.
<span class='line'>5897</span>    * 
<span class='line'>5898</span>    * @property {Vector2} from The Vector2 defining the start of the line.
<span class='line'>5899</span>    * @property {Vector2} to The Vector2 defining the end of the line.
<span class='line'>5900</span>    * @property {String} elementFrom The element symbol associated with the start of the line.
<span class='line'>5901</span>    * @property {String} elementTo The element symbol associated with the end of the line.
<span class='line'>5902</span>    * @property {Boolean} chiralFrom A boolean indicating whether or not the source atom is a chiral center.
<span class='line'>5903</span>    * @property {Boolean} chiralTo A boolean indicating whether or tno the target atom is a chiral center.
<span class='line'>5904</span>    */</span><span class="WHIT">
<span class='line'>5905</span> </span><span class="WHIT">  
<span class='line'>5906</span>   
<span class='line'>5907</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5908</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5909</span>      * The constructor for the class Line.
<span class='line'>5910</span>      *
<span class='line'>5911</span>      * @param {Vector2} [from=new Vector2(0, 0)] A vector marking the beginning of the line.
<span class='line'>5912</span>      * @param {Vector2} [to=new Vector2(0, 0)] A vector marking the end of the line.
<span class='line'>5913</span>      * @param {string} [elementFrom=null] A one-letter representation of the element associated with the vector marking the beginning of the line.
<span class='line'>5914</span>      * @param {string} [elementTo=null] A one-letter representation of the element associated with the vector marking the end of the line.
<span class='line'>5915</span>      * @param {Boolean} [chiralFrom=false] Whether or not the from atom is a chiral center.
<span class='line'>5916</span>      * @param {Boolean} [chiralTo=false] Whether or not the to atom is a chiral center.
<span class='line'>5917</span>      */</span><span class="WHIT">
<span class='line'>5918</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">from</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">chiralFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">chiralTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5919</span> </span><span class="WHIT">      </span><span class="NAME">this.from</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">from</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5920</span> </span><span class="WHIT">      </span><span class="NAME">this.to</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5921</span> </span><span class="WHIT">      </span><span class="NAME">this.elementFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementFrom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5922</span> </span><span class="WHIT">      </span><span class="NAME">this.elementTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementTo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5923</span> </span><span class="WHIT">      </span><span class="NAME">this.chiralFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">chiralFrom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5924</span> </span><span class="WHIT">      </span><span class="NAME">this.chiralTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">chiralTo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5925</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5926</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5927</span>      * Clones this line and returns the clone.
<span class='line'>5928</span>      *
<span class='line'>5929</span>      * @returns {Line} A clone of this line.
<span class='line'>5930</span>      */</span><span class="WHIT">
<span class='line'>5931</span> </span><span class="WHIT">  
<span class='line'>5932</span>   
<span class='line'>5933</span>     </span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5934</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">this.from.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.to.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.elementFrom</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.elementTo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5935</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5936</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5937</span>      * Returns the length of this line.
<span class='line'>5938</span>      *
<span class='line'>5939</span>      * @returns {Number} The length of this line.
<span class='line'>5940</span>      */</span><span class="WHIT">
<span class='line'>5941</span> </span><span class="WHIT">  
<span class='line'>5942</span>   
<span class='line'>5943</span>     </span><span class="NAME">getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5944</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">this.to.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.from.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">this.to.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.from.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5945</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5946</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5947</span>      * Returns the angle of the line in relation to the coordinate system (the x-axis).
<span class='line'>5948</span>      *
<span class='line'>5949</span>      * @returns {Number} The angle in radians.
<span class='line'>5950</span>      */</span><span class="WHIT">
<span class='line'>5951</span> </span><span class="WHIT">  
<span class='line'>5952</span>   
<span class='line'>5953</span>     </span><span class="NAME">getAngle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5954</span> </span><span class="WHIT">      </span><span class="COMM">// Get the angle between the line and the x-axis</span><span class="WHIT">
<span class='line'>5955</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">diff</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">this.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5956</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">diff.angle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5957</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5958</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5959</span>      * Returns the right vector (the vector with the larger x value).
<span class='line'>5960</span>      *
<span class='line'>5961</span>      * @returns {Vector2} The right vector.
<span class='line'>5962</span>      */</span><span class="WHIT">
<span class='line'>5963</span> </span><span class="WHIT">  
<span class='line'>5964</span>   
<span class='line'>5965</span>     </span><span class="NAME">getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5966</span> </span><span class="WHIT">      </span><span class="COMM">// Return the vector with the larger x value (the right one)</span><span class="WHIT">
<span class='line'>5967</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5968</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.to</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5969</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5970</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.from</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5971</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5972</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5973</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5974</span>      * Returns the left vector (the vector with the smaller x value).
<span class='line'>5975</span>      *
<span class='line'>5976</span>      * @returns {Vector2} The left vector.
<span class='line'>5977</span>      */</span><span class="WHIT">
<span class='line'>5978</span> </span><span class="WHIT">  
<span class='line'>5979</span>   
<span class='line'>5980</span>     </span><span class="NAME">getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5981</span> </span><span class="WHIT">      </span><span class="COMM">// Return the vector with the smaller x value (the left one)</span><span class="WHIT">
<span class='line'>5982</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5983</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.from</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5984</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5985</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.to</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5986</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5987</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5988</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>5989</span>      * Returns the element associated with the right vector (the vector with the larger x value).
<span class='line'>5990</span>      *
<span class='line'>5991</span>      * @returns {String} The element associated with the right vector.
<span class='line'>5992</span>      */</span><span class="WHIT">
<span class='line'>5993</span> </span><span class="WHIT">  
<span class='line'>5994</span>   
<span class='line'>5995</span>     </span><span class="NAME">getRightElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5996</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5997</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.elementTo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5998</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5999</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.elementFrom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6000</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6001</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6002</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6003</span>      * Returns the element associated with the left vector (the vector with the smaller x value).
<span class='line'>6004</span>      *
<span class='line'>6005</span>      * @returns {String} The element associated with the left vector.
<span class='line'>6006</span>      */</span><span class="WHIT">
<span class='line'>6007</span> </span><span class="WHIT">  
<span class='line'>6008</span>   
<span class='line'>6009</span>     </span><span class="NAME">getLeftElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6010</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6011</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.elementFrom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6012</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6013</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.elementTo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6014</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6015</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6016</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6017</span>      * Returns whether or not the atom associated with the right vector (the vector with the larger x value) is a chiral center.
<span class='line'>6018</span>      *
<span class='line'>6019</span>      * @returns {Boolean} Whether or not the atom associated with the right vector is a chiral center.
<span class='line'>6020</span>      */</span><span class="WHIT">
<span class='line'>6021</span> </span><span class="WHIT">  
<span class='line'>6022</span>   
<span class='line'>6023</span>     </span><span class="NAME">getRightChiral</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6024</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6025</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.chiralTo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6026</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6027</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.chiralFrom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6028</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6029</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6030</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6031</span>      * Returns whether or not the atom associated with the left vector (the vector with the smaller x value) is a chiral center.
<span class='line'>6032</span>      *
<span class='line'>6033</span>      * @returns {Boolean} Whether or not the atom  associated with the left vector is a chiral center.
<span class='line'>6034</span>      */</span><span class="WHIT">
<span class='line'>6035</span> </span><span class="WHIT">  
<span class='line'>6036</span>   
<span class='line'>6037</span>     </span><span class="NAME">getLeftChiral</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6038</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6039</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.chiralFrom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6040</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6041</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.chiralTo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6042</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6043</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6044</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6045</span>      * Set the value of the right vector.
<span class='line'>6046</span>      *
<span class='line'>6047</span>      * @param {Number} x The x value.
<span class='line'>6048</span>      * @param {Number} y The y value.
<span class='line'>6049</span>      * @returns {Line} This line.
<span class='line'>6050</span>      */</span><span class="WHIT">
<span class='line'>6051</span> </span><span class="WHIT">  
<span class='line'>6052</span>   
<span class='line'>6053</span>     </span><span class="NAME">setRightVector</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6054</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6055</span> </span><span class="WHIT">        </span><span class="NAME">this.to.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6056</span> </span><span class="WHIT">        </span><span class="NAME">this.to.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6057</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6058</span> </span><span class="WHIT">        </span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6059</span> </span><span class="WHIT">        </span><span class="NAME">this.from.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6060</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6061</span> </span><span class="WHIT">  
<span class='line'>6062</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6063</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6064</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6065</span>      * Set the value of the left vector.
<span class='line'>6066</span>      *
<span class='line'>6067</span>      * @param {Number} x The x value.
<span class='line'>6068</span>      * @param {Number} y The y value.
<span class='line'>6069</span>      * @returns {Line} This line.
<span class='line'>6070</span>      */</span><span class="WHIT">
<span class='line'>6071</span> </span><span class="WHIT">  
<span class='line'>6072</span>   
<span class='line'>6073</span>     </span><span class="NAME">setLeftVector</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6074</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6075</span> </span><span class="WHIT">        </span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6076</span> </span><span class="WHIT">        </span><span class="NAME">this.from.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6077</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6078</span> </span><span class="WHIT">        </span><span class="NAME">this.to.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6079</span> </span><span class="WHIT">        </span><span class="NAME">this.to.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6080</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6081</span> </span><span class="WHIT">  
<span class='line'>6082</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6083</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6084</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6085</span>      * Rotates this line to be aligned with the x-axis. The center of rotation is the left vector.
<span class='line'>6086</span>      *
<span class='line'>6087</span>      * @returns {Line} This line.
<span class='line'>6088</span>      */</span><span class="WHIT">
<span class='line'>6089</span> </span><span class="WHIT">  
<span class='line'>6090</span>   
<span class='line'>6091</span>     </span><span class="NAME">rotateToXAxis</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6092</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6093</span> </span><span class="WHIT">      </span><span class="NAME">this.setRightVector</span><span class="PUNC">(</span><span class="NAME">left.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">left.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6094</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6095</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6096</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6097</span>      * Rotate the line by a given value (in radians). The center of rotation is the left vector.
<span class='line'>6098</span>      *
<span class='line'>6099</span>      * @param {Number} theta The angle (in radians) to rotate the line.
<span class='line'>6100</span>      * @returns {Line} This line.
<span class='line'>6101</span>      */</span><span class="WHIT">
<span class='line'>6102</span> </span><span class="WHIT">  
<span class='line'>6103</span>   
<span class='line'>6104</span>     </span><span class="NAME">rotate</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6105</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6106</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6107</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sinTheta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6108</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cosTheta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6109</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cosTheta</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">l.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sinTheta</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">l.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">l.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6110</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sinTheta</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">l.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">cosTheta</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">l.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">l.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6111</span> </span><span class="WHIT">      </span><span class="NAME">this.setRightVector</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6112</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6113</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6114</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6115</span>      * Shortens this line from the "from" direction by a given value (in pixels).
<span class='line'>6116</span>      *
<span class='line'>6117</span>      * @param {Number} by The length in pixels to shorten the vector by.
<span class='line'>6118</span>      * @returns {Line} This line.
<span class='line'>6119</span>      */</span><span class="WHIT">
<span class='line'>6120</span> </span><span class="WHIT">  
<span class='line'>6121</span>   
<span class='line'>6122</span>     </span><span class="NAME">shortenFrom</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6123</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">this.to</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.from</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6124</span> </span><span class="WHIT">      </span><span class="NAME">f.normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6125</span> </span><span class="WHIT">      </span><span class="NAME">f.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6126</span> </span><span class="WHIT">      </span><span class="NAME">this.from.add</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6127</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6128</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6129</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6130</span>      * Shortens this line from the "to" direction by a given value (in pixels).
<span class='line'>6131</span>      *
<span class='line'>6132</span>      * @param {Number} by The length in pixels to shorten the vector by.
<span class='line'>6133</span>      * @returns {Line} This line.
<span class='line'>6134</span>      */</span><span class="WHIT">
<span class='line'>6135</span> </span><span class="WHIT">  
<span class='line'>6136</span>   
<span class='line'>6137</span>     </span><span class="NAME">shortenTo</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6138</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">this.from</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.to</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6139</span> </span><span class="WHIT">      </span><span class="NAME">f.normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6140</span> </span><span class="WHIT">      </span><span class="NAME">f.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6141</span> </span><span class="WHIT">      </span><span class="NAME">this.to.add</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6142</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6143</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6144</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6145</span>      * Shorten the right side.
<span class='line'>6146</span>      *
<span class='line'>6147</span>      * @param {Number} by The length in pixels to shorten the vector by.
<span class='line'>6148</span>      * @returns {Line} Returns itself.
<span class='line'>6149</span>      */</span><span class="WHIT">
<span class='line'>6150</span> </span><span class="WHIT">  
<span class='line'>6151</span>   
<span class='line'>6152</span>     </span><span class="NAME">shortenRight</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6153</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6154</span> </span><span class="WHIT">        </span><span class="NAME">this.shortenTo</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6155</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6156</span> </span><span class="WHIT">        </span><span class="NAME">this.shortenFrom</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6157</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6158</span> </span><span class="WHIT">  
<span class='line'>6159</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6160</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6161</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6162</span>      * Shorten the left side.
<span class='line'>6163</span>      * 
<span class='line'>6164</span>      * @param {Number} by The length in pixels to shorten the vector by.
<span class='line'>6165</span>      * @returns {Line} Returns itself.
<span class='line'>6166</span>      */</span><span class="WHIT">
<span class='line'>6167</span> </span><span class="WHIT">  
<span class='line'>6168</span>   
<span class='line'>6169</span>     </span><span class="NAME">shortenLeft</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6170</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.from.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6171</span> </span><span class="WHIT">        </span><span class="NAME">this.shortenFrom</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6172</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6173</span> </span><span class="WHIT">        </span><span class="NAME">this.shortenTo</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6174</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6175</span> </span><span class="WHIT">  
<span class='line'>6176</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6177</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6178</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6179</span>      * Shortens this line from both directions by a given value (in pixels).
<span class='line'>6180</span>      *
<span class='line'>6181</span>      * @param {Number} by The length in pixels to shorten the vector by.
<span class='line'>6182</span>      * @returns {Line} This line.
<span class='line'>6183</span>      */</span><span class="WHIT">
<span class='line'>6184</span> </span><span class="WHIT">  
<span class='line'>6185</span>   
<span class='line'>6186</span>     </span><span class="NAME">shorten</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6187</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">this.from</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.to</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6188</span> </span><span class="WHIT">      </span><span class="NAME">f.normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6189</span> </span><span class="WHIT">      </span><span class="NAME">f.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">by</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6190</span> </span><span class="WHIT">      </span><span class="NAME">this.to.add</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6191</span> </span><span class="WHIT">      </span><span class="NAME">this.from.subtract</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6192</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6193</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6194</span> </span><span class="WHIT">  
<span class='line'>6195</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6196</span> </span><span class="WHIT">  
<span class='line'>6197</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6198</span> </span><span class="WHIT">  
<span class='line'>6199</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./Vector2"</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">9</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6200</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6201</span> </span><span class="WHIT">  
<span class='line'>6202</span>   </span><span class="COMM">/** 
<span class='line'>6203</span>    * A static class containing helper functions for math-related tasks. 
<span class='line'>6204</span>    */</span><span class="WHIT">
<span class='line'>6205</span> </span><span class="WHIT">  </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">MathHelper</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6206</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6207</span>      * Rounds a value to a given number of decimals.
<span class='line'>6208</span>      *
<span class='line'>6209</span>      * @static
<span class='line'>6210</span>      * @param {Number} value A number.
<span class='line'>6211</span>      * @param {Number} decimals The number of decimals.
<span class='line'>6212</span>      * @returns {Number} A number rounded to a given number of decimals.
<span class='line'>6213</span>      */</span><span class="WHIT">
<span class='line'>6214</span> </span><span class="WHIT">    </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">round</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">decimals</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6215</span> </span><span class="WHIT">      </span><span class="NAME">decimals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decimals</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">decimals</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6216</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'e'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">decimals</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'e-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">decimals</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6217</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6218</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6219</span>      * Returns the means of the angles contained in an array. In radians.
<span class='line'>6220</span>      *
<span class='line'>6221</span>      * @static
<span class='line'>6222</span>      * @param {Number[]} arr An array containing angles (in radians).
<span class='line'>6223</span>      * @returns {Number} The mean angle in radians.
<span class='line'>6224</span>      */</span><span class="WHIT">
<span class='line'>6225</span> </span><span class="WHIT">  
<span class='line'>6226</span>   
<span class='line'>6227</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">meanAngle</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6228</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6229</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6230</span> </span><span class="WHIT">  
<span class='line'>6231</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6232</span> </span><span class="WHIT">        </span><span class="NAME">sin</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6233</span> </span><span class="WHIT">        </span><span class="NAME">cos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6234</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6235</span> </span><span class="WHIT">  
<span class='line'>6236</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="NAME">sin</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cos</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6237</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6238</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6239</span>      * Returns the inner angle of a n-sided regular polygon.
<span class='line'>6240</span>      *
<span class='line'>6241</span>      * @static
<span class='line'>6242</span>      * @param {Number} n Number of sides of a regular polygon.
<span class='line'>6243</span>      * @returns {Number} The inner angle of a given regular polygon.
<span class='line'>6244</span>      */</span><span class="WHIT">
<span class='line'>6245</span> </span><span class="WHIT">  
<span class='line'>6246</span>   
<span class='line'>6247</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">innerAngle</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6248</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">180</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6249</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6250</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6251</span>      * Returns the circumradius of a n-sided regular polygon with a given side-length.
<span class='line'>6252</span>      *
<span class='line'>6253</span>      * @static
<span class='line'>6254</span>      * @param {Number} s The side length of the regular polygon.
<span class='line'>6255</span>      * @param {Number} n The number of sides.
<span class='line'>6256</span>      * @returns {Number} The circumradius of the regular polygon.
<span class='line'>6257</span>      */</span><span class="WHIT">
<span class='line'>6258</span> </span><span class="WHIT">  
<span class='line'>6259</span>   
<span class='line'>6260</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">polyCircumradius</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6261</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6262</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6263</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6264</span>      * Returns the apothem of a regular n-sided polygon based on its radius.
<span class='line'>6265</span>      *
<span class='line'>6266</span>      * @static
<span class='line'>6267</span>      * @param {Number} r The radius.
<span class='line'>6268</span>      * @param {Number} n The number of edges of the regular polygon.
<span class='line'>6269</span>      * @returns {Number} The apothem of a n-sided polygon based on its radius.
<span class='line'>6270</span>      */</span><span class="WHIT">
<span class='line'>6271</span> </span><span class="WHIT">  
<span class='line'>6272</span>   
<span class='line'>6273</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">apothem</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6274</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6275</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6276</span> </span><span class="WHIT">  
<span class='line'>6277</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">apothemFromSideLength</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6278</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.polyCircumradius</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6279</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">MathHelper.apothem</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6280</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6281</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6282</span>      * The central angle of a n-sided regular polygon. In radians.
<span class='line'>6283</span>      *
<span class='line'>6284</span>      * @static
<span class='line'>6285</span>      * @param {Number} n The number of sides of the regular polygon.
<span class='line'>6286</span>      * @returns {Number} The central angle of the n-sided polygon in radians.
<span class='line'>6287</span>      */</span><span class="WHIT">
<span class='line'>6288</span> </span><span class="WHIT">  
<span class='line'>6289</span>   
<span class='line'>6290</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">centralAngle</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6291</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">MathHelper.toRad</span><span class="PUNC">(</span><span class="NUMB">360</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6292</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6293</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6294</span>      * Convertes radians to degrees.
<span class='line'>6295</span>      *
<span class='line'>6296</span>      * @static
<span class='line'>6297</span>      * @param {Number} rad An angle in radians.
<span class='line'>6298</span>      * @returns {Number} The angle in degrees.
<span class='line'>6299</span>      */</span><span class="WHIT">
<span class='line'>6300</span> </span><span class="WHIT">  
<span class='line'>6301</span>   
<span class='line'>6302</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">toDeg</span><span class="PUNC">(</span><span class="NAME">rad</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6303</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rad</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">MathHelper.degFactor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6304</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6305</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6306</span>      * Converts degrees to radians.
<span class='line'>6307</span>      *
<span class='line'>6308</span>      * @static
<span class='line'>6309</span>      * @param {Number} deg An angle in degrees.
<span class='line'>6310</span>      * @returns {Number} The angle in radians.
<span class='line'>6311</span>      */</span><span class="WHIT">
<span class='line'>6312</span> </span><span class="WHIT">  
<span class='line'>6313</span>   
<span class='line'>6314</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">toRad</span><span class="PUNC">(</span><span class="NAME">deg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6315</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">deg</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">MathHelper.radFactor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6316</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6317</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6318</span>      * Returns the parity of the permutation (1 or -1)
<span class='line'>6319</span>      * @param {(Array|Uint8Array)} arr An array containing the permutation.
<span class='line'>6320</span>      * @returns {Number} The parity of the permutation (1 or -1), where 1 means even and -1 means odd.
<span class='line'>6321</span>      */</span><span class="WHIT">
<span class='line'>6322</span> </span><span class="WHIT">  
<span class='line'>6323</span>   
<span class='line'>6324</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">parityOfPermutation</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6325</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">visited</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Uint8Array</span><span class="PUNC">(</span><span class="NAME">arr.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6326</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">evenLengthCycleCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6327</span> </span><span class="WHIT">  
<span class='line'>6328</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">traverseCycle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cycleLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6329</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6330</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cycleLength</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6331</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6332</span> </span><span class="WHIT">  
<span class='line'>6333</span>         </span><span class="NAME">cycleLength</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6334</span> </span><span class="WHIT">        </span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6335</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">traverseCycle</span><span class="PUNC">(</span><span class="NAME">arr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cycleLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6336</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6337</span> </span><span class="WHIT">  
<span class='line'>6338</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6339</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">visited</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6340</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6341</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6342</span> </span><span class="WHIT">  
<span class='line'>6343</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cycleLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">traverseCycle</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6344</span> </span><span class="WHIT">        </span><span class="NAME">evenLengthCycleCount</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">cycleLength</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6345</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6346</span> </span><span class="WHIT">  
<span class='line'>6347</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">evenLengthCycleCount</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6348</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6349</span> </span><span class="WHIT">    </span><span class="COMM">/** The factor to convert degrees to radians. */</span><span class="WHIT">
<span class='line'>6350</span> </span><span class="WHIT">  
<span class='line'>6351</span>   
<span class='line'>6352</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">get</span><span class="WHIT"> </span><span class="NAME">radFactor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6353</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">180.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6354</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6355</span> </span><span class="WHIT">    </span><span class="COMM">/** The factor to convert radians to degrees. */</span><span class="WHIT">
<span class='line'>6356</span> </span><span class="WHIT">  
<span class='line'>6357</span>   
<span class='line'>6358</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">get</span><span class="WHIT"> </span><span class="NAME">degFactor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6359</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">180.0</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6360</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6361</span> </span><span class="WHIT">    </span><span class="COMM">/** Two times PI. */</span><span class="WHIT">
<span class='line'>6362</span> </span><span class="WHIT">  
<span class='line'>6363</span>   
<span class='line'>6364</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">get</span><span class="WHIT"> </span><span class="NAME">twoPI</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6365</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6366</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6367</span> </span><span class="WHIT">  
<span class='line'>6368</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6369</span> </span><span class="WHIT">  
<span class='line'>6370</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6371</span> </span><span class="WHIT">  
<span class='line'>6372</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6373</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6374</span> </span><span class="WHIT">  
<span class='line'>6375</span>   </span><span class="COMM">// WHEN REPLACING, CHECK FOR:</span><span class="WHIT">
<span class='line'>6376</span> </span><span class="WHIT">  </span><span class="COMM">// KEEP THIS WHEN REGENERATING THE PARSER !!</span><span class="WHIT">
<span class='line'>6377</span> </span><span class="WHIT">  </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6378</span> </span><span class="WHIT">    </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6379</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>6380</span>      * Generated by PEG.js 0.10.0.
<span class='line'>6381</span>      *
<span class='line'>6382</span>      * http://pegjs.org/
<span class='line'>6383</span>      */</span><span class="WHIT">
<span class='line'>6384</span> </span><span class="WHIT">  
<span class='line'>6385</span>     </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$subclass</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6386</span> </span><span class="WHIT">      </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">ctor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6387</span> </span><span class="WHIT">        </span><span class="NAME">this.constructor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">child</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6388</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6389</span> </span><span class="WHIT">  
<span class='line'>6390</span>       </span><span class="NAME">ctor.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parent.prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6391</span> </span><span class="WHIT">      </span><span class="NAME">child.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ctor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6392</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6393</span> </span><span class="WHIT">  
<span class='line'>6394</span>     </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$SyntaxError</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">expected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6395</span> </span><span class="WHIT">      </span><span class="NAME">this.message</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">message</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6396</span> </span><span class="WHIT">      </span><span class="NAME">this.expected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">expected</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6397</span> </span><span class="WHIT">      </span><span class="NAME">this.found</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6398</span> </span><span class="WHIT">      </span><span class="NAME">this.location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6399</span> </span><span class="WHIT">      </span><span class="NAME">this.name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"SyntaxError"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6400</span> </span><span class="WHIT">  
<span class='line'>6401</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">Error.captureStackTrace</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6402</span> </span><span class="WHIT">        </span><span class="NAME">Error.captureStackTrace</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$SyntaxError</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6403</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6404</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6405</span> </span><span class="WHIT">  
<span class='line'>6406</span>     </span><span class="NAME">peg$subclass</span><span class="PUNC">(</span><span class="NAME">peg$SyntaxError</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6407</span> </span><span class="WHIT">  
<span class='line'>6408</span>     </span><span class="NAME">peg$SyntaxError.buildMessage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6409</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">DESCRIBE_EXPECTATION_FNS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6410</span> </span><span class="WHIT">        </span><span class="NAME">literal</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expectation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6411</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">literalEscape</span><span class="PUNC">(</span><span class="NAME">expectation.text</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6412</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6413</span> </span><span class="WHIT">        </span><span class="STRN">"class"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expectation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6414</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">escapedParts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6415</span> </span><span class="WHIT">              </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6416</span> </span><span class="WHIT">  
<span class='line'>6417</span>           </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">expectation.parts.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6418</span> </span><span class="WHIT">            </span><span class="NAME">escapedParts</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">expectation.parts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">classEscape</span><span class="PUNC">(</span><span class="NAME">expectation.parts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"-"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">classEscape</span><span class="PUNC">(</span><span class="NAME">expectation.parts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">classEscape</span><span class="PUNC">(</span><span class="NAME">expectation.parts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6419</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6420</span> </span><span class="WHIT">  
<span class='line'>6421</span>           </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expectation.inverted</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"^"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">escapedParts</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6422</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6423</span> </span><span class="WHIT">        </span><span class="NAME">any</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expectation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6424</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"any character"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6425</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6426</span> </span><span class="WHIT">        </span><span class="NAME">end</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expectation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6427</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"end of input"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6428</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6429</span> </span><span class="WHIT">        </span><span class="NAME">other</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expectation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6430</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">expectation.description</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6431</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6432</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6433</span> </span><span class="WHIT">  
<span class='line'>6434</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">hex</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6435</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ch.charCodeAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6436</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6437</span> </span><span class="WHIT">  
<span class='line'>6438</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">literalEscape</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6439</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s.replace</span><span class="PUNC">(</span><span class="REGX">/\\/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\\\'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/"/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\"'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\0/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\0'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\t/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\t'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\n'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\r/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\r'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\x00-\x0F]/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6440</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'\\x0'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hex</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6441</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\x10-\x1F\x7F-\x9F]/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6442</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'\\x'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hex</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6443</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6444</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6445</span> </span><span class="WHIT">  
<span class='line'>6446</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">classEscape</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6447</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s.replace</span><span class="PUNC">(</span><span class="REGX">/\\/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\\\'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\]/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\]'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\^/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\^'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/-/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\-'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\0/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\0'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\t/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\t'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\n'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\r/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'\\r'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\x00-\x0F]/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6448</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'\\x0'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hex</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6449</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\x10-\x1F\x7F-\x9F]/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6450</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'\\x'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hex</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6451</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6452</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6453</span> </span><span class="WHIT">  
<span class='line'>6454</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">describeExpectation</span><span class="PUNC">(</span><span class="NAME">expectation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6455</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">DESCRIBE_EXPECTATION_FNS</span><span class="PUNC">[</span><span class="NAME">expectation.type</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">expectation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6456</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6457</span> </span><span class="WHIT">  
<span class='line'>6458</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">describeExpected</span><span class="PUNC">(</span><span class="NAME">expected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6459</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">descriptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">expected.length</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6460</span> </span><span class="WHIT">            </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6461</span> </span><span class="WHIT">            </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6462</span> </span><span class="WHIT">  
<span class='line'>6463</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">expected.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6464</span> </span><span class="WHIT">          </span><span class="NAME">descriptions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">describeExpectation</span><span class="PUNC">(</span><span class="NAME">expected</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6465</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6466</span> </span><span class="WHIT">  
<span class='line'>6467</span>         </span><span class="NAME">descriptions.sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6468</span> </span><span class="WHIT">  
<span class='line'>6469</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">descriptions.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6470</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">descriptions.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6471</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">descriptions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">descriptions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6472</span> </span><span class="WHIT">              </span><span class="NAME">descriptions</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">descriptions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6473</span> </span><span class="WHIT">              </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6474</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6475</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6476</span> </span><span class="WHIT">  
<span class='line'>6477</span>           </span><span class="NAME">descriptions.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6478</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6479</span> </span><span class="WHIT">  
<span class='line'>6480</span>         </span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">descriptions.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6481</span> </span><span class="WHIT">          </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>6482</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">descriptions</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6483</span> </span><span class="WHIT">  
<span class='line'>6484</span>           </span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>6485</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">descriptions</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" or "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">descriptions</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6486</span> </span><span class="WHIT">  
<span class='line'>6487</span>           </span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>6488</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">descriptions.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">", "</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">", or "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">descriptions</span><span class="PUNC">[</span><span class="NAME">descriptions.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6489</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6490</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6491</span> </span><span class="WHIT">  
<span class='line'>6492</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">describeFound</span><span class="PUNC">(</span><span class="NAME">found</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6493</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">found</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">literalEscape</span><span class="PUNC">(</span><span class="NAME">found</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\""</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"end of input"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6494</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6495</span> </span><span class="WHIT">  
<span class='line'>6496</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"Expected "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">describeExpected</span><span class="PUNC">(</span><span class="NAME">expected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" but "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">describeFound</span><span class="PUNC">(</span><span class="NAME">found</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" found."</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6497</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6498</span> </span><span class="WHIT">  
<span class='line'>6499</span>     </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parse</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6500</span> </span><span class="WHIT">      </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">void</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// KEEP THIS WHEN REGENERATING THE PARSER !!</span><span class="WHIT">
<span class='line'>6501</span> </span><span class="WHIT">  
<span class='line'>6502</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nOpenParentheses</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.split</span><span class="PUNC">(</span><span class="STRN">'('</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6503</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nCloseParentheses</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.split</span><span class="PUNC">(</span><span class="STRN">')'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6504</span> </span><span class="WHIT">  
<span class='line'>6505</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nOpenParentheses</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">nCloseParentheses</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6506</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">peg$buildSimpleError</span><span class="PUNC">(</span><span class="STRN">'The number of opening parentheses does not match the number of closing parentheses.'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6507</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// KEEP THIS WHEN REGENERATING THE PARSER !!</span><span class="WHIT">
<span class='line'>6508</span> </span><span class="WHIT">  
<span class='line'>6509</span>   
<span class='line'>6510</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6511</span> </span><span class="WHIT">          </span><span class="NAME">peg$startRuleFunctions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6512</span> </span><span class="WHIT">        </span><span class="NAME">chain</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">peg$parsechain</span><span class="WHIT">
<span class='line'>6513</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6514</span> </span><span class="WHIT">          </span><span class="NAME">peg$startRuleFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsechain</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6515</span> </span><span class="WHIT">          </span><span class="NAME">peg$c0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6516</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">branches</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6517</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6518</span> </span><span class="WHIT">  
<span class='line'>6519</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6520</span> </span><span class="WHIT">          </span><span class="NAME">branches.push</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6521</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6522</span> </span><span class="WHIT">  
<span class='line'>6523</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6524</span> </span><span class="WHIT">          </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6525</span> </span><span class="WHIT">          </span><span class="NAME">rings.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6526</span> </span><span class="WHIT">            </span><span class="STRN">'bond'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">bond</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6527</span> </span><span class="WHIT">            </span><span class="STRN">'id'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>6528</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6529</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6530</span> </span><span class="WHIT">  
<span class='line'>6531</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6532</span> </span><span class="WHIT">          </span><span class="NAME">branches.push</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6533</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6534</span> </span><span class="WHIT">  
<span class='line'>6535</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6536</span> </span><span class="WHIT">          </span><span class="NAME">branches.push</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6537</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6538</span> </span><span class="WHIT">  
<span class='line'>6539</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6540</span> </span><span class="WHIT">          </span><span class="STRN">'atom'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6541</span> </span><span class="WHIT">          </span><span class="STRN">'isBracket'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6542</span> </span><span class="WHIT">          </span><span class="STRN">'branches'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">branches</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6543</span> </span><span class="WHIT">          </span><span class="STRN">'branchCount'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">branches.length</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6544</span> </span><span class="WHIT">          </span><span class="STRN">'ringbonds'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6545</span> </span><span class="WHIT">          </span><span class="STRN">'ringbondCount'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">rings.length</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6546</span> </span><span class="WHIT">          </span><span class="STRN">'bond'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6547</span> </span><span class="WHIT">          </span><span class="STRN">'next'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6548</span> </span><span class="WHIT">          </span><span class="STRN">'hasNext'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>6549</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6550</span> </span><span class="WHIT">       </span><span class="COMM">// return s;</span><span class="WHIT">
<span class='line'>6551</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6552</span> </span><span class="WHIT">          </span><span class="NAME">peg$c1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"("</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6553</span> </span><span class="WHIT">          </span><span class="NAME">peg$c2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"("</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6554</span> </span><span class="WHIT">          </span><span class="NAME">peg$c3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6555</span> </span><span class="WHIT">          </span><span class="NAME">peg$c4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">")"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6556</span> </span><span class="WHIT">          </span><span class="NAME">peg$c5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6557</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6558</span> </span><span class="WHIT">        </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">branchBond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bond</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6559</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6560</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6561</span> </span><span class="WHIT">          </span><span class="NAME">peg$c6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6562</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6563</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6564</span> </span><span class="WHIT">          </span><span class="NAME">peg$c7</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/^[\-=#$:\/\\.]/</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6565</span> </span><span class="WHIT">          </span><span class="NAME">peg$c8</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"-"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"#"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"$"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">":"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"/"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"\\"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6566</span> </span><span class="WHIT">          </span><span class="NAME">peg$c9</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6567</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6568</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6569</span> </span><span class="WHIT">          </span><span class="NAME">peg$c10</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"["</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6570</span> </span><span class="WHIT">          </span><span class="NAME">peg$c11</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"["</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6571</span> </span><span class="WHIT">          </span><span class="NAME">peg$c12</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"se"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6572</span> </span><span class="WHIT">          </span><span class="NAME">peg$c13</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"se"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6573</span> </span><span class="WHIT">          </span><span class="NAME">peg$c14</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"as"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6574</span> </span><span class="WHIT">          </span><span class="NAME">peg$c15</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"as"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6575</span> </span><span class="WHIT">          </span><span class="NAME">peg$c16</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6576</span> </span><span class="WHIT">          </span><span class="NAME">peg$c17</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"]"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6577</span> </span><span class="WHIT">          </span><span class="NAME">peg$c18</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6578</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6579</span> </span><span class="WHIT">          </span><span class="STRN">'isotope'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6580</span> </span><span class="WHIT">          </span><span class="STRN">'element'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6581</span> </span><span class="WHIT">          </span><span class="STRN">'chirality'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6582</span> </span><span class="WHIT">          </span><span class="STRN">'hcount'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6583</span> </span><span class="WHIT">          </span><span class="STRN">'charge'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6584</span> </span><span class="WHIT">          </span><span class="STRN">'class'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>6585</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6586</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6587</span> </span><span class="WHIT">          </span><span class="NAME">peg$c19</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"B"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6588</span> </span><span class="WHIT">          </span><span class="NAME">peg$c20</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"B"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6589</span> </span><span class="WHIT">          </span><span class="NAME">peg$c21</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"r"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6590</span> </span><span class="WHIT">          </span><span class="NAME">peg$c22</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"r"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6591</span> </span><span class="WHIT">          </span><span class="NAME">peg$c23</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"C"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6592</span> </span><span class="WHIT">          </span><span class="NAME">peg$c24</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"C"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6593</span> </span><span class="WHIT">          </span><span class="NAME">peg$c25</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"l"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6594</span> </span><span class="WHIT">          </span><span class="NAME">peg$c26</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"l"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6595</span> </span><span class="WHIT">          </span><span class="NAME">peg$c27</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/^[NOPSFI]/</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6596</span> </span><span class="WHIT">          </span><span class="NAME">peg$c28</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"N"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"O"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"P"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"S"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"F"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"I"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6597</span> </span><span class="WHIT">          </span><span class="NAME">peg$c29</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6598</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6599</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6600</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6601</span> </span><span class="WHIT">          </span><span class="NAME">peg$c30</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/^[bcnops]/</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6602</span> </span><span class="WHIT">          </span><span class="NAME">peg$c31</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"c"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"n"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"o"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"p"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"s"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6603</span> </span><span class="WHIT">          </span><span class="NAME">peg$c32</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6604</span> </span><span class="WHIT">          </span><span class="NAME">peg$c33</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"*"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6605</span> </span><span class="WHIT">          </span><span class="NAME">peg$c34</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6606</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6607</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6608</span> </span><span class="WHIT">          </span><span class="NAME">peg$c35</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/^[A-Z]/</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6609</span> </span><span class="WHIT">          </span><span class="NAME">peg$c36</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="STRN">"A"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Z"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6610</span> </span><span class="WHIT">          </span><span class="NAME">peg$c37</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/^[a-z]/</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6611</span> </span><span class="WHIT">          </span><span class="NAME">peg$c38</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="STRN">"a"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"z"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6612</span> </span><span class="WHIT">          </span><span class="NAME">peg$c39</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6613</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6614</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6615</span> </span><span class="WHIT">          </span><span class="NAME">peg$c40</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"%"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6616</span> </span><span class="WHIT">          </span><span class="NAME">peg$c41</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"%"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6617</span> </span><span class="WHIT">          </span><span class="NAME">peg$c42</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/^[1-9]/</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6618</span> </span><span class="WHIT">          </span><span class="NAME">peg$c43</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="STRN">"1"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"9"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6619</span> </span><span class="WHIT">          </span><span class="NAME">peg$c44</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/^[0-9]/</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6620</span> </span><span class="WHIT">          </span><span class="NAME">peg$c45</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="STRN">"0"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"9"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6621</span> </span><span class="WHIT">          </span><span class="NAME">peg$c46</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6622</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6623</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">r.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="STRN">'%'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6624</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6625</span> </span><span class="WHIT">          </span><span class="NAME">peg$c47</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"@"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6626</span> </span><span class="WHIT">          </span><span class="NAME">peg$c48</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"@"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6627</span> </span><span class="WHIT">          </span><span class="NAME">peg$c49</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"TH"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6628</span> </span><span class="WHIT">          </span><span class="NAME">peg$c50</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"TH"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6629</span> </span><span class="WHIT">          </span><span class="NAME">peg$c51</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/^[12]/</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6630</span> </span><span class="WHIT">          </span><span class="NAME">peg$c52</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"1"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"2"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6631</span> </span><span class="WHIT">          </span><span class="NAME">peg$c53</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"AL"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6632</span> </span><span class="WHIT">          </span><span class="NAME">peg$c54</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"AL"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6633</span> </span><span class="WHIT">          </span><span class="NAME">peg$c55</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"SP"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6634</span> </span><span class="WHIT">          </span><span class="NAME">peg$c56</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"SP"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6635</span> </span><span class="WHIT">          </span><span class="NAME">peg$c57</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/^[1-3]/</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6636</span> </span><span class="WHIT">          </span><span class="NAME">peg$c58</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="STRN">"1"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"3"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6637</span> </span><span class="WHIT">          </span><span class="NAME">peg$c59</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"TB"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6638</span> </span><span class="WHIT">          </span><span class="NAME">peg$c60</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"TB"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6639</span> </span><span class="WHIT">          </span><span class="NAME">peg$c61</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"OH"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6640</span> </span><span class="WHIT">          </span><span class="NAME">peg$c62</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"OH"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6641</span> </span><span class="WHIT">          </span><span class="NAME">peg$c63</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6642</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'@'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6643</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'@'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'@@'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6644</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6645</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6646</span> </span><span class="WHIT">          </span><span class="NAME">peg$c64</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6647</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6648</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6649</span> </span><span class="WHIT">          </span><span class="NAME">peg$c65</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"+"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6650</span> </span><span class="WHIT">          </span><span class="NAME">peg$c66</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"+"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6651</span> </span><span class="WHIT">          </span><span class="NAME">peg$c67</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6652</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6653</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'+'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6654</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6655</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6656</span> </span><span class="WHIT">          </span><span class="NAME">peg$c68</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"-"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6657</span> </span><span class="WHIT">          </span><span class="NAME">peg$c69</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"-"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6658</span> </span><span class="WHIT">          </span><span class="NAME">peg$c70</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6659</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6660</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6661</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6662</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6663</span> </span><span class="WHIT">          </span><span class="NAME">peg$c71</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"H"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6664</span> </span><span class="WHIT">          </span><span class="NAME">peg$c72</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">"H"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6665</span> </span><span class="WHIT">          </span><span class="NAME">peg$c73</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6666</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6667</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6668</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6669</span> </span><span class="WHIT">          </span><span class="NAME">peg$c74</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">":"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6670</span> </span><span class="WHIT">          </span><span class="NAME">peg$c75</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6671</span> </span><span class="WHIT">          </span><span class="NAME">peg$c76</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/^[0]/</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6672</span> </span><span class="WHIT">          </span><span class="NAME">peg$c77</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"0"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6673</span> </span><span class="WHIT">          </span><span class="NAME">peg$c78</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6674</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6675</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6676</span> </span><span class="WHIT">          </span><span class="NAME">peg$c79</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6677</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">i.join</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6678</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6679</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6680</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6681</span> </span><span class="WHIT">          </span><span class="NAME">peg$posDetailsCache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6682</span> </span><span class="WHIT">        </span><span class="NAME">line</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6683</span> </span><span class="WHIT">        </span><span class="NAME">column</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>6684</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6685</span> </span><span class="WHIT">          </span><span class="NAME">peg$maxFailPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6686</span> </span><span class="WHIT">          </span><span class="NAME">peg$maxFailExpected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6687</span> </span><span class="WHIT">          </span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6688</span> </span><span class="WHIT">          </span><span class="NAME">peg$result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6689</span> </span><span class="WHIT">  
<span class='line'>6690</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"startRule"</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6691</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">options.startRule</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">peg$startRuleFunctions</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6692</span> </span><span class="WHIT">          </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Can't start parsing from rule \""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">options.startRule</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\"."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6693</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6694</span> </span><span class="WHIT">  
<span class='line'>6695</span>         </span><span class="NAME">peg$startRuleFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$startRuleFunctions</span><span class="PUNC">[</span><span class="NAME">options.startRule</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6696</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6697</span> </span><span class="WHIT">  
<span class='line'>6698</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">text</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6699</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">input.substring</span><span class="PUNC">(</span><span class="NAME">peg$savedPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6700</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6701</span> </span><span class="WHIT">  
<span class='line'>6702</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6703</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">peg$computeLocation</span><span class="PUNC">(</span><span class="NAME">peg$savedPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6704</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6705</span> </span><span class="WHIT">  
<span class='line'>6706</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">expected</span><span class="PUNC">(</span><span class="NAME">description</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6707</span> </span><span class="WHIT">        </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">void</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">peg$computeLocation</span><span class="PUNC">(</span><span class="NAME">peg$savedPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6708</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">peg$buildStructuredError</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">peg$otherExpectation</span><span class="PUNC">(</span><span class="NAME">description</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">input.substring</span><span class="PUNC">(</span><span class="NAME">peg$savedPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6709</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6710</span> </span><span class="WHIT">  
<span class='line'>6711</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">error</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6712</span> </span><span class="WHIT">        </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">void</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">peg$computeLocation</span><span class="PUNC">(</span><span class="NAME">peg$savedPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6713</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">peg$buildSimpleError</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6714</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6715</span> </span><span class="WHIT">  
<span class='line'>6716</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$literalExpectation</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ignoreCase</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6717</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6718</span> </span><span class="WHIT">          </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"literal"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6719</span> </span><span class="WHIT">          </span><span class="NAME">text</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">text</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6720</span> </span><span class="WHIT">          </span><span class="NAME">ignoreCase</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ignoreCase</span><span class="WHIT">
<span class='line'>6721</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6722</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6723</span> </span><span class="WHIT">  
<span class='line'>6724</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$classExpectation</span><span class="PUNC">(</span><span class="NAME">parts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inverted</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ignoreCase</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6725</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6726</span> </span><span class="WHIT">          </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"class"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6727</span> </span><span class="WHIT">          </span><span class="NAME">parts</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">parts</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6728</span> </span><span class="WHIT">          </span><span class="NAME">inverted</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">inverted</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6729</span> </span><span class="WHIT">          </span><span class="NAME">ignoreCase</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ignoreCase</span><span class="WHIT">
<span class='line'>6730</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6731</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6732</span> </span><span class="WHIT">  
<span class='line'>6733</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$anyExpectation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6734</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6735</span> </span><span class="WHIT">          </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"any"</span><span class="WHIT">
<span class='line'>6736</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6737</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6738</span> </span><span class="WHIT">  
<span class='line'>6739</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$endExpectation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6740</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6741</span> </span><span class="WHIT">          </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"end"</span><span class="WHIT">
<span class='line'>6742</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6743</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6744</span> </span><span class="WHIT">  
<span class='line'>6745</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$otherExpectation</span><span class="PUNC">(</span><span class="NAME">description</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6746</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6747</span> </span><span class="WHIT">          </span><span class="NAME">type</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"other"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6748</span> </span><span class="WHIT">          </span><span class="NAME">description</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">description</span><span class="WHIT">
<span class='line'>6749</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6750</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6751</span> </span><span class="WHIT">  
<span class='line'>6752</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$computePosDetails</span><span class="PUNC">(</span><span class="NAME">pos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6753</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">details</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$posDetailsCache</span><span class="PUNC">[</span><span class="NAME">pos</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6754</span> </span><span class="WHIT">            </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6755</span> </span><span class="WHIT">  
<span class='line'>6756</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">details</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6757</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">details</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6758</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6759</span> </span><span class="WHIT">          </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pos</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6760</span> </span><span class="WHIT">  
<span class='line'>6761</span>           </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">peg$posDetailsCache</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6762</span> </span><span class="WHIT">            </span><span class="NAME">p</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6763</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6764</span> </span><span class="WHIT">  
<span class='line'>6765</span>           </span><span class="NAME">details</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$posDetailsCache</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6766</span> </span><span class="WHIT">          </span><span class="NAME">details</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6767</span> </span><span class="WHIT">            </span><span class="NAME">line</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">details.line</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6768</span> </span><span class="WHIT">            </span><span class="NAME">column</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">details.column</span><span class="WHIT">
<span class='line'>6769</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6770</span> </span><span class="WHIT">  
<span class='line'>6771</span>           </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">pos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6772</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6773</span> </span><span class="WHIT">              </span><span class="NAME">details.line</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6774</span> </span><span class="WHIT">              </span><span class="NAME">details.column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6775</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6776</span> </span><span class="WHIT">              </span><span class="NAME">details.column</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6777</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6778</span> </span><span class="WHIT">  
<span class='line'>6779</span>             </span><span class="NAME">p</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6780</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6781</span> </span><span class="WHIT">  
<span class='line'>6782</span>           </span><span class="NAME">peg$posDetailsCache</span><span class="PUNC">[</span><span class="NAME">pos</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">details</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6783</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">details</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6784</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6785</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6786</span> </span><span class="WHIT">  
<span class='line'>6787</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$computeLocation</span><span class="PUNC">(</span><span class="NAME">startPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6788</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startPosDetails</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$computePosDetails</span><span class="PUNC">(</span><span class="NAME">startPos</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6789</span> </span><span class="WHIT">            </span><span class="NAME">endPosDetails</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$computePosDetails</span><span class="PUNC">(</span><span class="NAME">endPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6790</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6791</span> </span><span class="WHIT">          </span><span class="NAME">start</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6792</span> </span><span class="WHIT">            </span><span class="NAME">offset</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">startPos</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6793</span> </span><span class="WHIT">            </span><span class="NAME">line</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">startPosDetails.line</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6794</span> </span><span class="WHIT">            </span><span class="NAME">column</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">startPosDetails.column</span><span class="WHIT">
<span class='line'>6795</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6796</span> </span><span class="WHIT">          </span><span class="NAME">end</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6797</span> </span><span class="WHIT">            </span><span class="NAME">offset</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">endPos</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6798</span> </span><span class="WHIT">            </span><span class="NAME">line</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">endPosDetails.line</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6799</span> </span><span class="WHIT">            </span><span class="NAME">column</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">endPosDetails.column</span><span class="WHIT">
<span class='line'>6800</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6801</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6802</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6803</span> </span><span class="WHIT">  
<span class='line'>6804</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">expected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6805</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">peg$maxFailPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6806</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6807</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6808</span> </span><span class="WHIT">  
<span class='line'>6809</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">peg$maxFailPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6810</span> </span><span class="WHIT">          </span><span class="NAME">peg$maxFailPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6811</span> </span><span class="WHIT">          </span><span class="NAME">peg$maxFailExpected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6812</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6813</span> </span><span class="WHIT">  
<span class='line'>6814</span>         </span><span class="NAME">peg$maxFailExpected.push</span><span class="PUNC">(</span><span class="NAME">expected</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6815</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6816</span> </span><span class="WHIT">  
<span class='line'>6817</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$buildSimpleError</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6818</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">peg$SyntaxError</span><span class="PUNC">(</span><span class="NAME">message</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6819</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6820</span> </span><span class="WHIT">  
<span class='line'>6821</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$buildStructuredError</span><span class="PUNC">(</span><span class="NAME">expected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6822</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">peg$SyntaxError</span><span class="PUNC">(</span><span class="NAME">peg$SyntaxError.buildMessage</span><span class="PUNC">(</span><span class="NAME">expected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">expected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6823</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6824</span> </span><span class="WHIT">  
<span class='line'>6825</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsechain</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6826</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s7</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s8</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s9</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6827</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6828</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6829</span> </span><span class="WHIT">        </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parseatom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6830</span> </span><span class="WHIT">  
<span class='line'>6831</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6832</span> </span><span class="WHIT">          </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6833</span> </span><span class="WHIT">          </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebranch</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6834</span> </span><span class="WHIT">  
<span class='line'>6835</span>           </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6836</span> </span><span class="WHIT">            </span><span class="NAME">s3.push</span><span class="PUNC">(</span><span class="NAME">s4</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6837</span> </span><span class="WHIT">            </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebranch</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6838</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6839</span> </span><span class="WHIT">  
<span class='line'>6840</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6841</span> </span><span class="WHIT">            </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6842</span> </span><span class="WHIT">            </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6843</span> </span><span class="WHIT">            </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebond</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6844</span> </span><span class="WHIT">  
<span class='line'>6845</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6846</span> </span><span class="WHIT">              </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6847</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6848</span> </span><span class="WHIT">  
<span class='line'>6849</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6850</span> </span><span class="WHIT">              </span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsering</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6851</span> </span><span class="WHIT">  
<span class='line'>6852</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6853</span> </span><span class="WHIT">                </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6854</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s6</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6855</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6856</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6857</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6858</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6859</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6860</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6861</span> </span><span class="WHIT">              </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6862</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6863</span> </span><span class="WHIT">  
<span class='line'>6864</span>             </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6865</span> </span><span class="WHIT">              </span><span class="NAME">s4.push</span><span class="PUNC">(</span><span class="NAME">s5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6866</span> </span><span class="WHIT">              </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6867</span> </span><span class="WHIT">              </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebond</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6868</span> </span><span class="WHIT">  
<span class='line'>6869</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6870</span> </span><span class="WHIT">                </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6871</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6872</span> </span><span class="WHIT">  
<span class='line'>6873</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6874</span> </span><span class="WHIT">                </span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsering</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6875</span> </span><span class="WHIT">  
<span class='line'>6876</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6877</span> </span><span class="WHIT">                  </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6878</span> </span><span class="WHIT">                  </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s6</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6879</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6880</span> </span><span class="WHIT">                  </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6881</span> </span><span class="WHIT">                  </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6882</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6883</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6884</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6885</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6886</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6887</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6888</span> </span><span class="WHIT">  
<span class='line'>6889</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6890</span> </span><span class="WHIT">              </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6891</span> </span><span class="WHIT">              </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebranch</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6892</span> </span><span class="WHIT">  
<span class='line'>6893</span>               </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6894</span> </span><span class="WHIT">                </span><span class="NAME">s5.push</span><span class="PUNC">(</span><span class="NAME">s6</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6895</span> </span><span class="WHIT">                </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebranch</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6896</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6897</span> </span><span class="WHIT">  
<span class='line'>6898</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6899</span> </span><span class="WHIT">                </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebond</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6900</span> </span><span class="WHIT">  
<span class='line'>6901</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6902</span> </span><span class="WHIT">                  </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6903</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6904</span> </span><span class="WHIT">  
<span class='line'>6905</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6906</span> </span><span class="WHIT">                  </span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsechain</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6907</span> </span><span class="WHIT">  
<span class='line'>6908</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6909</span> </span><span class="WHIT">                    </span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6910</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6911</span> </span><span class="WHIT">  
<span class='line'>6912</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6913</span> </span><span class="WHIT">                    </span><span class="NAME">s8</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6914</span> </span><span class="WHIT">                    </span><span class="NAME">s9</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebranch</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6915</span> </span><span class="WHIT">  
<span class='line'>6916</span>                     </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s9</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6917</span> </span><span class="WHIT">                      </span><span class="NAME">s8.push</span><span class="PUNC">(</span><span class="NAME">s9</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6918</span> </span><span class="WHIT">                      </span><span class="NAME">s9</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebranch</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6919</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6920</span> </span><span class="WHIT">  
<span class='line'>6921</span>                     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s8</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6922</span> </span><span class="WHIT">                      </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s7</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6923</span> </span><span class="WHIT">                      </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6924</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6925</span> </span><span class="WHIT">                      </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6926</span> </span><span class="WHIT">                      </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6927</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6928</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6929</span> </span><span class="WHIT">                    </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6930</span> </span><span class="WHIT">                    </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6931</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6932</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6933</span> </span><span class="WHIT">                  </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6934</span> </span><span class="WHIT">                  </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6935</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6936</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6937</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6938</span> </span><span class="WHIT">                </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6939</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6940</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6941</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6942</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6943</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6944</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6945</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6946</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6947</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6948</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6949</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6950</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6951</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6952</span> </span><span class="WHIT">  
<span class='line'>6953</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6954</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6955</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c0</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6956</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6957</span> </span><span class="WHIT">  
<span class='line'>6958</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6959</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6960</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6961</span> </span><span class="WHIT">  
<span class='line'>6962</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsebranch</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6963</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6964</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6965</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6966</span> </span><span class="WHIT">  
<span class='line'>6967</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">40</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6968</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6969</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6970</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6971</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6972</span> </span><span class="WHIT">  
<span class='line'>6973</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6974</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6975</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6976</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6977</span> </span><span class="WHIT">  
<span class='line'>6978</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6979</span> </span><span class="WHIT">          </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebond</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6980</span> </span><span class="WHIT">  
<span class='line'>6981</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6982</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6983</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6984</span> </span><span class="WHIT">  
<span class='line'>6985</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6986</span> </span><span class="WHIT">            </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsechain</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6987</span> </span><span class="WHIT">  
<span class='line'>6988</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6989</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">41</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6990</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6991</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6992</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6993</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6994</span> </span><span class="WHIT">  
<span class='line'>6995</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6996</span> </span><span class="WHIT">                  </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c4</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6997</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6998</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6999</span> </span><span class="WHIT">  
<span class='line'>7000</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7001</span> </span><span class="WHIT">                </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7002</span> </span><span class="WHIT">                </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7003</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7004</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7005</span> </span><span class="WHIT">                </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7006</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7007</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7008</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7009</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7010</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7011</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7012</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7013</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7014</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7015</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7016</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7017</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7018</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7019</span> </span><span class="WHIT">  
<span class='line'>7020</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7021</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7022</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c5</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7023</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7024</span> </span><span class="WHIT">  
<span class='line'>7025</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7026</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7027</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7028</span> </span><span class="WHIT">  
<span class='line'>7029</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parseatom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7030</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7031</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7032</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parseorganicsymbol</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7033</span> </span><span class="WHIT">  
<span class='line'>7034</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7035</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsearomaticsymbol</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7036</span> </span><span class="WHIT">  
<span class='line'>7037</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7038</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsebracketatom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7039</span> </span><span class="WHIT">  
<span class='line'>7040</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7041</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsewildcard</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7042</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7043</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7044</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7045</span> </span><span class="WHIT">  
<span class='line'>7046</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7047</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7048</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c6</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7049</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7050</span> </span><span class="WHIT">  
<span class='line'>7051</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7052</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7053</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7054</span> </span><span class="WHIT">  
<span class='line'>7055</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsebond</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7056</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7057</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7058</span> </span><span class="WHIT">  
<span class='line'>7059</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c7.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7060</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Hack to resolve problem caused by:</span><span class="WHIT">
<span class='line'>7061</span> </span><span class="WHIT">          </span><span class="COMM">// O=C(N[C@@H](CC(O)=O)C(N[C@H](C1=CC=C(O)C=C1)C(N[C@@H](CC(O)=O)C(NCC(N[C@@H](C(N[C@@H]([C@H](C)CC(O)=O)C(N/C(C(O[C@H](C)[C@@H]2NC([C@H](CO)NC(C(O3)C3CCC)=O)=O)=O)=C\\\\C4=CNC5=C4C=CC=C5)=O)=O)[C@H](O)C(N)=O)=O)=O)=O)=O)[C@H](CC(O)=O)NC([C@@H](CC6=CNC7=C6C=CC=C7)NC2=O)=O</span><span class="WHIT">
<span class='line'>7062</span> </span><span class="WHIT">          </span><span class="COMM">// KEEP THIS WHEN REGENERATING THE PARSER !!</span><span class="WHIT">
<span class='line'>7063</span> </span><span class="WHIT">  
<span class='line'>7064</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7065</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7066</span> </span><span class="WHIT">  
<span class='line'>7067</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7068</span> </span><span class="WHIT">              </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">peg$buildSimpleError</span><span class="PUNC">(</span><span class="STRN">'The parser encountered a bond repetition.'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7069</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7070</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// KEEP THIS WHEN REGENERATING THE PARSER !!</span><span class="WHIT">
<span class='line'>7071</span> </span><span class="WHIT">  
<span class='line'>7072</span>   
<span class='line'>7073</span>           </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7074</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7075</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7076</span> </span><span class="WHIT">  
<span class='line'>7077</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7078</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c8</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7079</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7080</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7081</span> </span><span class="WHIT">  
<span class='line'>7082</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7083</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7084</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c9</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7085</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7086</span> </span><span class="WHIT">  
<span class='line'>7087</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7088</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7089</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7090</span> </span><span class="WHIT">  
<span class='line'>7091</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsebracketatom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7092</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s7</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s8</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s9</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7093</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7094</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7095</span> </span><span class="WHIT">  
<span class='line'>7096</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">91</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7097</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7098</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7099</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7100</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7101</span> </span><span class="WHIT">  
<span class='line'>7102</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7103</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c11</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7104</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7105</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7106</span> </span><span class="WHIT">  
<span class='line'>7107</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7108</span> </span><span class="WHIT">          </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parseisotope</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7109</span> </span><span class="WHIT">  
<span class='line'>7110</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7111</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7112</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7113</span> </span><span class="WHIT">  
<span class='line'>7114</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7115</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.substr</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$c12</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7116</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c12</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7117</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7118</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7119</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7120</span> </span><span class="WHIT">  
<span class='line'>7121</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7122</span> </span><span class="WHIT">                </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c13</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7123</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7124</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7125</span> </span><span class="WHIT">  
<span class='line'>7126</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7127</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.substr</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$c14</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7128</span> </span><span class="WHIT">                </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c14</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7129</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7130</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7131</span> </span><span class="WHIT">                </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7132</span> </span><span class="WHIT">  
<span class='line'>7133</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7134</span> </span><span class="WHIT">                  </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c15</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7135</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7136</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7137</span> </span><span class="WHIT">  
<span class='line'>7138</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7139</span> </span><span class="WHIT">                </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsearomaticsymbol</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7140</span> </span><span class="WHIT">  
<span class='line'>7141</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7142</span> </span><span class="WHIT">                  </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parseelementsymbol</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7143</span> </span><span class="WHIT">  
<span class='line'>7144</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7145</span> </span><span class="WHIT">                    </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsewildcard</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7146</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7147</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7148</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7149</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7150</span> </span><span class="WHIT">  
<span class='line'>7151</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7152</span> </span><span class="WHIT">              </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsechiral</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7153</span> </span><span class="WHIT">  
<span class='line'>7154</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7155</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7156</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7157</span> </span><span class="WHIT">  
<span class='line'>7158</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7159</span> </span><span class="WHIT">                </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsehcount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7160</span> </span><span class="WHIT">  
<span class='line'>7161</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7162</span> </span><span class="WHIT">                  </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7163</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7164</span> </span><span class="WHIT">  
<span class='line'>7165</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7166</span> </span><span class="WHIT">                  </span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsecharge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7167</span> </span><span class="WHIT">  
<span class='line'>7168</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7169</span> </span><span class="WHIT">                    </span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7170</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7171</span> </span><span class="WHIT">  
<span class='line'>7172</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s7</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7173</span> </span><span class="WHIT">                    </span><span class="NAME">s8</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parseclass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7174</span> </span><span class="WHIT">  
<span class='line'>7175</span>                     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s8</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7176</span> </span><span class="WHIT">                      </span><span class="NAME">s8</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7177</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7178</span> </span><span class="WHIT">  
<span class='line'>7179</span>                     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s8</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7180</span> </span><span class="WHIT">                      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">93</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7181</span> </span><span class="WHIT">                        </span><span class="NAME">s9</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c16</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7182</span> </span><span class="WHIT">                        </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7183</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7184</span> </span><span class="WHIT">                        </span><span class="NAME">s9</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7185</span> </span><span class="WHIT">  
<span class='line'>7186</span>                         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7187</span> </span><span class="WHIT">                          </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c17</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7188</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7189</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7190</span> </span><span class="WHIT">  
<span class='line'>7191</span>                       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s9</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7192</span> </span><span class="WHIT">                        </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s7</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s8</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s9</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7193</span> </span><span class="WHIT">                        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7194</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7195</span> </span><span class="WHIT">                        </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7196</span> </span><span class="WHIT">                        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7197</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7198</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7199</span> </span><span class="WHIT">                      </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7200</span> </span><span class="WHIT">                      </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7201</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7202</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7203</span> </span><span class="WHIT">                    </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7204</span> </span><span class="WHIT">                    </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7205</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7206</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7207</span> </span><span class="WHIT">                  </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7208</span> </span><span class="WHIT">                  </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7209</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7210</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7211</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7212</span> </span><span class="WHIT">                </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7213</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7214</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7215</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7216</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7217</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7218</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7219</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7220</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7221</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7222</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7223</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7224</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7225</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7226</span> </span><span class="WHIT">  
<span class='line'>7227</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7228</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7229</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c18</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7230</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7231</span> </span><span class="WHIT">  
<span class='line'>7232</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7233</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7234</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7235</span> </span><span class="WHIT">  
<span class='line'>7236</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parseorganicsymbol</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7237</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7238</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7239</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7240</span> </span><span class="WHIT">  
<span class='line'>7241</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">66</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7242</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c19</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7243</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7244</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7245</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7246</span> </span><span class="WHIT">  
<span class='line'>7247</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7248</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c20</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7249</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7250</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7251</span> </span><span class="WHIT">  
<span class='line'>7252</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7253</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">114</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7254</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c21</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7255</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7256</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7257</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7258</span> </span><span class="WHIT">  
<span class='line'>7259</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7260</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c22</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7261</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7262</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7263</span> </span><span class="WHIT">  
<span class='line'>7264</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7265</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7266</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7267</span> </span><span class="WHIT">  
<span class='line'>7268</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7269</span> </span><span class="WHIT">            </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7270</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7271</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7272</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7273</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7274</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7275</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7276</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7277</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7278</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7279</span> </span><span class="WHIT">  
<span class='line'>7280</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7281</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7282</span> </span><span class="WHIT">  
<span class='line'>7283</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">67</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7284</span> </span><span class="WHIT">            </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c23</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7285</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7286</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7287</span> </span><span class="WHIT">            </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7288</span> </span><span class="WHIT">  
<span class='line'>7289</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7290</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c24</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7291</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7292</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7293</span> </span><span class="WHIT">  
<span class='line'>7294</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7295</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">108</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7296</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c25</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7297</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7298</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7299</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7300</span> </span><span class="WHIT">  
<span class='line'>7301</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7302</span> </span><span class="WHIT">                </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c26</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7303</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7304</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7305</span> </span><span class="WHIT">  
<span class='line'>7306</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7307</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7308</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7309</span> </span><span class="WHIT">  
<span class='line'>7310</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7311</span> </span><span class="WHIT">              </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7312</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7313</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7314</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7315</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7316</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7317</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7318</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7319</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7320</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7321</span> </span><span class="WHIT">  
<span class='line'>7322</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7323</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c27.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7324</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7325</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7326</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7327</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7328</span> </span><span class="WHIT">  
<span class='line'>7329</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7330</span> </span><span class="WHIT">                </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c28</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7331</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7332</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7333</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7334</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7335</span> </span><span class="WHIT">  
<span class='line'>7336</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7337</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7338</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c29</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7339</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7340</span> </span><span class="WHIT">  
<span class='line'>7341</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7342</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7343</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7344</span> </span><span class="WHIT">  
<span class='line'>7345</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsearomaticsymbol</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7346</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7347</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7348</span> </span><span class="WHIT">  
<span class='line'>7349</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c30.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7350</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7351</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7352</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7353</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7354</span> </span><span class="WHIT">  
<span class='line'>7355</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7356</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c31</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7357</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7358</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7359</span> </span><span class="WHIT">  
<span class='line'>7360</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7361</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7362</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c6</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7363</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7364</span> </span><span class="WHIT">  
<span class='line'>7365</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7366</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7367</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7368</span> </span><span class="WHIT">  
<span class='line'>7369</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsewildcard</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7370</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7371</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7372</span> </span><span class="WHIT">  
<span class='line'>7373</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">42</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7374</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c32</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7375</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7376</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7377</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7378</span> </span><span class="WHIT">  
<span class='line'>7379</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7380</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c33</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7381</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7382</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7383</span> </span><span class="WHIT">  
<span class='line'>7384</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7385</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7386</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c34</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7387</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7388</span> </span><span class="WHIT">  
<span class='line'>7389</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7390</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7391</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7392</span> </span><span class="WHIT">  
<span class='line'>7393</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parseelementsymbol</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7394</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7395</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7396</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7397</span> </span><span class="WHIT">  
<span class='line'>7398</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c35.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7399</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7400</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7401</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7402</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7403</span> </span><span class="WHIT">  
<span class='line'>7404</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7405</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c36</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7406</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7407</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7408</span> </span><span class="WHIT">  
<span class='line'>7409</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7410</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c37.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7411</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7412</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7413</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7414</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7415</span> </span><span class="WHIT">  
<span class='line'>7416</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7417</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c38</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7418</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7419</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7420</span> </span><span class="WHIT">  
<span class='line'>7421</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7422</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7423</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7424</span> </span><span class="WHIT">  
<span class='line'>7425</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7426</span> </span><span class="WHIT">            </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7427</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7428</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7429</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7430</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7431</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7432</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7433</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7434</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7435</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7436</span> </span><span class="WHIT">  
<span class='line'>7437</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7438</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7439</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c39</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7440</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7441</span> </span><span class="WHIT">  
<span class='line'>7442</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7443</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7444</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7445</span> </span><span class="WHIT">  
<span class='line'>7446</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsering</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7447</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7448</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7449</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7450</span> </span><span class="WHIT">  
<span class='line'>7451</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">37</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7452</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c40</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7453</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7454</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7455</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7456</span> </span><span class="WHIT">  
<span class='line'>7457</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7458</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c41</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7459</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7460</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7461</span> </span><span class="WHIT">  
<span class='line'>7462</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7463</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c42.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7464</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7465</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7466</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7467</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7468</span> </span><span class="WHIT">  
<span class='line'>7469</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7470</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c43</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7471</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7472</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7473</span> </span><span class="WHIT">  
<span class='line'>7474</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7475</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7476</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7477</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7478</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7479</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7480</span> </span><span class="WHIT">  
<span class='line'>7481</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7482</span> </span><span class="WHIT">                </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7483</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7484</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7485</span> </span><span class="WHIT">  
<span class='line'>7486</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7487</span> </span><span class="WHIT">              </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7488</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7489</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7490</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7491</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7492</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7493</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7494</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7495</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7496</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7497</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7498</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7499</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7500</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7501</span> </span><span class="WHIT">  
<span class='line'>7502</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7503</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7504</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7505</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7506</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7507</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7508</span> </span><span class="WHIT">  
<span class='line'>7509</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7510</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7511</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7512</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7513</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7514</span> </span><span class="WHIT">  
<span class='line'>7515</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7516</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7517</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c46</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7518</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7519</span> </span><span class="WHIT">  
<span class='line'>7520</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7521</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7522</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7523</span> </span><span class="WHIT">  
<span class='line'>7524</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsechiral</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7525</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s6</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7526</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7527</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7528</span> </span><span class="WHIT">  
<span class='line'>7529</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">64</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7530</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c47</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7531</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7532</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7533</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7534</span> </span><span class="WHIT">  
<span class='line'>7535</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7536</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c48</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7537</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7538</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7539</span> </span><span class="WHIT">  
<span class='line'>7540</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7541</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">64</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7542</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c47</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7543</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7544</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7545</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7546</span> </span><span class="WHIT">  
<span class='line'>7547</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7548</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c48</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7549</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7550</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7551</span> </span><span class="WHIT">  
<span class='line'>7552</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7553</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7554</span> </span><span class="WHIT">  
<span class='line'>7555</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.substr</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$c49</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7556</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c49</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7557</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7558</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7559</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7560</span> </span><span class="WHIT">  
<span class='line'>7561</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7562</span> </span><span class="WHIT">                </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c50</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7563</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7564</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7565</span> </span><span class="WHIT">  
<span class='line'>7566</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7567</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c51.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7568</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7569</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7570</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7571</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7572</span> </span><span class="WHIT">  
<span class='line'>7573</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7574</span> </span><span class="WHIT">                  </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c52</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7575</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7576</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7577</span> </span><span class="WHIT">  
<span class='line'>7578</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7579</span> </span><span class="WHIT">                </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7580</span> </span><span class="WHIT">                </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7581</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7582</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7583</span> </span><span class="WHIT">                </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7584</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7585</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7586</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7587</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7588</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7589</span> </span><span class="WHIT">  
<span class='line'>7590</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7591</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7592</span> </span><span class="WHIT">  
<span class='line'>7593</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.substr</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$c53</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7594</span> </span><span class="WHIT">                </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c53</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7595</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7596</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7597</span> </span><span class="WHIT">                </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7598</span> </span><span class="WHIT">  
<span class='line'>7599</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7600</span> </span><span class="WHIT">                  </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c54</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7601</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7602</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7603</span> </span><span class="WHIT">  
<span class='line'>7604</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7605</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c51.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7606</span> </span><span class="WHIT">                  </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7607</span> </span><span class="WHIT">                  </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7608</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7609</span> </span><span class="WHIT">                  </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7610</span> </span><span class="WHIT">  
<span class='line'>7611</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7612</span> </span><span class="WHIT">                    </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c52</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7613</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7614</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7615</span> </span><span class="WHIT">  
<span class='line'>7616</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7617</span> </span><span class="WHIT">                  </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7618</span> </span><span class="WHIT">                  </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7619</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7620</span> </span><span class="WHIT">                  </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7621</span> </span><span class="WHIT">                  </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7622</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7623</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7624</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7625</span> </span><span class="WHIT">                </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7626</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7627</span> </span><span class="WHIT">  
<span class='line'>7628</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7629</span> </span><span class="WHIT">                </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7630</span> </span><span class="WHIT">  
<span class='line'>7631</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.substr</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$c55</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7632</span> </span><span class="WHIT">                  </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c55</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7633</span> </span><span class="WHIT">                  </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7634</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7635</span> </span><span class="WHIT">                  </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7636</span> </span><span class="WHIT">  
<span class='line'>7637</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7638</span> </span><span class="WHIT">                    </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c56</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7639</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7640</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7641</span> </span><span class="WHIT">  
<span class='line'>7642</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7643</span> </span><span class="WHIT">                  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c57.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7644</span> </span><span class="WHIT">                    </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7645</span> </span><span class="WHIT">                    </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7646</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7647</span> </span><span class="WHIT">                    </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7648</span> </span><span class="WHIT">  
<span class='line'>7649</span>                     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7650</span> </span><span class="WHIT">                      </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c58</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7651</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7652</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7653</span> </span><span class="WHIT">  
<span class='line'>7654</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7655</span> </span><span class="WHIT">                    </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7656</span> </span><span class="WHIT">                    </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7657</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7658</span> </span><span class="WHIT">                    </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7659</span> </span><span class="WHIT">                    </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7660</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7661</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7662</span> </span><span class="WHIT">                  </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7663</span> </span><span class="WHIT">                  </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7664</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7665</span> </span><span class="WHIT">  
<span class='line'>7666</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7667</span> </span><span class="WHIT">                  </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7668</span> </span><span class="WHIT">  
<span class='line'>7669</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.substr</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$c59</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7670</span> </span><span class="WHIT">                    </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c59</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7671</span> </span><span class="WHIT">                    </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7672</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7673</span> </span><span class="WHIT">                    </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7674</span> </span><span class="WHIT">  
<span class='line'>7675</span>                     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7676</span> </span><span class="WHIT">                      </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c60</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7677</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7678</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7679</span> </span><span class="WHIT">  
<span class='line'>7680</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7681</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c42.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7682</span> </span><span class="WHIT">                      </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7683</span> </span><span class="WHIT">                      </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7684</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7685</span> </span><span class="WHIT">                      </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7686</span> </span><span class="WHIT">  
<span class='line'>7687</span>                       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7688</span> </span><span class="WHIT">                        </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c43</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7689</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7690</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7691</span> </span><span class="WHIT">  
<span class='line'>7692</span>                     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7693</span> </span><span class="WHIT">                      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7694</span> </span><span class="WHIT">                        </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7695</span> </span><span class="WHIT">                        </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7696</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7697</span> </span><span class="WHIT">                        </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7698</span> </span><span class="WHIT">  
<span class='line'>7699</span>                         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7700</span> </span><span class="WHIT">                          </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7701</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7702</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7703</span> </span><span class="WHIT">  
<span class='line'>7704</span>                       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7705</span> </span><span class="WHIT">                        </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7706</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7707</span> </span><span class="WHIT">  
<span class='line'>7708</span>                       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7709</span> </span><span class="WHIT">                        </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7710</span> </span><span class="WHIT">                        </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7711</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7712</span> </span><span class="WHIT">                        </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7713</span> </span><span class="WHIT">                        </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7714</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7715</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7716</span> </span><span class="WHIT">                      </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7717</span> </span><span class="WHIT">                      </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7718</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7719</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7720</span> </span><span class="WHIT">                    </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7721</span> </span><span class="WHIT">                    </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7722</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7723</span> </span><span class="WHIT">  
<span class='line'>7724</span>                   </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7725</span> </span><span class="WHIT">                    </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7726</span> </span><span class="WHIT">  
<span class='line'>7727</span>                     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.substr</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$c61</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7728</span> </span><span class="WHIT">                      </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c61</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7729</span> </span><span class="WHIT">                      </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7730</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7731</span> </span><span class="WHIT">                      </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7732</span> </span><span class="WHIT">  
<span class='line'>7733</span>                       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7734</span> </span><span class="WHIT">                        </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c62</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7735</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7736</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7737</span> </span><span class="WHIT">  
<span class='line'>7738</span>                     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7739</span> </span><span class="WHIT">                      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c42.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7740</span> </span><span class="WHIT">                        </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7741</span> </span><span class="WHIT">                        </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7742</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7743</span> </span><span class="WHIT">                        </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7744</span> </span><span class="WHIT">  
<span class='line'>7745</span>                         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7746</span> </span><span class="WHIT">                          </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c43</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7747</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7748</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7749</span> </span><span class="WHIT">  
<span class='line'>7750</span>                       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7751</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7752</span> </span><span class="WHIT">                          </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7753</span> </span><span class="WHIT">                          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7754</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7755</span> </span><span class="WHIT">                          </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7756</span> </span><span class="WHIT">  
<span class='line'>7757</span>                           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7758</span> </span><span class="WHIT">                            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7759</span> </span><span class="WHIT">                          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7760</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7761</span> </span><span class="WHIT">  
<span class='line'>7762</span>                         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7763</span> </span><span class="WHIT">                          </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7764</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7765</span> </span><span class="WHIT">  
<span class='line'>7766</span>                         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7767</span> </span><span class="WHIT">                          </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s6</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7768</span> </span><span class="WHIT">                          </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7769</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7770</span> </span><span class="WHIT">                          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7771</span> </span><span class="WHIT">                          </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7772</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7773</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7774</span> </span><span class="WHIT">                        </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7775</span> </span><span class="WHIT">                        </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7776</span> </span><span class="WHIT">                      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7777</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7778</span> </span><span class="WHIT">                      </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7779</span> </span><span class="WHIT">                      </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7780</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7781</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7782</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7783</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7784</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7785</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7786</span> </span><span class="WHIT">  
<span class='line'>7787</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7788</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7789</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7790</span> </span><span class="WHIT">  
<span class='line'>7791</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7792</span> </span><span class="WHIT">            </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7793</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7794</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7795</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7796</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7797</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7798</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7799</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7800</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7801</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7802</span> </span><span class="WHIT">  
<span class='line'>7803</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7804</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7805</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c63</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7806</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7807</span> </span><span class="WHIT">  
<span class='line'>7808</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7809</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7810</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7811</span> </span><span class="WHIT">  
<span class='line'>7812</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsecharge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7813</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7814</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7815</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parseposcharge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7816</span> </span><span class="WHIT">  
<span class='line'>7817</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7818</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$parsenegcharge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7819</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7820</span> </span><span class="WHIT">  
<span class='line'>7821</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7822</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7823</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c64</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7824</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7825</span> </span><span class="WHIT">  
<span class='line'>7826</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7827</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7828</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7829</span> </span><span class="WHIT">  
<span class='line'>7830</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parseposcharge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7831</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7832</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7833</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7834</span> </span><span class="WHIT">  
<span class='line'>7835</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">43</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7836</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c65</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7837</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7838</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7839</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7840</span> </span><span class="WHIT">  
<span class='line'>7841</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7842</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c66</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7843</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7844</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7845</span> </span><span class="WHIT">  
<span class='line'>7846</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7847</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">43</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7848</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c65</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7849</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7850</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7851</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7852</span> </span><span class="WHIT">  
<span class='line'>7853</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7854</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c66</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7855</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7856</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7857</span> </span><span class="WHIT">  
<span class='line'>7858</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7859</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7860</span> </span><span class="WHIT">  
<span class='line'>7861</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c42.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7862</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7863</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7864</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7865</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7866</span> </span><span class="WHIT">  
<span class='line'>7867</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7868</span> </span><span class="WHIT">                </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c43</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7869</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7870</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7871</span> </span><span class="WHIT">  
<span class='line'>7872</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7873</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7874</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7875</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7876</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7877</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7878</span> </span><span class="WHIT">  
<span class='line'>7879</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7880</span> </span><span class="WHIT">                  </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7881</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7882</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7883</span> </span><span class="WHIT">  
<span class='line'>7884</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7885</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7886</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7887</span> </span><span class="WHIT">  
<span class='line'>7888</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7889</span> </span><span class="WHIT">                </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7890</span> </span><span class="WHIT">                </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7891</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7892</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7893</span> </span><span class="WHIT">                </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7894</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7895</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7896</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7897</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7898</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7899</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7900</span> </span><span class="WHIT">  
<span class='line'>7901</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7902</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7903</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7904</span> </span><span class="WHIT">  
<span class='line'>7905</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7906</span> </span><span class="WHIT">            </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7907</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7908</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7909</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7910</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7911</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7912</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7913</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7914</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7915</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7916</span> </span><span class="WHIT">  
<span class='line'>7917</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7918</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7919</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c67</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7920</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7921</span> </span><span class="WHIT">  
<span class='line'>7922</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7923</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7924</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7925</span> </span><span class="WHIT">  
<span class='line'>7926</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsenegcharge</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7927</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7928</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7929</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7930</span> </span><span class="WHIT">  
<span class='line'>7931</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">45</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7932</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c68</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7933</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7934</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7935</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7936</span> </span><span class="WHIT">  
<span class='line'>7937</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7938</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c69</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7939</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7940</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7941</span> </span><span class="WHIT">  
<span class='line'>7942</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7943</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">45</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7944</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c68</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7945</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7946</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7947</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7948</span> </span><span class="WHIT">  
<span class='line'>7949</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7950</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c69</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7951</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7952</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7953</span> </span><span class="WHIT">  
<span class='line'>7954</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7955</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7956</span> </span><span class="WHIT">  
<span class='line'>7957</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c42.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7958</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7959</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7960</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7961</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7962</span> </span><span class="WHIT">  
<span class='line'>7963</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7964</span> </span><span class="WHIT">                </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c43</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7965</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7966</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7967</span> </span><span class="WHIT">  
<span class='line'>7968</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7969</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7970</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7971</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7972</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7973</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7974</span> </span><span class="WHIT">  
<span class='line'>7975</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7976</span> </span><span class="WHIT">                  </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7977</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7978</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7979</span> </span><span class="WHIT">  
<span class='line'>7980</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7981</span> </span><span class="WHIT">                </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7982</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7983</span> </span><span class="WHIT">  
<span class='line'>7984</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7985</span> </span><span class="WHIT">                </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7986</span> </span><span class="WHIT">                </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7987</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7988</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7989</span> </span><span class="WHIT">                </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7990</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7991</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7992</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7993</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7994</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7995</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7996</span> </span><span class="WHIT">  
<span class='line'>7997</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7998</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7999</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8000</span> </span><span class="WHIT">  
<span class='line'>8001</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8002</span> </span><span class="WHIT">            </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8003</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8004</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8005</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8006</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8007</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8008</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8009</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8010</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8011</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8012</span> </span><span class="WHIT">  
<span class='line'>8013</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8014</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8015</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c70</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8016</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8017</span> </span><span class="WHIT">  
<span class='line'>8018</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8019</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8020</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8021</span> </span><span class="WHIT">  
<span class='line'>8022</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parsehcount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8023</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8024</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8025</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8026</span> </span><span class="WHIT">  
<span class='line'>8027</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">72</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8028</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c71</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8029</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8030</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8031</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8032</span> </span><span class="WHIT">  
<span class='line'>8033</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8034</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c72</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8035</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8036</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8037</span> </span><span class="WHIT">  
<span class='line'>8038</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8039</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8040</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8041</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8042</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8043</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8044</span> </span><span class="WHIT">  
<span class='line'>8045</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8046</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8047</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8048</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8049</span> </span><span class="WHIT">  
<span class='line'>8050</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8051</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8052</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8053</span> </span><span class="WHIT">  
<span class='line'>8054</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8055</span> </span><span class="WHIT">            </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8056</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8057</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8058</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8059</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8060</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8061</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8062</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8063</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8064</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8065</span> </span><span class="WHIT">  
<span class='line'>8066</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8067</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8068</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c73</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8069</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8070</span> </span><span class="WHIT">  
<span class='line'>8071</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8072</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8073</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8074</span> </span><span class="WHIT">  
<span class='line'>8075</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parseclass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8076</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s6</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8077</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8078</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8079</span> </span><span class="WHIT">  
<span class='line'>8080</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input.charCodeAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">58</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8081</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c74</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8082</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8083</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8084</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8085</span> </span><span class="WHIT">  
<span class='line'>8086</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8087</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c75</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8088</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8089</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8090</span> </span><span class="WHIT">  
<span class='line'>8091</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8092</span> </span><span class="WHIT">          </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8093</span> </span><span class="WHIT">  
<span class='line'>8094</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c42.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8095</span> </span><span class="WHIT">            </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8096</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8097</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8098</span> </span><span class="WHIT">            </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8099</span> </span><span class="WHIT">  
<span class='line'>8100</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8101</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c43</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8102</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8103</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8104</span> </span><span class="WHIT">  
<span class='line'>8105</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8106</span> </span><span class="WHIT">            </span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8107</span> </span><span class="WHIT">  
<span class='line'>8108</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8109</span> </span><span class="WHIT">              </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8110</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8111</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8112</span> </span><span class="WHIT">              </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8113</span> </span><span class="WHIT">  
<span class='line'>8114</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8115</span> </span><span class="WHIT">                </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8116</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8117</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8118</span> </span><span class="WHIT">  
<span class='line'>8119</span>             </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8120</span> </span><span class="WHIT">              </span><span class="NAME">s5.push</span><span class="PUNC">(</span><span class="NAME">s6</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8121</span> </span><span class="WHIT">  
<span class='line'>8122</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8123</span> </span><span class="WHIT">                </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8124</span> </span><span class="WHIT">                </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8125</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8126</span> </span><span class="WHIT">                </span><span class="NAME">s6</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8127</span> </span><span class="WHIT">  
<span class='line'>8128</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8129</span> </span><span class="WHIT">                  </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8130</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8131</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8132</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8133</span> </span><span class="WHIT">  
<span class='line'>8134</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s5</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8135</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8136</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8137</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8138</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8139</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8140</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8141</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8142</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8143</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8144</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8145</span> </span><span class="WHIT">  
<span class='line'>8146</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8147</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c76.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8148</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8149</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8150</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8151</span> </span><span class="WHIT">              </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8152</span> </span><span class="WHIT">  
<span class='line'>8153</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8154</span> </span><span class="WHIT">                </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c77</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8155</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8156</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8157</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8158</span> </span><span class="WHIT">  
<span class='line'>8159</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8160</span> </span><span class="WHIT">            </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8161</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8162</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8163</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8164</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8165</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8166</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8167</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8168</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8169</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8170</span> </span><span class="WHIT">  
<span class='line'>8171</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8172</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8173</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c78</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8174</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8175</span> </span><span class="WHIT">  
<span class='line'>8176</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8177</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8178</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8179</span> </span><span class="WHIT">  
<span class='line'>8180</span>       </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">peg$parseisotope</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8181</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8182</span> </span><span class="WHIT">        </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8183</span> </span><span class="WHIT">        </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8184</span> </span><span class="WHIT">  
<span class='line'>8185</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c42.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8186</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8187</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8188</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8189</span> </span><span class="WHIT">          </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8190</span> </span><span class="WHIT">  
<span class='line'>8191</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8192</span> </span><span class="WHIT">            </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c43</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8193</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8194</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8195</span> </span><span class="WHIT">  
<span class='line'>8196</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8197</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8198</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8199</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8200</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8201</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8202</span> </span><span class="WHIT">  
<span class='line'>8203</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8204</span> </span><span class="WHIT">              </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8205</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8206</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8207</span> </span><span class="WHIT">  
<span class='line'>8208</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8209</span> </span><span class="WHIT">            </span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8210</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8211</span> </span><span class="WHIT">  
<span class='line'>8212</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s3</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8213</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$c44.test</span><span class="PUNC">(</span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8214</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$currPos</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8215</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8216</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8217</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8218</span> </span><span class="WHIT">  
<span class='line'>8219</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$silentFails</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8220</span> </span><span class="WHIT">                </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$c45</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8221</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8222</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8223</span> </span><span class="WHIT">  
<span class='line'>8224</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8225</span> </span><span class="WHIT">              </span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8226</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8227</span> </span><span class="WHIT">  
<span class='line'>8228</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s4</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8229</span> </span><span class="WHIT">              </span><span class="NAME">s2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">s2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8230</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8231</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8232</span> </span><span class="WHIT">              </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8233</span> </span><span class="WHIT">              </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8234</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8235</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8236</span> </span><span class="WHIT">            </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8237</span> </span><span class="WHIT">            </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8238</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8239</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8240</span> </span><span class="WHIT">          </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8241</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8242</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8243</span> </span><span class="WHIT">  
<span class='line'>8244</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8245</span> </span><span class="WHIT">          </span><span class="NAME">peg$savedPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8246</span> </span><span class="WHIT">          </span><span class="NAME">s1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$c79</span><span class="PUNC">(</span><span class="NAME">s1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8247</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8248</span> </span><span class="WHIT">  
<span class='line'>8249</span>         </span><span class="NAME">s0</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8250</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8251</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8252</span> </span><span class="WHIT">  
<span class='line'>8253</span>       </span><span class="NAME">peg$result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">peg$startRuleFunction</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8254</span> </span><span class="WHIT">  
<span class='line'>8255</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$result</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">input.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8256</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">peg$result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8257</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8258</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">peg$result</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">peg$FAILED</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">peg$currPos</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">input.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8259</span> </span><span class="WHIT">          </span><span class="NAME">peg$fail</span><span class="PUNC">(</span><span class="NAME">peg$endExpectation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8260</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8261</span> </span><span class="WHIT">  
<span class='line'>8262</span>         </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">peg$buildStructuredError</span><span class="PUNC">(</span><span class="NAME">peg$maxFailExpected</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$maxFailPos</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">input.length</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">input.charAt</span><span class="PUNC">(</span><span class="NAME">peg$maxFailPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$maxFailPos</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">input.length</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">peg$computeLocation</span><span class="PUNC">(</span><span class="NAME">peg$maxFailPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$maxFailPos</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">peg$computeLocation</span><span class="PUNC">(</span><span class="NAME">peg$maxFailPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">peg$maxFailPos</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8263</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8264</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8265</span> </span><span class="WHIT">  
<span class='line'>8266</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8267</span> </span><span class="WHIT">      </span><span class="NAME">SyntaxError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">peg$SyntaxError</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8268</span> </span><span class="WHIT">      </span><span class="NAME">parse</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">peg$parse</span><span class="WHIT">
<span class='line'>8269</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8270</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8271</span> </span><span class="WHIT">  
<span class='line'>8272</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">11</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8273</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8274</span> </span><span class="WHIT">  
<span class='line'>8275</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>8276</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">ArrayHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./ArrayHelper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8277</span> </span><span class="WHIT">  
<span class='line'>8278</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vector2'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8279</span> </span><span class="WHIT">  
<span class='line'>8280</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vertex'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8281</span> </span><span class="WHIT">  
<span class='line'>8282</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">RingConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./RingConnection'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8283</span> </span><span class="WHIT">  </span><span class="COMM">/** 
<span class='line'>8284</span>    * A class representing a ring.
<span class='line'>8285</span>    * 
<span class='line'>8286</span>    * @property {Number} id The id of this ring.
<span class='line'>8287</span>    * @property {Number[]} members An array containing the vertex ids of the ring members.
<span class='line'>8288</span>    * @property {Number[]} edges An array containing the edge ids of the edges between the ring members.
<span class='line'>8289</span>    * @property {Number[]} insiders An array containing the vertex ids of the vertices contained within the ring if it is a bridged ring.
<span class='line'>8290</span>    * @property {Number[]} neighbours An array containing the ids of neighbouring rings.
<span class='line'>8291</span>    * @property {Boolean} positioned A boolean indicating whether or not this ring has been positioned.
<span class='line'>8292</span>    * @property {Vector2} center The center of this ring.
<span class='line'>8293</span>    * @property {Ring[]} rings The rings contained within this ring if this ring is bridged.
<span class='line'>8294</span>    * @property {Boolean} isBridged A boolean whether or not this ring is bridged.
<span class='line'>8295</span>    * @property {Boolean} isPartOfBridged A boolean whether or not this ring is part of a bridge ring.
<span class='line'>8296</span>    * @property {Boolean} isSpiro A boolean whether or not this ring is part of a spiro.
<span class='line'>8297</span>    * @property {Boolean} isFused A boolean whether or not this ring is part of a fused ring.
<span class='line'>8298</span>    * @property {Number} centralAngle The central angle of this ring.
<span class='line'>8299</span>    * @property {Boolean} canFlip A boolean indicating whether or not this ring allows flipping of attached vertices to the inside of the ring.
<span class='line'>8300</span>    */</span><span class="WHIT">
<span class='line'>8301</span> </span><span class="WHIT">  
<span class='line'>8302</span>   
<span class='line'>8303</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">Ring</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8304</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8305</span>      * The constructor for the class Ring.
<span class='line'>8306</span>      *
<span class='line'>8307</span>      * @param {Number[]} members An array containing the vertex ids of the members of the ring to be created.
<span class='line'>8308</span>      */</span><span class="WHIT">
<span class='line'>8309</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">members</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8310</span> </span><span class="WHIT">      </span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8311</span> </span><span class="WHIT">      </span><span class="NAME">this.members</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">members</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8312</span> </span><span class="WHIT">      </span><span class="NAME">this.edges</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8313</span> </span><span class="WHIT">      </span><span class="NAME">this.insiders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8314</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8315</span> </span><span class="WHIT">      </span><span class="NAME">this.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8316</span> </span><span class="WHIT">      </span><span class="NAME">this.center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8317</span> </span><span class="WHIT">      </span><span class="NAME">this.rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8318</span> </span><span class="WHIT">      </span><span class="NAME">this.isBridged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8319</span> </span><span class="WHIT">      </span><span class="NAME">this.isPartOfBridged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8320</span> </span><span class="WHIT">      </span><span class="NAME">this.isSpiro</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8321</span> </span><span class="WHIT">      </span><span class="NAME">this.isFused</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8322</span> </span><span class="WHIT">      </span><span class="NAME">this.centralAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8323</span> </span><span class="WHIT">      </span><span class="NAME">this.canFlip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8324</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8325</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8326</span>      * Clones this ring and returns the clone.
<span class='line'>8327</span>      *
<span class='line'>8328</span>      * @returns {Ring} A clone of this ring.
<span class='line'>8329</span>      */</span><span class="WHIT">
<span class='line'>8330</span> </span><span class="WHIT">  
<span class='line'>8331</span>   
<span class='line'>8332</span>     </span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8333</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">clone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ring</span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8334</span> </span><span class="WHIT">      </span><span class="NAME">clone.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8335</span> </span><span class="WHIT">      </span><span class="NAME">clone.insiders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.clone</span><span class="PUNC">(</span><span class="NAME">this.insiders</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8336</span> </span><span class="WHIT">      </span><span class="NAME">clone.neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.clone</span><span class="PUNC">(</span><span class="NAME">this.neighbours</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8337</span> </span><span class="WHIT">      </span><span class="NAME">clone.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.positioned</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8338</span> </span><span class="WHIT">      </span><span class="NAME">clone.center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.center.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8339</span> </span><span class="WHIT">      </span><span class="NAME">clone.rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.clone</span><span class="PUNC">(</span><span class="NAME">this.rings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8340</span> </span><span class="WHIT">      </span><span class="NAME">clone.isBridged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isBridged</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8341</span> </span><span class="WHIT">      </span><span class="NAME">clone.isPartOfBridged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isPartOfBridged</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8342</span> </span><span class="WHIT">      </span><span class="NAME">clone.isSpiro</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isSpiro</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8343</span> </span><span class="WHIT">      </span><span class="NAME">clone.isFused</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isFused</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8344</span> </span><span class="WHIT">      </span><span class="NAME">clone.centralAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.centralAngle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8345</span> </span><span class="WHIT">      </span><span class="NAME">clone.canFlip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.canFlip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8346</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">clone</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8347</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8348</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8349</span>      * Returns the size (number of members) of this ring.
<span class='line'>8350</span>      *
<span class='line'>8351</span>      * @returns {Number} The size (number of members) of this ring.
<span class='line'>8352</span>      */</span><span class="WHIT">
<span class='line'>8353</span> </span><span class="WHIT">  
<span class='line'>8354</span>   
<span class='line'>8355</span>     </span><span class="NAME">getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8356</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.members.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8357</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8358</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8359</span>      * Gets the polygon representation (an array of the ring-members positional vectors) of this ring.
<span class='line'>8360</span>      *
<span class='line'>8361</span>      * @param {Vertex[]} vertices An array of vertices representing the current molecule.
<span class='line'>8362</span>      * @returns {Vector2[]} An array of the positional vectors of the ring members.
<span class='line'>8363</span>      */</span><span class="WHIT">
<span class='line'>8364</span> </span><span class="WHIT">  
<span class='line'>8365</span>   
<span class='line'>8366</span>     </span><span class="NAME">getPolygon</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8367</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">polygon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8368</span> </span><span class="WHIT">  
<span class='line'>8369</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.members.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8370</span> </span><span class="WHIT">        </span><span class="NAME">polygon.push</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8371</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8372</span> </span><span class="WHIT">  
<span class='line'>8373</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">polygon</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8374</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8375</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8376</span>      * Returns the angle of this ring in relation to the coordinate system.
<span class='line'>8377</span>      *
<span class='line'>8378</span>      * @returns {Number} The angle in radians.
<span class='line'>8379</span>      */</span><span class="WHIT">
<span class='line'>8380</span> </span><span class="WHIT">  
<span class='line'>8381</span>   
<span class='line'>8382</span>     </span><span class="NAME">getAngle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8383</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.centralAngle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8384</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8385</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8386</span>      * Loops over the members of this ring from a given start position in a direction opposite to the vertex id passed as the previousId.
<span class='line'>8387</span>      *
<span class='line'>8388</span>      * @param {Vertex[]} vertices The vertices associated with the current molecule.
<span class='line'>8389</span>      * @param {Function} callback A callback with the current vertex id as a parameter.
<span class='line'>8390</span>      * @param {Number} startVertexId The vertex id of the start vertex.
<span class='line'>8391</span>      * @param {Number} previousVertexId The vertex id of the previous vertex (the loop calling the callback function will run in the opposite direction of this vertex).
<span class='line'>8392</span>      */</span><span class="WHIT">
<span class='line'>8393</span> </span><span class="WHIT">  
<span class='line'>8394</span>   
<span class='line'>8395</span>     </span><span class="NAME">eachMember</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startVertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8396</span> </span><span class="WHIT">      </span><span class="NAME">startVertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startVertexId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">startVertexId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">startVertexId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8397</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startVertexId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8398</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8399</span> </span><span class="WHIT">  
<span class='line'>8400</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">max</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8401</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">prev</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">current</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8402</span> </span><span class="WHIT">        </span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">prev</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8403</span> </span><span class="WHIT">        </span><span class="NAME">current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">current</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getNextInRing</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8404</span> </span><span class="WHIT">        </span><span class="NAME">previousVertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prev</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Stop while loop when arriving back at the start vertex</span><span class="WHIT">
<span class='line'>8405</span> </span><span class="WHIT">  
<span class='line'>8406</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">startVertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8407</span> </span><span class="WHIT">          </span><span class="NAME">current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8408</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8409</span> </span><span class="WHIT">  
<span class='line'>8410</span>         </span><span class="NAME">max</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8411</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8412</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8413</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8414</span>      * Returns an array containing the neighbouring rings of this ring ordered by ring size.
<span class='line'>8415</span>      *
<span class='line'>8416</span>      * @param {RingConnection[]} ringConnections An array of ring connections associated with the current molecule.
<span class='line'>8417</span>      * @returns {Object[]} An array of neighbouring rings sorted by ring size. Example: { n: 5, neighbour: 1 }.
<span class='line'>8418</span>      */</span><span class="WHIT">
<span class='line'>8419</span> </span><span class="WHIT">  
<span class='line'>8420</span>   
<span class='line'>8421</span>     </span><span class="NAME">getOrderedNeighbours</span><span class="PUNC">(</span><span class="NAME">ringConnections</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8422</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">orderedNeighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">this.neighbours.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8423</span> </span><span class="WHIT">  
<span class='line'>8424</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8425</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RingConnection.getVertices</span><span class="PUNC">(</span><span class="NAME">ringConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8426</span> </span><span class="WHIT">        </span><span class="NAME">orderedNeighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8427</span> </span><span class="WHIT">          </span><span class="NAME">n</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">vertices.length</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8428</span> </span><span class="WHIT">          </span><span class="NAME">neighbour</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>8429</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8430</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8431</span> </span><span class="WHIT">  
<span class='line'>8432</span>       </span><span class="NAME">orderedNeighbours.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8433</span> </span><span class="WHIT">        </span><span class="COMM">// Sort highest to lowest</span><span class="WHIT">
<span class='line'>8434</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b.n</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a.n</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8435</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8436</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">orderedNeighbours</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8437</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8438</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8439</span>      * Check whether this ring is an implicitly defined benzene-like (e.g. C1=CC=CC=C1) with 6 members and 3 double bonds.
<span class='line'>8440</span>      *
<span class='line'>8441</span>      * @param {Vertex[]} vertices An array of vertices associated with the current molecule.
<span class='line'>8442</span>      * @returns {Boolean} A boolean indicating whether or not this ring is an implicitly defined benzene-like.
<span class='line'>8443</span>      */</span><span class="WHIT">
<span class='line'>8444</span> </span><span class="WHIT">  
<span class='line'>8445</span>   
<span class='line'>8446</span>     </span><span class="NAME">isBenzeneLike</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8447</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">db</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDoubleBondCount</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8448</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.members.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8449</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">db</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">db</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8450</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8451</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8452</span>      * Get the number of double bonds inside this ring.
<span class='line'>8453</span>      *
<span class='line'>8454</span>      * @param {Vertex[]} vertices An array of vertices associated with the current molecule.
<span class='line'>8455</span>      * @returns {Number} The number of double bonds inside this ring.
<span class='line'>8456</span>      */</span><span class="WHIT">
<span class='line'>8457</span> </span><span class="WHIT">  
<span class='line'>8458</span>   
<span class='line'>8459</span>     </span><span class="NAME">getDoubleBondCount</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8460</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">doubleBondCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8461</span> </span><span class="WHIT">  
<span class='line'>8462</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.members.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8463</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">atom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8464</span> </span><span class="WHIT">  
<span class='line'>8465</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'='</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">atom.branchBond</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'='</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8466</span> </span><span class="WHIT">          </span><span class="NAME">doubleBondCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8467</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8468</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8469</span> </span><span class="WHIT">  
<span class='line'>8470</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">doubleBondCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8471</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8472</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8473</span>      * Checks whether or not this ring contains a member with a given vertex id.
<span class='line'>8474</span>      *
<span class='line'>8475</span>      * @param {Number} vertexId A vertex id.
<span class='line'>8476</span>      * @returns {Boolean} A boolean indicating whether or not this ring contains a member with the given vertex id.
<span class='line'>8477</span>      */</span><span class="WHIT">
<span class='line'>8478</span> </span><span class="WHIT">  
<span class='line'>8479</span>   
<span class='line'>8480</span>     </span><span class="NAME">contains</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8481</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.members.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8482</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.members</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8483</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8484</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8485</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8486</span> </span><span class="WHIT">  
<span class='line'>8487</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8488</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8489</span> </span><span class="WHIT">  
<span class='line'>8490</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8491</span> </span><span class="WHIT">  
<span class='line'>8492</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Ring</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8493</span> </span><span class="WHIT">  
<span class='line'>8494</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./ArrayHelper"</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">"./RingConnection"</span><span class="PUNC">:</span><span class="NUMB">12</span><span class="PUNC">,</span><span class="STRN">"./Vector2"</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">,</span><span class="STRN">"./Vertex"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">12</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8495</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8496</span> </span><span class="WHIT">  
<span class='line'>8497</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>8498</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vertex'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8499</span> </span><span class="WHIT">  
<span class='line'>8500</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Ring'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8501</span> </span><span class="WHIT">  </span><span class="COMM">/** 
<span class='line'>8502</span>    * A class representing a ring connection.
<span class='line'>8503</span>    * 
<span class='line'>8504</span>    * @property {Number} id The id of this ring connection.
<span class='line'>8505</span>    * @property {Number} firstRingId A ring id.
<span class='line'>8506</span>    * @property {Number} secondRingId A ring id.
<span class='line'>8507</span>    * @property {Set&lt;Number>} vertices A set containing the vertex ids participating in the ring connection.
<span class='line'>8508</span>    */</span><span class="WHIT">
<span class='line'>8509</span> </span><span class="WHIT">  
<span class='line'>8510</span>   
<span class='line'>8511</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">RingConnection</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8512</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8513</span>      * The constructor for the class RingConnection.
<span class='line'>8514</span>      *
<span class='line'>8515</span>      * @param {Ring} firstRing A ring.
<span class='line'>8516</span>      * @param {Ring} secondRing A ring.
<span class='line'>8517</span>      */</span><span class="WHIT">
<span class='line'>8518</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">firstRing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">secondRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8519</span> </span><span class="WHIT">      </span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8520</span> </span><span class="WHIT">      </span><span class="NAME">this.firstRingId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">firstRing.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8521</span> </span><span class="WHIT">      </span><span class="NAME">this.secondRingId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">secondRing.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8522</span> </span><span class="WHIT">      </span><span class="NAME">this.vertices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Set</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8523</span> </span><span class="WHIT">  
<span class='line'>8524</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">firstRing.members.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8525</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">firstRing.members</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8526</span> </span><span class="WHIT">  
<span class='line'>8527</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">secondRing.members.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8528</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">secondRing.members</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8529</span> </span><span class="WHIT">  
<span class='line'>8530</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8531</span> </span><span class="WHIT">            </span><span class="NAME">this.addVertex</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8532</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8533</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8534</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8535</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8536</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8537</span>      * Adding a vertex to the ring connection.
<span class='line'>8538</span>      *
<span class='line'>8539</span>      * @param {Number} vertexId A vertex id.
<span class='line'>8540</span>      */</span><span class="WHIT">
<span class='line'>8541</span> </span><span class="WHIT">  
<span class='line'>8542</span>   
<span class='line'>8543</span>     </span><span class="NAME">addVertex</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8544</span> </span><span class="WHIT">      </span><span class="NAME">this.vertices.add</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8545</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8546</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8547</span>      * Update the ring id of this ring connection that is not the ring id supplied as the second argument.
<span class='line'>8548</span>      *
<span class='line'>8549</span>      * @param {Number} ringId A ring id. The new ring id to be set.
<span class='line'>8550</span>      * @param {Number} otherRingId A ring id. The id that is NOT to be updated.
<span class='line'>8551</span>      */</span><span class="WHIT">
<span class='line'>8552</span> </span><span class="WHIT">  
<span class='line'>8553</span>   
<span class='line'>8554</span>     </span><span class="NAME">updateOther</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherRingId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8555</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">otherRingId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8556</span> </span><span class="WHIT">        </span><span class="NAME">this.secondRingId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8557</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8558</span> </span><span class="WHIT">        </span><span class="NAME">this.firstRingId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8559</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8560</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8561</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8562</span>      * Returns a boolean indicating whether or not a ring with a given id is participating in this ring connection.
<span class='line'>8563</span>      * 
<span class='line'>8564</span>      * @param {Number} ringId A ring id.
<span class='line'>8565</span>      * @returns {Boolean} A boolean indicating whether or not a ring with a given id participates in this ring connection.
<span class='line'>8566</span>      */</span><span class="WHIT">
<span class='line'>8567</span> </span><span class="WHIT">  
<span class='line'>8568</span>   
<span class='line'>8569</span>     </span><span class="NAME">containsRing</span><span class="PUNC">(</span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8570</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.secondRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8571</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8572</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8573</span>      * Checks whether or not this ring connection is a bridge in a bridged ring.
<span class='line'>8574</span>      *
<span class='line'>8575</span>      * @param {Vertex[]} vertices The array of vertices associated with the current molecule.
<span class='line'>8576</span>      * @returns {Boolean} A boolean indicating whether or not this ring connection is a bridge.
<span class='line'>8577</span>      */</span><span class="WHIT">
<span class='line'>8578</span> </span><span class="WHIT">  
<span class='line'>8579</span>   
<span class='line'>8580</span>     </span><span class="NAME">isBridge</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8581</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.vertices.size</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8582</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8583</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8584</span> </span><span class="WHIT">  
<span class='line'>8585</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8586</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">vertexId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.rings.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8587</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8588</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8589</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8590</span> </span><span class="WHIT">  
<span class='line'>8591</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8592</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8593</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8594</span>      * Checks whether or not two rings are connected by a bridged bond.
<span class='line'>8595</span>      *
<span class='line'>8596</span>      * @static
<span class='line'>8597</span>      * @param {RingConnection[]} ringConnections An array of ring connections containing the ring connections associated with the current molecule.
<span class='line'>8598</span>      * @param {Vertex[]} vertices An array of vertices containing the vertices associated with the current molecule.
<span class='line'>8599</span>      * @param {Number} firstRingId A ring id.
<span class='line'>8600</span>      * @param {Number} secondRingId A ring id.
<span class='line'>8601</span>      * @returns {Boolean} A boolean indicating whether or not two rings ar connected by a bridged bond.
<span class='line'>8602</span>      */</span><span class="WHIT">
<span class='line'>8603</span> </span><span class="WHIT">  
<span class='line'>8604</span>   
<span class='line'>8605</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">isBridge</span><span class="PUNC">(</span><span class="NAME">ringConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">firstRingId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">secondRingId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8606</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8607</span> </span><span class="WHIT">  
<span class='line'>8608</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8609</span> </span><span class="WHIT">        </span><span class="NAME">ringConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ringConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8610</span> </span><span class="WHIT">  
<span class='line'>8611</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ringConnection.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">firstRingId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ringConnection.secondRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">secondRingId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ringConnection.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">secondRingId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ringConnection.secondRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">firstRingId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8612</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ringConnection.isBridge</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8613</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8614</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8615</span> </span><span class="WHIT">  
<span class='line'>8616</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8617</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8618</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8619</span>      * Retruns the neighbouring rings of a given ring.
<span class='line'>8620</span>      *
<span class='line'>8621</span>      * @static
<span class='line'>8622</span>      * @param {RingConnection[]} ringConnections An array of ring connections containing ring connections associated with the current molecule.
<span class='line'>8623</span>      * @param {Number} ringId A ring id.
<span class='line'>8624</span>      * @returns {Number[]} An array of ring ids of neighbouring rings.
<span class='line'>8625</span>      */</span><span class="WHIT">
<span class='line'>8626</span> </span><span class="WHIT">  
<span class='line'>8627</span>   
<span class='line'>8628</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getNeighbours</span><span class="PUNC">(</span><span class="NAME">ringConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8629</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8630</span> </span><span class="WHIT">  
<span class='line'>8631</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8632</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ringConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8633</span> </span><span class="WHIT">  
<span class='line'>8634</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ringConnection.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8635</span> </span><span class="WHIT">          </span><span class="NAME">neighbours.push</span><span class="PUNC">(</span><span class="NAME">ringConnection.secondRingId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8636</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ringConnection.secondRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8637</span> </span><span class="WHIT">          </span><span class="NAME">neighbours.push</span><span class="PUNC">(</span><span class="NAME">ringConnection.firstRingId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8638</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8639</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8640</span> </span><span class="WHIT">  
<span class='line'>8641</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8642</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8643</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8644</span>      * Returns an array of vertex ids associated with a given ring connection.
<span class='line'>8645</span>      *
<span class='line'>8646</span>      * @static
<span class='line'>8647</span>      * @param {RingConnection[]} ringConnections An array of ring connections containing ring connections associated with the current molecule.
<span class='line'>8648</span>      * @param {Number} firstRingId A ring id.
<span class='line'>8649</span>      * @param {Number} secondRingId A ring id.
<span class='line'>8650</span>      * @returns {Number[]} An array of vertex ids associated with the ring connection.
<span class='line'>8651</span>      */</span><span class="WHIT">
<span class='line'>8652</span> </span><span class="WHIT">  
<span class='line'>8653</span>   
<span class='line'>8654</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getVertices</span><span class="PUNC">(</span><span class="NAME">ringConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">firstRingId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">secondRingId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8655</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ringConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8656</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ringConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ringConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8657</span> </span><span class="WHIT">  
<span class='line'>8658</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ringConnection.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">firstRingId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ringConnection.secondRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">secondRingId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">ringConnection.firstRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">secondRingId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ringConnection.secondRingId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">firstRingId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8659</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">ringConnection.vertices</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8660</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8661</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8662</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8663</span> </span><span class="WHIT">  
<span class='line'>8664</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8665</span> </span><span class="WHIT">  
<span class='line'>8666</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">RingConnection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8667</span> </span><span class="WHIT">  
<span class='line'>8668</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./Ring"</span><span class="PUNC">:</span><span class="NUMB">11</span><span class="PUNC">,</span><span class="STRN">"./Vertex"</span><span class="PUNC">:</span><span class="NUMB">19</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">13</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8669</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8670</span> </span><span class="WHIT">  
<span class='line'>8671</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>8672</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Graph</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Graph'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8673</span> </span><span class="WHIT">  </span><span class="COMM">/** A class encapsulating the functionality to find the smallest set of smallest rings in a graph. */</span><span class="WHIT">
<span class='line'>8674</span> </span><span class="WHIT">  
<span class='line'>8675</span>   
<span class='line'>8676</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">SSSR</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8677</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8678</span>      * Returns an array containing arrays, each representing a ring from the smallest set of smallest rings in the graph.
<span class='line'>8679</span>      * 
<span class='line'>8680</span>      * @param {Graph} graph A Graph object.
<span class='line'>8681</span>      * @param {Boolean} [experimental=false] Whether or not to use experimental SSSR.
<span class='line'>8682</span>      * @returns {Array[]} An array containing arrays, each representing a ring from the smallest set of smallest rings in the group.
<span class='line'>8683</span>      */</span><span class="WHIT">
<span class='line'>8684</span> </span><span class="WHIT">    </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getRings</span><span class="PUNC">(</span><span class="NAME">graph</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">experimental</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8685</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">graph.getComponentsAdjacencyMatrix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8686</span> </span><span class="WHIT">  
<span class='line'>8687</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">adjacencyMatrix.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8688</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8689</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8690</span> </span><span class="WHIT">  
<span class='line'>8691</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">connectedComponents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Graph.getConnectedComponents</span><span class="PUNC">(</span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8692</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8693</span> </span><span class="WHIT">  
<span class='line'>8694</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">connectedComponents.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8695</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">connectedComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectedComponents</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8696</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ccAdjacencyMatrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">graph.getSubgraphAdjacencyMatrix</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">connectedComponent</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8697</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrBondCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Uint16Array</span><span class="PUNC">(</span><span class="NAME">ccAdjacencyMatrix.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8698</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arrRingCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Uint16Array</span><span class="PUNC">(</span><span class="NAME">ccAdjacencyMatrix.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8699</span> </span><span class="WHIT">  
<span class='line'>8700</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ccAdjacencyMatrix.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8701</span> </span><span class="WHIT">          </span><span class="NAME">arrRingCount</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8702</span> </span><span class="WHIT">          </span><span class="NAME">arrBondCount</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8703</span> </span><span class="WHIT">  
<span class='line'>8704</span>           </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ccAdjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8705</span> </span><span class="WHIT">            </span><span class="NAME">arrBondCount</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ccAdjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8706</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8707</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Get the edge number and the theoretical number of rings in SSSR</span><span class="WHIT">
<span class='line'>8708</span> </span><span class="WHIT">  
<span class='line'>8709</span>   
<span class='line'>8710</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nEdges</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8711</span> </span><span class="WHIT">  
<span class='line'>8712</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ccAdjacencyMatrix.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8713</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ccAdjacencyMatrix.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8714</span> </span><span class="WHIT">            </span><span class="NAME">nEdges</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ccAdjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8715</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8716</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8717</span> </span><span class="WHIT">  
<span class='line'>8718</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">nSssr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nEdges</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ccAdjacencyMatrix.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// console.log(nEdges, ccAdjacencyMatrix.length, nSssr);</span><span class="WHIT">
<span class='line'>8719</span> </span><span class="WHIT">        </span><span class="COMM">// console.log(SSSR.getEdgeList(ccAdjacencyMatrix));</span><span class="WHIT">
<span class='line'>8720</span> </span><span class="WHIT">        </span><span class="COMM">// console.log(ccAdjacencyMatrix);</span><span class="WHIT">
<span class='line'>8721</span> </span><span class="WHIT">        </span><span class="COMM">// If all vertices have 3 incident edges, calculate with different formula (see Euler)</span><span class="WHIT">
<span class='line'>8722</span> </span><span class="WHIT">  
<span class='line'>8723</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">allThree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8724</span> </span><span class="WHIT">  
<span class='line'>8725</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arrBondCount.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8726</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arrBondCount</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8727</span> </span><span class="WHIT">            </span><span class="NAME">allThree</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8728</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8729</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8730</span> </span><span class="WHIT">  
<span class='line'>8731</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">allThree</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8732</span> </span><span class="WHIT">          </span><span class="NAME">nSssr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nEdges</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ccAdjacencyMatrix.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8733</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// All vertices are part of one ring if theres only one ring.</span><span class="WHIT">
<span class='line'>8734</span> </span><span class="WHIT">  
<span class='line'>8735</span>   
<span class='line'>8736</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nSssr</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8737</span> </span><span class="WHIT">          </span><span class="NAME">rings.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="PUNC">.</span><span class="NAME">connectedComponent</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8738</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8739</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8740</span> </span><span class="WHIT">  
<span class='line'>8741</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">experimental</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8742</span> </span><span class="WHIT">          </span><span class="NAME">nSssr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">999</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8743</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8744</span> </span><span class="WHIT">  
<span class='line'>8745</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8746</span> </span><span class="WHIT">          </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8747</span> </span><span class="WHIT">          </span><span class="NAME">pe</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8748</span> </span><span class="WHIT">          </span><span class="NAME">pe_prime</span><span class="WHIT">
<span class='line'>8749</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SSSR.getPathIncludedDistanceMatrices</span><span class="PUNC">(</span><span class="NAME">ccAdjacencyMatrix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8750</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SSSR.getRingCandidates</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe_prime</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8751</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sssr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SSSR.getSSSR</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ccAdjacencyMatrix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe_prime</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrBondCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrRingCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nSssr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8752</span> </span><span class="WHIT">  
<span class='line'>8753</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sssr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8754</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">sssr</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">size</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8755</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8756</span> </span><span class="WHIT">  
<span class='line'>8757</span>           </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">sssr</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8758</span> </span><span class="WHIT">            </span><span class="COMM">// Get the original id of the vertex back</span><span class="WHIT">
<span class='line'>8759</span> </span><span class="WHIT">            </span><span class="NAME">ring</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectedComponent</span><span class="PUNC">[</span><span class="NAME">val</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8760</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8761</span> </span><span class="WHIT">  
<span class='line'>8762</span>           </span><span class="NAME">rings.push</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8763</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8764</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// So, for some reason, this would return three rings for C1CCCC2CC1CCCC2, which is wrong</span><span class="WHIT">
<span class='line'>8765</span> </span><span class="WHIT">      </span><span class="COMM">// As I don't have time to fix this properly, it will stay in. I'm sorry next person who works</span><span class="WHIT">
<span class='line'>8766</span> </span><span class="WHIT">      </span><span class="COMM">// on it. At that point it might be best to reimplement the whole SSSR thing...</span><span class="WHIT">
<span class='line'>8767</span> </span><span class="WHIT">  
<span class='line'>8768</span>   
<span class='line'>8769</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8770</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8771</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8772</span>      * Creates a printable string from a matrix (2D array).
<span class='line'>8773</span>      * 
<span class='line'>8774</span>      * @param {Array[]} matrix A 2D array.
<span class='line'>8775</span>      * @returns {String} A string representing the matrix.
<span class='line'>8776</span>      */</span><span class="WHIT">
<span class='line'>8777</span> </span><span class="WHIT">  
<span class='line'>8778</span>   
<span class='line'>8779</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">matrixToString</span><span class="PUNC">(</span><span class="NAME">matrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8780</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8781</span> </span><span class="WHIT">  
<span class='line'>8782</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">matrix.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8783</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">matrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8784</span> </span><span class="WHIT">          </span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">matrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' '</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8785</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8786</span> </span><span class="WHIT">  
<span class='line'>8787</span>         </span><span class="NAME">str</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'\n'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8788</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8789</span> </span><span class="WHIT">  
<span class='line'>8790</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8791</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8792</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8793</span>      * Returnes the two path-included distance matrices used to find the sssr.
<span class='line'>8794</span>      * 
<span class='line'>8795</span>      * @param {Array[]} adjacencyMatrix An adjacency matrix.
<span class='line'>8796</span>      * @returns {Object} The path-included distance matrices. { p1, p2 }
<span class='line'>8797</span>      */</span><span class="WHIT">
<span class='line'>8798</span> </span><span class="WHIT">  
<span class='line'>8799</span>   
<span class='line'>8800</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getPathIncludedDistanceMatrices</span><span class="PUNC">(</span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8801</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8802</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8803</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8804</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pe_prime</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8805</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8806</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8807</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8808</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8809</span> </span><span class="WHIT">  
<span class='line'>8810</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8811</span> </span><span class="WHIT">        </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8812</span> </span><span class="WHIT">        </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8813</span> </span><span class="WHIT">        </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8814</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8815</span> </span><span class="WHIT">  
<span class='line'>8816</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8817</span> </span><span class="WHIT">          </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Number.POSITIVE_INFINITY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8818</span> </span><span class="WHIT">  
<span class='line'>8819</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8820</span> </span><span class="WHIT">            </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8821</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8822</span> </span><span class="WHIT">            </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8823</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8824</span> </span><span class="WHIT">  
<span class='line'>8825</span>           </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8826</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8827</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8828</span> </span><span class="WHIT">  
<span class='line'>8829</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8830</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8831</span> </span><span class="WHIT">  
<span class='line'>8832</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8833</span> </span><span class="WHIT">        </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8834</span> </span><span class="WHIT">  
<span class='line'>8835</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8836</span> </span><span class="WHIT">          </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8837</span> </span><span class="WHIT">  
<span class='line'>8838</span>           </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8839</span> </span><span class="WHIT">            </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">previousPathLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8840</span> </span><span class="WHIT">            </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">newPathLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8841</span> </span><span class="WHIT">  
<span class='line'>8842</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousPathLength</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">newPathLength</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8843</span> </span><span class="WHIT">              </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8844</span> </span><span class="WHIT">  
<span class='line'>8845</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousPathLength</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">newPathLength</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8846</span> </span><span class="WHIT">                </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8847</span> </span><span class="WHIT">                </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8848</span> </span><span class="WHIT">  
<span class='line'>8849</span>                 </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8850</span> </span><span class="WHIT">                  </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8851</span> </span><span class="WHIT">                  </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8852</span> </span><span class="WHIT">  
<span class='line'>8853</span>                   </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8854</span> </span><span class="WHIT">                    </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8855</span> </span><span class="WHIT">                    </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8856</span> </span><span class="WHIT">  
<span class='line'>8857</span>                     </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8858</span> </span><span class="WHIT">                      </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8859</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8860</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8861</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8862</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8863</span> </span><span class="WHIT">                </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8864</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8865</span> </span><span class="WHIT">  
<span class='line'>8866</span>               </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newPathLength</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8867</span> </span><span class="WHIT">              </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8868</span> </span><span class="WHIT">              </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8869</span> </span><span class="WHIT">  
<span class='line'>8870</span>               </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8871</span> </span><span class="WHIT">                </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8872</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8873</span> </span><span class="WHIT">  
<span class='line'>8874</span>               </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8875</span> </span><span class="WHIT">  
<span class='line'>8876</span>               </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8877</span> </span><span class="WHIT">                </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8878</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8879</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousPathLength</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">newPathLength</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8880</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8881</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8882</span> </span><span class="WHIT">  
<span class='line'>8883</span>                 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8884</span> </span><span class="WHIT">                  </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8885</span> </span><span class="WHIT">                  </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8886</span> </span><span class="WHIT">  
<span class='line'>8887</span>                   </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8888</span> </span><span class="WHIT">                    </span><span class="NAME">tmp.push</span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8889</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8890</span> </span><span class="WHIT">  
<span class='line'>8891</span>                   </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8892</span> </span><span class="WHIT">  
<span class='line'>8893</span>                   </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8894</span> </span><span class="WHIT">                    </span><span class="NAME">tmp.push</span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8895</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8896</span> </span><span class="WHIT">  
<span class='line'>8897</span>                   </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8898</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8899</span> </span><span class="WHIT">                  </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8900</span> </span><span class="WHIT">                  </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8901</span> </span><span class="WHIT">  
<span class='line'>8902</span>                   </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8903</span> </span><span class="WHIT">                    </span><span class="NAME">tmp.push</span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8904</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8905</span> </span><span class="WHIT">  
<span class='line'>8906</span>                   </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8907</span> </span><span class="WHIT">  
<span class='line'>8908</span>                   </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8909</span> </span><span class="WHIT">                    </span><span class="NAME">tmp.push</span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8910</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8911</span> </span><span class="WHIT">  
<span class='line'>8912</span>                   </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8913</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8914</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8915</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">previousPathLength</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">newPathLength</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8916</span> </span><span class="WHIT">              </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8917</span> </span><span class="WHIT">  
<span class='line'>8918</span>               </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8919</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8920</span> </span><span class="WHIT">                </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8921</span> </span><span class="WHIT">  
<span class='line'>8922</span>                 </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8923</span> </span><span class="WHIT">                  </span><span class="NAME">tmp.push</span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8924</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8925</span> </span><span class="WHIT">  
<span class='line'>8926</span>                 </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8927</span> </span><span class="WHIT">  
<span class='line'>8928</span>                 </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8929</span> </span><span class="WHIT">                  </span><span class="NAME">tmp.push</span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8930</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8931</span> </span><span class="WHIT">  
<span class='line'>8932</span>                 </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8933</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8934</span> </span><span class="WHIT">                </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8935</span> </span><span class="WHIT">                </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8936</span> </span><span class="WHIT">  
<span class='line'>8937</span>                 </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8938</span> </span><span class="WHIT">                  </span><span class="NAME">tmp.push</span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8939</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8940</span> </span><span class="WHIT">  
<span class='line'>8941</span>                 </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8942</span> </span><span class="WHIT">  
<span class='line'>8943</span>                 </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8944</span> </span><span class="WHIT">                  </span><span class="NAME">tmp.push</span><span class="PUNC">(</span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8945</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8946</span> </span><span class="WHIT">  
<span class='line'>8947</span>                 </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8948</span> </span><span class="WHIT">              </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8949</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8950</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8951</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8952</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8953</span> </span><span class="WHIT">  
<span class='line'>8954</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8955</span> </span><span class="WHIT">        </span><span class="NAME">d</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8956</span> </span><span class="WHIT">        </span><span class="NAME">pe</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8957</span> </span><span class="WHIT">        </span><span class="NAME">pe_prime</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">pe_prime</span><span class="WHIT">
<span class='line'>8958</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8959</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8960</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>8961</span>      * Get the ring candidates from the path-included distance matrices.
<span class='line'>8962</span>      * 
<span class='line'>8963</span>      * @param {Array[]} d The distance matrix.
<span class='line'>8964</span>      * @param {Array[]} pe A matrix containing the shortest paths.
<span class='line'>8965</span>      * @param {Array[]} pe_prime A matrix containing the shortest paths + one vertex.
<span class='line'>8966</span>      * @returns {Array[]} The ring candidates.
<span class='line'>8967</span>      */</span><span class="WHIT">
<span class='line'>8968</span> </span><span class="WHIT">  
<span class='line'>8969</span>   
<span class='line'>8970</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getRingCandidates</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe_prime</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8971</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8972</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">candidates</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8973</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8974</span> </span><span class="WHIT">  
<span class='line'>8975</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8976</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8977</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8978</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8979</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8980</span> </span><span class="WHIT">            </span><span class="COMM">// c is the number of vertices in the cycle.</span><span class="WHIT">
<span class='line'>8981</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8982</span> </span><span class="WHIT">              </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8983</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8984</span> </span><span class="WHIT">              </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8985</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8986</span> </span><span class="WHIT">  
<span class='line'>8987</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8988</span> </span><span class="WHIT">              </span><span class="NAME">candidates.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe_prime</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8989</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8990</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8991</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8992</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Candidates have to be sorted by c</span><span class="WHIT">
<span class='line'>8993</span> </span><span class="WHIT">  
<span class='line'>8994</span>   
<span class='line'>8995</span>       </span><span class="NAME">candidates.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8996</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8997</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8998</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">candidates</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8999</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9000</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9001</span>      * Searches the candidates for the smallest set of smallest rings.
<span class='line'>9002</span>      * 
<span class='line'>9003</span>      * @param {Array[]} c The candidates.
<span class='line'>9004</span>      * @param {Array[]} d The distance matrix.
<span class='line'>9005</span>      * @param {Array[]} adjacencyMatrix An adjacency matrix.
<span class='line'>9006</span>      * @param {Array[]} pe A matrix containing the shortest paths.
<span class='line'>9007</span>      * @param {Array[]} pe_prime A matrix containing the shortest paths + one vertex.
<span class='line'>9008</span>      * @param {Uint16Array} arrBondCount A matrix containing the bond count of each vertex.
<span class='line'>9009</span>      * @param {Uint16Array} arrRingCount A matrix containing the number of rings associated with each vertex.
<span class='line'>9010</span>      * @param {Number} nsssr The theoretical number of rings in the graph.
<span class='line'>9011</span>      * @returns {Set[]} The smallest set of smallest rings.
<span class='line'>9012</span>      */</span><span class="WHIT">
<span class='line'>9013</span> </span><span class="WHIT">  
<span class='line'>9014</span>   
<span class='line'>9015</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getSSSR</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pe_prime</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrBondCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrRingCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nsssr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9016</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cSssr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9017</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">allBonds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9018</span> </span><span class="WHIT">  
<span class='line'>9019</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9020</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9021</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9022</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Some bonds are added twice, resulting in [[u, v], [u, v]] instead of [u, v].</span><span class="WHIT">
<span class='line'>9023</span> </span><span class="WHIT">            </span><span class="COMM">// TODO: This is a workaround, fix later. Probably should be a set rather than an array, however the computational overhead</span><span class="WHIT">
<span class='line'>9024</span> </span><span class="WHIT">            </span><span class="COMM">//       is probably bigger compared to leaving it like this.</span><span class="WHIT">
<span class='line'>9025</span> </span><span class="WHIT">  
<span class='line'>9026</span>             </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">bonds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9027</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">constructor</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9028</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9029</span> </span><span class="WHIT">  
<span class='line'>9030</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">atoms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SSSR.bondsToAtoms</span><span class="PUNC">(</span><span class="NAME">bonds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9031</span> </span><span class="WHIT">  
<span class='line'>9032</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SSSR.getBondCount</span><span class="PUNC">(</span><span class="NAME">atoms</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">atoms.size</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">SSSR.pathSetsContain</span><span class="PUNC">(</span><span class="NAME">cSssr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atoms</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">allBonds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrBondCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrRingCount</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9033</span> </span><span class="WHIT">              </span><span class="NAME">cSssr.push</span><span class="PUNC">(</span><span class="NAME">atoms</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9034</span> </span><span class="WHIT">              </span><span class="NAME">allBonds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">allBonds.concat</span><span class="PUNC">(</span><span class="NAME">bonds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9035</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9036</span> </span><span class="WHIT">  
<span class='line'>9037</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cSssr.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">nsssr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9038</span> </span><span class="WHIT">              </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cSssr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9039</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9040</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9041</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9042</span> </span><span class="WHIT">          </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9043</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Some bonds are added twice, resulting in [[u, v], [u, v]] instead of [u, v].</span><span class="WHIT">
<span class='line'>9044</span> </span><span class="WHIT">            </span><span class="COMM">// TODO: This is a workaround, fix later. Probably should be a set rather than an array, however the computational overhead</span><span class="WHIT">
<span class='line'>9045</span> </span><span class="WHIT">            </span><span class="COMM">//       is probably bigger compared to leaving it like this.</span><span class="WHIT">
<span class='line'>9046</span> </span><span class="WHIT">  
<span class='line'>9047</span>             </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">bonds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9048</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">constructor</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9049</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9050</span> </span><span class="WHIT">  
<span class='line'>9051</span>             </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">atoms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SSSR.bondsToAtoms</span><span class="PUNC">(</span><span class="NAME">bonds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9052</span> </span><span class="WHIT">  
<span class='line'>9053</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SSSR.getBondCount</span><span class="PUNC">(</span><span class="NAME">atoms</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">atoms.size</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">SSSR.pathSetsContain</span><span class="PUNC">(</span><span class="NAME">cSssr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atoms</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">allBonds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrBondCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrRingCount</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9054</span> </span><span class="WHIT">              </span><span class="NAME">cSssr.push</span><span class="PUNC">(</span><span class="NAME">atoms</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9055</span> </span><span class="WHIT">              </span><span class="NAME">allBonds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">allBonds.concat</span><span class="PUNC">(</span><span class="NAME">bonds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9056</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9057</span> </span><span class="WHIT">  
<span class='line'>9058</span>             </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cSssr.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">nsssr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9059</span> </span><span class="WHIT">              </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cSssr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9060</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9061</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9062</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9063</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9064</span> </span><span class="WHIT">  
<span class='line'>9065</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cSssr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9066</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9067</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9068</span>      * Returns the number of edges in a graph defined by an adjacency matrix.
<span class='line'>9069</span>      * 
<span class='line'>9070</span>      * @param {Array[]} adjacencyMatrix An adjacency matrix.
<span class='line'>9071</span>      * @returns {Number} The number of edges in the graph defined by the adjacency matrix.
<span class='line'>9072</span>      */</span><span class="WHIT">
<span class='line'>9073</span> </span><span class="WHIT">  
<span class='line'>9074</span>   
<span class='line'>9075</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getEdgeCount</span><span class="PUNC">(</span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9076</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9077</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9078</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9079</span> </span><span class="WHIT">  
<span class='line'>9080</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9081</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9082</span> </span><span class="WHIT">  
<span class='line'>9083</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9084</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9085</span> </span><span class="WHIT">            </span><span class="NAME">edgeCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9086</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9087</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9088</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9089</span> </span><span class="WHIT">  
<span class='line'>9090</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">edgeCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9091</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9092</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9093</span>      * Returns an edge list constructed form an adjacency matrix.
<span class='line'>9094</span>      * 
<span class='line'>9095</span>      * @param {Array[]} adjacencyMatrix An adjacency matrix.
<span class='line'>9096</span>      * @returns {Array[]} An edge list. E.g. [ [ 0, 1 ], ..., [ 16, 2 ] ]
<span class='line'>9097</span>      */</span><span class="WHIT">
<span class='line'>9098</span> </span><span class="WHIT">  
<span class='line'>9099</span>   
<span class='line'>9100</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getEdgeList</span><span class="PUNC">(</span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9101</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9102</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9103</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9104</span> </span><span class="WHIT">  
<span class='line'>9105</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9106</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9107</span> </span><span class="WHIT">  
<span class='line'>9108</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9109</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9110</span> </span><span class="WHIT">            </span><span class="NAME">edgeList.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9111</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9112</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9113</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9114</span> </span><span class="WHIT">  
<span class='line'>9115</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">edgeList</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9116</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9117</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9118</span>      * Return a set of vertex indices contained in an array of bonds.
<span class='line'>9119</span>      * 
<span class='line'>9120</span>      * @param {Array} bonds An array of bonds. A bond is defined as [ sourceVertexId, targetVertexId ].
<span class='line'>9121</span>      * @returns {Set&lt;Number>} An array of vertices.
<span class='line'>9122</span>      */</span><span class="WHIT">
<span class='line'>9123</span> </span><span class="WHIT">  
<span class='line'>9124</span>   
<span class='line'>9125</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">bondsToAtoms</span><span class="PUNC">(</span><span class="NAME">bonds</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9126</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">atoms</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Set</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9127</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bonds.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9128</span> </span><span class="WHIT">  
<span class='line'>9129</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9130</span> </span><span class="WHIT">        </span><span class="NAME">atoms.add</span><span class="PUNC">(</span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9131</span> </span><span class="WHIT">        </span><span class="NAME">atoms.add</span><span class="PUNC">(</span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9132</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9133</span> </span><span class="WHIT">  
<span class='line'>9134</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">atoms</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9135</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9136</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9137</span>     * Returns the number of bonds within a set of atoms.
<span class='line'>9138</span>     * 
<span class='line'>9139</span>     * @param {Set&lt;Number>} atoms An array of atom ids.
<span class='line'>9140</span>     * @param {Array[]} adjacencyMatrix An adjacency matrix.
<span class='line'>9141</span>     * @returns {Number} The number of bonds in a set of atoms.
<span class='line'>9142</span>     */</span><span class="WHIT">
<span class='line'>9143</span> </span><span class="WHIT">  
<span class='line'>9144</span>   
<span class='line'>9145</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">getBondCount</span><span class="PUNC">(</span><span class="NAME">atoms</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9146</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9147</span> </span><span class="WHIT">  
<span class='line'>9148</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">atoms</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9149</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">atoms</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9150</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9151</span> </span><span class="WHIT">            </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9152</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9153</span> </span><span class="WHIT">  
<span class='line'>9154</span>           </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjacencyMatrix</span><span class="PUNC">[</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9155</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9156</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9157</span> </span><span class="WHIT">  
<span class='line'>9158</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9159</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9160</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9161</span>      * Checks whether or not a given path already exists in an array of paths.
<span class='line'>9162</span>      * 
<span class='line'>9163</span>      * @param {Set[]} pathSets An array of sets each representing a path.
<span class='line'>9164</span>      * @param {Set&lt;Number>} pathSet A set representing a path.
<span class='line'>9165</span>      * @param {Array[]} bonds The bonds associated with the current path.
<span class='line'>9166</span>      * @param {Array[]} allBonds All bonds currently associated with rings in the SSSR set.
<span class='line'>9167</span>      * @param {Uint16Array} arrBondCount A matrix containing the bond count of each vertex.
<span class='line'>9168</span>      * @param {Uint16Array} arrRingCount A matrix containing the number of rings associated with each vertex.
<span class='line'>9169</span>      * @returns {Boolean} A boolean indicating whether or not a give path is contained within a set.
<span class='line'>9170</span>      */</span><span class="WHIT">
<span class='line'>9171</span> </span><span class="WHIT">  
<span class='line'>9172</span>   
<span class='line'>9173</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">pathSetsContain</span><span class="PUNC">(</span><span class="NAME">pathSets</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pathSet</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">allBonds</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrBondCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arrRingCount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9174</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pathSets.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9175</span> </span><span class="WHIT">  
<span class='line'>9176</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9177</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SSSR.isSupersetOf</span><span class="PUNC">(</span><span class="NAME">pathSet</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pathSets</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9178</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9179</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9180</span> </span><span class="WHIT">  
<span class='line'>9181</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pathSets</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">size</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">pathSet.size</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9182</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9183</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9184</span> </span><span class="WHIT">  
<span class='line'>9185</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">SSSR.areSetsEqual</span><span class="PUNC">(</span><span class="NAME">pathSets</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pathSet</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9186</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9187</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9188</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Check if the edges from the candidate are already all contained within the paths of the set of paths.</span><span class="WHIT">
<span class='line'>9189</span> </span><span class="WHIT">      </span><span class="COMM">// TODO: For some reason, this does not replace the isSupersetOf method above -> why?</span><span class="WHIT">
<span class='line'>9190</span> </span><span class="WHIT">  
<span class='line'>9191</span>   
<span class='line'>9192</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9193</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">allContained</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9194</span> </span><span class="WHIT">      </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">bonds.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9195</span> </span><span class="WHIT">  
<span class='line'>9196</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9197</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">allBonds.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9198</span> </span><span class="WHIT">  
<span class='line'>9199</span>         </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9200</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">allBonds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">allBonds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">allBonds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">bonds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">allBonds</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9201</span> </span><span class="WHIT">            </span><span class="NAME">count</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9202</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9203</span> </span><span class="WHIT">  
<span class='line'>9204</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">count</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">bonds.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9205</span> </span><span class="WHIT">            </span><span class="NAME">allContained</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9206</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9207</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9208</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// If all the bonds and thus vertices are already contained within other rings</span><span class="WHIT">
<span class='line'>9209</span> </span><span class="WHIT">      </span><span class="COMM">// check if there's one vertex with ringCount &lt; bondCount</span><span class="WHIT">
<span class='line'>9210</span> </span><span class="WHIT">  
<span class='line'>9211</span>   
<span class='line'>9212</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">specialCase</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9213</span> </span><span class="WHIT">  
<span class='line'>9214</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">allContained</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9215</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">pathSet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9216</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arrRingCount</span><span class="PUNC">[</span><span class="NAME">element</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arrBondCount</span><span class="PUNC">[</span><span class="NAME">element</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9217</span> </span><span class="WHIT">            </span><span class="NAME">specialCase</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9218</span> </span><span class="WHIT">            </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9219</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9220</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9221</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9222</span> </span><span class="WHIT">  
<span class='line'>9223</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">allContained</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">specialCase</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9224</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9225</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Update the ring counts for the vertices</span><span class="WHIT">
<span class='line'>9226</span> </span><span class="WHIT">  
<span class='line'>9227</span>   
<span class='line'>9228</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">pathSet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9229</span> </span><span class="WHIT">        </span><span class="NAME">arrRingCount</span><span class="PUNC">[</span><span class="NAME">element</span><span class="PUNC">]</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9230</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9231</span> </span><span class="WHIT">  
<span class='line'>9232</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9233</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9234</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9235</span>      * Checks whether or not two sets are equal (contain the same elements).
<span class='line'>9236</span>      * 
<span class='line'>9237</span>      * @param {Set&lt;Number>} setA A set.
<span class='line'>9238</span>      * @param {Set&lt;Number>} setB A set.
<span class='line'>9239</span>      * @returns {Boolean} A boolean indicating whether or not the two sets are equal.
<span class='line'>9240</span>      */</span><span class="WHIT">
<span class='line'>9241</span> </span><span class="WHIT">  
<span class='line'>9242</span>   
<span class='line'>9243</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">areSetsEqual</span><span class="PUNC">(</span><span class="NAME">setA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">setB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9244</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">setA.size</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">setB.size</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9245</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9246</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9247</span> </span><span class="WHIT">  
<span class='line'>9248</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">setA</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9249</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">setB.has</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9250</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9251</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9252</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9253</span> </span><span class="WHIT">  
<span class='line'>9254</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9255</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9256</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9257</span>      * Checks whether or not a set (setA) is a superset of another set (setB).
<span class='line'>9258</span>      * 
<span class='line'>9259</span>      * @param {Set&lt;Number>} setA A set.
<span class='line'>9260</span>      * @param {Set&lt;Number>} setB A set.
<span class='line'>9261</span>      * @returns {Boolean} A boolean indicating whether or not setB is a superset of setA.
<span class='line'>9262</span>      */</span><span class="WHIT">
<span class='line'>9263</span> </span><span class="WHIT">  
<span class='line'>9264</span>   
<span class='line'>9265</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">isSupersetOf</span><span class="PUNC">(</span><span class="NAME">setA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">setB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9266</span> </span><span class="WHIT">      </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">setB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9267</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">setA.has</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9268</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9269</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9270</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9271</span> </span><span class="WHIT">  
<span class='line'>9272</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9273</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9274</span> </span><span class="WHIT">  
<span class='line'>9275</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9276</span> </span><span class="WHIT">  
<span class='line'>9277</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SSSR</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9278</span> </span><span class="WHIT">  
<span class='line'>9279</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./Graph"</span><span class="PUNC">:</span><span class="NUMB">7</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">14</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9280</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9281</span> </span><span class="WHIT">  
<span class='line'>9282</span>   </span><span class="COMM">// we use the drawer to do all the preprocessing. then we take over the drawing</span><span class="WHIT">
<span class='line'>9283</span> </span><span class="WHIT">  </span><span class="COMM">// portion to output to svg</span><span class="WHIT">
<span class='line'>9284</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">ArrayHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./ArrayHelper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9285</span> </span><span class="WHIT">  
<span class='line'>9286</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Atom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Atom'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9287</span> </span><span class="WHIT">  
<span class='line'>9288</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Drawer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Drawer'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9289</span> </span><span class="WHIT">  
<span class='line'>9290</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Graph</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Graph'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9291</span> </span><span class="WHIT">  
<span class='line'>9292</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Line'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9293</span> </span><span class="WHIT">  
<span class='line'>9294</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">SvgWrapper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./SvgWrapper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9295</span> </span><span class="WHIT">  
<span class='line'>9296</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">ThemeManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./ThemeManager'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9297</span> </span><span class="WHIT">  
<span class='line'>9298</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vector2'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9299</span> </span><span class="WHIT">  
<span class='line'>9300</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">SvgDrawer</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9301</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9302</span> </span><span class="WHIT">      </span><span class="NAME">this.preprocessor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Drawer</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9303</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9304</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9305</span>      * Draws the parsed smiles data to an svg element.
<span class='line'>9306</span>      *
<span class='line'>9307</span>      * @param {Object} data The tree returned by the smiles parser.
<span class='line'>9308</span>      * @param {(String|HTMLElement)} target The id of the HTML svg element the structure is drawn to - or the element itself.
<span class='line'>9309</span>      * @param {String} themeName='dark' The name of the theme to use. Built-in themes are 'light' and 'dark'.
<span class='line'>9310</span>      * @param {Boolean} infoOnly=false Only output info on the molecule without drawing anything to the canvas.
<span class='line'>9311</span>        * @returns {Oject} The dimensions of the drawing in { width, height }
<span class='line'>9312</span>      */</span><span class="WHIT">
<span class='line'>9313</span> </span><span class="WHIT">  
<span class='line'>9314</span>   
<span class='line'>9315</span>     </span><span class="NAME">draw</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">themeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'light'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">infoOnly</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9316</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">preprocessor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.preprocessor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9317</span> </span><span class="WHIT">      </span><span class="NAME">preprocessor.initDraw</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">themeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">infoOnly</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9318</span> </span><span class="WHIT">  
<span class='line'>9319</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">infoOnly</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9320</span> </span><span class="WHIT">        </span><span class="NAME">this.themeManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ThemeManager</span><span class="PUNC">(</span><span class="NAME">this.preprocessor.opts.themes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">themeName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9321</span> </span><span class="WHIT">        </span><span class="NAME">this.svgWrapper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">SvgWrapper</span><span class="PUNC">(</span><span class="NAME">this.themeManager</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.preprocessor.opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9322</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9323</span> </span><span class="WHIT">  
<span class='line'>9324</span>       </span><span class="NAME">preprocessor.processGraph</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Set the canvas to the appropriate size</span><span class="WHIT">
<span class='line'>9325</span> </span><span class="WHIT">  
<span class='line'>9326</span>       </span><span class="NAME">this.svgWrapper.determineDimensions</span><span class="PUNC">(</span><span class="NAME">preprocessor.graph.vertices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Do the actual drawing</span><span class="WHIT">
<span class='line'>9327</span> </span><span class="WHIT">  
<span class='line'>9328</span>       </span><span class="NAME">this.drawEdges</span><span class="PUNC">(</span><span class="NAME">preprocessor.opts.debug</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9329</span> </span><span class="WHIT">      </span><span class="NAME">this.drawVertices</span><span class="PUNC">(</span><span class="NAME">preprocessor.opts.debug</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9330</span> </span><span class="WHIT">  
<span class='line'>9331</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">preprocessor.opts.debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9332</span> </span><span class="WHIT">        </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">preprocessor.graph</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9333</span> </span><span class="WHIT">        </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">preprocessor.rings</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9334</span> </span><span class="WHIT">        </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">preprocessor.ringConnections</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9335</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9336</span> </span><span class="WHIT">  
<span class='line'>9337</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.svgWrapper.constructSvg</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9338</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9339</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9340</span>      * Draws a ring inside a provided ring, indicating aromaticity.
<span class='line'>9341</span>      *
<span class='line'>9342</span>      * @param {Ring} ring A ring.
<span class='line'>9343</span>      */</span><span class="WHIT">
<span class='line'>9344</span> </span><span class="WHIT">  
<span class='line'>9345</span>   
<span class='line'>9346</span>     </span><span class="NAME">drawAromaticityRing</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9347</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9348</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.apothemFromSideLength</span><span class="PUNC">(</span><span class="NAME">this.opts.bondLength</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9349</span> </span><span class="WHIT">      </span><span class="NAME">ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9350</span> </span><span class="WHIT">      </span><span class="NAME">ctx.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColor</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9351</span> </span><span class="WHIT">      </span><span class="NAME">ctx.lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondThickness</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9352</span> </span><span class="WHIT">      </span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9353</span> </span><span class="WHIT">      </span><span class="NAME">ctx.arc</span><span class="PUNC">(</span><span class="NAME">ring.center.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ring.center.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.opts.bondSpacing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9354</span> </span><span class="WHIT">      </span><span class="NAME">ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9355</span> </span><span class="WHIT">      </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9356</span> </span><span class="WHIT">      </span><span class="NAME">ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9357</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9358</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9359</span>      * Draw the actual edges as bonds.
<span class='line'>9360</span>      *
<span class='line'>9361</span>      * @param {Boolean} debug A boolean indicating whether or not to draw debug helpers.
<span class='line'>9362</span>      */</span><span class="WHIT">
<span class='line'>9363</span> </span><span class="WHIT">  
<span class='line'>9364</span>   
<span class='line'>9365</span>     </span><span class="NAME">drawEdges</span><span class="PUNC">(</span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9366</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">preprocessor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.preprocessor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9367</span> </span><span class="WHIT">          </span><span class="NAME">graph</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.graph</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9368</span> </span><span class="WHIT">          </span><span class="NAME">rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.rings</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9369</span> </span><span class="WHIT">          </span><span class="NAME">drawn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">this.preprocessor.graph.edges.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9370</span> </span><span class="WHIT">      </span><span class="NAME">drawn.fill</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9371</span> </span><span class="WHIT">      </span><span class="NAME">graph.traverseBF</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9372</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edges</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">graph.getEdges</span><span class="PUNC">(</span><span class="NAME">vertex.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9373</span> </span><span class="WHIT">  
<span class='line'>9374</span>         </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">edges.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9375</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edges</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9376</span> </span><span class="WHIT">  
<span class='line'>9377</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">drawn</span><span class="PUNC">[</span><span class="NAME">edgeId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9378</span> </span><span class="WHIT">            </span><span class="NAME">drawn</span><span class="PUNC">[</span><span class="NAME">edgeId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9379</span> </span><span class="WHIT">            </span><span class="NAME">this.drawEdge</span><span class="PUNC">(</span><span class="NAME">edgeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debug</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9380</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9381</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9382</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Draw ring for implicitly defined aromatic rings</span><span class="WHIT">
<span class='line'>9383</span> </span><span class="WHIT">  
<span class='line'>9384</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.bridgedRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9385</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9386</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ring</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9387</span> </span><span class="WHIT">  
<span class='line'>9388</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">preprocessor.isRingAromatic</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9389</span> </span><span class="WHIT">            </span><span class="NAME">this.drawAromaticityRing</span><span class="PUNC">(</span><span class="NAME">ring</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9390</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9391</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9392</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9393</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9394</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9395</span>      * Draw the an edge as a bond.
<span class='line'>9396</span>      *
<span class='line'>9397</span>      * @param {Number} edgeId An edge id.
<span class='line'>9398</span>      * @param {Boolean} debug A boolean indicating whether or not to draw debug helpers.
<span class='line'>9399</span>      */</span><span class="WHIT">
<span class='line'>9400</span> </span><span class="WHIT">  
<span class='line'>9401</span>   
<span class='line'>9402</span>     </span><span class="NAME">drawEdge</span><span class="PUNC">(</span><span class="NAME">edgeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9403</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">preprocessor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.preprocessor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9404</span> </span><span class="WHIT">          </span><span class="NAME">opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.opts</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9405</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.svgWrapper</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9406</span> </span><span class="WHIT">          </span><span class="NAME">edge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.graph.edges</span><span class="PUNC">[</span><span class="NAME">edgeId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9407</span> </span><span class="WHIT">          </span><span class="NAME">vertexA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.sourceId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9408</span> </span><span class="WHIT">          </span><span class="NAME">vertexB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.graph.vertices</span><span class="PUNC">[</span><span class="NAME">edge.targetId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9409</span> </span><span class="WHIT">          </span><span class="NAME">elementA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexA.value.element</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9410</span> </span><span class="WHIT">          </span><span class="NAME">elementB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexB.value.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9411</span> </span><span class="WHIT">  
<span class='line'>9412</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertexA.value.isDrawn</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">vertexB.value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">preprocessor.opts.atomVisualization</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'default'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9413</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9414</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9415</span> </span><span class="WHIT">  
<span class='line'>9416</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9417</span> </span><span class="WHIT">          </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9418</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.getEdgeNormals</span><span class="PUNC">(</span><span class="NAME">edge</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9419</span> </span><span class="WHIT">          </span><span class="COMM">// Create a point on each side of the line</span><span class="WHIT">
<span class='line'>9420</span> </span><span class="WHIT">      </span><span class="NAME">sides</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.clone</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9421</span> </span><span class="WHIT">      </span><span class="NAME">sides</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9422</span> </span><span class="WHIT">      </span><span class="NAME">sides</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9423</span> </span><span class="WHIT">  
<span class='line'>9424</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'='</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">preprocessor.getRingbondType</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'='</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">edge.isPartOfAromaticRing</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">preprocessor.bridgedRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9425</span> </span><span class="WHIT">        </span><span class="COMM">// Always draw double bonds inside the ring</span><span class="WHIT">
<span class='line'>9426</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">inRing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.areVerticesInSameRing</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9427</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.chooseSide</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sides</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9428</span> </span><span class="WHIT">  
<span class='line'>9429</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">inRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9430</span> </span><span class="WHIT">          </span><span class="COMM">// Always draw double bonds inside a ring</span><span class="WHIT">
<span class='line'>9431</span> </span><span class="WHIT">          </span><span class="COMM">// if the bond is shared by two rings, it is drawn in the larger</span><span class="WHIT">
<span class='line'>9432</span> </span><span class="WHIT">          </span><span class="COMM">// problem: smaller ring is aromatic, bond is still drawn in larger -> fix this</span><span class="WHIT">
<span class='line'>9433</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lcr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.getLargestOrAromaticCommonRing</span><span class="PUNC">(</span><span class="NAME">vertexA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9434</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lcr.center</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9435</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9436</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Choose the normal that is on the same side as the center</span><span class="WHIT">
<span class='line'>9437</span> </span><span class="WHIT">  
<span class='line'>9438</span>           </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9439</span> </span><span class="WHIT">  
<span class='line'>9440</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">center.sameSideAs</span><span class="PUNC">(</span><span class="NAME">vertexA.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexB.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9441</span> </span><span class="WHIT">            </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9442</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9443</span> </span><span class="WHIT">            </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9444</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9445</span> </span><span class="WHIT">  
<span class='line'>9446</span>           </span><span class="NAME">line.shorten</span><span class="PUNC">(</span><span class="NAME">opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">opts.shortBondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">opts.bondLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// The shortened edge</span><span class="WHIT">
<span class='line'>9447</span> </span><span class="WHIT">  
<span class='line'>9448</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.isPartOfAromaticRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9449</span> </span><span class="WHIT">            </span><span class="COMM">// preprocessor.canvasWrapper.drawLine(line, true);</span><span class="WHIT">
<span class='line'>9450</span> </span><span class="WHIT">            </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9451</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9452</span> </span><span class="WHIT">            </span><span class="COMM">// preprocessor.canvasWrapper.drawLine(line);</span><span class="WHIT">
<span class='line'>9453</span> </span><span class="WHIT">            </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9454</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9455</span> </span><span class="WHIT">  
<span class='line'>9456</span>           </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9457</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.center</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">vertexA.isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertexB.isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">s.anCount</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">s.bnCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">s.bnCount</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">s.anCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9458</span> </span><span class="WHIT">          </span><span class="NAME">this.multiplyNormals</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts.halfBondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9459</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lineA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9460</span> </span><span class="WHIT">              </span><span class="NAME">lineB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9461</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">lineA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9462</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">lineB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9463</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s.sideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">s.sideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">s.totalSideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">s.totalSideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9464</span> </span><span class="WHIT">          </span><span class="NAME">this.multiplyNormals</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9465</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9466</span> </span><span class="WHIT">          </span><span class="NAME">line.shorten</span><span class="PUNC">(</span><span class="NAME">opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">opts.shortBondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">opts.bondLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9467</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9468</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9469</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s.sideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">s.sideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">s.totalSideCount</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">s.totalSideCount</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9470</span> </span><span class="WHIT">          </span><span class="NAME">this.multiplyNormals</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opts.bondSpacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9471</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9472</span> </span><span class="WHIT">          </span><span class="NAME">line.shorten</span><span class="PUNC">(</span><span class="NAME">opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">opts.shortBondLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">opts.bondLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9473</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9474</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9475</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9476</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'#'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9477</span> </span><span class="WHIT">        </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">opts.bondSpacing</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9478</span> </span><span class="WHIT">        </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">opts.bondSpacing</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9479</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lineA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9480</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">lineB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9481</span> </span><span class="WHIT">        </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">lineA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9482</span> </span><span class="WHIT">        </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="NAME">lineB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9483</span> </span><span class="WHIT">        </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9484</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.bondType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'.'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="COMM">// TODO: Something... maybe... version 2?</span><span class="WHIT">
<span class='line'>9485</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9486</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isChiralCenterA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexA.value.isStereoCenter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9487</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isChiralCenterB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertexB.value.isStereoCenter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9488</span> </span><span class="WHIT">  
<span class='line'>9489</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.wedge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9490</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawWedge</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9491</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">edge.wedge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9492</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawDashedWedge</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9493</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9494</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChiralCenterB</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9495</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9496</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9497</span> </span><span class="WHIT">  
<span class='line'>9498</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9499</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">midpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.midpoint</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9500</span> </span><span class="WHIT">        </span><span class="NAME">svgWrapper.drawDebugText</span><span class="PUNC">(</span><span class="NAME">midpoint.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midpoint.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'e: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9501</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9502</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9503</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9504</span>      * Draws the vertices representing atoms to the canvas.
<span class='line'>9505</span>      *
<span class='line'>9506</span>      * @param {Boolean} debug A boolean indicating whether or not to draw debug messages to the canvas.
<span class='line'>9507</span>      */</span><span class="WHIT">
<span class='line'>9508</span> </span><span class="WHIT">  
<span class='line'>9509</span>   
<span class='line'>9510</span>     </span><span class="NAME">drawVertices</span><span class="PUNC">(</span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9511</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">preprocessor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.preprocessor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9512</span> </span><span class="WHIT">          </span><span class="NAME">opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.opts</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9513</span> </span><span class="WHIT">          </span><span class="NAME">graph</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.graph</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9514</span> </span><span class="WHIT">          </span><span class="NAME">rings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preprocessor.rings</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9515</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.svgWrapper</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9516</span> </span><span class="WHIT">      </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9517</span> </span><span class="WHIT">  
<span class='line'>9518</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">graph.vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9519</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">graph.vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9520</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">atom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9521</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9522</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isotope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9523</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bondCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.value.bondCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9524</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9525</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Atom.maxBonds</span><span class="PUNC">[</span><span class="NAME">element</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">bondCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9526</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertex.getTextDirection</span><span class="PUNC">(</span><span class="NAME">graph.vertices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9527</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">opts.terminalCarbons</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">atom.hasAttachedPseudoElements</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">vertex.isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9528</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isCarbon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// This is a HACK to remove all hydrogens from nitrogens in aromatic rings, as this</span><span class="WHIT">
<span class='line'>9529</span> </span><span class="WHIT">        </span><span class="COMM">// should be the most common state. This has to be fixed by kekulization</span><span class="WHIT">
<span class='line'>9530</span> </span><span class="WHIT">  
<span class='line'>9531</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.element</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'N'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">atom.isPartOfAromaticRing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9532</span> </span><span class="WHIT">          </span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9533</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9534</span> </span><span class="WHIT">  
<span class='line'>9535</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.bracket</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9536</span> </span><span class="WHIT">          </span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.bracket.hcount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9537</span> </span><span class="WHIT">          </span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.bracket.charge</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9538</span> </span><span class="WHIT">          </span><span class="NAME">isotope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atom.bracket.isotope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9539</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9540</span> </span><span class="WHIT">  
<span class='line'>9541</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts.atomVisualization</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'allballs'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9542</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawBall</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9543</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atom.isDrawn</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isCarbon</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">atom.drawExplicit</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">atom.hasAttachedPseudoElements</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">graph.vertices.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9544</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts.atomVisualization</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'default'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9545</span> </span><span class="WHIT">            </span><span class="NAME">svgWrapper.drawText</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hydrogens</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isotope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atom.getAttachedPseudoElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9546</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts.atomVisualization</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'balls'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9547</span> </span><span class="WHIT">            </span><span class="NAME">svgWrapper.drawBall</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9548</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9549</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertex.getNeighbourCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">vertex.forcePositioned</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9550</span> </span><span class="WHIT">          </span><span class="COMM">// If there is a carbon which bonds are in a straight line, draw a dot</span><span class="WHIT">
<span class='line'>9551</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertex.neighbours</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9552</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">graph.vertices</span><span class="PUNC">[</span><span class="NAME">vertex.neighbours</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9553</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.threePointangle</span><span class="PUNC">(</span><span class="NAME">vertex.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9554</span> </span><span class="WHIT">  
<span class='line'>9555</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9556</span> </span><span class="WHIT">            </span><span class="NAME">svgWrapper.drawPoint</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9557</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9558</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9559</span> </span><span class="WHIT">  
<span class='line'>9560</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9561</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'v: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">' '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.print</span><span class="PUNC">(</span><span class="NAME">atom.ringbonds</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9562</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawDebugText</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9563</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9564</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawDebugText</span><span class="PUNC">(</span><span class="NAME">vertex.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.position.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertex.value.chirality</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9565</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9566</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Draw the ring centers for debug purposes</span><span class="WHIT">
<span class='line'>9567</span> </span><span class="WHIT">  
<span class='line'>9568</span>   
<span class='line'>9569</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opts.debug</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9570</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">rings.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9571</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">center</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">center</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9572</span> </span><span class="WHIT">          </span><span class="NAME">svgWrapper.drawDebugPoint</span><span class="PUNC">(</span><span class="NAME">center.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'r: '</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">rings</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9573</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9574</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9575</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9576</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9577</span>      * Returns the total overlap score of the current molecule.
<span class='line'>9578</span>      *
<span class='line'>9579</span>      * @returns {Number} The overlap score.
<span class='line'>9580</span>      */</span><span class="WHIT">
<span class='line'>9581</span> </span><span class="WHIT">  
<span class='line'>9582</span>   
<span class='line'>9583</span>     </span><span class="NAME">getTotalOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9584</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.preprocessor.getTotalOverlapScore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9585</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9586</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9587</span>      * Returns the molecular formula of the loaded molecule as a string.
<span class='line'>9588</span>      *
<span class='line'>9589</span>      * @returns {String} The molecular formula.
<span class='line'>9590</span>      */</span><span class="WHIT">
<span class='line'>9591</span> </span><span class="WHIT">  
<span class='line'>9592</span>   
<span class='line'>9593</span>     </span><span class="NAME">getMolecularFormula</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9594</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.preprocessor.getMolecularFormula</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9595</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9596</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9597</span>      * @param {Array} normals list of normals to multiply
<span class='line'>9598</span>      * @param {Number} spacing value to multiply normals by
<span class='line'>9599</span>      */</span><span class="WHIT">
<span class='line'>9600</span> </span><span class="WHIT">  
<span class='line'>9601</span>   
<span class='line'>9602</span>     </span><span class="NAME">multiplyNormals</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">spacing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9603</span> </span><span class="WHIT">      </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">spacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9604</span> </span><span class="WHIT">      </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">spacing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9605</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9606</span> </span><span class="WHIT">  
<span class='line'>9607</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9608</span> </span><span class="WHIT">  
<span class='line'>9609</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SvgDrawer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9610</span> </span><span class="WHIT">  
<span class='line'>9611</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./ArrayHelper"</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">"./Atom"</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="STRN">"./Drawer"</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="STRN">"./Graph"</span><span class="PUNC">:</span><span class="NUMB">7</span><span class="PUNC">,</span><span class="STRN">"./Line"</span><span class="PUNC">:</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="STRN">"./SvgWrapper"</span><span class="PUNC">:</span><span class="NUMB">15</span><span class="PUNC">,</span><span class="STRN">"./ThemeManager"</span><span class="PUNC">:</span><span class="NUMB">16</span><span class="PUNC">,</span><span class="STRN">"./Vector2"</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">15</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9612</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9613</span> </span><span class="WHIT">  
<span class='line'>9614</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9615</span> </span><span class="WHIT">    </span><span class="NAME">getChargeText</span><span class="WHIT">
<span class='line'>9616</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./UtilityFunctions'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9617</span> </span><span class="WHIT">  
<span class='line'>9618</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Line'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9619</span> </span><span class="WHIT">  
<span class='line'>9620</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vector2'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9621</span> </span><span class="WHIT">  
<span class='line'>9622</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">SvgWrapper</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9623</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">themeManager</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9624</span> </span><span class="WHIT">      </span><span class="NAME">this.svg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">target</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9625</span> </span><span class="WHIT">      </span><span class="NAME">this.opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9626</span> </span><span class="WHIT">      </span><span class="NAME">this.gradientId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// maintain a list of line elements and their corresponding gradients</span><span class="WHIT">
<span class='line'>9627</span> </span><span class="WHIT">      </span><span class="COMM">// maintain a list of vertex elements</span><span class="WHIT">
<span class='line'>9628</span> </span><span class="WHIT">  
<span class='line'>9629</span>       </span><span class="NAME">this.paths</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9630</span> </span><span class="WHIT">      </span><span class="NAME">this.vertices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9631</span> </span><span class="WHIT">      </span><span class="NAME">this.gradients</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// maintain the offset for drawing purposes</span><span class="WHIT">
<span class='line'>9632</span> </span><span class="WHIT">  
<span class='line'>9633</span>       </span><span class="NAME">this.offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9634</span> </span><span class="WHIT">      </span><span class="NAME">this.offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// maintain the dimensions</span><span class="WHIT">
<span class='line'>9635</span> </span><span class="WHIT">  
<span class='line'>9636</span>       </span><span class="NAME">this.drawingWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9637</span> </span><span class="WHIT">      </span><span class="NAME">this.drawingHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9638</span> </span><span class="WHIT">      </span><span class="NAME">this.halfBondThickness</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.bondThickness</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// for managing color schemes</span><span class="WHIT">
<span class='line'>9639</span> </span><span class="WHIT">  
<span class='line'>9640</span>       </span><span class="NAME">this.themeManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">themeManager</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// create the mask</span><span class="WHIT">
<span class='line'>9641</span> </span><span class="WHIT">  
<span class='line'>9642</span>       </span><span class="NAME">this.maskElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9643</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">mask</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'rect'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9644</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'x'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9645</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'y'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9646</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'width'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'100%'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9647</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'height'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'100%'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9648</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'white'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9649</span> </span><span class="WHIT">      </span><span class="NAME">this.maskElements.push</span><span class="PUNC">(</span><span class="NAME">mask</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// clear the svg element</span><span class="WHIT">
<span class='line'>9650</span> </span><span class="WHIT">  
<span class='line'>9651</span>       </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.svg.firstChild</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9652</span> </span><span class="WHIT">        </span><span class="NAME">this.svg.removeChild</span><span class="PUNC">(</span><span class="NAME">this.svg.firstChild</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9653</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9654</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9655</span> </span><span class="WHIT">  
<span class='line'>9656</span>     </span><span class="NAME">constructSvg</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9657</span> </span><span class="WHIT">      </span><span class="COMM">// TODO: add the defs element to put gradients in</span><span class="WHIT">
<span class='line'>9658</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">defs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'defs'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9659</span> </span><span class="WHIT">          </span><span class="NAME">masks</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'mask'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9660</span> </span><span class="WHIT">          </span><span class="NAME">style</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'style'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9661</span> </span><span class="WHIT">          </span><span class="NAME">paths</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'g'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9662</span> </span><span class="WHIT">          </span><span class="NAME">vertices</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'g'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9663</span> </span><span class="WHIT">          </span><span class="NAME">pathChildNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.paths</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// give the mask an id</span><span class="WHIT">
<span class='line'>9664</span> </span><span class="WHIT">  
<span class='line'>9665</span>       </span><span class="NAME">masks.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'id'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'text-mask'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// create the css styles</span><span class="WHIT">
<span class='line'>9666</span> </span><span class="WHIT">  
<span class='line'>9667</span>       </span><span class="NAME">style.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="TOKN">`</span><span class="WHIT">
<span class='line'>9668</span> </span><span class="WHIT">                  </span><span class="PUNC">.</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9669</span> </span><span class="WHIT">                      </span><span class="NAME">font</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">this.opts.fontSizeLarge</span><span class="PUNC">}</span><span class="NAME">pt</span><span class="WHIT"> </span><span class="NAME">Helvetica</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Arial</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sans</span><span class="PUNC">-</span><span class="NAME">serif</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9670</span> </span><span class="WHIT">                      </span><span class="NAME">alignment</span><span class="PUNC">-</span><span class="NAME">baseline</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'middle'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9671</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9672</span> </span><span class="WHIT">                  </span><span class="PUNC">.</span><span class="NAME">sub</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9673</span> </span><span class="WHIT">                      </span><span class="NAME">font</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">this.opts.fontSizeSmall</span><span class="PUNC">}</span><span class="NAME">pt</span><span class="WHIT"> </span><span class="NAME">Helvetica</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Arial</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sans</span><span class="PUNC">-</span><span class="NAME">serif</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9674</span> </span><span class="WHIT">                  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9675</span> </span><span class="WHIT">              </span><span class="TOKN">`</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9676</span> </span><span class="WHIT">  
<span class='line'>9677</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">path</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">pathChildNodes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9678</span> </span><span class="WHIT">        </span><span class="NAME">paths.appendChild</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9679</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9680</span> </span><span class="WHIT">  
<span class='line'>9681</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vertex</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">this.vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9682</span> </span><span class="WHIT">        </span><span class="NAME">vertices.appendChild</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9683</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9684</span> </span><span class="WHIT">  
<span class='line'>9685</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">mask</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">this.maskElements</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9686</span> </span><span class="WHIT">        </span><span class="NAME">masks.appendChild</span><span class="PUNC">(</span><span class="NAME">mask</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9687</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9688</span> </span><span class="WHIT">  
<span class='line'>9689</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">gradient</span><span class="WHIT"> </span><span class="NAME">of</span><span class="WHIT"> </span><span class="NAME">this.gradients</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9690</span> </span><span class="WHIT">        </span><span class="NAME">defs.appendChild</span><span class="PUNC">(</span><span class="NAME">gradient</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9691</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9692</span> </span><span class="WHIT">  
<span class='line'>9693</span>       </span><span class="NAME">paths.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'mask'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'url(#text-mask)'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9694</span> </span><span class="WHIT">  
<span class='line'>9695</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.svg</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9696</span> </span><span class="WHIT">        </span><span class="NAME">this.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">defs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9697</span> </span><span class="WHIT">        </span><span class="NAME">this.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">masks</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9698</span> </span><span class="WHIT">        </span><span class="NAME">this.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9699</span> </span><span class="WHIT">        </span><span class="NAME">this.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">paths</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9700</span> </span><span class="WHIT">        </span><span class="NAME">this.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9701</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.svg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9702</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9703</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'g'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9704</span> </span><span class="WHIT">        </span><span class="NAME">container.appendChild</span><span class="PUNC">(</span><span class="NAME">defs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9705</span> </span><span class="WHIT">        </span><span class="NAME">container.appendChild</span><span class="PUNC">(</span><span class="NAME">masks</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9706</span> </span><span class="WHIT">        </span><span class="NAME">container.appendChild</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9707</span> </span><span class="WHIT">        </span><span class="NAME">container.appendChild</span><span class="PUNC">(</span><span class="NAME">paths</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9708</span> </span><span class="WHIT">        </span><span class="NAME">container.appendChild</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9709</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9710</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9711</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9712</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9713</span>      * Create a linear gradient to apply to a line
<span class='line'>9714</span>      *
<span class='line'>9715</span>      * @param {Line} line the line to apply the gradiation to.
<span class='line'>9716</span>      */</span><span class="WHIT">
<span class='line'>9717</span> </span><span class="WHIT">  
<span class='line'>9718</span>   
<span class='line'>9719</span>     </span><span class="NAME">createGradient</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9720</span> </span><span class="WHIT">      </span><span class="COMM">// create the gradient and add it</span><span class="WHIT">
<span class='line'>9721</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">gradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'linearGradient'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9722</span> </span><span class="WHIT">          </span><span class="NAME">gradientUrl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="TOKN">`</span><span class="NAME">line</span><span class="PUNC">-</span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">this.gradientId</span><span class="PUNC">++</span><span class="PUNC">}</span><span class="TOKN">`</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9723</span> </span><span class="WHIT">          </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9724</span> </span><span class="WHIT">          </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9725</span> </span><span class="WHIT">          </span><span class="NAME">fromX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9726</span> </span><span class="WHIT">          </span><span class="NAME">fromY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9727</span> </span><span class="WHIT">          </span><span class="NAME">toX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9728</span> </span><span class="WHIT">          </span><span class="NAME">toY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9729</span> </span><span class="WHIT">      </span><span class="NAME">gradient.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'id'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gradientUrl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9730</span> </span><span class="WHIT">      </span><span class="NAME">gradient.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'gradientUnits'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'userSpaceOnUse'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9731</span> </span><span class="WHIT">      </span><span class="NAME">gradient.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'x1'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fromX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9732</span> </span><span class="WHIT">      </span><span class="NAME">gradient.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'y1'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fromY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9733</span> </span><span class="WHIT">      </span><span class="NAME">gradient.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'x2'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9734</span> </span><span class="WHIT">      </span><span class="NAME">gradient.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'y2'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9735</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">firstStop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'stop'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9736</span> </span><span class="WHIT">      </span><span class="NAME">firstStop.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'stop-color'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">line.getLeftElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9737</span> </span><span class="WHIT">      </span><span class="NAME">firstStop.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'offset'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'20%'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9738</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">secondStop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'stop'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9739</span> </span><span class="WHIT">      </span><span class="NAME">secondStop.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'stop-color'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">line.getRightElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="STRN">'C'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9740</span> </span><span class="WHIT">      </span><span class="NAME">secondStop.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'offset'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'100%'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9741</span> </span><span class="WHIT">      </span><span class="NAME">gradient.appendChild</span><span class="PUNC">(</span><span class="NAME">firstStop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9742</span> </span><span class="WHIT">      </span><span class="NAME">gradient.appendChild</span><span class="PUNC">(</span><span class="NAME">secondStop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9743</span> </span><span class="WHIT">      </span><span class="NAME">this.gradients.push</span><span class="PUNC">(</span><span class="NAME">gradient</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9744</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gradientUrl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9745</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9746</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9747</span>      * Create a tspan element for sub or super scripts that styles the text
<span class='line'>9748</span>      * appropriately as one of those text types.
<span class='line'>9749</span>      *
<span class='line'>9750</span>      * @param {String} text the actual text
<span class='line'>9751</span>      * @param {String} shift the type of text, either 'sub', or 'super'
<span class='line'>9752</span>      */</span><span class="WHIT">
<span class='line'>9753</span> </span><span class="WHIT">  
<span class='line'>9754</span>   
<span class='line'>9755</span>     </span><span class="NAME">createSubSuperScripts</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">shift</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9756</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'tspan'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9757</span> </span><span class="WHIT">      </span><span class="NAME">elem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'baseline-shift'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">shift</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9758</span> </span><span class="WHIT">      </span><span class="NAME">elem.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9759</span> </span><span class="WHIT">      </span><span class="NAME">elem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'class'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'sub'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9760</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">elem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9761</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9762</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9763</span>      * Determine drawing dimensiosn based on vertex positions.
<span class='line'>9764</span>      *
<span class='line'>9765</span>      * @param {Vertex[]} vertices An array of vertices containing the vertices associated with the current molecule.
<span class='line'>9766</span>      */</span><span class="WHIT">
<span class='line'>9767</span> </span><span class="WHIT">  
<span class='line'>9768</span>   
<span class='line'>9769</span>     </span><span class="NAME">determineDimensions</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9770</span> </span><span class="WHIT">      </span><span class="COMM">// Figure out the final size of the image</span><span class="WHIT">
<span class='line'>9771</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9772</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9773</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9774</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number.MAX_VALUE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9775</span> </span><span class="WHIT">  
<span class='line'>9776</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vertices.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9777</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9778</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9779</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9780</span> </span><span class="WHIT">  
<span class='line'>9781</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9782</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">p.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9783</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">p.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9784</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">p.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9785</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">p.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9786</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// Add padding</span><span class="WHIT">
<span class='line'>9787</span> </span><span class="WHIT">  
<span class='line'>9788</span>   
<span class='line'>9789</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">padding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts.padding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9790</span> </span><span class="WHIT">      </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">padding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9791</span> </span><span class="WHIT">      </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">padding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9792</span> </span><span class="WHIT">      </span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">padding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9793</span> </span><span class="WHIT">      </span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">padding</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9794</span> </span><span class="WHIT">      </span><span class="NAME">this.drawingWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">minX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9795</span> </span><span class="WHIT">      </span><span class="NAME">this.drawingHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">minY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9796</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">scaleX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.svg.clientWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.drawingWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9797</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">scaleY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.svg.clientHeight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.drawingHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9798</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scaleX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">scaleY</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">scaleX</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">scaleY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9799</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">viewBoxDim</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">this.drawingWidth</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.drawingHeight</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.drawingWidth</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.drawingHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9800</span> </span><span class="WHIT">      </span><span class="NAME">this.svg.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'viewBox'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="TOKN">`</span><span class="NUMB">0</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">viewBoxDim</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">viewBoxDim</span><span class="PUNC">}</span><span class="TOKN">`</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9801</span> </span><span class="WHIT">      </span><span class="NAME">this.offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">minX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9802</span> </span><span class="WHIT">      </span><span class="NAME">this.offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">minY</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Center</span><span class="WHIT">
<span class='line'>9803</span> </span><span class="WHIT">  
<span class='line'>9804</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scaleX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">scaleY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9805</span> </span><span class="WHIT">        </span><span class="NAME">this.offsetY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.svg.clientHeight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.drawingHeight</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9806</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9807</span> </span><span class="WHIT">        </span><span class="NAME">this.offsetX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.svg.clientWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.drawingWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9808</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9809</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9810</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9811</span>      * Draw an svg ellipse as a ball.
<span class='line'>9812</span>      *
<span class='line'>9813</span>      * @param {Number} x The x position of the text.
<span class='line'>9814</span>      * @param {Number} y The y position of the text.
<span class='line'>9815</span>      * @param {String} elementName The name of the element (single-letter).
<span class='line'>9816</span>      */</span><span class="WHIT">
<span class='line'>9817</span> </span><span class="WHIT">  
<span class='line'>9818</span>   
<span class='line'>9819</span>     </span><span class="NAME">drawBall</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9820</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ball</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'circle'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9821</span> </span><span class="WHIT">      </span><span class="NAME">ball.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cx'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9822</span> </span><span class="WHIT">      </span><span class="NAME">ball.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cy'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9823</span> </span><span class="WHIT">      </span><span class="NAME">ball.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'r'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.opts.bondLength</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">4.5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9824</span> </span><span class="WHIT">      </span><span class="NAME">ball.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9825</span> </span><span class="WHIT">      </span><span class="NAME">this.vertices.push</span><span class="PUNC">(</span><span class="NAME">ball</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9826</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9827</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9828</span>      * Draw a dashed wedge on the canvas.
<span class='line'>9829</span>      *
<span class='line'>9830</span>      * @param {Line} line A line.
<span class='line'>9831</span>      */</span><span class="WHIT">
<span class='line'>9832</span> </span><span class="WHIT">  
<span class='line'>9833</span>   
<span class='line'>9834</span>     </span><span class="NAME">drawDashedWedge</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9835</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.from.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.from.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.to.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">line.to.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9836</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9837</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9838</span> </span><span class="WHIT">  
<span class='line'>9839</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9840</span> </span><span class="WHIT">          </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9841</span> </span><span class="WHIT">          </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9842</span> </span><span class="WHIT">          </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9843</span> </span><span class="WHIT">          </span><span class="NAME">normals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.normals</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9844</span> </span><span class="WHIT">      </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9845</span> </span><span class="WHIT">      </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9846</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isRightChiralCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightChiral</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9847</span> </span><span class="WHIT">          </span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9848</span> </span><span class="WHIT">          </span><span class="NAME">end</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9849</span> </span><span class="WHIT">  
<span class='line'>9850</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isRightChiralCenter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9851</span> </span><span class="WHIT">        </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9852</span> </span><span class="WHIT">        </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9853</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9854</span> </span><span class="WHIT">        </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9855</span> </span><span class="WHIT">        </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9856</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9857</span> </span><span class="WHIT">  
<span class='line'>9858</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">end</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9859</span> </span><span class="WHIT">          </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getLength</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9860</span> </span><span class="WHIT">          </span><span class="NAME">step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.25</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opts.bondThickness</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">3.0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9861</span> </span><span class="WHIT">          </span><span class="NAME">changed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9862</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">gradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createGradient</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9863</span> </span><span class="WHIT">  
<span class='line'>9864</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">step</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9865</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">dir</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9866</span> </span><span class="WHIT">            </span><span class="NAME">startDash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9867</span> </span><span class="WHIT">            </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9868</span> </span><span class="WHIT">            </span><span class="NAME">dashOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9869</span> </span><span class="WHIT">        </span><span class="NAME">startDash.subtract</span><span class="PUNC">(</span><span class="NAME">dashOffset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9870</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">endDash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startDash.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9871</span> </span><span class="WHIT">        </span><span class="NAME">endDash.add</span><span class="PUNC">(</span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">dashOffset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9872</span> </span><span class="WHIT">        </span><span class="NAME">this.drawLine</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="PUNC">(</span><span class="NAME">startDash</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endDash</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gradient</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9873</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9874</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9875</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9876</span>      * Draws a debug dot at a given coordinate and adds text.
<span class='line'>9877</span>      *
<span class='line'>9878</span>      * @param {Number} x The x coordinate.
<span class='line'>9879</span>      * @param {Number} y The y coordindate.
<span class='line'>9880</span>      * @param {String} [debugText=''] A string.
<span class='line'>9881</span>      * @param {String} [color='#f00'] A color in hex form.
<span class='line'>9882</span>      */</span><span class="WHIT">
<span class='line'>9883</span> </span><span class="WHIT">  
<span class='line'>9884</span>   
<span class='line'>9885</span>     </span><span class="NAME">drawDebugPoint</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debugText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'#f00'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9886</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'circle'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9887</span> </span><span class="WHIT">      </span><span class="NAME">point.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cx'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9888</span> </span><span class="WHIT">      </span><span class="NAME">point.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cy'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9889</span> </span><span class="WHIT">      </span><span class="NAME">point.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'r'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'2'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9890</span> </span><span class="WHIT">      </span><span class="NAME">point.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'#f00'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9891</span> </span><span class="WHIT">      </span><span class="NAME">this.vertices.push</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9892</span> </span><span class="WHIT">      </span><span class="NAME">this.drawDebugText</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">debugText</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9893</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9894</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9895</span>      * Draws a debug text message at a given position
<span class='line'>9896</span>      *
<span class='line'>9897</span>      * @param {Number} x The x coordinate.
<span class='line'>9898</span>      * @param {Number} y The y coordinate.
<span class='line'>9899</span>      * @param {String} text The debug text.
<span class='line'>9900</span>      */</span><span class="WHIT">
<span class='line'>9901</span> </span><span class="WHIT">  
<span class='line'>9902</span>   
<span class='line'>9903</span>     </span><span class="NAME">drawDebugText</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">text</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9904</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">textElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'text'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9905</span> </span><span class="WHIT">      </span><span class="NAME">textElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'x'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9906</span> </span><span class="WHIT">      </span><span class="NAME">textElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'y'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9907</span> </span><span class="WHIT">      </span><span class="NAME">textElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'class'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'debug'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9908</span> </span><span class="WHIT">      </span><span class="NAME">textElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'#ff0000'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9909</span> </span><span class="WHIT">      </span><span class="NAME">textElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="TOKN">`</span><span class="WHIT">
<span class='line'>9910</span> </span><span class="WHIT">                  </span><span class="NAME">font</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="NAME">px</span><span class="WHIT"> </span><span class="NAME">Droid</span><span class="WHIT"> </span><span class="NAME">Sans</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sans</span><span class="PUNC">-</span><span class="NAME">serif</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9911</span> </span><span class="WHIT">              </span><span class="TOKN">`</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9912</span> </span><span class="WHIT">      </span><span class="NAME">textElem.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="NAME">text</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9913</span> </span><span class="WHIT">      </span><span class="NAME">this.vertices.push</span><span class="PUNC">(</span><span class="NAME">textElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9914</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9915</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9916</span>      * Draws a line.
<span class='line'>9917</span>      *
<span class='line'>9918</span>      * @param {Line} line A line.
<span class='line'>9919</span>      * @param {Boolean} dashed defaults to false.
<span class='line'>9920</span>      * @param {String} gradient gradient url. Defaults to null.
<span class='line'>9921</span>      */</span><span class="WHIT">
<span class='line'>9922</span> </span><span class="WHIT">  
<span class='line'>9923</span>   
<span class='line'>9924</span>     </span><span class="NAME">drawLine</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dashed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9925</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.opts</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9926</span> </span><span class="WHIT">          </span><span class="NAME">stylesArr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">[</span><span class="STRN">'stroke-linecap'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'round'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'stroke-dasharray'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dashed</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'5, 5'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'none'</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9927</span> </span><span class="WHIT">          </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9928</span> </span><span class="WHIT">          </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9929</span> </span><span class="WHIT">          </span><span class="NAME">fromX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9930</span> </span><span class="WHIT">          </span><span class="NAME">fromY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9931</span> </span><span class="WHIT">          </span><span class="NAME">toX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9932</span> </span><span class="WHIT">          </span><span class="NAME">toY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9933</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">stylesArr.map</span><span class="PUNC">(</span><span class="NAME">sub</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">sub.join</span><span class="PUNC">(</span><span class="STRN">':'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">';'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9934</span> </span><span class="WHIT">          </span><span class="NAME">lineElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'line'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9935</span> </span><span class="WHIT">      </span><span class="NAME">lineElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'x1'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fromX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9936</span> </span><span class="WHIT">      </span><span class="NAME">lineElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'y1'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fromY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9937</span> </span><span class="WHIT">      </span><span class="NAME">lineElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'x2'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9938</span> </span><span class="WHIT">      </span><span class="NAME">lineElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'y2'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9939</span> </span><span class="WHIT">      </span><span class="NAME">lineElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">styles</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9940</span> </span><span class="WHIT">      </span><span class="NAME">this.paths.push</span><span class="PUNC">(</span><span class="NAME">lineElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9941</span> </span><span class="WHIT">  
<span class='line'>9942</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gradient</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9943</span> </span><span class="WHIT">        </span><span class="NAME">gradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createGradient</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fromX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fromY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9944</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9945</span> </span><span class="WHIT">  
<span class='line'>9946</span>       </span><span class="NAME">lineElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'stroke'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="TOKN">`</span><span class="NAME">url</span><span class="PUNC">(</span><span class="STRN">'#${gradient}'</span><span class="PUNC">)</span><span class="TOKN">`</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9947</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9948</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9949</span>      * Draw a point.
<span class='line'>9950</span>      *
<span class='line'>9951</span>      * @param {Number} x The x position of the point.
<span class='line'>9952</span>      * @param {Number} y The y position of the point.
<span class='line'>9953</span>      * @param {String} elementName The name of the element (single-letter).
<span class='line'>9954</span>      */</span><span class="WHIT">
<span class='line'>9955</span> </span><span class="WHIT">  
<span class='line'>9956</span>   
<span class='line'>9957</span>     </span><span class="NAME">drawPoint</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9958</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9959</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9960</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// first create a mask</span><span class="WHIT">
<span class='line'>9961</span> </span><span class="WHIT">  
<span class='line'>9962</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">mask</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'circle'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9963</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cx'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9964</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cy'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9965</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'r'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'1.5'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9966</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'black'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9967</span> </span><span class="WHIT">      </span><span class="NAME">this.maskElements.push</span><span class="PUNC">(</span><span class="NAME">mask</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// now create the point</span><span class="WHIT">
<span class='line'>9968</span> </span><span class="WHIT">  
<span class='line'>9969</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">point</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'circle'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9970</span> </span><span class="WHIT">      </span><span class="NAME">point.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cx'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9971</span> </span><span class="WHIT">      </span><span class="NAME">point.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cy'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9972</span> </span><span class="WHIT">      </span><span class="NAME">point.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'r'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'0.75'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9973</span> </span><span class="WHIT">      </span><span class="NAME">point.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9974</span> </span><span class="WHIT">      </span><span class="NAME">this.vertices.push</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9975</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9976</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>9977</span>      * Draw a text to the canvas.
<span class='line'>9978</span>      *
<span class='line'>9979</span>      * @param {Number} x The x position of the text.
<span class='line'>9980</span>      * @param {Number} y The y position of the text.
<span class='line'>9981</span>      * @param {String} elementName The name of the element (single-letter).
<span class='line'>9982</span>      * @param {Number} hydrogens The number of hydrogen atoms.
<span class='line'>9983</span>      * @param {String} direction The direction of the text in relation to the associated vertex.
<span class='line'>9984</span>      * @param {Boolean} isTerminal A boolean indicating whether or not the vertex is terminal.
<span class='line'>9985</span>      * @param {Number} charge The charge of the atom.
<span class='line'>9986</span>      * @param {Number} isotope The isotope number.
<span class='line'>9987</span>      * @param {Object} attachedPseudoElement A map with containing information for pseudo elements or concatinated elements. The key is comprised of the element symbol and the hydrogen count.
<span class='line'>9988</span>      * @param {String} attachedPseudoElement.element The element symbol.
<span class='line'>9989</span>      * @param {Number} attachedPseudoElement.count The number of occurences that match the key.
<span class='line'>9990</span>      * @param {Number} attachedPseudoElement.hyrogenCount The number of hydrogens attached to each atom matching the key.
<span class='line'>9991</span>      */</span><span class="WHIT">
<span class='line'>9992</span> </span><span class="WHIT">  
<span class='line'>9993</span>   
<span class='line'>9994</span>     </span><span class="NAME">drawText</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hydrogens</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isTerminal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">charge</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isotope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9995</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9996</span> </span><span class="WHIT">          </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9997</span> </span><span class="WHIT">          </span><span class="NAME">pos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9998</span> </span><span class="WHIT">        </span><span class="NAME">x</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9999</span> </span><span class="WHIT">        </span><span class="NAME">y</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT">
<span class='line'>10000</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10001</span> </span><span class="WHIT">          </span><span class="NAME">textElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'text'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10002</span> </span><span class="WHIT">          </span><span class="NAME">writingMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'horizontal-tb'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10003</span> </span><span class="WHIT">          </span><span class="NAME">letterSpacing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'normal'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10004</span> </span><span class="WHIT">          </span><span class="NAME">textOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'mixed'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10005</span> </span><span class="WHIT">          </span><span class="NAME">textDirection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'direction: ltr;'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10006</span> </span><span class="WHIT">          </span><span class="NAME">xShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10007</span> </span><span class="WHIT">          </span><span class="NAME">yShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10008</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">mask</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'circle'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10009</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cx'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pos.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10010</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'cy'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pos.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10011</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'r'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'3.5'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10012</span> </span><span class="WHIT">      </span><span class="NAME">mask.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'black'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10013</span> </span><span class="WHIT">      </span><span class="NAME">this.maskElements.push</span><span class="PUNC">(</span><span class="NAME">mask</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// determine writing mode</span><span class="WHIT">
<span class='line'>10014</span> </span><span class="WHIT">  
<span class='line'>10015</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="REGX">/up|down/</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10016</span> </span><span class="WHIT">        </span><span class="NAME">writingMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'vertical-rl'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10017</span> </span><span class="WHIT">        </span><span class="NAME">textOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'upright'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10018</span> </span><span class="WHIT">        </span><span class="NAME">letterSpacing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'-1px'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10019</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10020</span> </span><span class="WHIT">  
<span class='line'>10021</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10022</span> </span><span class="WHIT">        </span><span class="NAME">xShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10023</span> </span><span class="WHIT">        </span><span class="NAME">yShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10024</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10025</span> </span><span class="WHIT">        </span><span class="NAME">xShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10026</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10027</span> </span><span class="WHIT">        </span><span class="NAME">xShift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10028</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10029</span> </span><span class="WHIT">  
<span class='line'>10030</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">isTerminal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10031</span> </span><span class="WHIT">        </span><span class="NAME">textDirection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'direction: rtl; unicode-bidi: bidi-override;'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10032</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// now the text element</span><span class="WHIT">
<span class='line'>10033</span> </span><span class="WHIT">  
<span class='line'>10034</span>   
<span class='line'>10035</span>       </span><span class="NAME">textElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'x'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pos.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">xShift</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10036</span> </span><span class="WHIT">      </span><span class="NAME">textElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'y'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pos.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">yShift</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10037</span> </span><span class="WHIT">      </span><span class="NAME">textElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'class'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'element'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10038</span> </span><span class="WHIT">      </span><span class="NAME">textElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10039</span> </span><span class="WHIT">      </span><span class="NAME">textElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="TOKN">`</span><span class="WHIT">
<span class='line'>10040</span> </span><span class="WHIT">                  </span><span class="NAME">text</span><span class="PUNC">-</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10041</span> </span><span class="WHIT">                  </span><span class="NAME">writing</span><span class="PUNC">-</span><span class="NAME">mode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">writingMode</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10042</span> </span><span class="WHIT">                  </span><span class="NAME">text</span><span class="PUNC">-</span><span class="NAME">orientation</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">textOrientation</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10043</span> </span><span class="WHIT">                  </span><span class="NAME">letter</span><span class="PUNC">-</span><span class="NAME">spacing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">letterSpacing</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10044</span> </span><span class="WHIT">                  </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">textDirection</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10045</span> </span><span class="WHIT">              </span><span class="TOKN">`</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10046</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">textNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'tspan'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// special case for element names that are 2 letters</span><span class="WHIT">
<span class='line'>10047</span> </span><span class="WHIT">  
<span class='line'>10048</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementName.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10049</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">textAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/up|down/</span><span class="PUNC">.</span><span class="NAME">test</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">'middle'</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'start'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10050</span> </span><span class="WHIT">        </span><span class="NAME">textNode.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="TOKN">`</span><span class="WHIT">
<span class='line'>10051</span> </span><span class="WHIT">                  </span><span class="NAME">unicode</span><span class="PUNC">-</span><span class="NAME">bidi</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">plaintext</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10052</span> </span><span class="WHIT">                  </span><span class="NAME">writing</span><span class="PUNC">-</span><span class="NAME">mode</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">lr</span><span class="PUNC">-</span><span class="NAME">tb</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10053</span> </span><span class="WHIT">                  </span><span class="NAME">letter</span><span class="PUNC">-</span><span class="NAME">spacing</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">normal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10054</span> </span><span class="WHIT">                  </span><span class="NAME">text</span><span class="PUNC">-</span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">textAnchor</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10055</span> </span><span class="WHIT">              </span><span class="TOKN">`</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10056</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10057</span> </span><span class="WHIT">  
<span class='line'>10058</span>       </span><span class="NAME">textNode.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="NAME">elementName</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10059</span> </span><span class="WHIT">      </span><span class="NAME">textElem.appendChild</span><span class="PUNC">(</span><span class="NAME">textNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Charge</span><span class="WHIT">
<span class='line'>10060</span> </span><span class="WHIT">  
<span class='line'>10061</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10062</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">chargeElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createSubSuperScripts</span><span class="PUNC">(</span><span class="NAME">getChargeText</span><span class="PUNC">(</span><span class="NAME">charge</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'super'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10063</span> </span><span class="WHIT">        </span><span class="NAME">textNode.appendChild</span><span class="PUNC">(</span><span class="NAME">chargeElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10064</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10065</span> </span><span class="WHIT">  
<span class='line'>10066</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isotopeText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'0'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10067</span> </span><span class="WHIT">  
<span class='line'>10068</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isotope</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10069</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isotopeElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createSubSuperScripts</span><span class="PUNC">(</span><span class="NAME">isotope.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'super'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10070</span> </span><span class="WHIT">        </span><span class="NAME">textNode.appendChild</span><span class="PUNC">(</span><span class="NAME">isotopeElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10071</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// TODO: Better handle exceptions</span><span class="WHIT">
<span class='line'>10072</span> </span><span class="WHIT">      </span><span class="COMM">// Exception for nitro (draw nitro as NO2 instead of N+O-O)</span><span class="WHIT">
<span class='line'>10073</span> </span><span class="WHIT">  
<span class='line'>10074</span>   
<span class='line'>10075</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">elementName</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'N'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'0O'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">'0O-1'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10076</span> </span><span class="WHIT">        </span><span class="NAME">attachedPseudoElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10077</span> </span><span class="WHIT">          </span><span class="STRN">'0O'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10078</span> </span><span class="WHIT">            </span><span class="NAME">element</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'O'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10079</span> </span><span class="WHIT">            </span><span class="NAME">count</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10080</span> </span><span class="WHIT">            </span><span class="NAME">hydrogenCount</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10081</span> </span><span class="WHIT">            </span><span class="NAME">previousElement</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10082</span> </span><span class="WHIT">            </span><span class="NAME">charge</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">''</span><span class="WHIT">
<span class='line'>10083</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10084</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10085</span> </span><span class="WHIT">        </span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10086</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10087</span> </span><span class="WHIT">  
<span class='line'>10088</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10089</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hydrogenElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'tspan'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10090</span> </span><span class="WHIT">        </span><span class="NAME">hydrogenElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'unicode-bidi: plaintext;'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10091</span> </span><span class="WHIT">        </span><span class="NAME">hydrogenElem.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10092</span> </span><span class="WHIT">        </span><span class="NAME">textElem.appendChild</span><span class="PUNC">(</span><span class="NAME">hydrogenElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10093</span> </span><span class="WHIT">  
<span class='line'>10094</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogens</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10095</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hydrogenCountElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createSubSuperScripts</span><span class="PUNC">(</span><span class="NAME">hydrogens</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'sub'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10096</span> </span><span class="WHIT">          </span><span class="NAME">hydrogenElem.appendChild</span><span class="PUNC">(</span><span class="NAME">hydrogenCountElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10097</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10098</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10099</span> </span><span class="WHIT">  
<span class='line'>10100</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10101</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">attachedPseudoElement.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10102</span> </span><span class="WHIT">          </span><span class="KEYW">continue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10103</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10104</span> </span><span class="WHIT">  
<span class='line'>10105</span>         </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10106</span> </span><span class="WHIT">            </span><span class="NAME">elementCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">count</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10107</span> </span><span class="WHIT">            </span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hydrogenCount</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10108</span> </span><span class="WHIT">            </span><span class="NAME">elementCharge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attachedPseudoElement</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">charge</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10109</span> </span><span class="WHIT">            </span><span class="NAME">pseudoElementElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'tspan'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10110</span> </span><span class="WHIT">        </span><span class="NAME">pseudoElementElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'unicode-bidi: plaintext;'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10111</span> </span><span class="WHIT">        </span><span class="NAME">pseudoElementElem.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10112</span> </span><span class="WHIT">        </span><span class="NAME">pseudoElementElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.themeManager.getColor</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10113</span> </span><span class="WHIT">  
<span class='line'>10114</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementCharge</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10115</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elementChargeElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createSubSuperScripts</span><span class="PUNC">(</span><span class="NAME">getChargeText</span><span class="PUNC">(</span><span class="NAME">elementCharge</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'super'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10116</span> </span><span class="WHIT">          </span><span class="NAME">pseudoElementElem.appendChild</span><span class="PUNC">(</span><span class="NAME">elementChargeElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10117</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10118</span> </span><span class="WHIT">  
<span class='line'>10119</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10120</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">pseudoHydrogenElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'tspan'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10121</span> </span><span class="WHIT">          </span><span class="NAME">pseudoHydrogenElem.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'unicode-bidi: plaintext;'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10122</span> </span><span class="WHIT">          </span><span class="NAME">pseudoHydrogenElem.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createTextNode</span><span class="PUNC">(</span><span class="STRN">'H'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10123</span> </span><span class="WHIT">          </span><span class="NAME">pseudoElementElem.appendChild</span><span class="PUNC">(</span><span class="NAME">pseudoHydrogenElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10124</span> </span><span class="WHIT">  
<span class='line'>10125</span>           </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10126</span> </span><span class="WHIT">            </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">hydrogenCountElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createSubSuperScripts</span><span class="PUNC">(</span><span class="NAME">hydrogenCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'sub'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10127</span> </span><span class="WHIT">            </span><span class="NAME">pseudoHydrogenElem.appendChild</span><span class="PUNC">(</span><span class="NAME">hydrogenCountElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10128</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10129</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10130</span> </span><span class="WHIT">  
<span class='line'>10131</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10132</span> </span><span class="WHIT">          </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">elementCountElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createSubSuperScripts</span><span class="PUNC">(</span><span class="NAME">elementCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'sub'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10133</span> </span><span class="WHIT">          </span><span class="NAME">pseudoElementElem.appendChild</span><span class="PUNC">(</span><span class="NAME">elementCountElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10134</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10135</span> </span><span class="WHIT">  
<span class='line'>10136</span>         </span><span class="NAME">textElem.appendChild</span><span class="PUNC">(</span><span class="NAME">pseudoElementElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10137</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10138</span> </span><span class="WHIT">  
<span class='line'>10139</span>       </span><span class="NAME">this.vertices.push</span><span class="PUNC">(</span><span class="NAME">textElem</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10140</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10141</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10142</span>      * @param {Line} line the line object to create the wedge from
<span class='line'>10143</span>      */</span><span class="WHIT">
<span class='line'>10144</span> </span><span class="WHIT">  
<span class='line'>10145</span>   
<span class='line'>10146</span>     </span><span class="NAME">drawWedge</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10147</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetX</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10148</span> </span><span class="WHIT">          </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.offsetY</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10149</span> </span><span class="WHIT">          </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getLeftVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10150</span> </span><span class="WHIT">          </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightVector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10151</span> </span><span class="WHIT">      </span><span class="NAME">l.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10152</span> </span><span class="WHIT">      </span><span class="NAME">l.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10153</span> </span><span class="WHIT">      </span><span class="NAME">r.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10154</span> </span><span class="WHIT">      </span><span class="NAME">r.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10155</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.normals</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10156</span> </span><span class="WHIT">      </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10157</span> </span><span class="WHIT">      </span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10158</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">isRightChiralCenter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">line.getRightChiral</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10159</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10160</span> </span><span class="WHIT">          </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10161</span> </span><span class="WHIT">  
<span class='line'>10162</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isRightChiralCenter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10163</span> </span><span class="WHIT">        </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10164</span> </span><span class="WHIT">        </span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10165</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10166</span> </span><span class="WHIT">  
<span class='line'>10167</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.halfBondThickness</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10168</span> </span><span class="WHIT">          </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">end</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.halfBondThickness</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10169</span> </span><span class="WHIT">          </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">end</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.halfBondThickness</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10170</span> </span><span class="WHIT">          </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.add</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Vector2.multiplyScalar</span><span class="PUNC">(</span><span class="NAME">normals</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.halfBondThickness</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10171</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">polygon</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="STRN">'http://www.w3.org/2000/svg'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'polygon'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10172</span> </span><span class="WHIT">          </span><span class="NAME">gradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.createGradient</span><span class="PUNC">(</span><span class="NAME">line</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">l.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">l.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10173</span> </span><span class="WHIT">      </span><span class="NAME">polygon.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'points'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="TOKN">`</span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">t.x</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">t.y</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">u.x</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">u.y</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">v.x</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">v.y</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">w.x</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">$</span><span class="PUNC">{</span><span class="NAME">w.y</span><span class="PUNC">}</span><span class="TOKN">`</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10174</span> </span><span class="WHIT">      </span><span class="NAME">polygon.setAttributeNS</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'fill'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="TOKN">`</span><span class="NAME">url</span><span class="PUNC">(</span><span class="STRN">'#${gradient}'</span><span class="PUNC">)</span><span class="TOKN">`</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10175</span> </span><span class="WHIT">      </span><span class="NAME">this.paths.push</span><span class="PUNC">(</span><span class="NAME">polygon</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10176</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10177</span> </span><span class="WHIT">  
<span class='line'>10178</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10179</span> </span><span class="WHIT">  
<span class='line'>10180</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SvgWrapper</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10181</span> </span><span class="WHIT">  
<span class='line'>10182</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./Line"</span><span class="PUNC">:</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="STRN">"./UtilityFunctions"</span><span class="PUNC">:</span><span class="NUMB">17</span><span class="PUNC">,</span><span class="STRN">"./Vector2"</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">16</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10183</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10184</span> </span><span class="WHIT">  
<span class='line'>10185</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">ThemeManager</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10186</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">colors</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theme</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10187</span> </span><span class="WHIT">      </span><span class="NAME">this.colors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">colors</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10188</span> </span><span class="WHIT">      </span><span class="NAME">this.theme</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.colors</span><span class="PUNC">[</span><span class="NAME">theme</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10189</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10190</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10191</span>      * Returns the hex code of a color associated with a key from the current theme.
<span class='line'>10192</span>      *
<span class='line'>10193</span>      * @param {String} key The color key in the theme (e.g. C, N, BACKGROUND, ...).
<span class='line'>10194</span>      * @returns {String} A color hex value.
<span class='line'>10195</span>      */</span><span class="WHIT">
<span class='line'>10196</span> </span><span class="WHIT">  
<span class='line'>10197</span>   
<span class='line'>10198</span>     </span><span class="NAME">getColor</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10199</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10200</span> </span><span class="WHIT">        </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10201</span> </span><span class="WHIT">  
<span class='line'>10202</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.theme</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10203</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.theme</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10204</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10205</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10206</span> </span><span class="WHIT">  
<span class='line'>10207</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.theme</span><span class="PUNC">[</span><span class="STRN">'C'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10208</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10209</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10210</span>      * Sets the theme to the specified string if it exists. If it does not, this
<span class='line'>10211</span>      * does nothing.
<span class='line'>10212</span>      *
<span class='line'>10213</span>      * @param {String} theme the name of the theme to switch to
<span class='line'>10214</span>      */</span><span class="WHIT">
<span class='line'>10215</span> </span><span class="WHIT">  
<span class='line'>10216</span>   
<span class='line'>10217</span>     </span><span class="NAME">setTheme</span><span class="PUNC">(</span><span class="NAME">theme</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10218</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.colors.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">theme</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10219</span> </span><span class="WHIT">        </span><span class="NAME">this.theme</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.colors</span><span class="PUNC">[</span><span class="NAME">theme</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10220</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// TODO: this probably should notify those who are watching this theme</span><span class="WHIT">
<span class='line'>10221</span> </span><span class="WHIT">      </span><span class="COMM">// manager that the theme has changed so that colors can be changed</span><span class="WHIT">
<span class='line'>10222</span> </span><span class="WHIT">      </span><span class="COMM">// on the fly</span><span class="WHIT">
<span class='line'>10223</span> </span><span class="WHIT">  
<span class='line'>10224</span>     </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10225</span> </span><span class="WHIT">  
<span class='line'>10226</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10227</span> </span><span class="WHIT">  
<span class='line'>10228</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ThemeManager</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10229</span> </span><span class="WHIT">  
<span class='line'>10230</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">17</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10231</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10232</span> </span><span class="WHIT">  
<span class='line'>10233</span>   </span><span class="COMM">/**
<span class='line'>10234</span>    * Translate the integer indicating the charge to the appropriate text.
<span class='line'>10235</span>    * @param {Number} charge The integer indicating the charge.
<span class='line'>10236</span>    * @returns {String} A string representing a charge.
<span class='line'>10237</span>    */</span><span class="WHIT">
<span class='line'>10238</span> </span><span class="WHIT">  </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">getChargeText</span><span class="PUNC">(</span><span class="NAME">charge</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10239</span> </span><span class="WHIT">   </span><span class="COMM">// console.log('in the utility version of getChargeText');</span><span class="WHIT">
<span class='line'>10240</span> </span><span class="WHIT">  
<span class='line'>10241</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10242</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'+'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10243</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10244</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'2+'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10245</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10246</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'-'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10247</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">charge</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10248</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'2-'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10249</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10250</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10251</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10252</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10253</span> </span><span class="WHIT">  
<span class='line'>10254</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10255</span> </span><span class="WHIT">    </span><span class="NAME">getChargeText</span><span class="WHIT">
<span class='line'>10256</span> </span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10257</span> </span><span class="WHIT">  
<span class='line'>10258</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">18</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10259</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10260</span> </span><span class="WHIT">  
<span class='line'>10261</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>10262</span> </span><span class="WHIT">  
<span class='line'>10263</span>   </span><span class="COMM">/** 
<span class='line'>10264</span>    * A class representing a 2D vector.
<span class='line'>10265</span>    * 
<span class='line'>10266</span>    * @property {Number} x The x component of the vector.
<span class='line'>10267</span>    * @property {Number} y The y component of the vector.
<span class='line'>10268</span>    */</span><span class="WHIT">
<span class='line'>10269</span> </span><span class="WHIT">  </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10270</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10271</span>      * The constructor of the class Vector2.
<span class='line'>10272</span>      *
<span class='line'>10273</span>      * @param {(Number|Vector2)} x The initial x coordinate value or, if the single argument, a Vector2 object.
<span class='line'>10274</span>      * @param {Number} y The initial y coordinate value.
<span class='line'>10275</span>      */</span><span class="WHIT">
<span class='line'>10276</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10277</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10278</span> </span><span class="WHIT">        </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10279</span> </span><span class="WHIT">        </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10280</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10281</span> </span><span class="WHIT">        </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10282</span> </span><span class="WHIT">        </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10283</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10284</span> </span><span class="WHIT">        </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10285</span> </span><span class="WHIT">        </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10286</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10287</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10288</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10289</span>      * Clones this vector and returns the clone.
<span class='line'>10290</span>      *
<span class='line'>10291</span>      * @returns {Vector2} The clone of this vector.
<span class='line'>10292</span>      */</span><span class="WHIT">
<span class='line'>10293</span> </span><span class="WHIT">  
<span class='line'>10294</span>   
<span class='line'>10295</span>     </span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10296</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10297</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10298</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10299</span>      * Returns a string representation of this vector.
<span class='line'>10300</span>      *
<span class='line'>10301</span>      * @returns {String} A string representation of this vector.
<span class='line'>10302</span>      */</span><span class="WHIT">
<span class='line'>10303</span> </span><span class="WHIT">  
<span class='line'>10304</span>   
<span class='line'>10305</span>     </span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10306</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'('</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">','</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">')'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10307</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10308</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10309</span>      * Add the x and y coordinate values of a vector to the x and y coordinate values of this vector.
<span class='line'>10310</span>      *
<span class='line'>10311</span>      * @param {Vector2} vec Another vector.
<span class='line'>10312</span>      * @returns {Vector2} Returns itself.
<span class='line'>10313</span>      */</span><span class="WHIT">
<span class='line'>10314</span> </span><span class="WHIT">  
<span class='line'>10315</span>   
<span class='line'>10316</span>     </span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10317</span> </span><span class="WHIT">      </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10318</span> </span><span class="WHIT">      </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10319</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10320</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10321</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10322</span>      * Subtract the x and y coordinate values of a vector from the x and y coordinate values of this vector.
<span class='line'>10323</span>      *
<span class='line'>10324</span>      * @param {Vector2} vec Another vector.
<span class='line'>10325</span>      * @returns {Vector2} Returns itself.
<span class='line'>10326</span>      */</span><span class="WHIT">
<span class='line'>10327</span> </span><span class="WHIT">  
<span class='line'>10328</span>   
<span class='line'>10329</span>     </span><span class="NAME">subtract</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10330</span> </span><span class="WHIT">      </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10331</span> </span><span class="WHIT">      </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10332</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10333</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10334</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10335</span>      * Divide the x and y coordinate values of this vector by a scalar.
<span class='line'>10336</span>      *
<span class='line'>10337</span>      * @param {Number} scalar The scalar.
<span class='line'>10338</span>      * @returns {Vector2} Returns itself.
<span class='line'>10339</span>      */</span><span class="WHIT">
<span class='line'>10340</span> </span><span class="WHIT">  
<span class='line'>10341</span>   
<span class='line'>10342</span>     </span><span class="NAME">divide</span><span class="PUNC">(</span><span class="NAME">scalar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10343</span> </span><span class="WHIT">      </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scalar</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10344</span> </span><span class="WHIT">      </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scalar</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10345</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10346</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10347</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10348</span>      * Multiply the x and y coordinate values of this vector by the values of another vector.
<span class='line'>10349</span>      *
<span class='line'>10350</span>      * @param {Vector2} v A vector.
<span class='line'>10351</span>      * @returns {Vector2} Returns itself.
<span class='line'>10352</span>      */</span><span class="WHIT">
<span class='line'>10353</span> </span><span class="WHIT">  
<span class='line'>10354</span>   
<span class='line'>10355</span>     </span><span class="NAME">multiply</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10356</span> </span><span class="WHIT">      </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10357</span> </span><span class="WHIT">      </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10358</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10359</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10360</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10361</span>      * Multiply the x and y coordinate values of this vector by a scalar.
<span class='line'>10362</span>      *
<span class='line'>10363</span>      * @param {Number} scalar The scalar.
<span class='line'>10364</span>      * @returns {Vector2} Returns itself.
<span class='line'>10365</span>      */</span><span class="WHIT">
<span class='line'>10366</span> </span><span class="WHIT">  
<span class='line'>10367</span>   
<span class='line'>10368</span>     </span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">scalar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10369</span> </span><span class="WHIT">      </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scalar</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10370</span> </span><span class="WHIT">      </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scalar</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10371</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10372</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10373</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10374</span>      * Inverts this vector. Same as multiply(-1.0).
<span class='line'>10375</span>      *
<span class='line'>10376</span>      * @returns {Vector2} Returns itself.
<span class='line'>10377</span>      */</span><span class="WHIT">
<span class='line'>10378</span> </span><span class="WHIT">  
<span class='line'>10379</span>   
<span class='line'>10380</span>     </span><span class="NAME">invert</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10381</span> </span><span class="WHIT">      </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">this.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10382</span> </span><span class="WHIT">      </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">this.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10383</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10384</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10385</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10386</span>      * Returns the angle of this vector in relation to the coordinate system.
<span class='line'>10387</span>      *
<span class='line'>10388</span>      * @returns {Number} The angle in radians.
<span class='line'>10389</span>      */</span><span class="WHIT">
<span class='line'>10390</span> </span><span class="WHIT">  
<span class='line'>10391</span>   
<span class='line'>10392</span>     </span><span class="NAME">angle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10393</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10394</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10395</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10396</span>      * Returns the euclidean distance between this vector and another vector.
<span class='line'>10397</span>      *
<span class='line'>10398</span>      * @param {Vector2} vec A vector.
<span class='line'>10399</span>      * @returns {Number} The euclidean distance between the two vectors.
<span class='line'>10400</span>      */</span><span class="WHIT">
<span class='line'>10401</span> </span><span class="WHIT">  
<span class='line'>10402</span>   
<span class='line'>10403</span>     </span><span class="NAME">distance</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10404</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">vec.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10405</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10406</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10407</span>      * Returns the squared euclidean distance between this vector and another vector. When only the relative distances of a set of vectors are needed, this is is less expensive than using distance(vec).
<span class='line'>10408</span>      *
<span class='line'>10409</span>      * @param {Vector2} vec Another vector.
<span class='line'>10410</span>      * @returns {Number} The squared euclidean distance of the two vectors.
<span class='line'>10411</span>      */</span><span class="WHIT">
<span class='line'>10412</span> </span><span class="WHIT">  
<span class='line'>10413</span>   
<span class='line'>10414</span>     </span><span class="NAME">distanceSq</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10415</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10416</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10417</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10418</span>      * Checks whether or not this vector is in a clockwise or counter-clockwise rotational direction compared to another vector in relation to the coordinate system.
<span class='line'>10419</span>      *
<span class='line'>10420</span>      * @param {Vector2} vec Another vector.
<span class='line'>10421</span>      * @returns {Number} Returns -1, 0 or 1 if the vector supplied as an argument is clockwise, neutral or counter-clockwise respectively to this vector in relation to the coordinate system.
<span class='line'>10422</span>      */</span><span class="WHIT">
<span class='line'>10423</span> </span><span class="WHIT">  
<span class='line'>10424</span>   
<span class='line'>10425</span>     </span><span class="NAME">clockwise</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10426</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vec.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10427</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vec.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10428</span> </span><span class="WHIT">  
<span class='line'>10429</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10430</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10431</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10432</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10433</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10434</span> </span><span class="WHIT">  
<span class='line'>10435</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10436</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10437</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10438</span>      * Checks whether or not this vector is in a clockwise or counter-clockwise rotational direction compared to another vector in relation to an arbitrary third vector.
<span class='line'>10439</span>      *
<span class='line'>10440</span>      * @param {Vector2} center The central vector.
<span class='line'>10441</span>      * @param {Vector2} vec Another vector.
<span class='line'>10442</span>      * @returns {Number} Returns -1, 0 or 1 if the vector supplied as an argument is clockwise, neutral or counter-clockwise respectively to this vector in relation to an arbitrary third vector.
<span class='line'>10443</span>      */</span><span class="WHIT">
<span class='line'>10444</span> </span><span class="WHIT">  
<span class='line'>10445</span>   
<span class='line'>10446</span>     </span><span class="NAME">relativeClockwise</span><span class="PUNC">(</span><span class="NAME">center</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10447</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">center.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">center.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10448</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">center.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vec.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">center.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10449</span> </span><span class="WHIT">  
<span class='line'>10450</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10451</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10452</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10453</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10454</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10455</span> </span><span class="WHIT">  
<span class='line'>10456</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10457</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10458</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10459</span>      * Rotates this vector by a given number of radians around the origin of the coordinate system.
<span class='line'>10460</span>      *
<span class='line'>10461</span>      * @param {Number} angle The angle in radians to rotate the vector.
<span class='line'>10462</span>      * @returns {Vector2} Returns itself.
<span class='line'>10463</span>      */</span><span class="WHIT">
<span class='line'>10464</span> </span><span class="WHIT">  
<span class='line'>10465</span>   
<span class='line'>10466</span>     </span><span class="NAME">rotate</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10467</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10468</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">cosAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10469</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">sinAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10470</span> </span><span class="WHIT">      </span><span class="NAME">tmp.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">cosAngle</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sinAngle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10471</span> </span><span class="WHIT">      </span><span class="NAME">tmp.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sinAngle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">cosAngle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10472</span> </span><span class="WHIT">      </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10473</span> </span><span class="WHIT">      </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10474</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10475</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10476</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10477</span>      * Rotates this vector around another vector.
<span class='line'>10478</span>      *
<span class='line'>10479</span>      * @param {Number} angle The angle in radians to rotate the vector.
<span class='line'>10480</span>      * @param {Vector2} vec The vector which is used as the rotational center.
<span class='line'>10481</span>      * @returns {Vector2} Returns itself.
<span class='line'>10482</span>      */</span><span class="WHIT">
<span class='line'>10483</span> </span><span class="WHIT">  
<span class='line'>10484</span>   
<span class='line'>10485</span>     </span><span class="NAME">rotateAround</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10486</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10487</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10488</span> </span><span class="WHIT">      </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10489</span> </span><span class="WHIT">      </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vec.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10490</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10491</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10492</span> </span><span class="WHIT">      </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vec.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10493</span> </span><span class="WHIT">      </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vec.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10494</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10495</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10496</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10497</span>      * Rotate a vector around a given center to the same angle as another vector (so that the two vectors and the center are in a line, with both vectors on one side of the center), keeps the distance from this vector to the center.
<span class='line'>10498</span>      *
<span class='line'>10499</span>      * @param {Vector2} vec The vector to rotate this vector to.
<span class='line'>10500</span>      * @param {Vector2} center The rotational center.
<span class='line'>10501</span>      * @param {Number} [offsetAngle=0.0] An additional amount of radians to rotate the vector.
<span class='line'>10502</span>      * @returns {Vector2} Returns itself.
<span class='line'>10503</span>      */</span><span class="WHIT">
<span class='line'>10504</span> </span><span class="WHIT">  
<span class='line'>10505</span>   
<span class='line'>10506</span>     </span><span class="NAME">rotateTo</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offsetAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10507</span> </span><span class="WHIT">      </span><span class="COMM">// Problem if this is first position</span><span class="WHIT">
<span class='line'>10508</span> </span><span class="WHIT">      </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.001</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10509</span> </span><span class="WHIT">      </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.001</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10510</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10511</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10512</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.angle</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10513</span> </span><span class="WHIT">      </span><span class="NAME">this.rotateAround</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetAngle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10514</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10515</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10516</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10517</span>      * Rotates the vector away from a specified vector around a center.
<span class='line'>10518</span>      * 
<span class='line'>10519</span>      * @param {Vector2} vec The vector this one is rotated away from.
<span class='line'>10520</span>      * @param {Vector2} center The rotational center.
<span class='line'>10521</span>      * @param {Number} angle The angle by which to rotate.
<span class='line'>10522</span>      */</span><span class="WHIT">
<span class='line'>10523</span> </span><span class="WHIT">  
<span class='line'>10524</span>   
<span class='line'>10525</span>     </span><span class="NAME">rotateAwayFrom</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10526</span> </span><span class="WHIT">      </span><span class="NAME">this.rotateAround</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10527</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">distSqA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.distanceSq</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10528</span> </span><span class="WHIT">      </span><span class="NAME">this.rotateAround</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10529</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">distSqB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.distanceSq</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// If it was rotated towards the other vertex, rotate in other direction by same amount.</span><span class="WHIT">
<span class='line'>10530</span> </span><span class="WHIT">  
<span class='line'>10531</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">distSqB</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">distSqA</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10532</span> </span><span class="WHIT">        </span><span class="NAME">this.rotateAround</span><span class="PUNC">(</span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10533</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10534</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10535</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10536</span>      * Returns the angle in radians used to rotate this vector away from a given vector.
<span class='line'>10537</span>      * 
<span class='line'>10538</span>      * @param {Vector2} vec The vector this one is rotated away from.
<span class='line'>10539</span>      * @param {Vector2} center The rotational center.
<span class='line'>10540</span>      * @param {Number} angle The angle by which to rotate.
<span class='line'>10541</span>      * @returns {Number} The angle in radians.
<span class='line'>10542</span>      */</span><span class="WHIT">
<span class='line'>10543</span> </span><span class="WHIT">  
<span class='line'>10544</span>   
<span class='line'>10545</span>     </span><span class="NAME">getRotateAwayFromAngle</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10546</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10547</span> </span><span class="WHIT">      </span><span class="NAME">tmp.rotateAround</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10548</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">distSqA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp.distanceSq</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10549</span> </span><span class="WHIT">      </span><span class="NAME">tmp.rotateAround</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10550</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">distSqB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp.distanceSq</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10551</span> </span><span class="WHIT">  
<span class='line'>10552</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">distSqB</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">distSqA</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10553</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10554</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10555</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10556</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10557</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10558</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10559</span>      * Returns the angle in radians used to rotate this vector towards a given vector.
<span class='line'>10560</span>      * 
<span class='line'>10561</span>      * @param {Vector2} vec The vector this one is rotated towards to.
<span class='line'>10562</span>      * @param {Vector2} center The rotational center.
<span class='line'>10563</span>      * @param {Number} angle The angle by which to rotate.
<span class='line'>10564</span>      * @returns {Number} The angle in radians.
<span class='line'>10565</span>      */</span><span class="WHIT">
<span class='line'>10566</span> </span><span class="WHIT">  
<span class='line'>10567</span>   
<span class='line'>10568</span>     </span><span class="NAME">getRotateTowardsAngle</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10569</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10570</span> </span><span class="WHIT">      </span><span class="NAME">tmp.rotateAround</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10571</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">distSqA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp.distanceSq</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10572</span> </span><span class="WHIT">      </span><span class="NAME">tmp.rotateAround</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">2.0</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10573</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">distSqB</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tmp.distanceSq</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10574</span> </span><span class="WHIT">  
<span class='line'>10575</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">distSqB</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">distSqA</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10576</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10577</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10578</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10579</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10580</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10581</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10582</span>      * Gets the angles between this vector and another vector around a common center of rotation.
<span class='line'>10583</span>      *
<span class='line'>10584</span>      * @param {Vector2} vec Another vector.
<span class='line'>10585</span>      * @param {Vector2} center The center of rotation.
<span class='line'>10586</span>      * @returns {Number} The angle between this vector and another vector around a center of rotation in radians.
<span class='line'>10587</span>      */</span><span class="WHIT">
<span class='line'>10588</span> </span><span class="WHIT">  
<span class='line'>10589</span>   
<span class='line'>10590</span>     </span><span class="NAME">getRotateToAngle</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10591</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10592</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">center</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10593</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.angle</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10594</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Number.isNaN</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10595</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10596</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10597</span>      * Checks whether a vector lies within a polygon spanned by a set of vectors.
<span class='line'>10598</span>      *
<span class='line'>10599</span>      * @param {Vector2[]} polygon An array of vectors spanning the polygon.
<span class='line'>10600</span>      * @returns {Boolean} A boolean indicating whether or not this vector is within a polygon.
<span class='line'>10601</span>      */</span><span class="WHIT">
<span class='line'>10602</span> </span><span class="WHIT">  
<span class='line'>10603</span>   
<span class='line'>10604</span>     </span><span class="NAME">isInPolygon</span><span class="PUNC">(</span><span class="NAME">polygon</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10605</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">inside</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Its not always a given, that the polygon is convex (-> sugars)</span><span class="WHIT">
<span class='line'>10606</span> </span><span class="WHIT">  
<span class='line'>10607</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">polygon.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">polygon.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10608</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">polygon</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">polygon</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">polygon</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">polygon</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">polygon</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">polygon</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">polygon</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">polygon</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10609</span> </span><span class="WHIT">          </span><span class="NAME">inside</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">inside</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10610</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10611</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10612</span> </span><span class="WHIT">  
<span class='line'>10613</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">inside</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10614</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10615</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10616</span>      * Returns the length of this vector.
<span class='line'>10617</span>      *
<span class='line'>10618</span>      * @returns {Number} The length of this vector.
<span class='line'>10619</span>      */</span><span class="WHIT">
<span class='line'>10620</span> </span><span class="WHIT">  
<span class='line'>10621</span>   
<span class='line'>10622</span>     </span><span class="NAME">length</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10623</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10624</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10625</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10626</span>      * Returns the square of the length of this vector.
<span class='line'>10627</span>      *
<span class='line'>10628</span>      * @returns {Number} The square of the length of this vector.
<span class='line'>10629</span>      */</span><span class="WHIT">
<span class='line'>10630</span> </span><span class="WHIT">  
<span class='line'>10631</span>   
<span class='line'>10632</span>     </span><span class="NAME">lengthSq</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10633</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10634</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10635</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10636</span>      * Normalizes this vector.
<span class='line'>10637</span>      *
<span class='line'>10638</span>      * @returns {Vector2} Returns itself.
<span class='line'>10639</span>      */</span><span class="WHIT">
<span class='line'>10640</span> </span><span class="WHIT">  
<span class='line'>10641</span>   
<span class='line'>10642</span>     </span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10643</span> </span><span class="WHIT">      </span><span class="NAME">this.divide</span><span class="PUNC">(</span><span class="NAME">this.length</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10644</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10645</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10646</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10647</span>      * Returns a normalized copy of this vector.
<span class='line'>10648</span>      *
<span class='line'>10649</span>      * @returns {Vector2} A normalized copy of this vector.
<span class='line'>10650</span>      */</span><span class="WHIT">
<span class='line'>10651</span> </span><span class="WHIT">  
<span class='line'>10652</span>   
<span class='line'>10653</span>     </span><span class="NAME">normalized</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10654</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Vector2.divideScalar</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10655</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10656</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10657</span>      * Calculates which side of a line spanned by two vectors this vector is.
<span class='line'>10658</span>      *
<span class='line'>10659</span>      * @param {Vector2} vecA A vector.
<span class='line'>10660</span>      * @param {Vector2} vecB A vector.
<span class='line'>10661</span>      * @returns {Number} A number indicating the side of this vector, given a line spanned by two other vectors.
<span class='line'>10662</span>      */</span><span class="WHIT">
<span class='line'>10663</span> </span><span class="WHIT">  
<span class='line'>10664</span>   
<span class='line'>10665</span>     </span><span class="NAME">whichSide</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10666</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vecA.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vecB.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vecA.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vecA.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vecB.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vecA.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10667</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10668</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10669</span>      * Checks whether or not this vector is on the same side of a line spanned by two vectors as another vector.
<span class='line'>10670</span>      *
<span class='line'>10671</span>      * @param {Vector2} vecA A vector spanning the line.
<span class='line'>10672</span>      * @param {Vector2} vecB A vector spanning the line.
<span class='line'>10673</span>      * @param {Vector2} vecC A vector to check whether or not it is on the same side as this vector.
<span class='line'>10674</span>      * @returns {Boolean} Returns a boolean indicating whether or not this vector is on the same side as another vector.
<span class='line'>10675</span>      */</span><span class="WHIT">
<span class='line'>10676</span> </span><span class="WHIT">  
<span class='line'>10677</span>   
<span class='line'>10678</span>     </span><span class="NAME">sameSideAs</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10679</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.whichSide</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10680</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dRef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vecC.whichSide</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10681</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">dRef</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">dRef</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">dRef</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10682</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10683</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10684</span>      * Adds two vectors and returns the result as a new vector.
<span class='line'>10685</span>      *
<span class='line'>10686</span>      * @static
<span class='line'>10687</span>      * @param {Vector2} vecA A summand.
<span class='line'>10688</span>      * @param {Vector2} vecB A summand.
<span class='line'>10689</span>      * @returns {Vector2} Returns the sum of two vectors.
<span class='line'>10690</span>      */</span><span class="WHIT">
<span class='line'>10691</span> </span><span class="WHIT">  
<span class='line'>10692</span>   
<span class='line'>10693</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">add</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10694</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">vecA.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vecB.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecA.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vecB.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10695</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10696</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10697</span>      * Subtracts one vector from another and returns the result as a new vector.
<span class='line'>10698</span>      *
<span class='line'>10699</span>      * @static
<span class='line'>10700</span>      * @param {Vector2} vecA The minuend.
<span class='line'>10701</span>      * @param {Vector2} vecB The subtrahend.
<span class='line'>10702</span>      * @returns {Vector2} Returns the difference of two vectors.
<span class='line'>10703</span>      */</span><span class="WHIT">
<span class='line'>10704</span> </span><span class="WHIT">  
<span class='line'>10705</span>   
<span class='line'>10706</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">subtract</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10707</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">vecA.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vecB.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecA.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">vecB.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10708</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10709</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10710</span>      * Multiplies two vectors (value by value) and returns the result.
<span class='line'>10711</span>      *
<span class='line'>10712</span>      * @static
<span class='line'>10713</span>      * @param {Vector2} vecA A vector.
<span class='line'>10714</span>      * @param {Vector2} vecB A vector.
<span class='line'>10715</span>      * @returns {Vector2} Returns the product of two vectors.
<span class='line'>10716</span>      */</span><span class="WHIT">
<span class='line'>10717</span> </span><span class="WHIT">  
<span class='line'>10718</span>   
<span class='line'>10719</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">multiply</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10720</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">vecA.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vecB.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecA.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vecB.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10721</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10722</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10723</span>      * Multiplies two vectors (value by value) and returns the result.
<span class='line'>10724</span>      *
<span class='line'>10725</span>      * @static
<span class='line'>10726</span>      * @param {Vector2} vec A vector.
<span class='line'>10727</span>      * @param {Number} scalar A scalar.
<span class='line'>10728</span>      * @returns {Vector2} Returns the product of two vectors.
<span class='line'>10729</span>      */</span><span class="WHIT">
<span class='line'>10730</span> </span><span class="WHIT">  
<span class='line'>10731</span>   
<span class='line'>10732</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scalar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10733</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">vec.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vec.y</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">multiplyScalar</span><span class="PUNC">(</span><span class="NAME">scalar</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10734</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10735</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10736</span>      * Returns the midpoint of a line spanned by two vectors.
<span class='line'>10737</span>      *
<span class='line'>10738</span>      * @static
<span class='line'>10739</span>      * @param {Vector2} vecA A vector spanning the line.
<span class='line'>10740</span>      * @param {Vector2} vecB A vector spanning the line.
<span class='line'>10741</span>      * @returns {Vector2} The midpoint of the line spanned by two vectors.
<span class='line'>10742</span>      */</span><span class="WHIT">
<span class='line'>10743</span> </span><span class="WHIT">  
<span class='line'>10744</span>   
<span class='line'>10745</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">midpoint</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10746</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">vecA.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vecB.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vecA.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vecB.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10747</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10748</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10749</span>      * Returns the normals of a line spanned by two vectors.
<span class='line'>10750</span>      *
<span class='line'>10751</span>      * @static
<span class='line'>10752</span>      * @param {Vector2} vecA A vector spanning the line.
<span class='line'>10753</span>      * @param {Vector2} vecB A vector spanning the line.
<span class='line'>10754</span>      * @returns {Vector2[]} An array containing the two normals, each represented by a vector.
<span class='line'>10755</span>      */</span><span class="WHIT">
<span class='line'>10756</span> </span><span class="WHIT">  
<span class='line'>10757</span>   
<span class='line'>10758</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">normals</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10759</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">delta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">vecB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10760</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">delta.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">delta.x</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">delta.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">delta.x</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10761</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10762</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10763</span>      * Returns the unit (normalized normal) vectors of a line spanned by two vectors.
<span class='line'>10764</span>      *
<span class='line'>10765</span>      * @static
<span class='line'>10766</span>      * @param {Vector2} vecA A vector spanning the line.
<span class='line'>10767</span>      * @param {Vector2} vecB A vector spanning the line.
<span class='line'>10768</span>      * @returns {Vector2[]} An array containing the two unit vectors.
<span class='line'>10769</span>      */</span><span class="WHIT">
<span class='line'>10770</span> </span><span class="WHIT">  
<span class='line'>10771</span>   
<span class='line'>10772</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">units</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10773</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">delta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">vecB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10774</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">delta.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">delta.x</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">delta.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">delta.x</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10775</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10776</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10777</span>      * Divides a vector by another vector and returns the result as new vector.
<span class='line'>10778</span>      *
<span class='line'>10779</span>      * @static
<span class='line'>10780</span>      * @param {Vector2} vecA The dividend.
<span class='line'>10781</span>      * @param {Vector2} vecB The divisor.
<span class='line'>10782</span>      * @returns {Vector2} The fraction of the two vectors.
<span class='line'>10783</span>      */</span><span class="WHIT">
<span class='line'>10784</span> </span><span class="WHIT">  
<span class='line'>10785</span>   
<span class='line'>10786</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">divide</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10787</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">vecA.x</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">vecB.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecA.y</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">vecB.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10788</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10789</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10790</span>      * Divides a vector by a scalar and returns the result as new vector.
<span class='line'>10791</span>      *
<span class='line'>10792</span>      * @static
<span class='line'>10793</span>      * @param {Vector2} vecA The dividend.
<span class='line'>10794</span>      * @param {Number} s The scalar.
<span class='line'>10795</span>      * @returns {Vector2} The fraction of the two vectors.
<span class='line'>10796</span>      */</span><span class="WHIT">
<span class='line'>10797</span> </span><span class="WHIT">  
<span class='line'>10798</span>   
<span class='line'>10799</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">divideScalar</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10800</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">vecA.x</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecA.y</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10801</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10802</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10803</span>      * Returns the dot product of two vectors.
<span class='line'>10804</span>      *
<span class='line'>10805</span>      * @static
<span class='line'>10806</span>      * @param {Vector2} vecA A vector.
<span class='line'>10807</span>      * @param {Vector2} vecB A vector.
<span class='line'>10808</span>      * @returns {Number} The dot product of two vectors.
<span class='line'>10809</span>      */</span><span class="WHIT">
<span class='line'>10810</span> </span><span class="WHIT">  
<span class='line'>10811</span>   
<span class='line'>10812</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">dot</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10813</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vecA.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vecB.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vecA.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vecB.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10814</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10815</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10816</span>      * Returns the angle between two vectors.
<span class='line'>10817</span>      *
<span class='line'>10818</span>      * @static
<span class='line'>10819</span>      * @param {Vector2} vecA A vector.
<span class='line'>10820</span>      * @param {Vector2} vecB A vector.
<span class='line'>10821</span>      * @returns {Number} The angle between two vectors in radians.
<span class='line'>10822</span>      */</span><span class="WHIT">
<span class='line'>10823</span> </span><span class="WHIT">  
<span class='line'>10824</span>   
<span class='line'>10825</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10826</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">dot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.dot</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10827</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.acos</span><span class="PUNC">(</span><span class="NAME">dot</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vecA.length</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">vecB.length</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10828</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10829</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10830</span>      * Returns the angle between two vectors based on a third vector in between.
<span class='line'>10831</span>      *
<span class='line'>10832</span>      * @static
<span class='line'>10833</span>      * @param {Vector2} vecA A vector.
<span class='line'>10834</span>      * @param {Vector2} vecB A (central) vector.
<span class='line'>10835</span>      * @param {Vector2} vecC A vector.
<span class='line'>10836</span>      * @returns {Number} The angle in radians.
<span class='line'>10837</span>      */</span><span class="WHIT">
<span class='line'>10838</span> </span><span class="WHIT">  
<span class='line'>10839</span>   
<span class='line'>10840</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">threePointangle</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10841</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">ab</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">vecB</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecA</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10842</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">vecC</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10843</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">abLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vecA.distance</span><span class="PUNC">(</span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10844</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">bcLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vecB.distance</span><span class="PUNC">(</span><span class="NAME">vecC</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10845</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.acos</span><span class="PUNC">(</span><span class="NAME">Vector2.dot</span><span class="PUNC">(</span><span class="NAME">ab</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">abLength</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">bcLength</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10846</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10847</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10848</span>      * Returns the scalar projection of a vector on another vector.
<span class='line'>10849</span>      *
<span class='line'>10850</span>      * @static
<span class='line'>10851</span>      * @param {Vector2} vecA The vector to be projected.
<span class='line'>10852</span>      * @param {Vector2} vecB The vector to be projection upon.
<span class='line'>10853</span>      * @returns {Number} The scalar component.
<span class='line'>10854</span>      */</span><span class="WHIT">
<span class='line'>10855</span> </span><span class="WHIT">  
<span class='line'>10856</span>   
<span class='line'>10857</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">scalarProjection</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vecB</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10858</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">unit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vecB.normalized</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10859</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Vector2.dot</span><span class="PUNC">(</span><span class="NAME">vecA</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">unit</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10860</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10861</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10862</span>     * Returns the average vector (normalized) of the input vectors.
<span class='line'>10863</span>     *
<span class='line'>10864</span>     * @static
<span class='line'>10865</span>     * @param {Array} vecs An array containing vectors.
<span class='line'>10866</span>     * @returns {Vector2} The resulting vector (normalized).
<span class='line'>10867</span>     */</span><span class="WHIT">
<span class='line'>10868</span> </span><span class="WHIT">  
<span class='line'>10869</span>   
<span class='line'>10870</span>     </span><span class="NAME">static</span><span class="WHIT"> </span><span class="NAME">averageDirection</span><span class="PUNC">(</span><span class="NAME">vecs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10871</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">avg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0.0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10872</span> </span><span class="WHIT">  
<span class='line'>10873</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">vecs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10874</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">vec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vecs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10875</span> </span><span class="WHIT">        </span><span class="NAME">avg.add</span><span class="PUNC">(</span><span class="NAME">vec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10876</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10877</span> </span><span class="WHIT">  
<span class='line'>10878</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">avg.normalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10879</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10880</span> </span><span class="WHIT">  
<span class='line'>10881</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10882</span> </span><span class="WHIT">  
<span class='line'>10883</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10884</span> </span><span class="WHIT">  
<span class='line'>10885</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">19</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">require</span><span class="PUNC">,</span><span class="NAME">module</span><span class="PUNC">,</span><span class="NAME">exports</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10886</span> </span><span class="WHIT">  </span><span class="STRN">"use strict"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10887</span> </span><span class="WHIT">  
<span class='line'>10888</span>   </span><span class="COMM">//@ts-check</span><span class="WHIT">
<span class='line'>10889</span> </span><span class="WHIT">  </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">MathHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./MathHelper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10890</span> </span><span class="WHIT">  
<span class='line'>10891</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">ArrayHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./ArrayHelper'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10892</span> </span><span class="WHIT">  
<span class='line'>10893</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Vector2'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10894</span> </span><span class="WHIT">  
<span class='line'>10895</span>   </span><span class="KEYW">const</span><span class="WHIT"> </span><span class="NAME">Atom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./Atom'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10896</span> </span><span class="WHIT">  </span><span class="COMM">/** 
<span class='line'>10897</span>    * A class representing a vertex.
<span class='line'>10898</span>    * 
<span class='line'>10899</span>    * @property {Number} id The id of this vertex.
<span class='line'>10900</span>    * @property {Atom} value The atom associated with this vertex.
<span class='line'>10901</span>    * @property {Vector2} position The position of this vertex.
<span class='line'>10902</span>    * @property {Vector2} previousPosition The position of the previous vertex.
<span class='line'>10903</span>    * @property {Number|null} parentVertexId The id of the previous vertex.
<span class='line'>10904</span>    * @property {Number[]} children The ids of the children of this vertex.
<span class='line'>10905</span>    * @property {Number[]} spanningTreeChildren The ids of the children of this vertex as defined in the spanning tree defined by the SMILES.
<span class='line'>10906</span>    * @property {Number[]} edges The ids of edges associated with this vertex.
<span class='line'>10907</span>    * @property {Boolean} positioned A boolean indicating whether or not this vertex has been positioned.
<span class='line'>10908</span>    * @property {Number} angle The angle of this vertex.
<span class='line'>10909</span>    * @property {Number} dir The direction of this vertex.
<span class='line'>10910</span>    * @property {Number} neighbourCount The number of neighbouring vertices.
<span class='line'>10911</span>    * @property {Number[]} neighbours The vertex ids of neighbouring vertices.
<span class='line'>10912</span>    * @property {String[]} neighbouringElements The element symbols associated with neighbouring vertices.
<span class='line'>10913</span>    * @property {Boolean} forcePositioned A boolean indicating whether or not this vertex was positioned using a force-based approach.
<span class='line'>10914</span>    */</span><span class="WHIT">
<span class='line'>10915</span> </span><span class="WHIT">  
<span class='line'>10916</span>   
<span class='line'>10917</span>   </span><span class="NAME">class</span><span class="WHIT"> </span><span class="NAME">Vertex</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10918</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10919</span>      * The constructor for the class Vertex.
<span class='line'>10920</span>      *
<span class='line'>10921</span>      * @param {Atom} value The value associated with this vertex.
<span class='line'>10922</span>      * @param {Number} [x=0] The initial x coordinate of the positional vector of this vertex.
<span class='line'>10923</span>      * @param {Number} [y=0] The initial y coordinate of the positional vector of this vertex.
<span class='line'>10924</span>      */</span><span class="WHIT">
<span class='line'>10925</span> </span><span class="WHIT">    </span><span class="NAME">constructor</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10926</span> </span><span class="WHIT">      </span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10927</span> </span><span class="WHIT">      </span><span class="NAME">this.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10928</span> </span><span class="WHIT">      </span><span class="NAME">this.position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10929</span> </span><span class="WHIT">      </span><span class="NAME">this.previousPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10930</span> </span><span class="WHIT">      </span><span class="NAME">this.parentVertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10931</span> </span><span class="WHIT">      </span><span class="NAME">this.children</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10932</span> </span><span class="WHIT">      </span><span class="NAME">this.spanningTreeChildren</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10933</span> </span><span class="WHIT">      </span><span class="NAME">this.edges</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10934</span> </span><span class="WHIT">      </span><span class="NAME">this.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10935</span> </span><span class="WHIT">      </span><span class="NAME">this.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10936</span> </span><span class="WHIT">      </span><span class="NAME">this.dir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10937</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbourCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10938</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10939</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbouringElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10940</span> </span><span class="WHIT">      </span><span class="NAME">this.forcePositioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10941</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10942</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10943</span>      * Set the 2D coordinates of the vertex.
<span class='line'>10944</span>      * 
<span class='line'>10945</span>      * @param {Number} x The x component of the coordinates.
<span class='line'>10946</span>      * @param {Number} y The y component of the coordinates.
<span class='line'>10947</span>      * 
<span class='line'>10948</span>      */</span><span class="WHIT">
<span class='line'>10949</span> </span><span class="WHIT">  
<span class='line'>10950</span>   
<span class='line'>10951</span>     </span><span class="NAME">setPosition</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10952</span> </span><span class="WHIT">      </span><span class="NAME">this.position.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10953</span> </span><span class="WHIT">      </span><span class="NAME">this.position.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10954</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10955</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10956</span>      * Set the 2D coordinates of the vertex from a Vector2.
<span class='line'>10957</span>      * 
<span class='line'>10958</span>      * @param {Vector2} v A 2D vector.
<span class='line'>10959</span>      * 
<span class='line'>10960</span>      */</span><span class="WHIT">
<span class='line'>10961</span> </span><span class="WHIT">  
<span class='line'>10962</span>   
<span class='line'>10963</span>     </span><span class="NAME">setPositionFromVector</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10964</span> </span><span class="WHIT">      </span><span class="NAME">this.position.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10965</span> </span><span class="WHIT">      </span><span class="NAME">this.position.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10966</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10967</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10968</span>      * Add a child vertex id to this vertex.
<span class='line'>10969</span>      * @param {Number} vertexId The id of a vertex to be added as a child to this vertex.
<span class='line'>10970</span>      */</span><span class="WHIT">
<span class='line'>10971</span> </span><span class="WHIT">  
<span class='line'>10972</span>   
<span class='line'>10973</span>     </span><span class="NAME">addChild</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10974</span> </span><span class="WHIT">      </span><span class="NAME">this.children.push</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10975</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbours.push</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10976</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbourCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10977</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10978</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10979</span>      * Add a child vertex id to this vertex as the second child of the neighbours array,
<span class='line'>10980</span>      * except this vertex is the first vertex of the SMILE string, then it is added as the first.
<span class='line'>10981</span>      * This is used to get the correct ordering of neighbours for parity calculations.
<span class='line'>10982</span>      * If a hydrogen is implicitly attached to the chiral center, insert as the third child.
<span class='line'>10983</span>      * @param {Number} vertexId The id of a vertex to be added as a child to this vertex.
<span class='line'>10984</span>      * @param {Number} ringbondIndex The index of the ringbond.
<span class='line'>10985</span>      */</span><span class="WHIT">
<span class='line'>10986</span> </span><span class="WHIT">  
<span class='line'>10987</span>   
<span class='line'>10988</span>     </span><span class="NAME">addRingbondChild</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringbondIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10989</span> </span><span class="WHIT">      </span><span class="NAME">this.children.push</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10990</span> </span><span class="WHIT">  
<span class='line'>10991</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.value.bracket</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10992</span> </span><span class="WHIT">        </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10993</span> </span><span class="WHIT">  
<span class='line'>10994</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.value.bracket.hcount</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10995</span> </span><span class="WHIT">          </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10996</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10997</span> </span><span class="WHIT">  
<span class='line'>10998</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.value.bracket.hcount</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ringbondIndex</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10999</span> </span><span class="WHIT">          </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11000</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11001</span> </span><span class="WHIT">  
<span class='line'>11002</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.value.bracket.hcount</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ringbondIndex</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11003</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.neighbours.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11004</span> </span><span class="WHIT">            </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11005</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11006</span> </span><span class="WHIT">            </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11007</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11008</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11009</span> </span><span class="WHIT">  
<span class='line'>11010</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.value.bracket.hcount</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ringbondIndex</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11011</span> </span><span class="WHIT">          </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11012</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11013</span> </span><span class="WHIT">  
<span class='line'>11014</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.value.bracket.hcount</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ringbondIndex</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11015</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.neighbours.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11016</span> </span><span class="WHIT">            </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11017</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11018</span> </span><span class="WHIT">            </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11019</span> </span><span class="WHIT">          </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11020</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11021</span> </span><span class="WHIT">  
<span class='line'>11022</span>         </span><span class="NAME">this.neighbours.splice</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11023</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11024</span> </span><span class="WHIT">        </span><span class="NAME">this.neighbours.push</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11025</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11026</span> </span><span class="WHIT">  
<span class='line'>11027</span>       </span><span class="NAME">this.neighbourCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11028</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11029</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11030</span>      * Set the vertex id of the parent.
<span class='line'>11031</span>      * 
<span class='line'>11032</span>      * @param {Number} parentVertexId The parents vertex id.
<span class='line'>11033</span>      */</span><span class="WHIT">
<span class='line'>11034</span> </span><span class="WHIT">  
<span class='line'>11035</span>   
<span class='line'>11036</span>     </span><span class="NAME">setParentVertexId</span><span class="PUNC">(</span><span class="NAME">parentVertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11037</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbourCount</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11038</span> </span><span class="WHIT">      </span><span class="NAME">this.parentVertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parentVertexId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11039</span> </span><span class="WHIT">      </span><span class="NAME">this.neighbours.push</span><span class="PUNC">(</span><span class="NAME">parentVertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11040</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11041</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11042</span>      * Returns true if this vertex is terminal (has no parent or child vertices), otherwise returns false. Always returns true if associated value has property hasAttachedPseudoElements set to true.
<span class='line'>11043</span>      *
<span class='line'>11044</span>      * @returns {Boolean} A boolean indicating whether or not this vertex is terminal.
<span class='line'>11045</span>      */</span><span class="WHIT">
<span class='line'>11046</span> </span><span class="WHIT">  
<span class='line'>11047</span>   
<span class='line'>11048</span>     </span><span class="NAME">isTerminal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11049</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.value.hasAttachedPseudoElements</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11050</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11051</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11052</span> </span><span class="WHIT">  
<span class='line'>11053</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.parentVertexId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.children.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.children.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11054</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11055</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11056</span>      * Clones this vertex and returns the clone.
<span class='line'>11057</span>      *
<span class='line'>11058</span>      * @returns {Vertex} A clone of this vertex.
<span class='line'>11059</span>      */</span><span class="WHIT">
<span class='line'>11060</span> </span><span class="WHIT">  
<span class='line'>11061</span>   
<span class='line'>11062</span>     </span><span class="NAME">clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11063</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">clone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vertex</span><span class="PUNC">(</span><span class="NAME">this.value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.position.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.position.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11064</span> </span><span class="WHIT">      </span><span class="NAME">clone.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11065</span> </span><span class="WHIT">      </span><span class="NAME">clone.previousPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Vector2</span><span class="PUNC">(</span><span class="NAME">this.previousPosition.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.previousPosition.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11066</span> </span><span class="WHIT">      </span><span class="NAME">clone.parentVertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.parentVertexId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11067</span> </span><span class="WHIT">      </span><span class="NAME">clone.children</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.clone</span><span class="PUNC">(</span><span class="NAME">this.children</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11068</span> </span><span class="WHIT">      </span><span class="NAME">clone.spanningTreeChildren</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.clone</span><span class="PUNC">(</span><span class="NAME">this.spanningTreeChildren</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11069</span> </span><span class="WHIT">      </span><span class="NAME">clone.edges</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ArrayHelper.clone</span><span class="PUNC">(</span><span class="NAME">this.edges</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11070</span> </span><span class="WHIT">      </span><span class="NAME">clone.positioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.positioned</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11071</span> </span><span class="WHIT">      </span><span class="NAME">clone.angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.angle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11072</span> </span><span class="WHIT">      </span><span class="NAME">clone.forcePositioned</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.forcePositioned</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11073</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">clone</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11074</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11075</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11076</span>      * Returns true if this vertex and the supplied vertex both have the same id, else returns false.
<span class='line'>11077</span>      *
<span class='line'>11078</span>      * @param {Vertex} vertex The vertex to check.
<span class='line'>11079</span>      * @returns {Boolean} A boolean indicating whether or not the two vertices have the same id.
<span class='line'>11080</span>      */</span><span class="WHIT">
<span class='line'>11081</span> </span><span class="WHIT">  
<span class='line'>11082</span>   
<span class='line'>11083</span>     </span><span class="NAME">equals</span><span class="PUNC">(</span><span class="NAME">vertex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11084</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">vertex.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11085</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11086</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11087</span>      * Returns the angle of this vertexes positional vector. If a reference vector is supplied in relations to this vector, else in relations to the coordinate system.
<span class='line'>11088</span>      *
<span class='line'>11089</span>      * @param {Vector2} [referenceVector=null] - The reference vector.
<span class='line'>11090</span>      * @param {Boolean} [returnAsDegrees=false] - If true, returns angle in degrees, else in radians.
<span class='line'>11091</span>      * @returns {Number} The angle of this vertex.
<span class='line'>11092</span>      */</span><span class="WHIT">
<span class='line'>11093</span> </span><span class="WHIT">  
<span class='line'>11094</span>   
<span class='line'>11095</span>     </span><span class="NAME">getAngle</span><span class="PUNC">(</span><span class="NAME">referenceVector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">returnAsDegrees</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11096</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11097</span> </span><span class="WHIT">  
<span class='line'>11098</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">referenceVector</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11099</span> </span><span class="WHIT">        </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">this.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.previousPosition</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11100</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11101</span> </span><span class="WHIT">        </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vector2.subtract</span><span class="PUNC">(</span><span class="NAME">this.position</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceVector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11102</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11103</span> </span><span class="WHIT">  
<span class='line'>11104</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">returnAsDegrees</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11105</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">MathHelper.toDeg</span><span class="PUNC">(</span><span class="NAME">u.angle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11106</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11107</span> </span><span class="WHIT">  
<span class='line'>11108</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">u.angle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11109</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11110</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11111</span>      * Returns the suggested text direction when text is added at the position of this vertex.
<span class='line'>11112</span>      *
<span class='line'>11113</span>      * @param {Vertex[]} vertices The array of vertices for the current molecule.
<span class='line'>11114</span>      * @returns {String} The suggested direction of the text.
<span class='line'>11115</span>      */</span><span class="WHIT">
<span class='line'>11116</span> </span><span class="WHIT">  
<span class='line'>11117</span>   
<span class='line'>11118</span>     </span><span class="NAME">getTextDirection</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11119</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDrawnNeighbours</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11120</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">angles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11121</span> </span><span class="WHIT">  
<span class='line'>11122</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11123</span> </span><span class="WHIT">        </span><span class="NAME">angles.push</span><span class="PUNC">(</span><span class="NAME">this.getAngle</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">position</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11124</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11125</span> </span><span class="WHIT">  
<span class='line'>11126</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">textAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">MathHelper.meanAngle</span><span class="PUNC">(</span><span class="NAME">angles</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Round to 0, 90, 180 or 270 degree</span><span class="WHIT">
<span class='line'>11127</span> </span><span class="WHIT">  
<span class='line'>11128</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">halfPi</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11129</span> </span><span class="WHIT">      </span><span class="NAME">textAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">textAngle</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">halfPi</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">halfPi</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11130</span> </span><span class="WHIT">  
<span class='line'>11131</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">textAngle</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11132</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11133</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">textAngle</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11134</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11135</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">textAngle</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">textAngle</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11136</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'right'</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// is checking for -0 necessary?</span><span class="WHIT">
<span class='line'>11137</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">textAngle</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">textAngle</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11138</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11139</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11140</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// default to down</span><span class="WHIT">
<span class='line'>11141</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11142</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11143</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11144</span>      * Returns an array of ids of neighbouring vertices.
<span class='line'>11145</span>      *
<span class='line'>11146</span>      * @param {Number} [vertexId=null] If a value is supplied, the vertex with this id is excluded from the returned indices.
<span class='line'>11147</span>      * @returns {Number[]} An array containing the ids of neighbouring vertices.
<span class='line'>11148</span>      */</span><span class="WHIT">
<span class='line'>11149</span> </span><span class="WHIT">  
<span class='line'>11150</span>   
<span class='line'>11151</span>     </span><span class="NAME">getNeighbours</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11152</span> </span><span class="WHIT">      </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11153</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.neighbours.slice</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11154</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11155</span> </span><span class="WHIT">  
<span class='line'>11156</span>       </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11157</span> </span><span class="WHIT">  
<span class='line'>11158</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11159</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11160</span> </span><span class="WHIT">          </span><span class="NAME">arr.push</span><span class="PUNC">(</span><span class="NAME">this.neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11161</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11162</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11163</span> </span><span class="WHIT">  
<span class='line'>11164</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11165</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11166</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11167</span>      * Returns an array of ids of neighbouring vertices that will be drawn (vertex.value.isDrawn === true).
<span class='line'>11168</span>      * 
<span class='line'>11169</span>      * @param {Vertex[]} vertices An array containing the vertices associated with the current molecule.
<span class='line'>11170</span>      * @returns {Number[]} An array containing the ids of neighbouring vertices that will be drawn.
<span class='line'>11171</span>      */</span><span class="WHIT">
<span class='line'>11172</span> </span><span class="WHIT">  
<span class='line'>11173</span>   
<span class='line'>11174</span>     </span><span class="NAME">getDrawnNeighbours</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11175</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11176</span> </span><span class="WHIT">  
<span class='line'>11177</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11178</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">this.neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.isDrawn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11179</span> </span><span class="WHIT">          </span><span class="NAME">arr.push</span><span class="PUNC">(</span><span class="NAME">this.neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11180</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11181</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11182</span> </span><span class="WHIT">  
<span class='line'>11183</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11184</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11185</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11186</span>      * Returns the number of neighbours of this vertex.
<span class='line'>11187</span>      *
<span class='line'>11188</span>      * @returns {Number} The number of neighbours.
<span class='line'>11189</span>      */</span><span class="WHIT">
<span class='line'>11190</span> </span><span class="WHIT">  
<span class='line'>11191</span>   
<span class='line'>11192</span>     </span><span class="NAME">getNeighbourCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11193</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.neighbourCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11194</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11195</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11196</span>      * Returns a list of ids of vertices neighbouring this one in the original spanning tree, excluding the ringbond connections.
<span class='line'>11197</span>      *
<span class='line'>11198</span>      * @param {Number} [vertexId=null] If supplied, the vertex with this id is excluded from the array returned.
<span class='line'>11199</span>      * @returns {Number[]} An array containing the ids of the neighbouring vertices.
<span class='line'>11200</span>      */</span><span class="WHIT">
<span class='line'>11201</span> </span><span class="WHIT">  
<span class='line'>11202</span>   
<span class='line'>11203</span>     </span><span class="NAME">getSpanningTreeNeighbours</span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11204</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11205</span> </span><span class="WHIT">  
<span class='line'>11206</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.spanningTreeChildren.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11207</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.spanningTreeChildren</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11208</span> </span><span class="WHIT">          </span><span class="NAME">neighbours.push</span><span class="PUNC">(</span><span class="NAME">this.spanningTreeChildren</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11209</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11210</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11211</span> </span><span class="WHIT">  
<span class='line'>11212</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.parentVertexId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11213</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">vertexId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">this.parentVertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11214</span> </span><span class="WHIT">          </span><span class="NAME">neighbours.push</span><span class="PUNC">(</span><span class="NAME">this.parentVertexId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11215</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11216</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11217</span> </span><span class="WHIT">  
<span class='line'>11218</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11219</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11220</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>11221</span>      * Gets the next vertex in the ring in opposide direction to the supplied vertex id.
<span class='line'>11222</span>      *
<span class='line'>11223</span>      * @param {Vertex[]} vertices The array of vertices for the current molecule.
<span class='line'>11224</span>      * @param {Number} ringId The id of the ring containing this vertex.
<span class='line'>11225</span>      * @param {Number} previousVertexId The id of the previous vertex. The next vertex will be opposite from the vertex with this id as seen from this vertex.
<span class='line'>11226</span>      * @returns {Number} The id of the next vertex in the ring.
<span class='line'>11227</span>      */</span><span class="WHIT">
<span class='line'>11228</span> </span><span class="WHIT">  
<span class='line'>11229</span>   
<span class='line'>11230</span>     </span><span class="NAME">getNextInRing</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">previousVertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11231</span> </span><span class="WHIT">      </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getNeighbours</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11232</span> </span><span class="WHIT">  
<span class='line'>11233</span>       </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">neighbours.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11234</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ArrayHelper.contains</span><span class="PUNC">(</span><span class="NAME">vertices</span><span class="PUNC">[</span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.rings</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11235</span> </span><span class="WHIT">          </span><span class="NAME">value</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ringId</span><span class="WHIT">
<span class='line'>11236</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">previousVertexId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>11237</span> </span><span class="WHIT">          </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">neighbours</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11238</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11239</span> </span><span class="WHIT">      </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11240</span> </span><span class="WHIT">  
<span class='line'>11241</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11242</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11243</span> </span><span class="WHIT">  
<span class='line'>11244</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>11245</span> </span><span class="WHIT">  
<span class='line'>11246</span>   </span><span class="NAME">module.exports</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Vertex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>11247</span> </span><span class="WHIT">  
<span class='line'>11248</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="STRN">"./ArrayHelper"</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">"./Atom"</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="STRN">"./MathHelper"</span><span class="PUNC">:</span><span class="NUMB">9</span><span class="PUNC">,</span><span class="STRN">"./Vector2"</span><span class="PUNC">:</span><span class="NUMB">18</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>11249</span> </span><span class="WHIT">  
<span class='line'>11250</span>   </span></pre></body></html>